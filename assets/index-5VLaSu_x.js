(function(){const re=document.createElement("link").relList;if(re&&re.supports&&re.supports("modulepreload"))return;for(const _e of document.querySelectorAll('link[rel="modulepreload"]'))Y(_e);new MutationObserver(_e=>{for(const Je of _e)if(Je.type==="childList")for(const D of Je.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&Y(D)}).observe(document,{childList:!0,subtree:!0});function ye(_e){const Je={};return _e.integrity&&(Je.integrity=_e.integrity),_e.referrerPolicy&&(Je.referrerPolicy=_e.referrerPolicy),_e.crossOrigin==="use-credentials"?Je.credentials="include":_e.crossOrigin==="anonymous"?Je.credentials="omit":Je.credentials="same-origin",Je}function Y(_e){if(_e.ep)return;_e.ep=!0;const Je=ye(_e);fetch(_e.href,Je)}})();function _m(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}var Pp={exports:{}},yf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zp;function ym(){if(Zp)return yf;Zp=1;var Z=Symbol.for("react.transitional.element"),re=Symbol.for("react.fragment");function ye(Y,_e,Je){var D=null;if(Je!==void 0&&(D=""+Je),_e.key!==void 0&&(D=""+_e.key),"key"in _e){Je={};for(var d in _e)d!=="key"&&(Je[d]=_e[d])}else Je=_e;return _e=Je.ref,{$$typeof:Z,type:Y,key:D,ref:_e!==void 0?_e:null,props:Je}}return yf.Fragment=re,yf.jsx=ye,yf.jsxs=ye,yf}var Gp;function vm(){return Gp||(Gp=1,Pp.exports=ym()),Pp.exports}var fn=vm(),Rp={exports:{}},ni={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qp;function xm(){if(qp)return ni;qp=1;var Z=Symbol.for("react.transitional.element"),re=Symbol.for("react.portal"),ye=Symbol.for("react.fragment"),Y=Symbol.for("react.strict_mode"),_e=Symbol.for("react.profiler"),Je=Symbol.for("react.consumer"),D=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),Re=Symbol.for("react.suspense"),Ie=Symbol.for("react.memo"),Ye=Symbol.for("react.lazy"),et=Symbol.iterator;function Ue(ue){return ue===null||typeof ue!="object"?null:(ue=et&&ue[et]||ue["@@iterator"],typeof ue=="function"?ue:null)}var ve={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Nt=Object.assign,Gt={};function Ht(ue,Ne,lt){this.props=ue,this.context=Ne,this.refs=Gt,this.updater=lt||ve}Ht.prototype.isReactComponent={},Ht.prototype.setState=function(ue,Ne){if(typeof ue!="object"&&typeof ue!="function"&&ue!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ue,Ne,"setState")},Ht.prototype.forceUpdate=function(ue){this.updater.enqueueForceUpdate(this,ue,"forceUpdate")};function pi(){}pi.prototype=Ht.prototype;function zt(ue,Ne,lt){this.props=ue,this.context=Ne,this.refs=Gt,this.updater=lt||ve}var Ct=zt.prototype=new pi;Ct.constructor=zt,Nt(Ct,Ht.prototype),Ct.isPureReactComponent=!0;var ii=Array.isArray,mt={H:null,A:null,T:null,S:null,V:null},Qt=Object.prototype.hasOwnProperty;function vi(ue,Ne,lt,at,xt,Jt){return lt=Jt.ref,{$$typeof:Z,type:ue,key:Ne,ref:lt!==void 0?lt:null,props:Jt}}function Oi(ue,Ne){return vi(ue.type,Ne,void 0,void 0,void 0,ue.props)}function Ji(ue){return typeof ue=="object"&&ue!==null&&ue.$$typeof===Z}function xi(ue){var Ne={"=":"=0",":":"=2"};return"$"+ue.replace(/[=:]/g,function(lt){return Ne[lt]})}var on=/\/+/g;function ri(ue,Ne){return typeof ue=="object"&&ue!==null&&ue.key!=null?xi(""+ue.key):Ne.toString(36)}function Xn(){}function pn(ue){switch(ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason;default:switch(typeof ue.status=="string"?ue.then(Xn,Xn):(ue.status="pending",ue.then(function(Ne){ue.status==="pending"&&(ue.status="fulfilled",ue.value=Ne)},function(Ne){ue.status==="pending"&&(ue.status="rejected",ue.reason=Ne)})),ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason}}throw ue}function Zi(ue,Ne,lt,at,xt){var Jt=typeof ue;(Jt==="undefined"||Jt==="boolean")&&(ue=null);var bt=!1;if(ue===null)bt=!0;else switch(Jt){case"bigint":case"string":case"number":bt=!0;break;case"object":switch(ue.$$typeof){case Z:case re:bt=!0;break;case Ye:return bt=ue._init,Zi(bt(ue._payload),Ne,lt,at,xt)}}if(bt)return xt=xt(ue),bt=at===""?"."+ri(ue,0):at,ii(xt)?(lt="",bt!=null&&(lt=bt.replace(on,"$&/")+"/"),Zi(xt,Ne,lt,"",function(jn){return jn})):xt!=null&&(Ji(xt)&&(xt=Oi(xt,lt+(xt.key==null||ue&&ue.key===xt.key?"":(""+xt.key).replace(on,"$&/")+"/")+bt)),Ne.push(xt)),1;bt=0;var Fn=at===""?".":at+":";if(ii(ue))for(var si=0;si<ue.length;si++)at=ue[si],Jt=Fn+ri(at,si),bt+=Zi(at,Ne,lt,Jt,xt);else if(si=Ue(ue),typeof si=="function")for(ue=si.call(ue),si=0;!(at=ue.next()).done;)at=at.value,Jt=Fn+ri(at,si++),bt+=Zi(at,Ne,lt,Jt,xt);else if(Jt==="object"){if(typeof ue.then=="function")return Zi(pn(ue),Ne,lt,at,xt);throw Ne=String(ue),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.")}return bt}function Be(ue,Ne,lt){if(ue==null)return ue;var at=[],xt=0;return Zi(ue,at,"","",function(Jt){return Ne.call(lt,Jt,xt++)}),at}function ot(ue){if(ue._status===-1){var Ne=ue._result;Ne=Ne(),Ne.then(function(lt){(ue._status===0||ue._status===-1)&&(ue._status=1,ue._result=lt)},function(lt){(ue._status===0||ue._status===-1)&&(ue._status=2,ue._result=lt)}),ue._status===-1&&(ue._status=0,ue._result=Ne)}if(ue._status===1)return ue._result.default;throw ue._result}var At=typeof reportError=="function"?reportError:function(ue){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ne=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ue=="object"&&ue!==null&&typeof ue.message=="string"?String(ue.message):String(ue),error:ue});if(!window.dispatchEvent(Ne))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ue);return}console.error(ue)};function Tt(){}return ni.Children={map:Be,forEach:function(ue,Ne,lt){Be(ue,function(){Ne.apply(this,arguments)},lt)},count:function(ue){var Ne=0;return Be(ue,function(){Ne++}),Ne},toArray:function(ue){return Be(ue,function(Ne){return Ne})||[]},only:function(ue){if(!Ji(ue))throw Error("React.Children.only expected to receive a single React element child.");return ue}},ni.Component=Ht,ni.Fragment=ye,ni.Profiler=_e,ni.PureComponent=zt,ni.StrictMode=Y,ni.Suspense=Re,ni.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=mt,ni.__COMPILER_RUNTIME={__proto__:null,c:function(ue){return mt.H.useMemoCache(ue)}},ni.cache=function(ue){return function(){return ue.apply(null,arguments)}},ni.cloneElement=function(ue,Ne,lt){if(ue==null)throw Error("The argument must be a React element, but you passed "+ue+".");var at=Nt({},ue.props),xt=ue.key,Jt=void 0;if(Ne!=null)for(bt in Ne.ref!==void 0&&(Jt=void 0),Ne.key!==void 0&&(xt=""+Ne.key),Ne)!Qt.call(Ne,bt)||bt==="key"||bt==="__self"||bt==="__source"||bt==="ref"&&Ne.ref===void 0||(at[bt]=Ne[bt]);var bt=arguments.length-2;if(bt===1)at.children=lt;else if(1<bt){for(var Fn=Array(bt),si=0;si<bt;si++)Fn[si]=arguments[si+2];at.children=Fn}return vi(ue.type,xt,void 0,void 0,Jt,at)},ni.createContext=function(ue){return ue={$$typeof:D,_currentValue:ue,_currentValue2:ue,_threadCount:0,Provider:null,Consumer:null},ue.Provider=ue,ue.Consumer={$$typeof:Je,_context:ue},ue},ni.createElement=function(ue,Ne,lt){var at,xt={},Jt=null;if(Ne!=null)for(at in Ne.key!==void 0&&(Jt=""+Ne.key),Ne)Qt.call(Ne,at)&&at!=="key"&&at!=="__self"&&at!=="__source"&&(xt[at]=Ne[at]);var bt=arguments.length-2;if(bt===1)xt.children=lt;else if(1<bt){for(var Fn=Array(bt),si=0;si<bt;si++)Fn[si]=arguments[si+2];xt.children=Fn}if(ue&&ue.defaultProps)for(at in bt=ue.defaultProps,bt)xt[at]===void 0&&(xt[at]=bt[at]);return vi(ue,Jt,void 0,void 0,null,xt)},ni.createRef=function(){return{current:null}},ni.forwardRef=function(ue){return{$$typeof:d,render:ue}},ni.isValidElement=Ji,ni.lazy=function(ue){return{$$typeof:Ye,_payload:{_status:-1,_result:ue},_init:ot}},ni.memo=function(ue,Ne){return{$$typeof:Ie,type:ue,compare:Ne===void 0?null:Ne}},ni.startTransition=function(ue){var Ne=mt.T,lt={};mt.T=lt;try{var at=ue(),xt=mt.S;xt!==null&&xt(lt,at),typeof at=="object"&&at!==null&&typeof at.then=="function"&&at.then(Tt,At)}catch(Jt){At(Jt)}finally{mt.T=Ne}},ni.unstable_useCacheRefresh=function(){return mt.H.useCacheRefresh()},ni.use=function(ue){return mt.H.use(ue)},ni.useActionState=function(ue,Ne,lt){return mt.H.useActionState(ue,Ne,lt)},ni.useCallback=function(ue,Ne){return mt.H.useCallback(ue,Ne)},ni.useContext=function(ue){return mt.H.useContext(ue)},ni.useDebugValue=function(){},ni.useDeferredValue=function(ue,Ne){return mt.H.useDeferredValue(ue,Ne)},ni.useEffect=function(ue,Ne,lt){var at=mt.H;if(typeof lt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return at.useEffect(ue,Ne)},ni.useId=function(){return mt.H.useId()},ni.useImperativeHandle=function(ue,Ne,lt){return mt.H.useImperativeHandle(ue,Ne,lt)},ni.useInsertionEffect=function(ue,Ne){return mt.H.useInsertionEffect(ue,Ne)},ni.useLayoutEffect=function(ue,Ne){return mt.H.useLayoutEffect(ue,Ne)},ni.useMemo=function(ue,Ne){return mt.H.useMemo(ue,Ne)},ni.useOptimistic=function(ue,Ne){return mt.H.useOptimistic(ue,Ne)},ni.useReducer=function(ue,Ne,lt){return mt.H.useReducer(ue,Ne,lt)},ni.useRef=function(ue){return mt.H.useRef(ue)},ni.useState=function(ue){return mt.H.useState(ue)},ni.useSyncExternalStore=function(ue,Ne,lt){return mt.H.useSyncExternalStore(ue,Ne,lt)},ni.useTransition=function(){return mt.H.useTransition()},ni.version="19.1.1",ni}var Hp;function jp(){return Hp||(Hp=1,Rp.exports=xm()),Rp.exports}var rt=jp(),Dp={exports:{}},vf={},Ip={exports:{}},kp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $p;function bm(){return $p||($p=1,(function(Z){function re(Be,ot){var At=Be.length;Be.push(ot);e:for(;0<At;){var Tt=At-1>>>1,ue=Be[Tt];if(0<_e(ue,ot))Be[Tt]=ot,Be[At]=ue,At=Tt;else break e}}function ye(Be){return Be.length===0?null:Be[0]}function Y(Be){if(Be.length===0)return null;var ot=Be[0],At=Be.pop();if(At!==ot){Be[0]=At;e:for(var Tt=0,ue=Be.length,Ne=ue>>>1;Tt<Ne;){var lt=2*(Tt+1)-1,at=Be[lt],xt=lt+1,Jt=Be[xt];if(0>_e(at,At))xt<ue&&0>_e(Jt,at)?(Be[Tt]=Jt,Be[xt]=At,Tt=xt):(Be[Tt]=at,Be[lt]=At,Tt=lt);else if(xt<ue&&0>_e(Jt,At))Be[Tt]=Jt,Be[xt]=At,Tt=xt;else break e}}return ot}function _e(Be,ot){var At=Be.sortIndex-ot.sortIndex;return At!==0?At:Be.id-ot.id}if(Z.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var Je=performance;Z.unstable_now=function(){return Je.now()}}else{var D=Date,d=D.now();Z.unstable_now=function(){return D.now()-d}}var Re=[],Ie=[],Ye=1,et=null,Ue=3,ve=!1,Nt=!1,Gt=!1,Ht=!1,pi=typeof setTimeout=="function"?setTimeout:null,zt=typeof clearTimeout=="function"?clearTimeout:null,Ct=typeof setImmediate<"u"?setImmediate:null;function ii(Be){for(var ot=ye(Ie);ot!==null;){if(ot.callback===null)Y(Ie);else if(ot.startTime<=Be)Y(Ie),ot.sortIndex=ot.expirationTime,re(Re,ot);else break;ot=ye(Ie)}}function mt(Be){if(Gt=!1,ii(Be),!Nt)if(ye(Re)!==null)Nt=!0,Qt||(Qt=!0,ri());else{var ot=ye(Ie);ot!==null&&Zi(mt,ot.startTime-Be)}}var Qt=!1,vi=-1,Oi=5,Ji=-1;function xi(){return Ht?!0:!(Z.unstable_now()-Ji<Oi)}function on(){if(Ht=!1,Qt){var Be=Z.unstable_now();Ji=Be;var ot=!0;try{e:{Nt=!1,Gt&&(Gt=!1,zt(vi),vi=-1),ve=!0;var At=Ue;try{t:{for(ii(Be),et=ye(Re);et!==null&&!(et.expirationTime>Be&&xi());){var Tt=et.callback;if(typeof Tt=="function"){et.callback=null,Ue=et.priorityLevel;var ue=Tt(et.expirationTime<=Be);if(Be=Z.unstable_now(),typeof ue=="function"){et.callback=ue,ii(Be),ot=!0;break t}et===ye(Re)&&Y(Re),ii(Be)}else Y(Re);et=ye(Re)}if(et!==null)ot=!0;else{var Ne=ye(Ie);Ne!==null&&Zi(mt,Ne.startTime-Be),ot=!1}}break e}finally{et=null,Ue=At,ve=!1}ot=void 0}}finally{ot?ri():Qt=!1}}}var ri;if(typeof Ct=="function")ri=function(){Ct(on)};else if(typeof MessageChannel<"u"){var Xn=new MessageChannel,pn=Xn.port2;Xn.port1.onmessage=on,ri=function(){pn.postMessage(null)}}else ri=function(){pi(on,0)};function Zi(Be,ot){vi=pi(function(){Be(Z.unstable_now())},ot)}Z.unstable_IdlePriority=5,Z.unstable_ImmediatePriority=1,Z.unstable_LowPriority=4,Z.unstable_NormalPriority=3,Z.unstable_Profiling=null,Z.unstable_UserBlockingPriority=2,Z.unstable_cancelCallback=function(Be){Be.callback=null},Z.unstable_forceFrameRate=function(Be){0>Be||125<Be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Oi=0<Be?Math.floor(1e3/Be):5},Z.unstable_getCurrentPriorityLevel=function(){return Ue},Z.unstable_next=function(Be){switch(Ue){case 1:case 2:case 3:var ot=3;break;default:ot=Ue}var At=Ue;Ue=ot;try{return Be()}finally{Ue=At}},Z.unstable_requestPaint=function(){Ht=!0},Z.unstable_runWithPriority=function(Be,ot){switch(Be){case 1:case 2:case 3:case 4:case 5:break;default:Be=3}var At=Ue;Ue=Be;try{return ot()}finally{Ue=At}},Z.unstable_scheduleCallback=function(Be,ot,At){var Tt=Z.unstable_now();switch(typeof At=="object"&&At!==null?(At=At.delay,At=typeof At=="number"&&0<At?Tt+At:Tt):At=Tt,Be){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=At+ue,Be={id:Ye++,callback:ot,priorityLevel:Be,startTime:At,expirationTime:ue,sortIndex:-1},At>Tt?(Be.sortIndex=At,re(Ie,Be),ye(Re)===null&&Be===ye(Ie)&&(Gt?(zt(vi),vi=-1):Gt=!0,Zi(mt,At-Tt))):(Be.sortIndex=ue,re(Re,Be),Nt||ve||(Nt=!0,Qt||(Qt=!0,ri()))),Be},Z.unstable_shouldYield=xi,Z.unstable_wrapCallback=function(Be){var ot=Ue;return function(){var At=Ue;Ue=ot;try{return Be.apply(this,arguments)}finally{Ue=At}}}})(kp)),kp}var Xp;function wm(){return Xp||(Xp=1,Ip.exports=bm()),Ip.exports}var Lp={exports:{}},ca={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yp;function Tm(){if(Yp)return ca;Yp=1;var Z=jp();function re(Re){var Ie="https://react.dev/errors/"+Re;if(1<arguments.length){Ie+="?args[]="+encodeURIComponent(arguments[1]);for(var Ye=2;Ye<arguments.length;Ye++)Ie+="&args[]="+encodeURIComponent(arguments[Ye])}return"Minified React error #"+Re+"; visit "+Ie+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function ye(){}var Y={d:{f:ye,r:function(){throw Error(re(522))},D:ye,C:ye,L:ye,m:ye,X:ye,S:ye,M:ye},p:0,findDOMNode:null},_e=Symbol.for("react.portal");function Je(Re,Ie,Ye){var et=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_e,key:et==null?null:""+et,children:Re,containerInfo:Ie,implementation:Ye}}var D=Z.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(Re,Ie){if(Re==="font")return"";if(typeof Ie=="string")return Ie==="use-credentials"?Ie:""}return ca.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Y,ca.createPortal=function(Re,Ie){var Ye=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ie||Ie.nodeType!==1&&Ie.nodeType!==9&&Ie.nodeType!==11)throw Error(re(299));return Je(Re,Ie,null,Ye)},ca.flushSync=function(Re){var Ie=D.T,Ye=Y.p;try{if(D.T=null,Y.p=2,Re)return Re()}finally{D.T=Ie,Y.p=Ye,Y.d.f()}},ca.preconnect=function(Re,Ie){typeof Re=="string"&&(Ie?(Ie=Ie.crossOrigin,Ie=typeof Ie=="string"?Ie==="use-credentials"?Ie:"":void 0):Ie=null,Y.d.C(Re,Ie))},ca.prefetchDNS=function(Re){typeof Re=="string"&&Y.d.D(Re)},ca.preinit=function(Re,Ie){if(typeof Re=="string"&&Ie&&typeof Ie.as=="string"){var Ye=Ie.as,et=d(Ye,Ie.crossOrigin),Ue=typeof Ie.integrity=="string"?Ie.integrity:void 0,ve=typeof Ie.fetchPriority=="string"?Ie.fetchPriority:void 0;Ye==="style"?Y.d.S(Re,typeof Ie.precedence=="string"?Ie.precedence:void 0,{crossOrigin:et,integrity:Ue,fetchPriority:ve}):Ye==="script"&&Y.d.X(Re,{crossOrigin:et,integrity:Ue,fetchPriority:ve,nonce:typeof Ie.nonce=="string"?Ie.nonce:void 0})}},ca.preinitModule=function(Re,Ie){if(typeof Re=="string")if(typeof Ie=="object"&&Ie!==null){if(Ie.as==null||Ie.as==="script"){var Ye=d(Ie.as,Ie.crossOrigin);Y.d.M(Re,{crossOrigin:Ye,integrity:typeof Ie.integrity=="string"?Ie.integrity:void 0,nonce:typeof Ie.nonce=="string"?Ie.nonce:void 0})}}else Ie==null&&Y.d.M(Re)},ca.preload=function(Re,Ie){if(typeof Re=="string"&&typeof Ie=="object"&&Ie!==null&&typeof Ie.as=="string"){var Ye=Ie.as,et=d(Ye,Ie.crossOrigin);Y.d.L(Re,Ye,{crossOrigin:et,integrity:typeof Ie.integrity=="string"?Ie.integrity:void 0,nonce:typeof Ie.nonce=="string"?Ie.nonce:void 0,type:typeof Ie.type=="string"?Ie.type:void 0,fetchPriority:typeof Ie.fetchPriority=="string"?Ie.fetchPriority:void 0,referrerPolicy:typeof Ie.referrerPolicy=="string"?Ie.referrerPolicy:void 0,imageSrcSet:typeof Ie.imageSrcSet=="string"?Ie.imageSrcSet:void 0,imageSizes:typeof Ie.imageSizes=="string"?Ie.imageSizes:void 0,media:typeof Ie.media=="string"?Ie.media:void 0})}},ca.preloadModule=function(Re,Ie){if(typeof Re=="string")if(Ie){var Ye=d(Ie.as,Ie.crossOrigin);Y.d.m(Re,{as:typeof Ie.as=="string"&&Ie.as!=="script"?Ie.as:void 0,crossOrigin:Ye,integrity:typeof Ie.integrity=="string"?Ie.integrity:void 0})}else Y.d.m(Re)},ca.requestFormReset=function(Re){Y.d.r(Re)},ca.unstable_batchedUpdates=function(Re,Ie){return Re(Ie)},ca.useFormState=function(Re,Ie,Ye){return D.H.useFormState(Re,Ie,Ye)},ca.useFormStatus=function(){return D.H.useHostTransitionStatus()},ca.version="19.1.1",ca}var Kp;function lm(){if(Kp)return Lp.exports;Kp=1;function Z(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Z)}catch(re){console.error(re)}}return Z(),Lp.exports=Tm(),Lp.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wp;function Sm(){if(Wp)return vf;Wp=1;var Z=wm(),re=jp(),ye=lm();function Y(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function _e(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Je(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function D(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function d(i){if(Je(i)!==i)throw Error(Y(188))}function Re(i){var s=i.alternate;if(!s){if(s=Je(i),s===null)throw Error(Y(188));return s!==i?null:i}for(var c=i,p=s;;){var x=c.return;if(x===null)break;var M=x.alternate;if(M===null){if(p=x.return,p!==null){c=p;continue}break}if(x.child===M.child){for(M=x.child;M;){if(M===c)return d(x),i;if(M===p)return d(x),s;M=M.sibling}throw Error(Y(188))}if(c.return!==p.return)c=x,p=M;else{for(var k=!1,V=x.child;V;){if(V===c){k=!0,c=x,p=M;break}if(V===p){k=!0,p=x,c=M;break}V=V.sibling}if(!k){for(V=M.child;V;){if(V===c){k=!0,c=M,p=x;break}if(V===p){k=!0,p=M,c=x;break}V=V.sibling}if(!k)throw Error(Y(189))}}if(c.alternate!==p)throw Error(Y(190))}if(c.tag!==3)throw Error(Y(188));return c.stateNode.current===c?i:s}function Ie(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=Ie(i),s!==null)return s;i=i.sibling}return null}var Ye=Object.assign,et=Symbol.for("react.element"),Ue=Symbol.for("react.transitional.element"),ve=Symbol.for("react.portal"),Nt=Symbol.for("react.fragment"),Gt=Symbol.for("react.strict_mode"),Ht=Symbol.for("react.profiler"),pi=Symbol.for("react.provider"),zt=Symbol.for("react.consumer"),Ct=Symbol.for("react.context"),ii=Symbol.for("react.forward_ref"),mt=Symbol.for("react.suspense"),Qt=Symbol.for("react.suspense_list"),vi=Symbol.for("react.memo"),Oi=Symbol.for("react.lazy"),Ji=Symbol.for("react.activity"),xi=Symbol.for("react.memo_cache_sentinel"),on=Symbol.iterator;function ri(i){return i===null||typeof i!="object"?null:(i=on&&i[on]||i["@@iterator"],typeof i=="function"?i:null)}var Xn=Symbol.for("react.client.reference");function pn(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===Xn?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Nt:return"Fragment";case Ht:return"Profiler";case Gt:return"StrictMode";case mt:return"Suspense";case Qt:return"SuspenseList";case Ji:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case ve:return"Portal";case Ct:return(i.displayName||"Context")+".Provider";case zt:return(i._context.displayName||"Context")+".Consumer";case ii:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case vi:return s=i.displayName||null,s!==null?s:pn(i.type)||"Memo";case Oi:s=i._payload,i=i._init;try{return pn(i(s))}catch{}}return null}var Zi=Array.isArray,Be=re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ot=ye.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,At={pending:!1,data:null,method:null,action:null},Tt=[],ue=-1;function Ne(i){return{current:i}}function lt(i){0>ue||(i.current=Tt[ue],Tt[ue]=null,ue--)}function at(i,s){ue++,Tt[ue]=i.current,i.current=s}var xt=Ne(null),Jt=Ne(null),bt=Ne(null),Fn=Ne(null);function si(i,s){switch(at(bt,s),at(Jt,i),at(xt,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?Tc(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=Tc(s),i=hu(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}lt(xt),at(xt,i)}function jn(){lt(xt),lt(Jt),lt(bt)}function As(i){i.memoizedState!==null&&at(Fn,i);var s=xt.current,c=hu(s,i.type);s!==c&&(at(Jt,i),at(xt,c))}function es(i){Jt.current===i&&(lt(xt),lt(Jt)),Fn.current===i&&(lt(Fn),z._currentValue=At)}var gr=Object.prototype.hasOwnProperty,Yi=Z.unstable_scheduleCallback,en=Z.unstable_cancelCallback,ua=Z.unstable_shouldYield,Da=Z.unstable_requestPaint,rr=Z.unstable_now,Ia=Z.unstable_getCurrentPriorityLevel,ha=Z.unstable_ImmediatePriority,eo=Z.unstable_UserBlockingPriority,da=Z.unstable_NormalPriority,zs=Z.unstable_LowPriority,ts=Z.unstable_IdlePriority,to=Z.log,Ps=Z.unstable_setDisableYieldValue,ta=null,Mn=null;function Nr(i){if(typeof to=="function"&&Ps(i),Mn&&typeof Mn.setStrictMode=="function")try{Mn.setStrictMode(ta,i)}catch{}}var ce=Math.clz32?Math.clz32:G,F=Math.log,j=Math.LN2;function G(i){return i>>>=0,i===0?32:31-(F(i)/j|0)|0}var ie=256,se=4194304;function he(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Me(i,s,c){var p=i.pendingLanes;if(p===0)return 0;var x=0,M=i.suspendedLanes,k=i.pingedLanes;i=i.warmLanes;var V=p&134217727;return V!==0?(p=V&~M,p!==0?x=he(p):(k&=V,k!==0?x=he(k):c||(c=V&~i,c!==0&&(x=he(c))))):(V=p&~M,V!==0?x=he(V):k!==0?x=he(k):c||(c=p&~i,c!==0&&(x=he(c)))),x===0?0:s!==0&&s!==x&&(s&M)===0&&(M=x&-x,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:x}function fe(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function ke(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qe(){var i=ie;return ie<<=1,(ie&4194048)===0&&(ie=256),i}function Oe(){var i=se;return se<<=1,(se&62914560)===0&&(se=4194304),i}function ct(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function ge(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Pt(i,s,c,p,x,M){var k=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var V=i.entanglements,ae=i.expirationTimes,Ee=i.hiddenUpdates;for(c=k&~c;0<c;){var je=31-ce(c),Ge=1<<je;V[je]=0,ae[je]=-1;var ze=Ee[je];if(ze!==null)for(Ee[je]=null,je=0;je<ze.length;je++){var De=ze[je];De!==null&&(De.lane&=-536870913)}c&=~Ge}p!==0&&Xt(i,p,0),M!==0&&x===0&&i.tag!==0&&(i.suspendedLanes|=M&~(k&~s))}function Xt(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var p=31-ce(s);i.entangledLanes|=s,i.entanglements[p]=i.entanglements[p]|1073741824|c&4194090}function _t(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var p=31-ce(c),x=1<<p;x&s|i[p]&s&&(i[p]|=s),c&=~x}}function Lt(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function bi(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function En(){var i=ot.p;return i!==0?i:(i=window.event,i===void 0?32:it(i.type))}function Pn(i,s){var c=ot.p;try{return ot.p=i,s()}finally{ot.p=c}}var Ei=Math.random().toString(36).slice(2),St="__reactFiber$"+Ei,Rt="__reactProps$"+Ei,Gi="__reactContainer$"+Ei,He="__reactEvents$"+Ei,ar="__reactListeners$"+Ei,tn="__reactHandles$"+Ei,is="__reactResources$"+Ei,ka="__reactMarker$"+Ei;function nt(i){delete i[St],delete i[Rt],delete i[He],delete i[ar],delete i[tn]}function jt(i){var s=i[St];if(s)return s;for(var c=i.parentNode;c;){if(s=c[Gi]||c[St]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=pf(i);i!==null;){if(c=i[St])return c;i=pf(i)}return s}i=c,c=i.parentNode}return null}function kt(i){if(i=i[St]||i[Gi]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function mn(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(Y(33))}function ia(i){var s=i[is];return s||(s=i[is]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function qi(i){i[ka]=!0}var Ut=new Set,Ll={};function Dr(i,s){ns(i,s),ns(i+"Capture",s)}function ns(i,s){for(Ll[i]=s,i=0;i<s.length;i++)Ut.add(s[i])}var La=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),io={},nn={};function Ec(i){return gr.call(nn,i)?!0:gr.call(io,i)?!1:La.test(i)?nn[i]=!0:(io[i]=!0,!1)}function Yn(i,s,c){if(Ec(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var p=s.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function mi(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function Ba(i,s,c,p){if(p===null)i.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+p)}}var no,Cc;function Vr(i){if(no===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);no=s&&s[1]||"",Cc=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+no+i+Cc}var Oa=!1;function Bl(i,s){if(!i||Oa)return"";Oa=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(s){var Ge=function(){throw Error()};if(Object.defineProperty(Ge.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ge,[])}catch(De){var ze=De}Reflect.construct(i,[],Ge)}else{try{Ge.call()}catch(De){ze=De}i.call(Ge.prototype)}}else{try{throw Error()}catch(De){ze=De}(Ge=i())&&typeof Ge.catch=="function"&&Ge.catch(function(){})}}catch(De){if(De&&ze&&typeof De.stack=="string")return[De.stack,ze.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=p.DetermineComponentFrameRoot(),k=M[0],V=M[1];if(k&&V){var ae=k.split(`
`),Ee=V.split(`
`);for(x=p=0;p<ae.length&&!ae[p].includes("DetermineComponentFrameRoot");)p++;for(;x<Ee.length&&!Ee[x].includes("DetermineComponentFrameRoot");)x++;if(p===ae.length||x===Ee.length)for(p=ae.length-1,x=Ee.length-1;1<=p&&0<=x&&ae[p]!==Ee[x];)x--;for(;1<=p&&0<=x;p--,x--)if(ae[p]!==Ee[x]){if(p!==1||x!==1)do if(p--,x--,0>x||ae[p]!==Ee[x]){var je=`
`+ae[p].replace(" at new "," at ");return i.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",i.displayName)),je}while(1<=p&&0<=x);break}}}finally{Oa=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?Vr(c):""}function Sh(i){switch(i.tag){case 26:case 27:case 5:return Vr(i.type);case 16:return Vr("Lazy");case 13:return Vr("Suspense");case 19:return Vr("SuspenseList");case 0:case 15:return Bl(i.type,!1);case 11:return Bl(i.type.render,!1);case 1:return Bl(i.type,!0);case 31:return Vr("Activity");default:return""}}function vu(i){try{var s="";do s+=Sh(i),i=i.return;while(i);return s}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function Kn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function xu(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function ud(i){var s=xu(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),p=""+i[s];if(!i.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var x=c.get,M=c.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return x.call(this)},set:function(k){p=""+k,M.call(this,k)}}),Object.defineProperty(i,s,{enumerable:c.enumerable}),{getValue:function(){return p},setValue:function(k){p=""+k},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Ac(i){i._valueTracker||(i._valueTracker=ud(i))}function Mh(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),p="";return i&&(p=xu(i)?i.checked?"true":"false":i.value),i=p,i!==c?(s.setValue(i),!0):!1}function $o(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Xo=/[\n"\\]/g;function Ir(i){return i.replace(Xo,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Ol(i,s,c,p,x,M,k,V){i.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?i.type=k:i.removeAttribute("type"),s!=null?k==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+Kn(s)):i.value!==""+Kn(s)&&(i.value=""+Kn(s)):k!=="submit"&&k!=="reset"||i.removeAttribute("value"),s!=null?Fl(i,k,Kn(s)):c!=null?Fl(i,k,Kn(c)):p!=null&&i.removeAttribute("value"),x==null&&M!=null&&(i.defaultChecked=!!M),x!=null&&(i.checked=x&&typeof x!="function"&&typeof x!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?i.name=""+Kn(V):i.removeAttribute("name")}function ro(i,s,c,p,x,M,k,V){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(i.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null))return;c=c!=null?""+Kn(c):"",s=s!=null?""+Kn(s):c,V||s===i.value||(i.value=s),i.defaultValue=s}p=p??x,p=typeof p!="function"&&typeof p!="symbol"&&!!p,i.checked=V?i.checked:!!p,i.defaultChecked=!!p,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(i.name=k)}function Fl(i,s,c){s==="number"&&$o(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function Rs(i,s,c,p){if(i=i.options,s){s={};for(var x=0;x<c.length;x++)s["$"+c[x]]=!0;for(c=0;c<i.length;c++)x=s.hasOwnProperty("$"+i[c].value),i[c].selected!==x&&(i[c].selected=x),x&&p&&(i[c].defaultSelected=!0)}else{for(c=""+Kn(c),s=null,x=0;x<i.length;x++){if(i[x].value===c){i[x].selected=!0,p&&(i[x].defaultSelected=!0);return}s!==null||i[x].disabled||(s=i[x])}s!==null&&(s.selected=!0)}}function Eh(i,s,c){if(s!=null&&(s=""+Kn(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+Kn(c):""}function ao(i,s,c,p){if(s==null){if(p!=null){if(c!=null)throw Error(Y(92));if(Zi(p)){if(1<p.length)throw Error(Y(93));p=p[0]}c=p}c==null&&(c=""),s=c}c=Kn(s),i.defaultValue=c,p=i.textContent,p===c&&p!==""&&p!==null&&(i.value=p)}function Fa(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var fa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $t(i,s,c){var p=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?p?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":p?i.setProperty(s,c):typeof c!="number"||c===0||fa.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function Ds(i,s,c){if(s!=null&&typeof s!="object")throw Error(Y(62));if(i=i.style,c!=null){for(var p in c)!c.hasOwnProperty(p)||s!=null&&s.hasOwnProperty(p)||(p.indexOf("--")===0?i.setProperty(p,""):p==="float"?i.cssFloat="":i[p]="");for(var x in s)p=s[x],s.hasOwnProperty(x)&&c[x]!==p&&$t(i,x,p)}else for(var M in s)s.hasOwnProperty(M)&&$t(i,M,s[M])}function ja(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),so=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function qt(i){return so.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var as=null;function Yo(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var ss=null,Cn=null;function Rn(i){var s=kt(i);if(s&&(i=s.stateNode)){var c=i[Rt]||null;e:switch(i=s.stateNode,s.type){case"input":if(Ol(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Ir(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var p=c[s];if(p!==i&&p.form===i.form){var x=p[Rt]||null;if(!x)throw Error(Y(90));Ol(p,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(s=0;s<c.length;s++)p=c[s],p.form===i.form&&Mh(p)}break e;case"textarea":Eh(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Rs(i,!!c.multiple,s,!1)}}}var Wn=!1;function gn(i,s,c){if(Wn)return i(s,c);Wn=!0;try{var p=i(s);return p}finally{if(Wn=!1,(ss!==null||Cn!==null)&&(lh(),ss&&(s=ss,i=Cn,Cn=ss=null,Rn(s),i)))for(s=0;s<i.length;s++)Rn(i[s])}}function di(i,s){var c=i.stateNode;if(c===null)return null;var p=c[Rt]||null;if(p===null)return null;c=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(i=i.type,p=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!p;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(Y(231,s,typeof c));return c}var Ua=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qn=!1;if(Ua)try{var Jn={};Object.defineProperty(Jn,"passive",{get:function(){Qn=!0}}),window.addEventListener("test",Jn,Jn),window.removeEventListener("test",Jn,Jn)}catch{Qn=!1}var rn=null,Ci=null,Na=null;function wt(){if(Na)return Na;var i,s=Ci,c=s.length,p,x="value"in rn?rn.value:rn.textContent,M=x.length;for(i=0;i<c&&s[i]===x[i];i++);var k=c-i;for(p=1;p<=k&&s[c-p]===x[M-p];p++);return Na=x.slice(i,1<p?1-p:void 0)}function Dt(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function na(){return!0}function ei(){return!1}function Fi(i){function s(c,p,x,M,k){this._reactName=c,this._targetInst=x,this.type=p,this.nativeEvent=M,this.target=k,this.currentTarget=null;for(var V in i)i.hasOwnProperty(V)&&(c=i[V],this[V]=c?c(M):M[V]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?na:ei,this.isPropagationStopped=ei,this}return Ye(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=na)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=na)},persist:function(){},isPersistent:na}),s}var sr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zr=Fi(sr),Is=Ye({},sr,{view:0,detail:0}),bu=Fi(Is),ks,oo,Ls,lo=Ye({},Is,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ho,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ls&&(Ls&&i.type==="mousemove"?(ks=i.screenX-Ls.screenX,oo=i.screenY-Ls.screenY):oo=ks=0,Ls=i),ks)},movementY:function(i){return"movementY"in i?i.movementY:oo}}),jl=Fi(lo),pa=Ye({},lo,{dataTransfer:0}),Un=Fi(pa),Ko=Ye({},Is,{relatedTarget:0}),co=Fi(Ko),uo=Ye({},sr,{animationName:0,elapsedTime:0,pseudoElement:0}),ln=Fi(uo),Ch=Ye({},sr,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Ul=Fi(Ch),wu=Ye({},sr,{data:0}),Ah=Fi(wu),Wo={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},er={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Va(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=Nl[i])?!!s[i]:!1}function ho(){return Va}var Vl=Ye({},Is,{key:function(i){if(i.key){var s=Wo[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Dt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?er[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ho,charCode:function(i){return i.type==="keypress"?Dt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Dt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Zl=Fi(Vl),or=Ye({},lo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tu=Fi(or),zc=Ye({},Is,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ho}),hd=Fi(zc),Su=Ye({},sr,{propertyName:0,elapsedTime:0,pseudoElement:0}),dd=Fi(Su),fd=Ye({},lo,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Pc=Fi(fd),Mu=Ye({},sr,{newState:0,oldState:0}),fo=Fi(Mu),Eu=[9,13,27,32],Qo=Ua&&"CompositionEvent"in window,_r=null;Ua&&"documentMode"in document&&(_r=document.documentMode);var pd=Ua&&"TextEvent"in window&&!_r,Gl=Ua&&(!Qo||_r&&8<_r&&11>=_r),Jo=" ",el=!1;function zh(i,s){switch(i){case"keyup":return Eu.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ql(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var tl=!1;function po(i,s){switch(i){case"compositionend":return ql(s);case"keypress":return s.which!==32?null:(el=!0,Jo);case"textInput":return i=s.data,i===Jo&&el?null:i;default:return null}}function Ph(i,s){if(tl)return i==="compositionend"||!Qo&&zh(i,s)?(i=wt(),Na=Ci=rn=null,tl=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Gl&&s.locale!=="ko"?null:s.data;default:return null}}var Cu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rh(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Cu[i.type]:s==="textarea"}function Au(i,s,c,p){ss?Cn?Cn.push(p):Cn=[p]:ss=p,s=id(s,"onChange"),0<s.length&&(c=new Zr("onChange","change",null,c,p),i.push({event:c,listeners:s}))}var mo=null,il=null;function Rc(i){af(i,0)}function Hl(i){var s=mn(i);if(Mh(s))return i}function zu(i,s){if(i==="change")return s}var Bs=!1;if(Ua){var $l;if(Ua){var Xl="oninput"in document;if(!Xl){var nl=document.createElement("div");nl.setAttribute("oninput","return;"),Xl=typeof nl.oninput=="function"}$l=Xl}else $l=!1;Bs=$l&&(!document.documentMode||9<document.documentMode)}function Dh(){mo&&(mo.detachEvent("onpropertychange",rl),il=mo=null)}function rl(i){if(i.propertyName==="value"&&Hl(il)){var s=[];Au(s,il,i,Yo(i)),gn(Rc,s)}}function Ih(i,s,c){i==="focusin"?(Dh(),mo=s,il=c,mo.attachEvent("onpropertychange",rl)):i==="focusout"&&Dh()}function md(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Hl(il)}function kh(i,s){if(i==="click")return Hl(s)}function Lh(i,s){if(i==="input"||i==="change")return Hl(s)}function Pu(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var yr=typeof Object.is=="function"?Object.is:Pu;function al(i,s){if(yr(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),p=Object.keys(s);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var x=c[p];if(!gr.call(s,x)||!yr(i[x],s[x]))return!1}return!0}function Yl(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Za(i,s){var c=Yl(i);i=0;for(var p;c;){if(c.nodeType===3){if(p=i+c.textContent.length,i<=s&&p>=s)return{node:c,offset:s-i};i=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Yl(c)}}function oi(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?oi(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Dc(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=$o(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=$o(i.document)}return s}function Kl(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var Bh=Ua&&"documentMode"in document&&11>=document.documentMode,Os=null,os=null,go=null,Ru=!1;function Oh(i,s,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Ru||Os==null||Os!==$o(p)||(p=Os,"selectionStart"in p&&Kl(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),go&&al(go,p)||(go=p,p=id(os,"onSelect"),0<p.length&&(s=new Zr("onSelect","select",null,s,c),i.push({event:s,listeners:p}),s.target=Os)))}function _o(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var sl={animationend:_o("Animation","AnimationEnd"),animationiteration:_o("Animation","AnimationIteration"),animationstart:_o("Animation","AnimationStart"),transitionrun:_o("Transition","TransitionRun"),transitionstart:_o("Transition","TransitionStart"),transitioncancel:_o("Transition","TransitionCancel"),transitionend:_o("Transition","TransitionEnd")},Ic={},Fh={};Ua&&(Fh=document.createElement("div").style,"AnimationEvent"in window||(delete sl.animationend.animation,delete sl.animationiteration.animation,delete sl.animationstart.animation),"TransitionEvent"in window||delete sl.transitionend.transition);function Fs(i){if(Ic[i])return Ic[i];if(!sl[i])return i;var s=sl[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in Fh)return Ic[i]=s[c];return i}var Wl=Fs("animationend"),Ql=Fs("animationiteration"),Jl=Fs("animationstart"),Du=Fs("transitionrun"),yo=Fs("transitionstart"),ec=Fs("transitioncancel"),vo=Fs("transitionend"),Gr=new Map,kc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");kc.push("scrollEnd");function ra(i,s){Gr.set(i,s),Dr(s,[i])}var Lc=new WeakMap;function Nn(i,s){if(typeof i=="object"&&i!==null){var c=Lc.get(i);return c!==void 0?c:(s={value:i,source:s,stack:vu(s)},Lc.set(i,s),s)}return{value:i,source:s,stack:vu(s)}}var vr=[],ls=0,xo=0;function bo(){for(var i=ls,s=xo=ls=0;s<i;){var c=vr[s];vr[s++]=null;var p=vr[s];vr[s++]=null;var x=vr[s];vr[s++]=null;var M=vr[s];if(vr[s++]=null,p!==null&&x!==null){var k=p.pending;k===null?x.next=x:(x.next=k.next,k.next=x),p.pending=x}M!==0&&Iu(c,x,M)}}function tc(i,s,c,p){vr[ls++]=i,vr[ls++]=s,vr[ls++]=c,vr[ls++]=p,xo|=p,i.lanes|=p,i=i.alternate,i!==null&&(i.lanes|=p)}function js(i,s,c,p){return tc(i,s,c,p),ol(i)}function qr(i,s){return tc(i,null,null,s),ol(i)}function Iu(i,s,c){i.lanes|=c;var p=i.alternate;p!==null&&(p.lanes|=c);for(var x=!1,M=i.return;M!==null;)M.childLanes|=c,p=M.alternate,p!==null&&(p.childLanes|=c),M.tag===22&&(i=M.stateNode,i===null||i._visibility&1||(x=!0)),i=M,M=M.return;return i.tag===3?(M=i.stateNode,x&&s!==null&&(x=31-ce(c),i=M.hiddenUpdates,p=i[x],p===null?i[x]=[s]:p.push(s),s.lane=c|536870912),M):null}function ol(i){if(50<oh)throw oh=0,Ud=null,Error(Y(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Vt={};function ic(i,s,c,p){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hr(i,s,c,p){return new ic(i,s,c,p)}function Bc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function lr(i,s){var c=i.alternate;return c===null?(c=Hr(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function ku(i,s){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function Oc(i,s,c,p,x,M){var k=0;if(p=i,typeof i=="function")Bc(i)&&(k=1);else if(typeof i=="string")k=t(i,c,xt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Ji:return i=Hr(31,c,s,x),i.elementType=Ji,i.lanes=M,i;case Nt:return Us(c.children,x,M,s);case Gt:k=8,x|=24;break;case Ht:return i=Hr(12,c,s,x|2),i.elementType=Ht,i.lanes=M,i;case mt:return i=Hr(13,c,s,x),i.elementType=mt,i.lanes=M,i;case Qt:return i=Hr(19,c,s,x),i.elementType=Qt,i.lanes=M,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case pi:case Ct:k=10;break e;case zt:k=9;break e;case ii:k=11;break e;case vi:k=14;break e;case Oi:k=16,p=null;break e}k=29,c=Error(Y(130,i===null?"null":typeof i,"")),p=null}return s=Hr(k,c,s,x),s.elementType=i,s.type=p,s.lanes=M,s}function Us(i,s,c,p){return i=Hr(7,i,p,s),i.lanes=c,i}function Lu(i,s,c){return i=Hr(6,i,null,s),i.lanes=c,i}function nc(i,s,c){return s=Hr(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var cs=[],Ga=0,Ns=null,ll=0,$r=[],cr=0,ma=null,Xr=1,xr="";function ga(i,s){cs[Ga++]=ll,cs[Ga++]=Ns,Ns=i,ll=s}function Fc(i,s,c){$r[cr++]=Xr,$r[cr++]=xr,$r[cr++]=ma,ma=i;var p=Xr;i=xr;var x=32-ce(p)-1;p&=~(1<<x),c+=1;var M=32-ce(s)+x;if(30<M){var k=x-x%5;M=(p&(1<<k)-1).toString(32),p>>=k,x-=k,Xr=1<<32-ce(s)+x|c<<x|p,xr=M+i}else Xr=1<<M|c<<x|p,xr=i}function us(i){i.return!==null&&(ga(i,1),Fc(i,1,0))}function rc(i){for(;i===Ns;)Ns=cs[--Ga],cs[Ga]=null,ll=cs[--Ga],cs[Ga]=null;for(;i===ma;)ma=$r[--cr],$r[cr]=null,xr=$r[--cr],$r[cr]=null,Xr=$r[--cr],$r[cr]=null}var Dn=null,Hi=null,hi=!1,Vs=null,_a=!1,cl=Error(Y(519));function hs(i){var s=Error(Y(418,""));throw Zs(Nn(s,i)),cl}function Bu(i){var s=i.stateNode,c=i.type,p=i.memoizedProps;switch(s[St]=i,s[Rt]=p,c){case"dialog":ci("cancel",s),ci("close",s);break;case"iframe":case"object":case"embed":ci("load",s);break;case"video":case"audio":for(c=0;c<uu.length;c++)ci(uu[c],s);break;case"source":ci("error",s);break;case"img":case"image":case"link":ci("error",s),ci("load",s);break;case"details":ci("toggle",s);break;case"input":ci("invalid",s),ro(s,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Ac(s);break;case"select":ci("invalid",s);break;case"textarea":ci("invalid",s),ao(s,p.value,p.defaultValue,p.children),Ac(s)}c=p.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||p.suppressHydrationWarning===!0||uf(s.textContent,c)?(p.popover!=null&&(ci("beforetoggle",s),ci("toggle",s)),p.onScroll!=null&&ci("scroll",s),p.onScrollEnd!=null&&ci("scrollend",s),p.onClick!=null&&(s.onclick=mh),s=!0):s=!1,s||hs(i)}function jc(i){for(Dn=i.return;Dn;)switch(Dn.tag){case 5:case 13:_a=!1;return;case 27:case 3:_a=!0;return;default:Dn=Dn.return}}function wi(i){if(i!==Dn)return!1;if(!hi)return jc(i),hi=!0,!1;var s=i.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||Vo(i.type,i.memoizedProps)),c=!c),c&&Hi&&hs(i),jc(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(c=i.data,c==="/$"){if(s===0){Hi=Ja(i.nextSibling);break e}s--}else c!=="$"&&c!=="$!"&&c!=="$?"||s++;i=i.nextSibling}Hi=null}}else s===27?(s=Hi,Zo(i.type)?(i=du,du=null,Hi=i):Hi=s):Hi=Dn?Ja(i.stateNode.nextSibling):null;return!0}function ya(){Hi=Dn=null,hi=!1}function kr(){var i=Vs;return i!==null&&(Kr===null?Kr=i:Kr.push.apply(Kr,i),Vs=null),i}function Zs(i){Vs===null?Vs=[i]:Vs.push(i)}var ul=Ne(null),ds=null,br=null;function Lr(i,s,c){at(ul,s._currentValue),s._currentValue=c}function Yr(i){i._currentValue=ul.current,lt(ul)}function ac(i,s,c){for(;i!==null;){var p=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),i===c)break;i=i.return}}function Uc(i,s,c,p){var x=i.child;for(x!==null&&(x.return=i);x!==null;){var M=x.dependencies;if(M!==null){var k=x.child;M=M.firstContext;e:for(;M!==null;){var V=M;M=x;for(var ae=0;ae<s.length;ae++)if(V.context===s[ae]){M.lanes|=c,V=M.alternate,V!==null&&(V.lanes|=c),ac(M.return,c,i),p||(k=null);break e}M=V.next}}else if(x.tag===18){if(k=x.return,k===null)throw Error(Y(341));k.lanes|=c,M=k.alternate,M!==null&&(M.lanes|=c),ac(k,c,i),k=null}else k=x.child;if(k!==null)k.return=x;else for(k=x;k!==null;){if(k===i){k=null;break}if(x=k.sibling,x!==null){x.return=k.return,k=x;break}k=k.return}x=k}}function hl(i,s,c,p){i=null;for(var x=s,M=!1;x!==null;){if(!M){if((x.flags&524288)!==0)M=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var k=x.alternate;if(k===null)throw Error(Y(387));if(k=k.memoizedProps,k!==null){var V=x.type;yr(x.pendingProps.value,k.value)||(i!==null?i.push(V):i=[V])}}else if(x===Fn.current){if(k=x.alternate,k===null)throw Error(Y(387));k.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(i!==null?i.push(z):i=[z])}x=x.return}i!==null&&Uc(s,i,c,p),s.flags|=262144}function sc(i){for(i=i.firstContext;i!==null;){if(!yr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Gs(i){ds=i,br=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function _n(i){return wr(ds,i)}function Br(i,s){return ds===null&&Gs(i),wr(i,s)}function wr(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},br===null){if(i===null)throw Error(Y(308));br=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else br=br.next=s;return c}var dl=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,p){i.push(p)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},Ou=Z.unstable_scheduleCallback,jh=Z.unstable_NormalPriority,An={$$typeof:Ct,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qs(){return{controller:new dl,data:new Map,refCount:0}}function wo(i){i.refCount--,i.refCount===0&&Ou(jh,function(){i.controller.abort()})}var Hs=null,fl=0,fs=0,tr=null;function Tr(i,s){if(Hs===null){var c=Hs=[];fl=0,fs=dh(),tr={status:"pending",value:void 0,then:function(p){c.push(p)}}}return fl++,s.then(Fu,Fu),s}function Fu(){if(--fl===0&&Hs!==null){tr!==null&&(tr.status="fulfilled");var i=Hs;Hs=null,fs=0,tr=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function va(i,s){var c=[],p={status:"pending",value:null,reason:null,then:function(x){c.push(x)}};return i.then(function(){p.status="fulfilled",p.value=s;for(var x=0;x<c.length;x++)(0,c[x])(s)},function(x){for(p.status="rejected",p.reason=x,x=0;x<c.length;x++)(0,c[x])(void 0)}),p}var To=Be.S;Be.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&Tr(i,s),To!==null&&To(i,s)};var xa=Ne(null);function ju(){var i=xa.current;return i!==null?i:Ni.pooledCache}function Nc(i,s){s===null?at(xa,xa.current):at(xa,s.pool)}function oc(){var i=ju();return i===null?null:{parent:An._currentValue,pool:i}}var pl=Error(Y(460)),$s=Error(Y(474)),Sr=Error(Y(542)),st={then:function(){}};function Vc(i){return i=i.status,i==="fulfilled"||i==="rejected"}function So(){}function Zc(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(So,So),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Gc(i),i;default:if(typeof s.status=="string")s.then(So,So);else{if(i=Ni,i!==null&&100<i.shellSuspendCounter)throw Error(Y(482));i=s,i.status="pending",i.then(function(p){if(s.status==="pending"){var x=s;x.status="fulfilled",x.value=p}},function(p){if(s.status==="pending"){var x=s;x.status="rejected",x.reason=p}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Gc(i),i}throw ba=s,pl}}var ba=null;function Mo(){if(ba===null)throw Error(Y(459));var i=ba;return ba=null,i}function Gc(i){if(i===pl||i===Sr)throw Error(Y(483))}var Ot=!1;function lc(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function qc(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function qa(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function ps(i,s,c){var p=i.updateQueue;if(p===null)return null;if(p=p.shared,(Di&2)!==0){var x=p.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),p.pending=s,s=ol(i),Iu(i,null,c),s}return tc(i,p,s,c),ol(i)}function ml(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var p=s.lanes;p&=i.pendingLanes,c|=p,s.lanes=c,_t(i,c)}}function Hc(i,s){var c=i.updateQueue,p=i.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var x=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var k={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?x=M=k:M=M.next=k,c=c.next}while(c!==null);M===null?x=M=s:M=M.next=s}else x=M=s;c={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:M,shared:p.shared,callbacks:p.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var cc=!1;function Eo(){if(cc){var i=tr;if(i!==null)throw i}}function gl(i,s,c,p){cc=!1;var x=i.updateQueue;Ot=!1;var M=x.firstBaseUpdate,k=x.lastBaseUpdate,V=x.shared.pending;if(V!==null){x.shared.pending=null;var ae=V,Ee=ae.next;ae.next=null,k===null?M=Ee:k.next=Ee,k=ae;var je=i.alternate;je!==null&&(je=je.updateQueue,V=je.lastBaseUpdate,V!==k&&(V===null?je.firstBaseUpdate=Ee:V.next=Ee,je.lastBaseUpdate=ae))}if(M!==null){var Ge=x.baseState;k=0,je=Ee=ae=null,V=M;do{var ze=V.lane&-536870913,De=ze!==V.lane;if(De?(ui&ze)===ze:(p&ze)===ze){ze!==0&&ze===fs&&(cc=!0),je!==null&&(je=je.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});e:{var Ft=i,It=V;ze=s;var Bi=c;switch(It.tag){case 1:if(Ft=It.payload,typeof Ft=="function"){Ge=Ft.call(Bi,Ge,ze);break e}Ge=Ft;break e;case 3:Ft.flags=Ft.flags&-65537|128;case 0:if(Ft=It.payload,ze=typeof Ft=="function"?Ft.call(Bi,Ge,ze):Ft,ze==null)break e;Ge=Ye({},Ge,ze);break e;case 2:Ot=!0}}ze=V.callback,ze!==null&&(i.flags|=64,De&&(i.flags|=8192),De=x.callbacks,De===null?x.callbacks=[ze]:De.push(ze))}else De={lane:ze,tag:V.tag,payload:V.payload,callback:V.callback,next:null},je===null?(Ee=je=De,ae=Ge):je=je.next=De,k|=ze;if(V=V.next,V===null){if(V=x.shared.pending,V===null)break;De=V,V=De.next,De.next=null,x.lastBaseUpdate=De,x.shared.pending=null}}while(!0);je===null&&(ae=Ge),x.baseState=ae,x.firstBaseUpdate=Ee,x.lastBaseUpdate=je,M===null&&(x.shared.lanes=0),Oo|=k,i.lanes=k,i.memoizedState=Ge}}function $c(i,s){if(typeof i!="function")throw Error(Y(191,i));i.call(s)}function Uu(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)$c(c[i],s)}var ms=Ne(null),wa=Ne(0);function gi(i,s){i=Bo,at(wa,i),at(ms,s),Bo=i|s.baseLanes}function Nu(){at(wa,Bo),at(ms,ms.current)}function _l(){Bo=wa.current,lt(ms),lt(wa)}var Ta=0,Yt=null,_i=null,yn=null,Xc=!1,Mr=!1,Ha=!1,ut=0,gt=0,gs=null,Vu=0;function Ki(){throw Error(Y(321))}function Vn(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!yr(i[c],s[c]))return!1;return!0}function Yc(i,s,c,p,x,M){return Ta=M,Yt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Be.H=i===null||i.memoizedState===null?$a:Xa,Ha=!1,M=c(p,x),Ha=!1,Mr&&(M=Xs(s,c,p,x)),aa(i),M}function aa(i){Be.H=Gn;var s=_i!==null&&_i.next!==null;if(Ta=0,yn=_i=Yt=null,Xc=!1,gt=0,gs=null,s)throw Error(Y(300));i===null||xn||(i=i.dependencies,i!==null&&sc(i)&&(xn=!0))}function Xs(i,s,c,p){Yt=i;var x=0;do{if(Mr&&(gs=null),gt=0,Mr=!1,25<=x)throw Error(Y(301));if(x+=1,yn=_i=null,i.updateQueue!=null){var M=i.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}Be.H=Ws,M=s(c,p)}while(Mr);return M}function yl(){var i=Be.H,s=i.useState()[0];return s=typeof s.then=="function"?Co(s):s,i=i.useState()[0],(_i!==null?_i.memoizedState:null)!==i&&(Yt.flags|=1024),s}function Pi(){var i=ut!==0;return ut=0,i}function Wi(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function vl(i){if(Xc){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Xc=!1}Ta=0,yn=_i=Yt=null,Mr=!1,gt=ut=0,gs=null}function Zn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?Yt.memoizedState=yn=i:yn=yn.next=i,yn}function ji(){if(_i===null){var i=Yt.alternate;i=i!==null?i.memoizedState:null}else i=_i.next;var s=yn===null?Yt.memoizedState:yn.next;if(s!==null)yn=s,_i=i;else{if(i===null)throw Yt.alternate===null?Error(Y(467)):Error(Y(310));_i=i,i={memoizedState:_i.memoizedState,baseState:_i.baseState,baseQueue:_i.baseQueue,queue:_i.queue,next:null},yn===null?Yt.memoizedState=yn=i:yn=yn.next=i}return yn}function _s(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Co(i){var s=gt;return gt+=1,gs===null&&(gs=[]),i=Zc(gs,i,s),s=Yt,(yn===null?s.memoizedState:yn.next)===null&&(s=s.alternate,Be.H=s===null||s.memoizedState===null?$a:Xa),i}function Ao(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Co(i);if(i.$$typeof===Ct)return _n(i)}throw Error(Y(438,String(i)))}function Sa(i){var s=null,c=Yt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var p=Yt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(s={data:p.data.map(function(x){return x.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=_s(),Yt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),p=0;p<i;p++)c[p]=xi;return s.index++,c}function Ma(i,s){return typeof s=="function"?s(i):s}function xl(i){var s=ji();return bl(s,_i,i)}function bl(i,s,c){var p=i.queue;if(p===null)throw Error(Y(311));p.lastRenderedReducer=c;var x=i.baseQueue,M=p.pending;if(M!==null){if(x!==null){var k=x.next;x.next=M.next,M.next=k}s.baseQueue=x=M,p.pending=null}if(M=i.baseState,x===null)i.memoizedState=M;else{s=x.next;var V=k=null,ae=null,Ee=s,je=!1;do{var Ge=Ee.lane&-536870913;if(Ge!==Ee.lane?(ui&Ge)===Ge:(Ta&Ge)===Ge){var ze=Ee.revertLane;if(ze===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null}),Ge===fs&&(je=!0);else if((Ta&ze)===ze){Ee=Ee.next,ze===fs&&(je=!0);continue}else Ge={lane:0,revertLane:Ee.revertLane,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null},ae===null?(V=ae=Ge,k=M):ae=ae.next=Ge,Yt.lanes|=ze,Oo|=ze;Ge=Ee.action,Ha&&c(M,Ge),M=Ee.hasEagerState?Ee.eagerState:c(M,Ge)}else ze={lane:Ge,revertLane:Ee.revertLane,action:Ee.action,hasEagerState:Ee.hasEagerState,eagerState:Ee.eagerState,next:null},ae===null?(V=ae=ze,k=M):ae=ae.next=ze,Yt.lanes|=Ge,Oo|=Ge;Ee=Ee.next}while(Ee!==null&&Ee!==s);if(ae===null?k=M:ae.next=V,!yr(M,i.memoizedState)&&(xn=!0,je&&(c=tr,c!==null)))throw c;i.memoizedState=M,i.baseState=k,i.baseQueue=ae,p.lastRenderedState=M}return x===null&&(p.lanes=0),[i.memoizedState,p.dispatch]}function uc(i){var s=ji(),c=s.queue;if(c===null)throw Error(Y(311));c.lastRenderedReducer=i;var p=c.dispatch,x=c.pending,M=s.memoizedState;if(x!==null){c.pending=null;var k=x=x.next;do M=i(M,k.action),k=k.next;while(k!==x);yr(M,s.memoizedState)||(xn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,p]}function f(i,s,c){var p=Yt,x=ji(),M=hi;if(M){if(c===void 0)throw Error(Y(407));c=c()}else c=s();var k=!yr((_i||x).memoizedState,c);k&&(x.memoizedState=c,xn=!0),x=x.queue;var V=l.bind(null,p,x,i);if(de(2048,8,V,[i]),x.getSnapshot!==s||k||yn!==null&&yn.memoizedState.tag&1){if(p.flags|=2048,Q(9,ne(),a.bind(null,p,x,c,s),null),Ni===null)throw Error(Y(349));M||(Ta&124)!==0||e(p,s,c)}return c}function e(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=Yt.updateQueue,s===null?(s=_s(),Yt.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function a(i,s,c,p){s.value=c,s.getSnapshot=p,h(s)&&g(i)}function l(i,s,c){return c(function(){h(s)&&g(i)})}function h(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!yr(i,c)}catch{return!0}}function g(i){var s=qr(i,2);s!==null&&Wr(s,i,2)}function y(i){var s=Zn();if(typeof i=="function"){var c=i;if(i=c(),Ha){Nr(!0);try{c()}finally{Nr(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:i},s}function w(i,s,c,p){return i.baseState=c,bl(i,_i,typeof p=="function"?p:Ma)}function T(i,s,c,p,x){if(Ks(i))throw Error(Y(485));if(i=s.action,i!==null){var M={payload:x,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){M.listeners.push(k)}};Be.T!==null?c(!0):M.isTransition=!1,p(M),c=s.pending,c===null?(M.next=s.pending=M,E(s,M)):(M.next=c.next,s.pending=c.next=M)}}function E(i,s){var c=s.action,p=s.payload,x=i.state;if(s.isTransition){var M=Be.T,k={};Be.T=k;try{var V=c(x,p),ae=Be.S;ae!==null&&ae(k,V),A(i,s,V)}catch(Ee){P(i,s,Ee)}finally{Be.T=M}}else try{M=c(x,p),A(i,s,M)}catch(Ee){P(i,s,Ee)}}function A(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(p){R(i,s,p)},function(p){return P(i,s,p)}):R(i,s,c)}function R(i,s,c){s.status="fulfilled",s.value=c,L(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,E(i,c)))}function P(i,s,c){var p=i.pending;if(i.pending=null,p!==null){p=p.next;do s.status="rejected",s.reason=c,L(s),s=s.next;while(s!==p)}i.action=null}function L(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function U(i,s){return s}function H(i,s){if(hi){var c=Ni.formState;if(c!==null){e:{var p=Yt;if(hi){if(Hi){t:{for(var x=Hi,M=_a;x.nodeType!==8;){if(!M){x=null;break t}if(x=Ja(x.nextSibling),x===null){x=null;break t}}M=x.data,x=M==="F!"||M==="F"?x:null}if(x){Hi=Ja(x.nextSibling),p=x.data==="F!";break e}}hs(p)}p=!1}p&&(s=c[0])}}return c=Zn(),c.memoizedState=c.baseState=s,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:U,lastRenderedState:s},c.queue=p,c=ys.bind(null,Yt,p),p.dispatch=c,p=y(!1),M=vs.bind(null,Yt,!1,p.queue),p=Zn(),x={state:s,dispatch:null,action:i,pending:null},p.queue=x,c=T.bind(null,Yt,x,M,c),x.dispatch=c,p.memoizedState=i,[s,c,!1]}function $(i){var s=ji();return X(s,_i,i)}function X(i,s,c){if(s=bl(i,s,U)[0],i=xl(Ma)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var p=Co(s)}catch(k){throw k===pl?Sr:k}else p=s;s=ji();var x=s.queue,M=x.dispatch;return c!==s.memoizedState&&(Yt.flags|=2048,Q(9,ne(),W.bind(null,x,c),null)),[p,M,i]}function W(i,s){i.action=s}function ee(i){var s=ji(),c=_i;if(c!==null)return X(s,c,i);ji(),s=s.memoizedState,c=ji();var p=c.queue.dispatch;return c.memoizedState=i,[s,p,!1]}function Q(i,s,c,p){return i={tag:i,create:c,deps:p,inst:s,next:null},s=Yt.updateQueue,s===null&&(s=_s(),Yt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(p=c.next,c.next=i,i.next=p,s.lastEffect=i),i}function ne(){return{destroy:void 0,resource:void 0}}function le(){return ji().memoizedState}function J(i,s,c,p){var x=Zn();p=p===void 0?null:p,Yt.flags|=i,x.memoizedState=Q(1|s,ne(),c,p)}function de(i,s,c,p){var x=ji();p=p===void 0?null:p;var M=x.memoizedState.inst;_i!==null&&p!==null&&Vn(p,_i.memoizedState.deps)?x.memoizedState=Q(s,M,c,p):(Yt.flags|=i,x.memoizedState=Q(1|s,M,c,p))}function Ce(i,s){J(8390656,8,i,s)}function be(i,s){de(2048,8,i,s)}function Te(i,s){return de(4,2,i,s)}function Ae(i,s){return de(4,4,i,s)}function Qe(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function Ke(i,s,c){c=c!=null?c.concat([i]):null,de(4,4,Qe.bind(null,s,i),c)}function Fe(){}function ht(i,s){var c=ji();s=s===void 0?null:s;var p=c.memoizedState;return s!==null&&Vn(s,p[1])?p[0]:(c.memoizedState=[i,s],i)}function Zt(i,s){var c=ji();s=s===void 0?null:s;var p=c.memoizedState;if(s!==null&&Vn(s,p[1]))return p[0];if(p=i(),Ha){Nr(!0);try{i()}finally{Nr(!1)}}return c.memoizedState=[p,s],p}function li(i,s,c){return c===void 0||(Ta&1073741824)!==0?i.memoizedState=s:(i.memoizedState=c,i=kn(),Yt.lanes|=i,Oo|=i,c)}function Ui(i,s,c,p){return yr(c,s)?c:ms.current!==null?(i=li(i,c,p),yr(i,s)||(xn=!0),i):(Ta&42)===0?(xn=!0,i.memoizedState=c):(i=kn(),Yt.lanes|=i,Oo|=i,s)}function Ti(i,s,c,p,x){var M=ot.p;ot.p=M!==0&&8>M?M:8;var k=Be.T,V={};Be.T=V,vs(i,!1,s,c);try{var ae=x(),Ee=Be.S;if(Ee!==null&&Ee(V,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var je=va(ae,p);Cr(i,s,je,Rr(i))}else Cr(i,s,p,Rr(i))}catch(Ge){Cr(i,s,{then:function(){},status:"rejected",reason:Ge},Rr())}finally{ot.p=M,Be.T=k}}function Si(){}function Ri(i,s,c,p){if(i.tag!==5)throw Error(Y(476));var x=Ai(i).queue;Ti(i,x,s,At,c===null?Si:function(){return Mi(i),c(p)})}function Ai(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:At,baseState:At,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:At},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Mi(i){var s=Ai(i).next.queue;Cr(i,s,{},Rr())}function ti(){return _n(z)}function zn(){return ji().memoizedState}function vn(){return ji().memoizedState}function Er(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=Rr();i=qa(c);var p=ps(s,i,c);p!==null&&(Wr(p,s,c),ml(p,s,c)),s={cache:qs()},i.payload=s;return}s=s.return}}function Ys(i,s,c){var p=Rr();c={lane:p,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},Ks(i)?hc(s,c):(c=js(i,s,c,p),c!==null&&(Wr(c,i,p),xs(c,s,p)))}function ys(i,s,c){var p=Rr();Cr(i,s,c,p)}function Cr(i,s,c,p){var x={lane:p,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ks(i))hc(s,x);else{var M=i.alternate;if(i.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var k=s.lastRenderedState,V=M(k,c);if(x.hasEagerState=!0,x.eagerState=V,yr(V,k))return tc(i,s,x,0),Ni===null&&bo(),!1}catch{}finally{}if(c=js(i,s,x,p),c!==null)return Wr(c,i,p),xs(c,s,p),!0}return!1}function vs(i,s,c,p){if(p={lane:2,revertLane:dh(),action:p,hasEagerState:!1,eagerState:null,next:null},Ks(i)){if(s)throw Error(Y(479))}else s=js(i,c,p,2),s!==null&&Wr(s,i,2)}function Ks(i){var s=i.alternate;return i===Yt||s!==null&&s===Yt}function hc(i,s){Mr=Xc=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function xs(i,s,c){if((c&4194048)!==0){var p=s.lanes;p&=i.pendingLanes,c|=p,s.lanes=c,_t(i,c)}}var Gn={readContext:_n,use:Ao,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useLayoutEffect:Ki,useInsertionEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useSyncExternalStore:Ki,useId:Ki,useHostTransitionStatus:Ki,useFormState:Ki,useActionState:Ki,useOptimistic:Ki,useMemoCache:Ki,useCacheRefresh:Ki},$a={readContext:_n,use:Ao,useCallback:function(i,s){return Zn().memoizedState=[i,s===void 0?null:s],i},useContext:_n,useEffect:Ce,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,J(4194308,4,Qe.bind(null,s,i),c)},useLayoutEffect:function(i,s){return J(4194308,4,i,s)},useInsertionEffect:function(i,s){J(4,2,i,s)},useMemo:function(i,s){var c=Zn();s=s===void 0?null:s;var p=i();if(Ha){Nr(!0);try{i()}finally{Nr(!1)}}return c.memoizedState=[p,s],p},useReducer:function(i,s,c){var p=Zn();if(c!==void 0){var x=c(s);if(Ha){Nr(!0);try{c(s)}finally{Nr(!1)}}}else x=s;return p.memoizedState=p.baseState=x,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:x},p.queue=i,i=i.dispatch=Ys.bind(null,Yt,i),[p.memoizedState,i]},useRef:function(i){var s=Zn();return i={current:i},s.memoizedState=i},useState:function(i){i=y(i);var s=i.queue,c=ys.bind(null,Yt,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:Fe,useDeferredValue:function(i,s){var c=Zn();return li(c,i,s)},useTransition:function(){var i=y(!1);return i=Ti.bind(null,Yt,i.queue,!0,!1),Zn().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var p=Yt,x=Zn();if(hi){if(c===void 0)throw Error(Y(407));c=c()}else{if(c=s(),Ni===null)throw Error(Y(349));(ui&124)!==0||e(p,s,c)}x.memoizedState=c;var M={value:c,getSnapshot:s};return x.queue=M,Ce(l.bind(null,p,M,i),[i]),p.flags|=2048,Q(9,ne(),a.bind(null,p,M,c,s),null),c},useId:function(){var i=Zn(),s=Ni.identifierPrefix;if(hi){var c=xr,p=Xr;c=(p&~(1<<32-ce(p)-1)).toString(32)+c,s=""+s+"R"+c,c=ut++,0<c&&(s+="H"+c.toString(32)),s+=""}else c=Vu++,s=""+s+"r"+c.toString(32)+"";return i.memoizedState=s},useHostTransitionStatus:ti,useFormState:H,useActionState:H,useOptimistic:function(i){var s=Zn();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=vs.bind(null,Yt,!0,c),c.dispatch=s,[i,s]},useMemoCache:Sa,useCacheRefresh:function(){return Zn().memoizedState=Er.bind(null,Yt)}},Xa={readContext:_n,use:Ao,useCallback:ht,useContext:_n,useEffect:be,useImperativeHandle:Ke,useInsertionEffect:Te,useLayoutEffect:Ae,useMemo:Zt,useReducer:xl,useRef:le,useState:function(){return xl(Ma)},useDebugValue:Fe,useDeferredValue:function(i,s){var c=ji();return Ui(c,_i.memoizedState,i,s)},useTransition:function(){var i=xl(Ma)[0],s=ji().memoizedState;return[typeof i=="boolean"?i:Co(i),s]},useSyncExternalStore:f,useId:zn,useHostTransitionStatus:ti,useFormState:$,useActionState:$,useOptimistic:function(i,s){var c=ji();return w(c,_i,i,s)},useMemoCache:Sa,useCacheRefresh:vn},Ws={readContext:_n,use:Ao,useCallback:ht,useContext:_n,useEffect:be,useImperativeHandle:Ke,useInsertionEffect:Te,useLayoutEffect:Ae,useMemo:Zt,useReducer:uc,useRef:le,useState:function(){return uc(Ma)},useDebugValue:Fe,useDeferredValue:function(i,s){var c=ji();return _i===null?li(c,i,s):Ui(c,_i.memoizedState,i,s)},useTransition:function(){var i=uc(Ma)[0],s=ji().memoizedState;return[typeof i=="boolean"?i:Co(i),s]},useSyncExternalStore:f,useId:zn,useHostTransitionStatus:ti,useFormState:ee,useActionState:ee,useOptimistic:function(i,s){var c=ji();return _i!==null?w(c,_i,i,s):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:Sa,useCacheRefresh:vn},fi=null,$i=0;function ur(i){var s=$i;return $i+=1,fi===null&&(fi=[]),Zc(fi,i,s)}function an(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function Kc(i,s){throw s.$$typeof===et?Error(Y(525)):(i=Object.prototype.toString.call(s),Error(Y(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Wc(i){var s=i._init;return s(i._payload)}function wl(i){function s(xe,me){if(i){var we=xe.deletions;we===null?(xe.deletions=[me],xe.flags|=16):we.push(me)}}function c(xe,me){if(!i)return null;for(;me!==null;)s(xe,me),me=me.sibling;return null}function p(xe){for(var me=new Map;xe!==null;)xe.key!==null?me.set(xe.key,xe):me.set(xe.index,xe),xe=xe.sibling;return me}function x(xe,me){return xe=lr(xe,me),xe.index=0,xe.sibling=null,xe}function M(xe,me,we){return xe.index=we,i?(we=xe.alternate,we!==null?(we=we.index,we<me?(xe.flags|=67108866,me):we):(xe.flags|=67108866,me)):(xe.flags|=1048576,me)}function k(xe){return i&&xe.alternate===null&&(xe.flags|=67108866),xe}function V(xe,me,we,Ze){return me===null||me.tag!==6?(me=Lu(we,xe.mode,Ze),me.return=xe,me):(me=x(me,we),me.return=xe,me)}function ae(xe,me,we,Ze){var yt=we.type;return yt===Nt?je(xe,me,we.props.children,Ze,we.key):me!==null&&(me.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===Oi&&Wc(yt)===me.type)?(me=x(me,we.props),an(me,we),me.return=xe,me):(me=Oc(we.type,we.key,we.props,null,xe.mode,Ze),an(me,we),me.return=xe,me)}function Ee(xe,me,we,Ze){return me===null||me.tag!==4||me.stateNode.containerInfo!==we.containerInfo||me.stateNode.implementation!==we.implementation?(me=nc(we,xe.mode,Ze),me.return=xe,me):(me=x(me,we.children||[]),me.return=xe,me)}function je(xe,me,we,Ze,yt){return me===null||me.tag!==7?(me=Us(we,xe.mode,Ze,yt),me.return=xe,me):(me=x(me,we),me.return=xe,me)}function Ge(xe,me,we){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=Lu(""+me,xe.mode,we),me.return=xe,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case Ue:return we=Oc(me.type,me.key,me.props,null,xe.mode,we),an(we,me),we.return=xe,we;case ve:return me=nc(me,xe.mode,we),me.return=xe,me;case Oi:var Ze=me._init;return me=Ze(me._payload),Ge(xe,me,we)}if(Zi(me)||ri(me))return me=Us(me,xe.mode,we,null),me.return=xe,me;if(typeof me.then=="function")return Ge(xe,ur(me),we);if(me.$$typeof===Ct)return Ge(xe,Br(xe,me),we);Kc(xe,me)}return null}function ze(xe,me,we,Ze){var yt=me!==null?me.key:null;if(typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint")return yt!==null?null:V(xe,me,""+we,Ze);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case Ue:return we.key===yt?ae(xe,me,we,Ze):null;case ve:return we.key===yt?Ee(xe,me,we,Ze):null;case Oi:return yt=we._init,we=yt(we._payload),ze(xe,me,we,Ze)}if(Zi(we)||ri(we))return yt!==null?null:je(xe,me,we,Ze,null);if(typeof we.then=="function")return ze(xe,me,ur(we),Ze);if(we.$$typeof===Ct)return ze(xe,me,Br(xe,we),Ze);Kc(xe,we)}return null}function De(xe,me,we,Ze,yt){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return xe=xe.get(we)||null,V(me,xe,""+Ze,yt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case Ue:return xe=xe.get(Ze.key===null?we:Ze.key)||null,ae(me,xe,Ze,yt);case ve:return xe=xe.get(Ze.key===null?we:Ze.key)||null,Ee(me,xe,Ze,yt);case Oi:var ai=Ze._init;return Ze=ai(Ze._payload),De(xe,me,we,Ze,yt)}if(Zi(Ze)||ri(Ze))return xe=xe.get(we)||null,je(me,xe,Ze,yt,null);if(typeof Ze.then=="function")return De(xe,me,we,ur(Ze),yt);if(Ze.$$typeof===Ct)return De(xe,me,we,Br(me,Ze),yt);Kc(me,Ze)}return null}function Ft(xe,me,we,Ze){for(var yt=null,ai=null,Et=me,Bt=me=0,mr=null;Et!==null&&Bt<we.length;Bt++){Et.index>Bt?(mr=Et,Et=null):mr=Et.sibling;var yi=ze(xe,Et,we[Bt],Ze);if(yi===null){Et===null&&(Et=mr);break}i&&Et&&yi.alternate===null&&s(xe,Et),me=M(yi,me,Bt),ai===null?yt=yi:ai.sibling=yi,ai=yi,Et=mr}if(Bt===we.length)return c(xe,Et),hi&&ga(xe,Bt),yt;if(Et===null){for(;Bt<we.length;Bt++)Et=Ge(xe,we[Bt],Ze),Et!==null&&(me=M(Et,me,Bt),ai===null?yt=Et:ai.sibling=Et,ai=Et);return hi&&ga(xe,Bt),yt}for(Et=p(Et);Bt<we.length;Bt++)mr=De(Et,xe,Bt,we[Bt],Ze),mr!==null&&(i&&mr.alternate!==null&&Et.delete(mr.key===null?Bt:mr.key),me=M(mr,me,Bt),ai===null?yt=mr:ai.sibling=mr,ai=mr);return i&&Et.forEach(function(Il){return s(xe,Il)}),hi&&ga(xe,Bt),yt}function It(xe,me,we,Ze){if(we==null)throw Error(Y(151));for(var yt=null,ai=null,Et=me,Bt=me=0,mr=null,yi=we.next();Et!==null&&!yi.done;Bt++,yi=we.next()){Et.index>Bt?(mr=Et,Et=null):mr=Et.sibling;var Il=ze(xe,Et,yi.value,Ze);if(Il===null){Et===null&&(Et=mr);break}i&&Et&&Il.alternate===null&&s(xe,Et),me=M(Il,me,Bt),ai===null?yt=Il:ai.sibling=Il,ai=Il,Et=mr}if(yi.done)return c(xe,Et),hi&&ga(xe,Bt),yt;if(Et===null){for(;!yi.done;Bt++,yi=we.next())yi=Ge(xe,yi.value,Ze),yi!==null&&(me=M(yi,me,Bt),ai===null?yt=yi:ai.sibling=yi,ai=yi);return hi&&ga(xe,Bt),yt}for(Et=p(Et);!yi.done;Bt++,yi=we.next())yi=De(Et,xe,Bt,yi.value,Ze),yi!==null&&(i&&yi.alternate!==null&&Et.delete(yi.key===null?Bt:yi.key),me=M(yi,me,Bt),ai===null?yt=yi:ai.sibling=yi,ai=yi);return i&&Et.forEach(function(zp){return s(xe,zp)}),hi&&ga(xe,Bt),yt}function Bi(xe,me,we,Ze){if(typeof we=="object"&&we!==null&&we.type===Nt&&we.key===null&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case Ue:e:{for(var yt=we.key;me!==null;){if(me.key===yt){if(yt=we.type,yt===Nt){if(me.tag===7){c(xe,me.sibling),Ze=x(me,we.props.children),Ze.return=xe,xe=Ze;break e}}else if(me.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===Oi&&Wc(yt)===me.type){c(xe,me.sibling),Ze=x(me,we.props),an(Ze,we),Ze.return=xe,xe=Ze;break e}c(xe,me);break}else s(xe,me);me=me.sibling}we.type===Nt?(Ze=Us(we.props.children,xe.mode,Ze,we.key),Ze.return=xe,xe=Ze):(Ze=Oc(we.type,we.key,we.props,null,xe.mode,Ze),an(Ze,we),Ze.return=xe,xe=Ze)}return k(xe);case ve:e:{for(yt=we.key;me!==null;){if(me.key===yt)if(me.tag===4&&me.stateNode.containerInfo===we.containerInfo&&me.stateNode.implementation===we.implementation){c(xe,me.sibling),Ze=x(me,we.children||[]),Ze.return=xe,xe=Ze;break e}else{c(xe,me);break}else s(xe,me);me=me.sibling}Ze=nc(we,xe.mode,Ze),Ze.return=xe,xe=Ze}return k(xe);case Oi:return yt=we._init,we=yt(we._payload),Bi(xe,me,we,Ze)}if(Zi(we))return Ft(xe,me,we,Ze);if(ri(we)){if(yt=ri(we),typeof yt!="function")throw Error(Y(150));return we=yt.call(we),It(xe,me,we,Ze)}if(typeof we.then=="function")return Bi(xe,me,ur(we),Ze);if(we.$$typeof===Ct)return Bi(xe,me,Br(xe,we),Ze);Kc(xe,we)}return typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint"?(we=""+we,me!==null&&me.tag===6?(c(xe,me.sibling),Ze=x(me,we),Ze.return=xe,xe=Ze):(c(xe,me),Ze=Lu(we,xe.mode,Ze),Ze.return=xe,xe=Ze),k(xe)):c(xe,me)}return function(xe,me,we,Ze){try{$i=0;var yt=Bi(xe,me,we,Ze);return fi=null,yt}catch(Et){if(Et===pl||Et===Sr)throw Et;var ai=Hr(29,Et,null,xe.mode);return ai.lanes=Ze,ai.return=xe,ai}finally{}}}var Ea=wl(!0),Ya=wl(!1),cn=Ne(null),sn=null;function Ka(i){var s=i.alternate;at(un,un.current&1),at(cn,i),sn===null&&(s===null||ms.current!==null||s.memoizedState!==null)&&(sn=i)}function bs(i){if(i.tag===22){if(at(un,un.current),at(cn,i),sn===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(sn=i)}}else ws()}function ws(){at(un,un.current),at(cn,cn.current)}function sa(i){lt(cn),sn===i&&(sn=null),lt(un)}var un=Ne(0);function zo(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||ff(c)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Po(i,s,c,p){s=i.memoizedState,c=c(p,s),c=c==null?s:Ye({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Ro={enqueueSetState:function(i,s,c){i=i._reactInternals;var p=Rr(),x=qa(p);x.payload=s,c!=null&&(x.callback=c),s=ps(i,x,p),s!==null&&(Wr(s,i,p),ml(s,i,p))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var p=Rr(),x=qa(p);x.tag=1,x.payload=s,c!=null&&(x.callback=c),s=ps(i,x,p),s!==null&&(Wr(s,i,p),ml(s,i,p))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=Rr(),p=qa(c);p.tag=2,s!=null&&(p.callback=s),s=ps(i,p,c),s!==null&&(Wr(s,i,c),ml(s,i,c))}};function gd(i,s,c,p,x,M,k){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(p,M,k):s.prototype&&s.prototype.isPureReactComponent?!al(c,p)||!al(x,M):!0}function Tf(i,s,c,p){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,p),s.state!==i&&Ro.enqueueReplaceState(s,s.state,null)}function Do(i,s){var c=s;if("ref"in s){c={};for(var p in s)p!=="ref"&&(c[p]=s[p])}if(i=i.defaultProps){c===s&&(c=Ye({},c));for(var x in i)c[x]===void 0&&(c[x]=i[x])}return c}var Zu=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Gu(i){Zu(i)}function _d(i){console.error(i)}function Sf(i){Zu(i)}function Qc(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(p){setTimeout(function(){throw p})}}function Mf(i,s,c){try{var p=i.onCaughtError;p(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function qu(i,s,c){return c=qa(c),c.tag=3,c.payload={element:null},c.callback=function(){Qc(i,s)},c}function yd(i){return i=qa(i),i.tag=3,i}function vd(i,s,c,p){var x=c.type.getDerivedStateFromError;if(typeof x=="function"){var M=p.value;i.payload=function(){return x(M)},i.callback=function(){Mf(s,c,p)}}var k=c.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(i.callback=function(){Mf(s,c,p),typeof x!="function"&&(Sl===null?Sl=new Set([this]):Sl.add(this));var V=p.stack;this.componentDidCatch(p.value,{componentStack:V!==null?V:""})})}function Jc(i,s,c,p,x){if(c.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(s=c.alternate,s!==null&&hl(s,c,x,!0),c=cn.current,c!==null){switch(c.tag){case 13:return sn===null?qd():c.alternate===null&&Qi===0&&(Qi=3),c.flags&=-257,c.flags|=65536,c.lanes=x,p===st?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([p]):s.add(p),Yd(i,p,x)),!1;case 22:return c.flags|=65536,p===st?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([p])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([p]):c.add(p)),Yd(i,p,x)),!1}throw Error(Y(435,c.tag))}return Yd(i,p,x),qd(),!1}if(hi)return s=cn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=x,p!==cl&&(i=Error(Y(422),{cause:p}),Zs(Nn(i,c)))):(p!==cl&&(s=Error(Y(423),{cause:p}),Zs(Nn(s,c))),i=i.current.alternate,i.flags|=65536,x&=-x,i.lanes|=x,p=Nn(p,c),x=qu(i.stateNode,p,x),Hc(i,x),Qi!==4&&(Qi=2)),!1;var M=Error(Y(520),{cause:p});if(M=Nn(M,c),nh===null?nh=[M]:nh.push(M),Qi!==4&&(Qi=2),s===null)return!0;p=Nn(p,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=x&-x,c.lanes|=i,i=qu(c.stateNode,p,i),Hc(c,i),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Sl===null||!Sl.has(M))))return c.flags|=65536,x&=-x,c.lanes|=x,x=yd(x),vd(x,i,c,p),Hc(c,x),!1}c=c.return}while(c!==null);return!1}var Ef=Error(Y(461)),xn=!1;function qn(i,s,c,p){s.child=i===null?Ya(s,null,c,p):Ea(s,i.child,c,p)}function Hu(i,s,c,p,x){c=c.render;var M=s.ref;if("ref"in p){var k={};for(var V in p)V!=="ref"&&(k[V]=p[V])}else k=p;return Gs(s),p=Yc(i,s,c,k,M,x),V=Pi(),i!==null&&!xn?(Wi(i,s,x),Ts(i,s,x)):(hi&&V&&us(s),s.flags|=1,qn(i,s,p,x),s.child)}function Cf(i,s,c,p,x){if(i===null){var M=c.type;return typeof M=="function"&&!Bc(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,Af(i,s,M,p,x)):(i=Oc(c.type,null,p,s,s.mode,x),i.ref=s.ref,i.return=s,s.child=i)}if(M=i.child,!Sd(i,x)){var k=M.memoizedProps;if(c=c.compare,c=c!==null?c:al,c(k,p)&&i.ref===s.ref)return Ts(i,s,x)}return s.flags|=1,i=lr(M,p),i.ref=s.ref,i.return=s,s.child=i}function Af(i,s,c,p,x){if(i!==null){var M=i.memoizedProps;if(al(M,p)&&i.ref===s.ref)if(xn=!1,s.pendingProps=p=M,Sd(i,x))(i.flags&131072)!==0&&(xn=!0);else return s.lanes=i.lanes,Ts(i,s,x)}return Xu(i,s,c,p,x)}function zf(i,s,c){var p=s.pendingProps,x=p.children,M=i!==null?i.memoizedState:null;if(p.mode==="hidden"){if((s.flags&128)!==0){if(p=M!==null?M.baseLanes|c:c,i!==null){for(x=s.child=i.child,M=0;x!==null;)M=M|x.lanes|x.childLanes,x=x.sibling;s.childLanes=M&~p}else s.childLanes=0,s.child=null;return Pf(i,s,p,c)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&Nc(s,M!==null?M.cachePool:null),M!==null?gi(s,M):Nu(),bs(s);else return s.lanes=s.childLanes=536870912,Pf(i,s,M!==null?M.baseLanes|c:c,c)}else M!==null?(Nc(s,M.cachePool),gi(s,M),ws(),s.memoizedState=null):(i!==null&&Nc(s,null),Nu(),ws());return qn(i,s,x,c),s.child}function Pf(i,s,c,p){var x=ju();return x=x===null?null:{parent:An._currentValue,pool:x},s.memoizedState={baseLanes:c,cachePool:x},i!==null&&Nc(s,null),Nu(),bs(s),i!==null&&hl(i,s,p,!0),null}function $u(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(Y(284));(i===null||i.ref!==c)&&(s.flags|=4194816)}}function Xu(i,s,c,p,x){return Gs(s),c=Yc(i,s,c,p,void 0,x),p=Pi(),i!==null&&!xn?(Wi(i,s,x),Ts(i,s,x)):(hi&&p&&us(s),s.flags|=1,qn(i,s,c,x),s.child)}function xd(i,s,c,p,x,M){return Gs(s),s.updateQueue=null,c=Xs(s,p,c,x),aa(i),p=Pi(),i!==null&&!xn?(Wi(i,s,M),Ts(i,s,M)):(hi&&p&&us(s),s.flags|=1,qn(i,s,c,M),s.child)}function bd(i,s,c,p,x){if(Gs(s),s.stateNode===null){var M=Vt,k=c.contextType;typeof k=="object"&&k!==null&&(M=_n(k)),M=new c(p,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Ro,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=p,M.state=s.memoizedState,M.refs={},lc(s),k=c.contextType,M.context=typeof k=="object"&&k!==null?_n(k):Vt,M.state=s.memoizedState,k=c.getDerivedStateFromProps,typeof k=="function"&&(Po(s,c,k,p),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(k=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),k!==M.state&&Ro.enqueueReplaceState(M,M.state,null),gl(s,p,M,x),Eo(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),p=!0}else if(i===null){M=s.stateNode;var V=s.memoizedProps,ae=Do(c,V);M.props=ae;var Ee=M.context,je=c.contextType;k=Vt,typeof je=="object"&&je!==null&&(k=_n(je));var Ge=c.getDerivedStateFromProps;je=typeof Ge=="function"||typeof M.getSnapshotBeforeUpdate=="function",V=s.pendingProps!==V,je||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(V||Ee!==k)&&Tf(s,M,p,k),Ot=!1;var ze=s.memoizedState;M.state=ze,gl(s,p,M,x),Eo(),Ee=s.memoizedState,V||ze!==Ee||Ot?(typeof Ge=="function"&&(Po(s,c,Ge,p),Ee=s.memoizedState),(ae=Ot||gd(s,c,ae,p,ze,Ee,k))?(je||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=Ee),M.props=p,M.state=Ee,M.context=k,p=ae):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{M=s.stateNode,qc(i,s),k=s.memoizedProps,je=Do(c,k),M.props=je,Ge=s.pendingProps,ze=M.context,Ee=c.contextType,ae=Vt,typeof Ee=="object"&&Ee!==null&&(ae=_n(Ee)),V=c.getDerivedStateFromProps,(Ee=typeof V=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(k!==Ge||ze!==ae)&&Tf(s,M,p,ae),Ot=!1,ze=s.memoizedState,M.state=ze,gl(s,p,M,x),Eo();var De=s.memoizedState;k!==Ge||ze!==De||Ot||i!==null&&i.dependencies!==null&&sc(i.dependencies)?(typeof V=="function"&&(Po(s,c,V,p),De=s.memoizedState),(je=Ot||gd(s,c,je,p,ze,De,ae)||i!==null&&i.dependencies!==null&&sc(i.dependencies))?(Ee||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(p,De,ae),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(p,De,ae)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||k===i.memoizedProps&&ze===i.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||k===i.memoizedProps&&ze===i.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=De),M.props=p,M.state=De,M.context=ae,p=je):(typeof M.componentDidUpdate!="function"||k===i.memoizedProps&&ze===i.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||k===i.memoizedProps&&ze===i.memoizedState||(s.flags|=1024),p=!1)}return M=p,$u(i,s),p=(s.flags&128)!==0,M||p?(M=s.stateNode,c=p&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,i!==null&&p?(s.child=Ea(s,i.child,null,x),s.child=Ea(s,null,c,x)):qn(i,s,c,x),s.memoizedState=M.state,i=s.child):i=Ts(i,s,x),i}function Rf(i,s,c,p){return ya(),s.flags|=256,qn(i,s,c,p),s.child}var wd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Uh(i){return{baseLanes:i,cachePool:oc()}}function Nh(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=Qa),i}function Df(i,s,c){var p=s.pendingProps,x=!1,M=(s.flags&128)!==0,k;if((k=M)||(k=i!==null&&i.memoizedState===null?!1:(un.current&2)!==0),k&&(x=!0,s.flags&=-129),k=(s.flags&32)!==0,s.flags&=-33,i===null){if(hi){if(x?Ka(s):ws(),hi){var V=Hi,ae;if(ae=V){e:{for(ae=V,V=_a;ae.nodeType!==8;){if(!V){V=null;break e}if(ae=Ja(ae.nextSibling),ae===null){V=null;break e}}V=ae}V!==null?(s.memoizedState={dehydrated:V,treeContext:ma!==null?{id:Xr,overflow:xr}:null,retryLane:536870912,hydrationErrors:null},ae=Hr(18,null,null,0),ae.stateNode=V,ae.return=s,s.child=ae,Dn=s,Hi=null,ae=!0):ae=!1}ae||hs(s)}if(V=s.memoizedState,V!==null&&(V=V.dehydrated,V!==null))return ff(V)?s.lanes=32:s.lanes=536870912,null;sa(s)}return V=p.children,p=p.fallback,x?(ws(),x=s.mode,V=Ku({mode:"hidden",children:V},x),p=Us(p,x,c,null),V.return=s,p.return=s,V.sibling=p,s.child=V,x=s.child,x.memoizedState=Uh(c),x.childLanes=Nh(i,k,c),s.memoizedState=wd,p):(Ka(s),Yu(s,V))}if(ae=i.memoizedState,ae!==null&&(V=ae.dehydrated,V!==null)){if(M)s.flags&256?(Ka(s),s.flags&=-257,s=Wu(i,s,c)):s.memoizedState!==null?(ws(),s.child=i.child,s.flags|=128,s=null):(ws(),x=p.fallback,V=s.mode,p=Ku({mode:"visible",children:p.children},V),x=Us(x,V,c,null),x.flags|=2,p.return=s,x.return=s,p.sibling=x,s.child=p,Ea(s,i.child,null,c),p=s.child,p.memoizedState=Uh(c),p.childLanes=Nh(i,k,c),s.memoizedState=wd,s=x);else if(Ka(s),ff(V)){if(k=V.nextSibling&&V.nextSibling.dataset,k)var Ee=k.dgst;k=Ee,p=Error(Y(419)),p.stack="",p.digest=k,Zs({value:p,source:null,stack:null}),s=Wu(i,s,c)}else if(xn||hl(i,s,c,!1),k=(c&i.childLanes)!==0,xn||k){if(k=Ni,k!==null&&(p=c&-c,p=(p&42)!==0?1:Lt(p),p=(p&(k.suspendedLanes|c))!==0?0:p,p!==0&&p!==ae.retryLane))throw ae.retryLane=p,qr(i,p),Wr(k,i,p),Ef;V.data==="$?"||qd(),s=Wu(i,s,c)}else V.data==="$?"?(s.flags|=192,s.child=i.child,s=null):(i=ae.treeContext,Hi=Ja(V.nextSibling),Dn=s,hi=!0,Vs=null,_a=!1,i!==null&&($r[cr++]=Xr,$r[cr++]=xr,$r[cr++]=ma,Xr=i.id,xr=i.overflow,ma=s),s=Yu(s,p.children),s.flags|=4096);return s}return x?(ws(),x=p.fallback,V=s.mode,ae=i.child,Ee=ae.sibling,p=lr(ae,{mode:"hidden",children:p.children}),p.subtreeFlags=ae.subtreeFlags&65011712,Ee!==null?x=lr(Ee,x):(x=Us(x,V,c,null),x.flags|=2),x.return=s,p.return=s,p.sibling=x,s.child=p,p=x,x=s.child,V=i.child.memoizedState,V===null?V=Uh(c):(ae=V.cachePool,ae!==null?(Ee=An._currentValue,ae=ae.parent!==Ee?{parent:Ee,pool:Ee}:ae):ae=oc(),V={baseLanes:V.baseLanes|c,cachePool:ae}),x.memoizedState=V,x.childLanes=Nh(i,k,c),s.memoizedState=wd,p):(Ka(s),c=i.child,i=c.sibling,c=lr(c,{mode:"visible",children:p.children}),c.return=s,c.sibling=null,i!==null&&(k=s.deletions,k===null?(s.deletions=[i],s.flags|=16):k.push(i)),s.child=c,s.memoizedState=null,c)}function Yu(i,s){return s=Ku({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function Ku(i,s){return i=Hr(22,i,null,s),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function Wu(i,s,c){return Ea(s,i.child,null,c),i=Yu(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function eu(i,s,c){i.lanes|=s;var p=i.alternate;p!==null&&(p.lanes|=s),ac(i.return,s,c)}function Ar(i,s,c,p,x){var M=i.memoizedState;M===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:x}:(M.isBackwards=s,M.rendering=null,M.renderingStartTime=0,M.last=p,M.tail=c,M.tailMode=x)}function Td(i,s,c){var p=s.pendingProps,x=p.revealOrder,M=p.tail;if(qn(i,s,p.children,c),p=un.current,(p&2)!==0)p=p&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&eu(i,c,s);else if(i.tag===19)eu(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}p&=1}switch(at(un,p),x){case"forwards":for(c=s.child,x=null;c!==null;)i=c.alternate,i!==null&&zo(i)===null&&(x=c),c=c.sibling;c=x,c===null?(x=s.child,s.child=null):(x=c.sibling,c.sibling=null),Ar(s,!1,x,c,M);break;case"backwards":for(c=null,x=s.child,s.child=null;x!==null;){if(i=x.alternate,i!==null&&zo(i)===null){s.child=x;break}i=x.sibling,x.sibling=c,c=x,x=i}Ar(s,!0,c,null,M);break;case"together":Ar(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Ts(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),Oo|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(hl(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(Y(153));if(s.child!==null){for(i=s.child,c=lr(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=lr(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function Sd(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&sc(i)))}function If(i,s,c){switch(s.tag){case 3:si(s,s.stateNode.containerInfo),Lr(s,An,i.memoizedState.cache),ya();break;case 27:case 5:As(s);break;case 4:si(s,s.stateNode.containerInfo);break;case 10:Lr(s,s.type,s.memoizedProps.value);break;case 13:var p=s.memoizedState;if(p!==null)return p.dehydrated!==null?(Ka(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Df(i,s,c):(Ka(s),i=Ts(i,s,c),i!==null?i.sibling:null);Ka(s);break;case 19:var x=(i.flags&128)!==0;if(p=(c&s.childLanes)!==0,p||(hl(i,s,c,!1),p=(c&s.childLanes)!==0),x){if(p)return Td(i,s,c);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),at(un,un.current),p)break;return null;case 22:case 23:return s.lanes=0,zf(i,s,c);case 24:Lr(s,An,i.memoizedState.cache)}return Ts(i,s,c)}function kf(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)xn=!0;else{if(!Sd(i,c)&&(s.flags&128)===0)return xn=!1,If(i,s,c);xn=(i.flags&131072)!==0}else xn=!1,hi&&(s.flags&1048576)!==0&&Fc(s,ll,s.index);switch(s.lanes=0,s.tag){case 16:e:{i=s.pendingProps;var p=s.elementType,x=p._init;if(p=x(p._payload),s.type=p,typeof p=="function")Bc(p)?(i=Do(p,i),s.tag=1,s=bd(null,s,p,i,c)):(s.tag=0,s=Xu(null,s,p,i,c));else{if(p!=null){if(x=p.$$typeof,x===ii){s.tag=11,s=Hu(null,s,p,i,c);break e}else if(x===vi){s.tag=14,s=Cf(null,s,p,i,c);break e}}throw s=pn(p)||p,Error(Y(306,s,""))}}return s;case 0:return Xu(i,s,s.type,s.pendingProps,c);case 1:return p=s.type,x=Do(p,s.pendingProps),bd(i,s,p,x,c);case 3:e:{if(si(s,s.stateNode.containerInfo),i===null)throw Error(Y(387));p=s.pendingProps;var M=s.memoizedState;x=M.element,qc(i,s),gl(s,p,null,c);var k=s.memoizedState;if(p=k.cache,Lr(s,An,p),p!==M.cache&&Uc(s,[An],c,!0),Eo(),p=k.element,M.isDehydrated)if(M={element:p,isDehydrated:!1,cache:k.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=Rf(i,s,p,c);break e}else if(p!==x){x=Nn(Error(Y(424)),s),Zs(x),s=Rf(i,s,p,c);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Hi=Ja(i.firstChild),Dn=s,hi=!0,Vs=null,_a=!0,c=Ya(s,null,p,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ya(),p===x){s=Ts(i,s,c);break e}qn(i,s,p,c)}s=s.child}return s;case 26:return $u(i,s),i===null?(c=ld(s.type,null,s.pendingProps,null))?s.memoizedState=c:hi||(c=s.type,i=s.pendingProps,p=Or(bt.current).createElement(c),p[St]=s,p[Rt]=i,Ln(p,c,i),qi(p),s.stateNode=p):s.memoizedState=ld(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return As(s),i===null&&hi&&(p=s.stateNode=_h(s.type,s.pendingProps,bt.current),Dn=s,_a=!0,x=Hi,Zo(s.type)?(du=x,Hi=Ja(p.firstChild)):Hi=x),qn(i,s,s.pendingProps.children,c),$u(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&hi&&((x=p=Hi)&&(p=cp(p,s.type,s.pendingProps,_a),p!==null?(s.stateNode=p,Dn=s,Hi=Ja(p.firstChild),_a=!1,x=!0):x=!1),x||hs(s)),As(s),x=s.type,M=s.pendingProps,k=i!==null?i.memoizedProps:null,p=M.children,Vo(x,M)?p=null:k!==null&&Vo(x,k)&&(s.flags|=32),s.memoizedState!==null&&(x=Yc(i,s,yl,null,null,c),z._currentValue=x),$u(i,s),qn(i,s,p,c),s.child;case 6:return i===null&&hi&&((i=c=Hi)&&(c=Ep(c,s.pendingProps,_a),c!==null?(s.stateNode=c,Dn=s,Hi=null,i=!0):i=!1),i||hs(s)),null;case 13:return Df(i,s,c);case 4:return si(s,s.stateNode.containerInfo),p=s.pendingProps,i===null?s.child=Ea(s,null,p,c):qn(i,s,p,c),s.child;case 11:return Hu(i,s,s.type,s.pendingProps,c);case 7:return qn(i,s,s.pendingProps,c),s.child;case 8:return qn(i,s,s.pendingProps.children,c),s.child;case 12:return qn(i,s,s.pendingProps.children,c),s.child;case 10:return p=s.pendingProps,Lr(s,s.type,p.value),qn(i,s,p.children,c),s.child;case 9:return x=s.type._context,p=s.pendingProps.children,Gs(s),x=_n(x),p=p(x),s.flags|=1,qn(i,s,p,c),s.child;case 14:return Cf(i,s,s.type,s.pendingProps,c);case 15:return Af(i,s,s.type,s.pendingProps,c);case 19:return Td(i,s,c);case 31:return p=s.pendingProps,c=s.mode,p={mode:p.mode,children:p.children},i===null?(c=Ku(p,c),c.ref=s.ref,s.child=c,c.return=s,s=c):(c=lr(i.child,p),c.ref=s.ref,s.child=c,c.return=s,s=c),s;case 22:return zf(i,s,c);case 24:return Gs(s),p=_n(An),i===null?(x=ju(),x===null&&(x=Ni,M=qs(),x.pooledCache=M,M.refCount++,M!==null&&(x.pooledCacheLanes|=c),x=M),s.memoizedState={parent:p,cache:x},lc(s),Lr(s,An,x)):((i.lanes&c)!==0&&(qc(i,s),gl(s,null,null,c),Eo()),x=i.memoizedState,M=s.memoizedState,x.parent!==p?(x={parent:p,cache:p},s.memoizedState=x,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=x),Lr(s,An,p)):(p=M.cache,Lr(s,An,p),p!==x.cache&&Uc(s,[An],c,!0))),qn(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(Y(156,s.tag))}function Io(i){i.flags|=4}function Md(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!n(s)){if(s=cn.current,s!==null&&((ui&4194048)===ui?sn!==null:(ui&62914560)!==ui&&(ui&536870912)===0||s!==sn))throw ba=st,$s;i.flags|=8192}}function Vh(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Oe():536870912,i.lanes|=s,nu|=s)}function dc(i,s){if(!hi)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:p.sibling=null}}function hn(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,p=0;if(s)for(var x=i.child;x!==null;)c|=x.lanes|x.childLanes,p|=x.subtreeFlags&65011712,p|=x.flags&65011712,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)c|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=p,i.childLanes=c,s}function Lf(i,s,c){var p=s.pendingProps;switch(rc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hn(s),null;case 1:return hn(s),null;case 3:return c=s.stateNode,p=null,i!==null&&(p=i.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),Yr(An),jn(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(wi(s)?Io(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,kr())),hn(s),null;case 26:return c=s.memoizedState,i===null?(Io(s),c!==null?(hn(s),Md(s,c)):(hn(s),s.flags&=-16777217)):c?c!==i.memoizedState?(Io(s),hn(s),Md(s,c)):(hn(s),s.flags&=-16777217):(i.memoizedProps!==p&&Io(s),hn(s),s.flags&=-16777217),null;case 27:es(s),c=bt.current;var x=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==p&&Io(s);else{if(!p){if(s.stateNode===null)throw Error(Y(166));return hn(s),null}i=xt.current,wi(s)?Bu(s):(i=_h(x,p,c),s.stateNode=i,Io(s))}return hn(s),null;case 5:if(es(s),c=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==p&&Io(s);else{if(!p){if(s.stateNode===null)throw Error(Y(166));return hn(s),null}if(i=xt.current,wi(s))Bu(s);else{switch(x=Or(bt.current),i){case 1:i=x.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:i=x.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":i=x.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":i=x.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":i=x.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof p.is=="string"?x.createElement("select",{is:p.is}):x.createElement("select"),p.multiple?i.multiple=!0:p.size&&(i.size=p.size);break;default:i=typeof p.is=="string"?x.createElement(c,{is:p.is}):x.createElement(c)}}i[St]=s,i[Rt]=p;e:for(x=s.child;x!==null;){if(x.tag===5||x.tag===6)i.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===s)break e;for(;x.sibling===null;){if(x.return===null||x.return===s)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}s.stateNode=i;e:switch(Ln(i,c,p),c){case"button":case"input":case"select":case"textarea":i=!!p.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Io(s)}}return hn(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==p&&Io(s);else{if(typeof p!="string"&&s.stateNode===null)throw Error(Y(166));if(i=bt.current,wi(s)){if(i=s.stateNode,c=s.memoizedProps,p=null,x=Dn,x!==null)switch(x.tag){case 27:case 5:p=x.memoizedProps}i[St]=s,i=!!(i.nodeValue===c||p!==null&&p.suppressHydrationWarning===!0||uf(i.nodeValue,c)),i||hs(s)}else i=Or(i).createTextNode(p),i[St]=s,s.stateNode=i}return hn(s),null;case 13:if(p=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(x=wi(s),p!==null&&p.dehydrated!==null){if(i===null){if(!x)throw Error(Y(318));if(x=s.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(Y(317));x[St]=s}else ya(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;hn(s),x=!1}else x=kr(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=x),x=!0;if(!x)return s.flags&256?(sa(s),s):(sa(s),null)}if(sa(s),(s.flags&128)!==0)return s.lanes=c,s;if(c=p!==null,i=i!==null&&i.memoizedState!==null,c){p=s.child,x=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(x=p.alternate.memoizedState.cachePool.pool);var M=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(M=p.memoizedState.cachePool.pool),M!==x&&(p.flags|=2048)}return c!==i&&c&&(s.child.flags|=8192),Vh(s,s.updateQueue),hn(s),null;case 4:return jn(),i===null&&of(s.stateNode.containerInfo),hn(s),null;case 10:return Yr(s.type),hn(s),null;case 19:if(lt(un),x=s.memoizedState,x===null)return hn(s),null;if(p=(s.flags&128)!==0,M=x.rendering,M===null)if(p)dc(x,!1);else{if(Qi!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(M=zo(i),M!==null){for(s.flags|=128,dc(x,!1),i=M.updateQueue,s.updateQueue=i,Vh(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)ku(c,i),c=c.sibling;return at(un,un.current&1|2),s.child}i=i.sibling}x.tail!==null&&rr()>ah&&(s.flags|=128,p=!0,dc(x,!1),s.lanes=4194304)}else{if(!p)if(i=zo(M),i!==null){if(s.flags|=128,p=!0,i=i.updateQueue,s.updateQueue=i,Vh(s,i),dc(x,!0),x.tail===null&&x.tailMode==="hidden"&&!M.alternate&&!hi)return hn(s),null}else 2*rr()-x.renderingStartTime>ah&&c!==536870912&&(s.flags|=128,p=!0,dc(x,!1),s.lanes=4194304);x.isBackwards?(M.sibling=s.child,s.child=M):(i=x.last,i!==null?i.sibling=M:s.child=M,x.last=M)}return x.tail!==null?(s=x.tail,x.rendering=s,x.tail=s.sibling,x.renderingStartTime=rr(),s.sibling=null,i=un.current,at(un,p?i&1|2:i&1),s):(hn(s),null);case 22:case 23:return sa(s),_l(),p=s.memoizedState!==null,i!==null?i.memoizedState!==null!==p&&(s.flags|=8192):p&&(s.flags|=8192),p?(c&536870912)!==0&&(s.flags&128)===0&&(hn(s),s.subtreeFlags&6&&(s.flags|=8192)):hn(s),c=s.updateQueue,c!==null&&Vh(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),p=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==c&&(s.flags|=2048),i!==null&&lt(xa),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Yr(An),hn(s),null;case 25:return null;case 30:return null}throw Error(Y(156,s.tag))}function xp(i,s){switch(rc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Yr(An),jn(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return es(s),null;case 13:if(sa(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(Y(340));ya()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return lt(un),null;case 4:return jn(),null;case 10:return Yr(s.type),null;case 22:case 23:return sa(s),_l(),i!==null&&lt(xa),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Yr(An),null;case 25:return null;default:return null}}function Bf(i,s){switch(rc(s),s.tag){case 3:Yr(An),jn();break;case 26:case 27:case 5:es(s);break;case 4:jn();break;case 13:sa(s);break;case 19:lt(un);break;case 10:Yr(s.type);break;case 22:case 23:sa(s),_l(),i!==null&&lt(xa);break;case 24:Yr(An)}}function Qu(i,s){try{var c=s.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var x=p.next;c=x;do{if((c.tag&i)===i){p=void 0;var M=c.create,k=c.inst;p=M(),k.destroy=p}c=c.next}while(c!==x)}}catch(V){Vi(s,s.return,V)}}function Qs(i,s,c){try{var p=s.updateQueue,x=p!==null?p.lastEffect:null;if(x!==null){var M=x.next;p=M;do{if((p.tag&i)===i){var k=p.inst,V=k.destroy;if(V!==void 0){k.destroy=void 0,x=s;var ae=c,Ee=V;try{Ee()}catch(je){Vi(x,ae,je)}}}p=p.next}while(p!==M)}}catch(je){Vi(s,s.return,je)}}function Zh(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{Uu(s,c)}catch(p){Vi(i,i.return,p)}}}function Ed(i,s,c){c.props=Do(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(p){Vi(i,s,p)}}function Ss(i,s){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var p=i.stateNode;break;case 30:p=i.stateNode;break;default:p=i.stateNode}typeof c=="function"?i.refCleanup=c(p):c.current=p}}catch(x){Vi(i,s,x)}}function oa(i,s){var c=i.ref,p=i.refCleanup;if(c!==null)if(typeof p=="function")try{p()}catch(x){Vi(i,s,x)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(x){Vi(i,s,x)}else c.current=null}function Of(i){var s=i.type,c=i.memoizedProps,p=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&p.focus();break e;case"img":c.src?p.src=c.src:c.srcSet&&(p.srcset=c.srcSet)}}catch(x){Vi(i,i.return,x)}}function Cd(i,s,c){try{var p=i.stateNode;rp(p,i.type,c,s),p[Rt]=s}catch(x){Vi(i,i.return,x)}}function Ff(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Zo(i.type)||i.tag===4}function Ad(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Ff(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Zo(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function zd(i,s,c){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(i),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=mh));else if(p!==4&&(p===27&&Zo(i.type)&&(c=i.stateNode,s=null),i=i.child,i!==null))for(zd(i,s,c),i=i.sibling;i!==null;)zd(i,s,c),i=i.sibling}function Gh(i,s,c){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(p!==4&&(p===27&&Zo(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(Gh(i,s,c),i=i.sibling;i!==null;)Gh(i,s,c),i=i.sibling}function jf(i){var s=i.stateNode,c=i.memoizedProps;try{for(var p=i.type,x=s.attributes;x.length;)s.removeAttributeNode(x[0]);Ln(s,p,c),s[St]=i,s[Rt]=c}catch(M){Vi(i,i.return,M)}}var Ms=!1,In=!1,qh=!1,tu=typeof WeakSet=="function"?WeakSet:Set,hr=null;function bn(i,s){if(i=i.containerInfo,gh=te,i=Dc(i),Kl(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var x=p.anchorOffset,M=p.focusNode;p=p.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var k=0,V=-1,ae=-1,Ee=0,je=0,Ge=i,ze=null;t:for(;;){for(var De;Ge!==c||x!==0&&Ge.nodeType!==3||(V=k+x),Ge!==M||p!==0&&Ge.nodeType!==3||(ae=k+p),Ge.nodeType===3&&(k+=Ge.nodeValue.length),(De=Ge.firstChild)!==null;)ze=Ge,Ge=De;for(;;){if(Ge===i)break t;if(ze===c&&++Ee===x&&(V=k),ze===M&&++je===p&&(ae=k),(De=Ge.nextSibling)!==null)break;Ge=ze,ze=Ge.parentNode}Ge=De}c=V===-1||ae===-1?null:{start:V,end:ae}}else c=null}c=c||{start:0,end:0}}else c=null;for(rd={focusedElem:i,selectionRange:c},te=!1,hr=s;hr!==null;)if(s=hr,i=s.child,(s.subtreeFlags&1024)!==0&&i!==null)i.return=s,hr=i;else for(;hr!==null;){switch(s=hr,M=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&M!==null){i=void 0,c=s,x=M.memoizedProps,M=M.memoizedState,p=c.stateNode;try{var Ft=Do(c.type,x,c.elementType===c.type);i=p.getSnapshotBeforeUpdate(Ft,M),p.__reactInternalSnapshotBeforeUpdate=i}catch(It){Vi(c,c.return,It)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)sd(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":sd(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(Y(163))}if(i=s.sibling,i!==null){i.return=s.return,hr=i;break}hr=s.return}}function fc(i,s,c){var p=c.flags;switch(c.tag){case 0:case 11:case 15:ko(i,c),p&4&&Qu(5,c);break;case 1:if(ko(i,c),p&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(k){Vi(c,c.return,k)}else{var x=Do(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(x,s,i.__reactInternalSnapshotBeforeUpdate)}catch(k){Vi(c,c.return,k)}}p&64&&Zh(c),p&512&&Ss(c,c.return);break;case 3:if(ko(i,c),p&64&&(i=c.updateQueue,i!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Uu(i,s)}catch(k){Vi(c,c.return,k)}}break;case 27:s===null&&p&4&&jf(c);case 26:case 5:ko(i,c),s===null&&p&4&&Of(c),p&512&&Ss(c,c.return);break;case 12:ko(i,c);break;case 13:ko(i,c),p&4&&Dd(i,c),p&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=Wd.bind(null,c),up(i,c))));break;case 22:if(p=c.memoizedState!==null||Ms,!p){s=s!==null&&s.memoizedState!==null||In,x=Ms;var M=In;Ms=p,(In=s)&&!M?Tl(i,c,(c.subtreeFlags&8772)!==0):ko(i,c),Ms=x,In=M}break;case 30:break;default:ko(i,c)}}function Pd(i){var s=i.alternate;s!==null&&(i.alternate=null,Pd(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&nt(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Xi=null,zr=!1;function Ca(i,s,c){for(c=c.child;c!==null;)Rd(i,s,c),c=c.sibling}function Rd(i,s,c){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount(ta,c)}catch{}switch(c.tag){case 26:In||oa(c,s),Ca(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:In||oa(c,s);var p=Xi,x=zr;Zo(c.type)&&(Xi=c.stateNode,zr=!1),Ca(i,s,c),zl(c.stateNode),Xi=p,zr=x;break;case 5:In||oa(c,s);case 6:if(p=Xi,x=zr,Xi=null,Ca(i,s,c),Xi=p,zr=x,Xi!==null)if(zr)try{(Xi.nodeType===9?Xi.body:Xi.nodeName==="HTML"?Xi.ownerDocument.body:Xi).removeChild(c.stateNode)}catch(M){Vi(c,s,M)}else try{Xi.removeChild(c.stateNode)}catch(M){Vi(c,s,M)}break;case 18:Xi!==null&&(zr?(i=Xi,df(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),Tn(i)):df(Xi,c.stateNode));break;case 4:p=Xi,x=zr,Xi=c.stateNode.containerInfo,zr=!0,Ca(i,s,c),Xi=p,zr=x;break;case 0:case 11:case 14:case 15:In||Qs(2,c,s),In||Qs(4,c,s),Ca(i,s,c);break;case 1:In||(oa(c,s),p=c.stateNode,typeof p.componentWillUnmount=="function"&&Ed(c,s,p)),Ca(i,s,c);break;case 21:Ca(i,s,c);break;case 22:In=(p=In)||c.memoizedState!==null,Ca(i,s,c),In=p;break;default:Ca(i,s,c)}}function Dd(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Tn(i)}catch(c){Vi(s,s.return,c)}}function Ju(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new tu),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new tu),s;default:throw Error(Y(435,i.tag))}}function eh(i,s){var c=Ju(i);s.forEach(function(p){var x=Qd.bind(null,i,p);c.has(p)||(c.add(p),p.then(x,x))})}function dr(i,s){var c=s.deletions;if(c!==null)for(var p=0;p<c.length;p++){var x=c[p],M=i,k=s,V=k;e:for(;V!==null;){switch(V.tag){case 27:if(Zo(V.type)){Xi=V.stateNode,zr=!1;break e}break;case 5:Xi=V.stateNode,zr=!1;break e;case 3:case 4:Xi=V.stateNode.containerInfo,zr=!0;break e}V=V.return}if(Xi===null)throw Error(Y(160));Rd(M,k,x),Xi=null,zr=!1,M=x.alternate,M!==null&&(M.return=null),x.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)pc(s,i),s=s.sibling}var la=null;function pc(i,s){var c=i.alternate,p=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:dr(s,i),Pr(i),p&4&&(Qs(3,i,i.return),Qu(3,i),Qs(5,i,i.return));break;case 1:dr(s,i),Pr(i),p&512&&(In||c===null||oa(c,c.return)),p&64&&Ms&&(i=i.updateQueue,i!==null&&(p=i.callbacks,p!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?p:c.concat(p))));break;case 26:var x=la;if(dr(s,i),Pr(i),p&512&&(In||c===null||oa(c,c.return)),p&4){var M=c!==null?c.memoizedState:null;if(p=i.memoizedState,c===null)if(p===null)if(i.stateNode===null){e:{p=i.type,c=i.memoizedProps,x=x.ownerDocument||x;t:switch(p){case"title":M=x.getElementsByTagName("title")[0],(!M||M[ka]||M[St]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=x.createElement(p),x.head.insertBefore(M,x.querySelector("head > title"))),Ln(M,p,c),M[St]=i,qi(M),p=M;break e;case"link":var k=gp("link","href",x).get(p+(c.href||""));if(k){for(var V=0;V<k.length;V++)if(M=k[V],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){k.splice(V,1);break t}}M=x.createElement(p),Ln(M,p,c),x.head.appendChild(M);break;case"meta":if(k=gp("meta","content",x).get(p+(c.content||""))){for(V=0;V<k.length;V++)if(M=k[V],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){k.splice(V,1);break t}}M=x.createElement(p),Ln(M,p,c),x.head.appendChild(M);break;default:throw Error(Y(468,p))}M[St]=i,qi(M),p=M}i.stateNode=p}else r(x,i.type,i.stateNode);else i.stateNode=yh(x,p,i.memoizedProps);else M!==p?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,p===null?r(x,i.type,i.stateNode):yh(x,p,i.memoizedProps)):p===null&&i.stateNode!==null&&Cd(i,i.memoizedProps,c.memoizedProps)}break;case 27:dr(s,i),Pr(i),p&512&&(In||c===null||oa(c,c.return)),c!==null&&p&4&&Cd(i,i.memoizedProps,c.memoizedProps);break;case 5:if(dr(s,i),Pr(i),p&512&&(In||c===null||oa(c,c.return)),i.flags&32){x=i.stateNode;try{Fa(x,"")}catch(De){Vi(i,i.return,De)}}p&4&&i.stateNode!=null&&(x=i.memoizedProps,Cd(i,x,c!==null?c.memoizedProps:x)),p&1024&&(qh=!0);break;case 6:if(dr(s,i),Pr(i),p&4){if(i.stateNode===null)throw Error(Y(162));p=i.memoizedProps,c=i.stateNode;try{c.nodeValue=p}catch(De){Vi(i,i.return,De)}}break;case 3:if(gu=null,x=la,la=od(s.containerInfo),dr(s,i),la=x,Pr(i),p&4&&c!==null&&c.memoizedState.isDehydrated)try{Tn(s.containerInfo)}catch(De){Vi(i,i.return,De)}qh&&(qh=!1,Uf(i));break;case 4:p=la,la=od(i.stateNode.containerInfo),dr(s,i),Pr(i),la=p;break;case 12:dr(s,i),Pr(i);break;case 13:dr(s,i),Pr(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Xh=rr()),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,eh(i,p)));break;case 22:x=i.memoizedState!==null;var ae=c!==null&&c.memoizedState!==null,Ee=Ms,je=In;if(Ms=Ee||x,In=je||ae,dr(s,i),In=je,Ms=Ee,Pr(i),p&8192)e:for(s=i.stateNode,s._visibility=x?s._visibility&-2:s._visibility|1,x&&(c===null||ae||Ms||In||Aa(i)),c=null,s=i;;){if(s.tag===5||s.tag===26){if(c===null){ae=c=s;try{if(M=ae.stateNode,x)k=M.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{V=ae.stateNode;var Ge=ae.memoizedProps.style,ze=Ge!=null&&Ge.hasOwnProperty("display")?Ge.display:null;V.style.display=ze==null||typeof ze=="boolean"?"":(""+ze).trim()}}catch(De){Vi(ae,ae.return,De)}}}else if(s.tag===6){if(c===null){ae=s;try{ae.stateNode.nodeValue=x?"":ae.memoizedProps}catch(De){Vi(ae,ae.return,De)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}p&4&&(p=i.updateQueue,p!==null&&(c=p.retryQueue,c!==null&&(p.retryQueue=null,eh(i,c))));break;case 19:dr(s,i),Pr(i),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,eh(i,p)));break;case 30:break;case 21:break;default:dr(s,i),Pr(i)}}function Pr(i){var s=i.flags;if(s&2){try{for(var c,p=i.return;p!==null;){if(Ff(p)){c=p;break}p=p.return}if(c==null)throw Error(Y(160));switch(c.tag){case 27:var x=c.stateNode,M=Ad(i);Gh(i,M,x);break;case 5:var k=c.stateNode;c.flags&32&&(Fa(k,""),c.flags&=-33);var V=Ad(i);Gh(i,V,k);break;case 3:case 4:var ae=c.stateNode.containerInfo,Ee=Ad(i);zd(i,Ee,ae);break;default:throw Error(Y(161))}}catch(je){Vi(i,i.return,je)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function Uf(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;Uf(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function ko(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)fc(i,s.alternate,s),s=s.sibling}function Aa(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Qs(4,s,s.return),Aa(s);break;case 1:oa(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Ed(s,s.return,c),Aa(s);break;case 27:zl(s.stateNode);case 26:case 5:oa(s,s.return),Aa(s);break;case 22:s.memoizedState===null&&Aa(s);break;case 30:Aa(s);break;default:Aa(s)}i=i.sibling}}function Tl(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var p=s.alternate,x=i,M=s,k=M.flags;switch(M.tag){case 0:case 11:case 15:Tl(x,M,c),Qu(4,M);break;case 1:if(Tl(x,M,c),p=M,x=p.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(Ee){Vi(p,p.return,Ee)}if(p=M,x=p.updateQueue,x!==null){var V=p.stateNode;try{var ae=x.shared.hiddenCallbacks;if(ae!==null)for(x.shared.hiddenCallbacks=null,x=0;x<ae.length;x++)$c(ae[x],V)}catch(Ee){Vi(p,p.return,Ee)}}c&&k&64&&Zh(M),Ss(M,M.return);break;case 27:jf(M);case 26:case 5:Tl(x,M,c),c&&p===null&&k&4&&Of(M),Ss(M,M.return);break;case 12:Tl(x,M,c);break;case 13:Tl(x,M,c),c&&k&4&&Dd(x,M);break;case 22:M.memoizedState===null&&Tl(x,M,c),Ss(M,M.return);break;case 30:break;default:Tl(x,M,c)}s=s.sibling}}function Hh(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&wo(c))}function mc(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&wo(i))}function Wa(i,s,c,p){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Id(i,s,c,p),s=s.sibling}function Id(i,s,c,p){var x=s.flags;switch(s.tag){case 0:case 11:case 15:Wa(i,s,c,p),x&2048&&Qu(9,s);break;case 1:Wa(i,s,c,p);break;case 3:Wa(i,s,c,p),x&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&wo(i)));break;case 12:if(x&2048){Wa(i,s,c,p),i=s.stateNode;try{var M=s.memoizedProps,k=M.id,V=M.onPostCommit;typeof V=="function"&&V(k,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ae){Vi(s,s.return,ae)}}else Wa(i,s,c,p);break;case 13:Wa(i,s,c,p);break;case 23:break;case 22:M=s.stateNode,k=s.alternate,s.memoizedState!==null?M._visibility&2?Wa(i,s,c,p):th(i,s):M._visibility&2?Wa(i,s,c,p):(M._visibility|=2,gc(i,s,c,p,(s.subtreeFlags&10256)!==0)),x&2048&&Hh(k,s);break;case 24:Wa(i,s,c,p),x&2048&&mc(s.alternate,s);break;default:Wa(i,s,c,p)}}function gc(i,s,c,p,x){for(x=x&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var M=i,k=s,V=c,ae=p,Ee=k.flags;switch(k.tag){case 0:case 11:case 15:gc(M,k,V,ae,x),Qu(8,k);break;case 23:break;case 22:var je=k.stateNode;k.memoizedState!==null?je._visibility&2?gc(M,k,V,ae,x):th(M,k):(je._visibility|=2,gc(M,k,V,ae,x)),x&&Ee&2048&&Hh(k.alternate,k);break;case 24:gc(M,k,V,ae,x),x&&Ee&2048&&mc(k.alternate,k);break;default:gc(M,k,V,ae,x)}s=s.sibling}}function th(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,p=s,x=p.flags;switch(p.tag){case 22:th(c,p),x&2048&&Hh(p.alternate,p);break;case 24:th(c,p),x&2048&&mc(p.alternate,p);break;default:th(c,p)}s=s.sibling}}var ih=8192;function iu(i){if(i.subtreeFlags&ih)for(i=i.child;i!==null;)Nf(i),i=i.sibling}function Nf(i){switch(i.tag){case 26:iu(i),i.flags&ih&&i.memoizedState!==null&&m(la,i.memoizedState,i.memoizedProps);break;case 5:iu(i);break;case 3:case 4:var s=la;la=od(i.stateNode.containerInfo),iu(i),la=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=ih,ih=16777216,iu(i),ih=s):iu(i));break;default:iu(i)}}function Vf(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function Js(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];hr=p,kd(p,i)}Vf(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Zf(i),i=i.sibling}function Zf(i){switch(i.tag){case 0:case 11:case 15:Js(i),i.flags&2048&&Qs(9,i,i.return);break;case 3:Js(i);break;case 12:Js(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,$h(i)):Js(i);break;default:Js(i)}}function $h(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];hr=p,kd(p,i)}Vf(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Qs(8,s,s.return),$h(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,$h(s));break;default:$h(s)}i=i.sibling}}function kd(i,s){for(;hr!==null;){var c=hr;switch(c.tag){case 0:case 11:case 15:Qs(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var p=c.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:wo(c.memoizedState.cache)}if(p=c.child,p!==null)p.return=c,hr=p;else e:for(c=i;hr!==null;){p=hr;var x=p.sibling,M=p.return;if(Pd(p),p===c){hr=null;break e}if(x!==null){x.return=M,hr=x;break e}hr=M}}}var bp={getCacheForType:function(i){var s=_n(An),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c}},Gf=typeof WeakMap=="function"?WeakMap:Map,Di=0,Ni=null,Wt=null,ui=0,Ii=0,za=null,Lo=!1,_c=!1,Ld=!1,Bo=0,Qi=0,Oo=0,yc=0,Bd=0,Qa=0,nu=0,nh=null,Kr=null,rh=!1,Xh=0,ah=1/0,sh=null,Sl=null,Hn=0,Ml=null,vc=null,ru=0,Od=0,Fd=null,jd=null,oh=0,Ud=null;function Rr(){if((Di&2)!==0&&ui!==0)return ui&-ui;if(Be.T!==null){var i=fs;return i!==0?i:dh()}return En()}function kn(){Qa===0&&(Qa=(ui&536870912)===0||hi?qe():536870912);var i=cn.current;return i!==null&&(i.flags|=32),Qa}function Wr(i,s,c){(i===Ni&&(Ii===2||Ii===9)||i.cancelPendingCommit!==null)&&(au(i,0),Pa(i,ui,Qa,!1)),ge(i,c),((Di&2)===0||i!==Ni)&&(i===Ni&&((Di&2)===0&&(yc|=c),Qi===4&&Pa(i,ui,Qa,!1)),Es(i))}function Nd(i,s,c){if((Di&6)!==0)throw Error(Y(327));var p=!c&&(s&124)===0&&(s&i.expiredLanes)===0||fe(i,s),x=p?Tp(i,s):Hd(i,s,!0),M=p;do{if(x===0){_c&&!p&&Pa(i,s,0,!1);break}else{if(c=i.current.alternate,M&&!Zd(c)){x=Hd(i,s,!1),M=!1;continue}if(x===2){if(M=s,i.errorRecoveryDisabledLanes&M)var k=0;else k=i.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){s=k;e:{var V=i;x=nh;var ae=V.current.memoizedState.isDehydrated;if(ae&&(au(V,k).flags|=256),k=Hd(V,k,!1),k!==2){if(Ld&&!ae){V.errorRecoveryDisabledLanes|=M,yc|=M,x=4;break e}M=Kr,Kr=x,M!==null&&(Kr===null?Kr=M:Kr.push.apply(Kr,M))}x=k}if(M=!1,x!==2)continue}}if(x===1){au(i,0),Pa(i,s,0,!0);break}e:{switch(p=i,M=x,M){case 0:case 1:throw Error(Y(345));case 4:if((s&4194048)!==s)break;case 6:Pa(p,s,Qa,!Lo);break e;case 2:Kr=null;break;case 3:case 5:break;default:throw Error(Y(329))}if((s&62914560)===s&&(x=Xh+300-rr(),10<x)){if(Pa(p,s,Qa,!Lo),Me(p,0,!0)!==0)break e;p.timeoutHandle=hf(Vd.bind(null,p,c,Kr,sh,rh,s,Qa,yc,nu,Lo,M,2,-0,0),x);break e}Vd(p,c,Kr,sh,rh,s,Qa,yc,nu,Lo,M,0,-0,0)}}break}while(!0);Es(i)}function Vd(i,s,c,p,x,M,k,V,ae,Ee,je,Ge,ze,De){if(i.timeoutHandle=-1,Ge=s.subtreeFlags,(Ge&8192||(Ge&16785408)===16785408)&&(o={stylesheets:null,count:0,unsuspend:u},Nf(s),Ge=_(),Ge!==null)){i.cancelPendingCommit=Ge(Fo.bind(null,i,s,M,c,p,x,k,V,ae,je,1,ze,De)),Pa(i,M,k,!Ee);return}Fo(i,s,M,c,p,x,k,V,ae)}function Zd(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var p=0;p<c.length;p++){var x=c[p],M=x.getSnapshot;x=x.value;try{if(!yr(M(),x))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Pa(i,s,c,p){s&=~Bd,s&=~yc,i.suspendedLanes|=s,i.pingedLanes&=~s,p&&(i.warmLanes|=s),p=i.expirationTimes;for(var x=s;0<x;){var M=31-ce(x),k=1<<M;p[M]=-1,x&=~k}c!==0&&Xt(i,c,s)}function lh(){return(Di&6)===0?(cu(0),!1):!0}function Gd(){if(Wt!==null){if(Ii===0)var i=Wt.return;else i=Wt,br=ds=null,vl(i),fi=null,$i=0,i=Wt;for(;i!==null;)Bf(i.alternate,i),i=i.return;Wt=null}}function au(i,s){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,sp(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),Gd(),Ni=i,Wt=c=lr(i.current,null),ui=s,Ii=0,za=null,Lo=!1,_c=fe(i,s),Ld=!1,nu=Qa=Bd=yc=Oo=Qi=0,Kr=nh=null,rh=!1,(s&8)!==0&&(s|=s&32);var p=i.entangledLanes;if(p!==0)for(i=i.entanglements,p&=s;0<p;){var x=31-ce(p),M=1<<x;s|=i[x],p&=~M}return Bo=s,bo(),c}function qf(i,s){Yt=null,Be.H=Gn,s===pl||s===Sr?(s=Mo(),Ii=3):s===$s?(s=Mo(),Ii=4):Ii=s===Ef?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,za=s,Wt===null&&(Qi=1,Qc(i,Nn(s,i.current)))}function Hf(){var i=Be.H;return Be.H=Gn,i===null?Gn:i}function $f(){var i=Be.A;return Be.A=bp,i}function qd(){Qi=4,Lo||(ui&4194048)!==ui&&cn.current!==null||(_c=!0),(Oo&134217727)===0&&(yc&134217727)===0||Ni===null||Pa(Ni,ui,Qa,!1)}function Hd(i,s,c){var p=Di;Di|=2;var x=Hf(),M=$f();(Ni!==i||ui!==s)&&(sh=null,au(i,s)),s=!1;var k=Qi;e:do try{if(Ii!==0&&Wt!==null){var V=Wt,ae=za;switch(Ii){case 8:Gd(),k=6;break e;case 3:case 2:case 9:case 6:cn.current===null&&(s=!0);var Ee=Ii;if(Ii=0,za=null,xc(i,V,ae,Ee),c&&_c){k=0;break e}break;default:Ee=Ii,Ii=0,za=null,xc(i,V,ae,Ee)}}wp(),k=Qi;break}catch(je){qf(i,je)}while(!0);return s&&i.shellSuspendCounter++,br=ds=null,Di=p,Be.H=x,Be.A=M,Wt===null&&(Ni=null,ui=0,bo()),k}function wp(){for(;Wt!==null;)Xf(Wt)}function Tp(i,s){var c=Di;Di|=2;var p=Hf(),x=$f();Ni!==i||ui!==s?(sh=null,ah=rr()+500,au(i,s)):_c=fe(i,s);e:do try{if(Ii!==0&&Wt!==null){s=Wt;var M=za;t:switch(Ii){case 1:Ii=0,za=null,xc(i,s,M,1);break;case 2:case 9:if(Vc(M)){Ii=0,za=null,Yf(s);break}s=function(){Ii!==2&&Ii!==9||Ni!==i||(Ii=7),Es(i)},M.then(s,s);break e;case 3:Ii=7;break e;case 4:Ii=5;break e;case 7:Vc(M)?(Ii=0,za=null,Yf(s)):(Ii=0,za=null,xc(i,s,M,7));break;case 5:var k=null;switch(Wt.tag){case 26:k=Wt.memoizedState;case 5:case 27:var V=Wt;if(!k||n(k)){Ii=0,za=null;var ae=V.sibling;if(ae!==null)Wt=ae;else{var Ee=V.return;Ee!==null?(Wt=Ee,su(Ee)):Wt=null}break t}}Ii=0,za=null,xc(i,s,M,5);break;case 6:Ii=0,za=null,xc(i,s,M,6);break;case 8:Gd(),Qi=6;break e;default:throw Error(Y(462))}}Sp();break}catch(je){qf(i,je)}while(!0);return br=ds=null,Be.H=p,Be.A=x,Di=c,Wt!==null?0:(Ni=null,ui=0,bo(),Qi)}function Sp(){for(;Wt!==null&&!ua();)Xf(Wt)}function Xf(i){var s=kf(i.alternate,i,Bo);i.memoizedProps=i.pendingProps,s===null?su(i):Wt=s}function Yf(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=xd(c,s,s.pendingProps,s.type,void 0,ui);break;case 11:s=xd(c,s,s.pendingProps,s.type.render,s.ref,ui);break;case 5:vl(s);default:Bf(c,s),s=Wt=ku(s,Bo),s=kf(c,s,Bo)}i.memoizedProps=i.pendingProps,s===null?su(i):Wt=s}function xc(i,s,c,p){br=ds=null,vl(s),fi=null,$i=0;var x=s.return;try{if(Jc(i,x,s,c,ui)){Qi=1,Qc(i,Nn(c,i.current)),Wt=null;return}}catch(M){if(x!==null)throw Wt=x,M;Qi=1,Qc(i,Nn(c,i.current)),Wt=null;return}s.flags&32768?(hi||p===1?i=!0:_c||(ui&536870912)!==0?i=!1:(Lo=i=!0,(p===2||p===9||p===3||p===6)&&(p=cn.current,p!==null&&p.tag===13&&(p.flags|=16384))),$d(s,i)):su(s)}function su(i){var s=i;do{if((s.flags&32768)!==0){$d(s,Lo);return}i=s.return;var c=Lf(s.alternate,s,Bo);if(c!==null){Wt=c;return}if(s=s.sibling,s!==null){Wt=s;return}Wt=s=i}while(s!==null);Qi===0&&(Qi=5)}function $d(i,s){do{var c=xp(i.alternate,i);if(c!==null){c.flags&=32767,Wt=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){Wt=i;return}Wt=i=c}while(i!==null);Qi=6,Wt=null}function Fo(i,s,c,p,x,M,k,V,ae){i.cancelPendingCommit=null;do Yh();while(Hn!==0);if((Di&6)!==0)throw Error(Y(327));if(s!==null){if(s===i.current)throw Error(Y(177));if(M=s.lanes|s.childLanes,M|=xo,Pt(i,c,M,k,V,ae),i===Ni&&(Wt=Ni=null,ui=0),vc=s,Ml=i,ru=c,Od=M,Fd=x,jd=p,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Mp(da,function(){return Kf(),null})):(i.callbackNode=null,i.callbackPriority=0),p=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||p){p=Be.T,Be.T=null,x=ot.p,ot.p=2,k=Di,Di|=4;try{bn(i,s,c)}finally{Di=k,ot.p=x,Be.T=p}}Hn=1,ou(),bc(),ch()}}function ou(){if(Hn===1){Hn=0;var i=Ml,s=vc,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Be.T,Be.T=null;var p=ot.p;ot.p=2;var x=Di;Di|=4;try{pc(s,i);var M=rd,k=Dc(i.containerInfo),V=M.focusedElem,ae=M.selectionRange;if(k!==V&&V&&V.ownerDocument&&oi(V.ownerDocument.documentElement,V)){if(ae!==null&&Kl(V)){var Ee=ae.start,je=ae.end;if(je===void 0&&(je=Ee),"selectionStart"in V)V.selectionStart=Ee,V.selectionEnd=Math.min(je,V.value.length);else{var Ge=V.ownerDocument||document,ze=Ge&&Ge.defaultView||window;if(ze.getSelection){var De=ze.getSelection(),Ft=V.textContent.length,It=Math.min(ae.start,Ft),Bi=ae.end===void 0?It:Math.min(ae.end,Ft);!De.extend&&It>Bi&&(k=Bi,Bi=It,It=k);var xe=Za(V,It),me=Za(V,Bi);if(xe&&me&&(De.rangeCount!==1||De.anchorNode!==xe.node||De.anchorOffset!==xe.offset||De.focusNode!==me.node||De.focusOffset!==me.offset)){var we=Ge.createRange();we.setStart(xe.node,xe.offset),De.removeAllRanges(),It>Bi?(De.addRange(we),De.extend(me.node,me.offset)):(we.setEnd(me.node,me.offset),De.addRange(we))}}}}for(Ge=[],De=V;De=De.parentNode;)De.nodeType===1&&Ge.push({element:De,left:De.scrollLeft,top:De.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<Ge.length;V++){var Ze=Ge[V];Ze.element.scrollLeft=Ze.left,Ze.element.scrollTop=Ze.top}}te=!!gh,rd=gh=null}finally{Di=x,ot.p=p,Be.T=c}}i.current=s,Hn=2}}function bc(){if(Hn===2){Hn=0;var i=Ml,s=vc,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Be.T,Be.T=null;var p=ot.p;ot.p=2;var x=Di;Di|=4;try{fc(i,s.alternate,s)}finally{Di=x,ot.p=p,Be.T=c}}Hn=3}}function ch(){if(Hn===4||Hn===3){Hn=0,Da();var i=Ml,s=vc,c=ru,p=jd;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Hn=5:(Hn=0,vc=Ml=null,uh(i,i.pendingLanes));var x=i.pendingLanes;if(x===0&&(Sl=null),bi(c),s=s.stateNode,Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot(ta,s,void 0,(s.current.flags&128)===128)}catch{}if(p!==null){s=Be.T,x=ot.p,ot.p=2,Be.T=null;try{for(var M=i.onRecoverableError,k=0;k<p.length;k++){var V=p[k];M(V.value,{componentStack:V.stack})}}finally{Be.T=s,ot.p=x}}(ru&3)!==0&&Yh(),Es(i),x=i.pendingLanes,(c&4194090)!==0&&(x&42)!==0?i===Ud?oh++:(oh=0,Ud=i):oh=0,cu(0)}}function uh(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,wo(s)))}function Yh(i){return ou(),bc(),ch(),Kf()}function Kf(){if(Hn!==5)return!1;var i=Ml,s=Od;Od=0;var c=bi(ru),p=Be.T,x=ot.p;try{ot.p=32>c?32:c,Be.T=null,c=Fd,Fd=null;var M=Ml,k=ru;if(Hn=0,vc=Ml=null,ru=0,(Di&6)!==0)throw Error(Y(331));var V=Di;if(Di|=4,Zf(M.current),Id(M,M.current,k,c),Di=V,cu(0,!1),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot(ta,M)}catch{}return!0}finally{ot.p=x,Be.T=p,uh(i,s)}}function Xd(i,s,c){s=Nn(c,s),s=qu(i.stateNode,s,2),i=ps(i,s,2),i!==null&&(ge(i,2),Es(i))}function Vi(i,s,c){if(i.tag===3)Xd(i,i,c);else for(;s!==null;){if(s.tag===3){Xd(s,i,c);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Sl===null||!Sl.has(p))){i=Nn(c,i),c=yd(2),p=ps(s,c,2),p!==null&&(vd(c,p,s,i),ge(p,2),Es(p));break}}s=s.return}}function Yd(i,s,c){var p=i.pingCache;if(p===null){p=i.pingCache=new Gf;var x=new Set;p.set(s,x)}else x=p.get(s),x===void 0&&(x=new Set,p.set(s,x));x.has(c)||(Ld=!0,x.add(c),i=Wf.bind(null,i,s,c),s.then(i,i))}function Wf(i,s,c){var p=i.pingCache;p!==null&&p.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Ni===i&&(ui&c)===c&&(Qi===4||Qi===3&&(ui&62914560)===ui&&300>rr()-Xh?(Di&2)===0&&au(i,0):Bd|=c,nu===ui&&(nu=0)),Es(i)}function Kd(i,s){s===0&&(s=Oe()),i=qr(i,s),i!==null&&(ge(i,s),Es(i))}function Wd(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),Kd(i,c)}function Qd(i,s){var c=0;switch(i.tag){case 13:var p=i.stateNode,x=i.memoizedState;x!==null&&(c=x.retryLane);break;case 19:p=i.stateNode;break;case 22:p=i.stateNode._retryCache;break;default:throw Error(Y(314))}p!==null&&p.delete(s),Kd(i,c)}function Mp(i,s){return Yi(i,s)}var hh=null,lu=null,Jd=!1,Kh=!1,ef=!1,wc=0;function Es(i){i!==lu&&i.next===null&&(lu===null?hh=lu=i:lu=lu.next=i),Kh=!0,Jd||(Jd=!0,Qh())}function cu(i,s){if(!ef&&Kh){ef=!0;do for(var c=!1,p=hh;p!==null;){if(i!==0){var x=p.pendingLanes;if(x===0)var M=0;else{var k=p.suspendedLanes,V=p.pingedLanes;M=(1<<31-ce(42|i)+1)-1,M&=x&~(k&~V),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,Qf(p,M))}else M=ui,M=Me(p,p===Ni?M:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(M&3)===0||fe(p,M)||(c=!0,Qf(p,M));p=p.next}while(c);ef=!1}}function jo(){Uo()}function Uo(){Kh=Jd=!1;var i=0;wc!==0&&(ap()&&(i=wc),wc=0);for(var s=rr(),c=null,p=hh;p!==null;){var x=p.next,M=tf(p,s);M===0?(p.next=null,c===null?hh=x:c.next=x,x===null&&(lu=c)):(c=p,(i!==0||(M&3)!==0)&&(Kh=!0)),p=x}cu(i)}function tf(i,s){for(var c=i.suspendedLanes,p=i.pingedLanes,x=i.expirationTimes,M=i.pendingLanes&-62914561;0<M;){var k=31-ce(M),V=1<<k,ae=x[k];ae===-1?((V&c)===0||(V&p)!==0)&&(x[k]=ke(V,s)):ae<=s&&(i.expiredLanes|=V),M&=~V}if(s=Ni,c=ui,c=Me(i,i===s?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p=i.callbackNode,c===0||i===s&&(Ii===2||Ii===9)||i.cancelPendingCommit!==null)return p!==null&&p!==null&&en(p),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||fe(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(p!==null&&en(p),bi(c)){case 2:case 8:c=eo;break;case 32:c=da;break;case 268435456:c=ts;break;default:c=da}return p=Wh.bind(null,i),c=Yi(c,p),i.callbackPriority=s,i.callbackNode=c,s}return p!==null&&p!==null&&en(p),i.callbackPriority=2,i.callbackNode=null,2}function Wh(i,s){if(Hn!==0&&Hn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(Yh()&&i.callbackNode!==c)return null;var p=ui;return p=Me(i,i===Ni?p:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p===0?null:(Nd(i,p,s),tf(i,rr()),i.callbackNode!=null&&i.callbackNode===c?Wh.bind(null,i):null)}function Qf(i,s){if(Yh())return null;Nd(i,s,!0)}function Qh(){lp(function(){(Di&6)!==0?Yi(ha,jo):Uo()})}function dh(){return wc===0&&(wc=qe()),wc}function Jf(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:qt(""+i)}function Jh(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function nf(i,s,c,p,x){if(s==="submit"&&c&&c.stateNode===x){var M=Jf((x[Rt]||null).action),k=p.submitter;k&&(s=(s=k[Rt]||null)?Jf(s.formAction):k.getAttribute("formAction"),s!==null&&(M=s,k=null));var V=new Zr("action","action",null,p,x);i.push({event:V,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(wc!==0){var ae=k?Jh(x,k):new FormData(x);Ri(c,{pending:!0,data:ae,method:x.method,action:M},null,ae)}}else typeof M=="function"&&(V.preventDefault(),ae=k?Jh(x,k):new FormData(x),Ri(c,{pending:!0,data:ae,method:x.method,action:M},M,ae))},currentTarget:x}]})}}for(var El=0;El<kc.length;El++){var ed=kc[El],ep=ed.toLowerCase(),rf=ed[0].toUpperCase()+ed.slice(1);ra(ep,"on"+rf)}ra(Wl,"onAnimationEnd"),ra(Ql,"onAnimationIteration"),ra(Jl,"onAnimationStart"),ra("dblclick","onDoubleClick"),ra("focusin","onFocus"),ra("focusout","onBlur"),ra(Du,"onTransitionRun"),ra(yo,"onTransitionStart"),ra(ec,"onTransitionCancel"),ra(vo,"onTransitionEnd"),ns("onMouseEnter",["mouseout","mouseover"]),ns("onMouseLeave",["mouseout","mouseover"]),ns("onPointerEnter",["pointerout","pointerover"]),ns("onPointerLeave",["pointerout","pointerover"]),Dr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Dr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Dr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Dr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Dr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Dr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),td=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(uu));function af(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var p=i[c],x=p.event;p=p.listeners;e:{var M=void 0;if(s)for(var k=p.length-1;0<=k;k--){var V=p[k],ae=V.instance,Ee=V.currentTarget;if(V=V.listener,ae!==M&&x.isPropagationStopped())break e;M=V,x.currentTarget=Ee;try{M(x)}catch(je){Zu(je)}x.currentTarget=null,M=ae}else for(k=0;k<p.length;k++){if(V=p[k],ae=V.instance,Ee=V.currentTarget,V=V.listener,ae!==M&&x.isPropagationStopped())break e;M=V,x.currentTarget=Ee;try{M(x)}catch(je){Zu(je)}x.currentTarget=null,M=ae}}}}function ci(i,s){var c=s[He];c===void 0&&(c=s[He]=new Set);var p=i+"__bubble";c.has(p)||(tp(s,i,2,!1),c.add(p))}function sf(i,s,c){var p=0;s&&(p|=4),tp(c,i,p,s)}var fh="_reactListening"+Math.random().toString(36).slice(2);function of(i){if(!i[fh]){i[fh]=!0,Ut.forEach(function(c){c!=="selectionchange"&&(td.has(c)||sf(c,!1,i),sf(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[fh]||(s[fh]=!0,sf("selectionchange",!1,s))}}function tp(i,s,c,p){switch(it(s)){case 2:var x=oe;break;case 8:x=Se;break;default:x=Pe}c=x.bind(null,s,c,i),x=void 0,!Qn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),p?x!==void 0?i.addEventListener(s,c,{capture:!0,passive:x}):i.addEventListener(s,c,!0):x!==void 0?i.addEventListener(s,c,{passive:x}):i.addEventListener(s,c,!1)}function lf(i,s,c,p,x){var M=p;if((s&1)===0&&(s&2)===0&&p!==null)e:for(;;){if(p===null)return;var k=p.tag;if(k===3||k===4){var V=p.stateNode.containerInfo;if(V===x)break;if(k===4)for(k=p.return;k!==null;){var ae=k.tag;if((ae===3||ae===4)&&k.stateNode.containerInfo===x)return;k=k.return}for(;V!==null;){if(k=jt(V),k===null)return;if(ae=k.tag,ae===5||ae===6||ae===26||ae===27){p=M=k;continue e}V=V.parentNode}}p=p.return}gn(function(){var Ee=M,je=Yo(c),Ge=[];e:{var ze=Gr.get(i);if(ze!==void 0){var De=Zr,Ft=i;switch(i){case"keypress":if(Dt(c)===0)break e;case"keydown":case"keyup":De=Zl;break;case"focusin":Ft="focus",De=co;break;case"focusout":Ft="blur",De=co;break;case"beforeblur":case"afterblur":De=co;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=jl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=Un;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=hd;break;case Wl:case Ql:case Jl:De=ln;break;case vo:De=dd;break;case"scroll":case"scrollend":De=bu;break;case"wheel":De=Pc;break;case"copy":case"cut":case"paste":De=Ul;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=Tu;break;case"toggle":case"beforetoggle":De=fo}var It=(s&4)!==0,Bi=!It&&(i==="scroll"||i==="scrollend"),xe=It?ze!==null?ze+"Capture":null:ze;It=[];for(var me=Ee,we;me!==null;){var Ze=me;if(we=Ze.stateNode,Ze=Ze.tag,Ze!==5&&Ze!==26&&Ze!==27||we===null||xe===null||(Ze=di(me,xe),Ze!=null&&It.push(ph(me,Ze,we))),Bi)break;me=me.return}0<It.length&&(ze=new De(ze,Ft,null,c,je),Ge.push({event:ze,listeners:It}))}}if((s&7)===0){e:{if(ze=i==="mouseover"||i==="pointerover",De=i==="mouseout"||i==="pointerout",ze&&c!==as&&(Ft=c.relatedTarget||c.fromElement)&&(jt(Ft)||Ft[Gi]))break e;if((De||ze)&&(ze=je.window===je?je:(ze=je.ownerDocument)?ze.defaultView||ze.parentWindow:window,De?(Ft=c.relatedTarget||c.toElement,De=Ee,Ft=Ft?jt(Ft):null,Ft!==null&&(Bi=Je(Ft),It=Ft.tag,Ft!==Bi||It!==5&&It!==27&&It!==6)&&(Ft=null)):(De=null,Ft=Ee),De!==Ft)){if(It=jl,Ze="onMouseLeave",xe="onMouseEnter",me="mouse",(i==="pointerout"||i==="pointerover")&&(It=Tu,Ze="onPointerLeave",xe="onPointerEnter",me="pointer"),Bi=De==null?ze:mn(De),we=Ft==null?ze:mn(Ft),ze=new It(Ze,me+"leave",De,c,je),ze.target=Bi,ze.relatedTarget=we,Ze=null,jt(je)===Ee&&(It=new It(xe,me+"enter",Ft,c,je),It.target=we,It.relatedTarget=Bi,Ze=It),Bi=Ze,De&&Ft)t:{for(It=De,xe=Ft,me=0,we=It;we;we=Cl(we))me++;for(we=0,Ze=xe;Ze;Ze=Cl(Ze))we++;for(;0<me-we;)It=Cl(It),me--;for(;0<we-me;)xe=Cl(xe),we--;for(;me--;){if(It===xe||xe!==null&&It===xe.alternate)break t;It=Cl(It),xe=Cl(xe)}It=null}else It=null;De!==null&&No(Ge,ze,De,It,!1),Ft!==null&&Bi!==null&&No(Ge,Bi,Ft,It,!0)}}e:{if(ze=Ee?mn(Ee):window,De=ze.nodeName&&ze.nodeName.toLowerCase(),De==="select"||De==="input"&&ze.type==="file")var yt=zu;else if(Rh(ze))if(Bs)yt=Lh;else{yt=md;var ai=Ih}else De=ze.nodeName,!De||De.toLowerCase()!=="input"||ze.type!=="checkbox"&&ze.type!=="radio"?Ee&&ja(Ee.elementType)&&(yt=zu):yt=kh;if(yt&&(yt=yt(i,Ee))){Au(Ge,yt,c,je);break e}ai&&ai(i,ze,Ee),i==="focusout"&&Ee&&ze.type==="number"&&Ee.memoizedProps.value!=null&&Fl(ze,"number",ze.value)}switch(ai=Ee?mn(Ee):window,i){case"focusin":(Rh(ai)||ai.contentEditable==="true")&&(Os=ai,os=Ee,go=null);break;case"focusout":go=os=Os=null;break;case"mousedown":Ru=!0;break;case"contextmenu":case"mouseup":case"dragend":Ru=!1,Oh(Ge,c,je);break;case"selectionchange":if(Bh)break;case"keydown":case"keyup":Oh(Ge,c,je)}var Et;if(Qo)e:{switch(i){case"compositionstart":var Bt="onCompositionStart";break e;case"compositionend":Bt="onCompositionEnd";break e;case"compositionupdate":Bt="onCompositionUpdate";break e}Bt=void 0}else tl?zh(i,c)&&(Bt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Bt="onCompositionStart");Bt&&(Gl&&c.locale!=="ko"&&(tl||Bt!=="onCompositionStart"?Bt==="onCompositionEnd"&&tl&&(Et=wt()):(rn=je,Ci="value"in rn?rn.value:rn.textContent,tl=!0)),ai=id(Ee,Bt),0<ai.length&&(Bt=new Ah(Bt,i,null,c,je),Ge.push({event:Bt,listeners:ai}),Et?Bt.data=Et:(Et=ql(c),Et!==null&&(Bt.data=Et)))),(Et=pd?po(i,c):Ph(i,c))&&(Bt=id(Ee,"onBeforeInput"),0<Bt.length&&(ai=new Ah("onBeforeInput","beforeinput",null,c,je),Ge.push({event:ai,listeners:Bt}),ai.data=Et)),nf(Ge,i,Ee,c,je)}af(Ge,s)})}function ph(i,s,c){return{instance:i,listener:s,currentTarget:c}}function id(i,s){for(var c=s+"Capture",p=[];i!==null;){var x=i,M=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||M===null||(x=di(i,c),x!=null&&p.unshift(ph(i,x,M)),x=di(i,s),x!=null&&p.push(ph(i,x,M))),i.tag===3)return p;i=i.return}return[]}function Cl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function No(i,s,c,p,x){for(var M=s._reactName,k=[];c!==null&&c!==p;){var V=c,ae=V.alternate,Ee=V.stateNode;if(V=V.tag,ae!==null&&ae===p)break;V!==5&&V!==26&&V!==27||Ee===null||(ae=Ee,x?(Ee=di(c,M),Ee!=null&&k.unshift(ph(c,Ee,ae))):x||(Ee=di(c,M),Ee!=null&&k.push(ph(c,Ee,ae)))),c=c.return}k.length!==0&&i.push({event:s,listeners:k})}var ip=/\r\n?/g,np=/\u0000|\uFFFD/g;function cf(i){return(typeof i=="string"?i:""+i).replace(ip,`
`).replace(np,"")}function uf(i,s){return s=cf(s),cf(i)===s}function mh(){}function zi(i,s,c,p,x,M){switch(c){case"children":typeof p=="string"?s==="body"||s==="textarea"&&p===""||Fa(i,p):(typeof p=="number"||typeof p=="bigint")&&s!=="body"&&Fa(i,""+p);break;case"className":mi(i,"class",p);break;case"tabIndex":mi(i,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":mi(i,c,p);break;case"style":Ds(i,p,M);break;case"data":if(s!=="object"){mi(i,"data",p);break}case"src":case"href":if(p===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(c);break}p=qt(""+p),i.setAttribute(c,p);break;case"action":case"formAction":if(typeof p=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&zi(i,s,"name",x.name,x,null),zi(i,s,"formEncType",x.formEncType,x,null),zi(i,s,"formMethod",x.formMethod,x,null),zi(i,s,"formTarget",x.formTarget,x,null)):(zi(i,s,"encType",x.encType,x,null),zi(i,s,"method",x.method,x,null),zi(i,s,"target",x.target,x,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(c);break}p=qt(""+p),i.setAttribute(c,p);break;case"onClick":p!=null&&(i.onclick=mh);break;case"onScroll":p!=null&&ci("scroll",i);break;case"onScrollEnd":p!=null&&ci("scrollend",i);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(Y(61));if(c=p.__html,c!=null){if(x.children!=null)throw Error(Y(60));i.innerHTML=c}}break;case"multiple":i.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":i.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){i.removeAttribute("xlink:href");break}c=qt(""+p),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,""+p):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":p===!0?i.setAttribute(c,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,p):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?i.setAttribute(c,p):i.removeAttribute(c);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?i.removeAttribute(c):i.setAttribute(c,p);break;case"popover":ci("beforetoggle",i),ci("toggle",i),Yn(i,"popover",p);break;case"xlinkActuate":Ba(i,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Ba(i,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Ba(i,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Ba(i,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Ba(i,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Ba(i,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Ba(i,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Ba(i,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Ba(i,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Yn(i,"is",p);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=rs.get(c)||c,Yn(i,c,p))}}function nd(i,s,c,p,x,M){switch(c){case"style":Ds(i,p,M);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(Y(61));if(c=p.__html,c!=null){if(x.children!=null)throw Error(Y(60));i.innerHTML=c}}break;case"children":typeof p=="string"?Fa(i,p):(typeof p=="number"||typeof p=="bigint")&&Fa(i,""+p);break;case"onScroll":p!=null&&ci("scroll",i);break;case"onScrollEnd":p!=null&&ci("scrollend",i);break;case"onClick":p!=null&&(i.onclick=mh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ll.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(x=c.endsWith("Capture"),s=c.slice(2,x?c.length-7:void 0),M=i[Rt]||null,M=M!=null?M[c]:null,typeof M=="function"&&i.removeEventListener(s,M,x),typeof p=="function")){typeof M!="function"&&M!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,p,x);break e}c in i?i[c]=p:p===!0?i.setAttribute(c,""):Yn(i,c,p)}}}function Ln(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ci("error",i),ci("load",i);var p=!1,x=!1,M;for(M in c)if(c.hasOwnProperty(M)){var k=c[M];if(k!=null)switch(M){case"src":p=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Y(137,s));default:zi(i,s,M,k,c,null)}}x&&zi(i,s,"srcSet",c.srcSet,c,null),p&&zi(i,s,"src",c.src,c,null);return;case"input":ci("invalid",i);var V=M=k=x=null,ae=null,Ee=null;for(p in c)if(c.hasOwnProperty(p)){var je=c[p];if(je!=null)switch(p){case"name":x=je;break;case"type":k=je;break;case"checked":ae=je;break;case"defaultChecked":Ee=je;break;case"value":M=je;break;case"defaultValue":V=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(Y(137,s));break;default:zi(i,s,p,je,c,null)}}ro(i,M,V,ae,Ee,k,x,!1),Ac(i);return;case"select":ci("invalid",i),p=k=M=null;for(x in c)if(c.hasOwnProperty(x)&&(V=c[x],V!=null))switch(x){case"value":M=V;break;case"defaultValue":k=V;break;case"multiple":p=V;default:zi(i,s,x,V,c,null)}s=M,c=k,i.multiple=!!p,s!=null?Rs(i,!!p,s,!1):c!=null&&Rs(i,!!p,c,!0);return;case"textarea":ci("invalid",i),M=x=p=null;for(k in c)if(c.hasOwnProperty(k)&&(V=c[k],V!=null))switch(k){case"value":p=V;break;case"defaultValue":x=V;break;case"children":M=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(Y(91));break;default:zi(i,s,k,V,c,null)}ao(i,p,x,M),Ac(i);return;case"option":for(ae in c)if(c.hasOwnProperty(ae)&&(p=c[ae],p!=null))switch(ae){case"selected":i.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:zi(i,s,ae,p,c,null)}return;case"dialog":ci("beforetoggle",i),ci("toggle",i),ci("cancel",i),ci("close",i);break;case"iframe":case"object":ci("load",i);break;case"video":case"audio":for(p=0;p<uu.length;p++)ci(uu[p],i);break;case"image":ci("error",i),ci("load",i);break;case"details":ci("toggle",i);break;case"embed":case"source":case"link":ci("error",i),ci("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ee in c)if(c.hasOwnProperty(Ee)&&(p=c[Ee],p!=null))switch(Ee){case"children":case"dangerouslySetInnerHTML":throw Error(Y(137,s));default:zi(i,s,Ee,p,c,null)}return;default:if(ja(s)){for(je in c)c.hasOwnProperty(je)&&(p=c[je],p!==void 0&&nd(i,s,je,p,c,void 0));return}}for(V in c)c.hasOwnProperty(V)&&(p=c[V],p!=null&&zi(i,s,V,p,c,null))}function rp(i,s,c,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,M=null,k=null,V=null,ae=null,Ee=null,je=null;for(De in c){var Ge=c[De];if(c.hasOwnProperty(De)&&Ge!=null)switch(De){case"checked":break;case"value":break;case"defaultValue":ae=Ge;default:p.hasOwnProperty(De)||zi(i,s,De,null,p,Ge)}}for(var ze in p){var De=p[ze];if(Ge=c[ze],p.hasOwnProperty(ze)&&(De!=null||Ge!=null))switch(ze){case"type":M=De;break;case"name":x=De;break;case"checked":Ee=De;break;case"defaultChecked":je=De;break;case"value":k=De;break;case"defaultValue":V=De;break;case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(Y(137,s));break;default:De!==Ge&&zi(i,s,ze,De,p,Ge)}}Ol(i,k,V,ae,Ee,je,M,x);return;case"select":De=k=V=ze=null;for(M in c)if(ae=c[M],c.hasOwnProperty(M)&&ae!=null)switch(M){case"value":break;case"multiple":De=ae;default:p.hasOwnProperty(M)||zi(i,s,M,null,p,ae)}for(x in p)if(M=p[x],ae=c[x],p.hasOwnProperty(x)&&(M!=null||ae!=null))switch(x){case"value":ze=M;break;case"defaultValue":V=M;break;case"multiple":k=M;default:M!==ae&&zi(i,s,x,M,p,ae)}s=V,c=k,p=De,ze!=null?Rs(i,!!c,ze,!1):!!p!=!!c&&(s!=null?Rs(i,!!c,s,!0):Rs(i,!!c,c?[]:"",!1));return;case"textarea":De=ze=null;for(V in c)if(x=c[V],c.hasOwnProperty(V)&&x!=null&&!p.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:zi(i,s,V,null,p,x)}for(k in p)if(x=p[k],M=c[k],p.hasOwnProperty(k)&&(x!=null||M!=null))switch(k){case"value":ze=x;break;case"defaultValue":De=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(Y(91));break;default:x!==M&&zi(i,s,k,x,p,M)}Eh(i,ze,De);return;case"option":for(var Ft in c)if(ze=c[Ft],c.hasOwnProperty(Ft)&&ze!=null&&!p.hasOwnProperty(Ft))switch(Ft){case"selected":i.selected=!1;break;default:zi(i,s,Ft,null,p,ze)}for(ae in p)if(ze=p[ae],De=c[ae],p.hasOwnProperty(ae)&&ze!==De&&(ze!=null||De!=null))switch(ae){case"selected":i.selected=ze&&typeof ze!="function"&&typeof ze!="symbol";break;default:zi(i,s,ae,ze,p,De)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var It in c)ze=c[It],c.hasOwnProperty(It)&&ze!=null&&!p.hasOwnProperty(It)&&zi(i,s,It,null,p,ze);for(Ee in p)if(ze=p[Ee],De=c[Ee],p.hasOwnProperty(Ee)&&ze!==De&&(ze!=null||De!=null))switch(Ee){case"children":case"dangerouslySetInnerHTML":if(ze!=null)throw Error(Y(137,s));break;default:zi(i,s,Ee,ze,p,De)}return;default:if(ja(s)){for(var Bi in c)ze=c[Bi],c.hasOwnProperty(Bi)&&ze!==void 0&&!p.hasOwnProperty(Bi)&&nd(i,s,Bi,void 0,p,ze);for(je in p)ze=p[je],De=c[je],!p.hasOwnProperty(je)||ze===De||ze===void 0&&De===void 0||nd(i,s,je,ze,p,De);return}}for(var xe in c)ze=c[xe],c.hasOwnProperty(xe)&&ze!=null&&!p.hasOwnProperty(xe)&&zi(i,s,xe,null,p,ze);for(Ge in p)ze=p[Ge],De=c[Ge],!p.hasOwnProperty(Ge)||ze===De||ze==null&&De==null||zi(i,s,Ge,ze,p,De)}var gh=null,rd=null;function Or(i){return i.nodeType===9?i:i.ownerDocument}function Tc(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hu(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Vo(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ad=null;function ap(){var i=window.event;return i&&i.type==="popstate"?i===ad?!1:(ad=i,!0):(ad=null,!1)}var hf=typeof setTimeout=="function"?setTimeout:void 0,sp=typeof clearTimeout=="function"?clearTimeout:void 0,op=typeof Promise=="function"?Promise:void 0,lp=typeof queueMicrotask=="function"?queueMicrotask:typeof op<"u"?function(i){return op.resolve(null).then(i).catch(Al)}:hf;function Al(i){setTimeout(function(){throw i})}function Zo(i){return i==="head"}function df(i,s){var c=s,p=0,x=0;do{var M=c.nextSibling;if(i.removeChild(c),M&&M.nodeType===8)if(c=M.data,c==="/$"){if(0<p&&8>p){c=p;var k=i.ownerDocument;if(c&1&&zl(k.documentElement),c&2&&zl(k.body),c&4)for(c=k.head,zl(c),k=c.firstChild;k;){var V=k.nextSibling,ae=k.nodeName;k[ka]||ae==="SCRIPT"||ae==="STYLE"||ae==="LINK"&&k.rel.toLowerCase()==="stylesheet"||c.removeChild(k),k=V}}if(x===0){i.removeChild(M),Tn(s);return}x--}else c==="$"||c==="$?"||c==="$!"?x++:p=c.charCodeAt(0)-48;else p=0;c=M}while(c);Tn(s)}function sd(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":sd(c),nt(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function cp(i,s,c,p){for(;i.nodeType===1;){var x=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!p&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(p){if(!i[ka])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(M=i.getAttribute("rel"),M==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(M!==x.rel||i.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||i.getAttribute("title")!==(x.title==null?null:x.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(M=i.getAttribute("src"),(M!==(x.src==null?null:x.src)||i.getAttribute("type")!==(x.type==null?null:x.type)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&M&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var M=x.name==null?null:""+x.name;if(x.type==="hidden"&&i.getAttribute("name")===M)return i}else return i;if(i=Ja(i.nextSibling),i===null)break}return null}function Ep(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=Ja(i.nextSibling),i===null))return null;return i}function ff(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function up(i,s){var c=i.ownerDocument;if(i.data!=="$?"||c.readyState==="complete")s();else{var p=function(){s(),c.removeEventListener("DOMContentLoaded",p)};c.addEventListener("DOMContentLoaded",p),i._reactRetry=p}}function Ja(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}var du=null;function pf(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(s===0)return i;s--}else c==="/$"&&s++}i=i.previousSibling}return null}function _h(i,s,c){switch(s=Or(c),i){case"html":if(i=s.documentElement,!i)throw Error(Y(452));return i;case"head":if(i=s.head,!i)throw Error(Y(453));return i;case"body":if(i=s.body,!i)throw Error(Y(454));return i;default:throw Error(Y(451))}}function zl(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);nt(i)}var Qr=new Map,hp=new Set;function od(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Go=ot.d;ot.d={f:fu,r:fr,D:dp,C:gf,L:Cp,m:fp,X:Ap,S:pp,M:mp};function fu(){var i=Go.f(),s=lh();return i||s}function fr(i){var s=kt(i);s!==null&&s.tag===5&&s.type==="form"?Mi(s):Go.r(i)}var Pl=typeof document>"u"?null:document;function mf(i,s,c){var p=Pl;if(p&&typeof s=="string"&&s){var x=Ir(s);x='link[rel="'+i+'"][href="'+x+'"]',typeof c=="string"&&(x+='[crossorigin="'+c+'"]'),hp.has(x)||(hp.add(x),i={rel:i,crossOrigin:c,href:s},p.querySelector(x)===null&&(s=p.createElement("link"),Ln(s,"link",i),qi(s),p.head.appendChild(s)))}}function dp(i){Go.D(i),mf("dns-prefetch",i,null)}function gf(i,s){Go.C(i,s),mf("preconnect",i,s)}function Cp(i,s,c){Go.L(i,s,c);var p=Pl;if(p&&i&&s){var x='link[rel="preload"][as="'+Ir(s)+'"]';s==="image"&&c&&c.imageSrcSet?(x+='[imagesrcset="'+Ir(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(x+='[imagesizes="'+Ir(c.imageSizes)+'"]')):x+='[href="'+Ir(i)+'"]';var M=x;switch(s){case"style":M=Rl(i);break;case"script":M=Sc(i)}Qr.has(M)||(i=Ye({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),Qr.set(M,i),p.querySelector(x)!==null||s==="style"&&p.querySelector(pu(M))||s==="script"&&p.querySelector(Mc(M))||(s=p.createElement("link"),Ln(s,"link",i),qi(s),p.head.appendChild(s)))}}function fp(i,s){Go.m(i,s);var c=Pl;if(c&&i){var p=s&&typeof s.as=="string"?s.as:"script",x='link[rel="modulepreload"][as="'+Ir(p)+'"][href="'+Ir(i)+'"]',M=x;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=Sc(i)}if(!Qr.has(M)&&(i=Ye({rel:"modulepreload",href:i},s),Qr.set(M,i),c.querySelector(x)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Mc(M)))return}p=c.createElement("link"),Ln(p,"link",i),qi(p),c.head.appendChild(p)}}}function pp(i,s,c){Go.S(i,s,c);var p=Pl;if(p&&i){var x=ia(p).hoistableStyles,M=Rl(i);s=s||"default";var k=x.get(M);if(!k){var V={loading:0,preload:null};if(k=p.querySelector(pu(M)))V.loading=5;else{i=Ye({rel:"stylesheet",href:i,"data-precedence":s},c),(c=Qr.get(M))&&vh(i,c);var ae=k=p.createElement("link");qi(ae),Ln(ae,"link",i),ae._p=new Promise(function(Ee,je){ae.onload=Ee,ae.onerror=je}),ae.addEventListener("load",function(){V.loading|=1}),ae.addEventListener("error",function(){V.loading|=2}),V.loading|=4,Dl(k,s,p)}k={type:"stylesheet",instance:k,count:1,state:V},x.set(M,k)}}}function Ap(i,s){Go.X(i,s);var c=Pl;if(c&&i){var p=ia(c).hoistableScripts,x=Sc(i),M=p.get(x);M||(M=c.querySelector(Mc(x)),M||(i=Ye({src:i,async:!0},s),(s=Qr.get(x))&&xh(i,s),M=c.createElement("script"),qi(M),Ln(M,"link",i),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},p.set(x,M))}}function mp(i,s){Go.M(i,s);var c=Pl;if(c&&i){var p=ia(c).hoistableScripts,x=Sc(i),M=p.get(x);M||(M=c.querySelector(Mc(x)),M||(i=Ye({src:i,async:!0,type:"module"},s),(s=Qr.get(x))&&xh(i,s),M=c.createElement("script"),qi(M),Ln(M,"link",i),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},p.set(x,M))}}function ld(i,s,c,p){var x=(x=bt.current)?od(x):null;if(!x)throw Error(Y(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=Rl(c.href),c=ia(x).hoistableStyles,p=c.get(s),p||(p={type:"style",instance:null,count:0,state:null},c.set(s,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=Rl(c.href);var M=ia(x).hoistableStyles,k=M.get(i);if(k||(x=x.ownerDocument||x,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(i,k),(M=x.querySelector(pu(i)))&&!M._p&&(k.instance=M,k.state.loading=5),Qr.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Qr.set(i,c),M||_f(x,i,c,k.state))),s&&p===null)throw Error(Y(528,""));return k}if(s&&p!==null)throw Error(Y(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Sc(c),c=ia(x).hoistableScripts,p=c.get(s),p||(p={type:"script",instance:null,count:0,state:null},c.set(s,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(Y(444,i))}}function Rl(i){return'href="'+Ir(i)+'"'}function pu(i){return'link[rel="stylesheet"]['+i+"]"}function mu(i){return Ye({},i,{"data-precedence":i.precedence,precedence:null})}function _f(i,s,c,p){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?p.loading=1:(s=i.createElement("link"),p.preload=s,s.addEventListener("load",function(){return p.loading|=1}),s.addEventListener("error",function(){return p.loading|=2}),Ln(s,"link",c),qi(s),i.head.appendChild(s))}function Sc(i){return'[src="'+Ir(i)+'"]'}function Mc(i){return"script[async]"+i}function yh(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var p=i.querySelector('style[data-href~="'+Ir(c.href)+'"]');if(p)return s.instance=p,qi(p),p;var x=Ye({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return p=(i.ownerDocument||i).createElement("style"),qi(p),Ln(p,"style",x),Dl(p,c.precedence,i),s.instance=p;case"stylesheet":x=Rl(c.href);var M=i.querySelector(pu(x));if(M)return s.state.loading|=4,s.instance=M,qi(M),M;p=mu(c),(x=Qr.get(x))&&vh(p,x),M=(i.ownerDocument||i).createElement("link"),qi(M);var k=M;return k._p=new Promise(function(V,ae){k.onload=V,k.onerror=ae}),Ln(M,"link",p),s.state.loading|=4,Dl(M,c.precedence,i),s.instance=M;case"script":return M=Sc(c.src),(x=i.querySelector(Mc(M)))?(s.instance=x,qi(x),x):(p=c,(x=Qr.get(M))&&(p=Ye({},c),xh(p,x)),i=i.ownerDocument||i,x=i.createElement("script"),qi(x),Ln(x,"link",p),i.head.appendChild(x),s.instance=x);case"void":return null;default:throw Error(Y(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(p=s.instance,s.state.loading|=4,Dl(p,c.precedence,i));return s.instance}function Dl(i,s,c){for(var p=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=p.length?p[p.length-1]:null,M=x,k=0;k<p.length;k++){var V=p[k];if(V.dataset.precedence===s)M=V;else if(M!==x)break}M?M.parentNode.insertBefore(i,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function vh(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function xh(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var gu=null;function gp(i,s,c){if(gu===null){var p=new Map,x=gu=new Map;x.set(c,p)}else x=gu,p=x.get(c),p||(p=new Map,x.set(c,p));if(p.has(i))return p;for(p.set(i,null),c=c.getElementsByTagName(i),x=0;x<c.length;x++){var M=c[x];if(!(M[ka]||M[St]||i==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var k=M.getAttribute(s)||"";k=i+k;var V=p.get(k);V?V.push(M):p.set(k,[M])}}return p}function r(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function t(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function n(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var o=null;function u(){}function m(i,s,c){if(o===null)throw Error(Y(475));var p=o;if(s.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var x=Rl(c.href),M=i.querySelector(pu(x));if(M){i=M._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(p.count++,p=v.bind(p),i.then(p,p)),s.state.loading|=4,s.instance=M,qi(M);return}M=i.ownerDocument||i,c=mu(c),(x=Qr.get(x))&&vh(c,x),M=M.createElement("link"),qi(M);var k=M;k._p=new Promise(function(V,ae){k.onload=V,k.onerror=ae}),Ln(M,"link",c),s.instance=M}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(p.count++,s=v.bind(p),i.addEventListener("load",s),i.addEventListener("error",s))}}function _(){if(o===null)throw Error(Y(475));var i=o;return i.stylesheets&&i.count===0&&S(i,i.stylesheets),0<i.count?function(s){var c=setTimeout(function(){if(i.stylesheets&&S(i,i.stylesheets),i.unsuspend){var p=i.unsuspend;i.unsuspend=null,p()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(c)}}:null}function v(){if(this.count--,this.count===0){if(this.stylesheets)S(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var b=null;function S(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,b=new Map,s.forEach(C,i),b=null,v.call(i))}function C(i,s){if(!(s.state.loading&4)){var c=b.get(i);if(c)var p=c.get(null);else{c=new Map,b.set(i,c);for(var x=i.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<x.length;M++){var k=x[M];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(c.set(k.dataset.precedence,k),p=k)}p&&c.set(null,p)}x=s.instance,k=x.getAttribute("data-precedence"),M=c.get(k)||p,M===p&&c.set(null,x),c.set(k,x),this.count++,p=v.bind(this),x.addEventListener("load",p),x.addEventListener("error",p),M?M.parentNode.insertBefore(x,M.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(x,i.firstChild)),s.state.loading|=4}}var z={$$typeof:Ct,Provider:null,Consumer:null,_currentValue:At,_currentValue2:At,_threadCount:0};function I(i,s,c,p,x,M,k,V){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ct(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ct(0),this.hiddenUpdates=ct(null),this.identifierPrefix=p,this.onUncaughtError=x,this.onCaughtError=M,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function B(i,s,c,p,x,M,k,V,ae,Ee,je,Ge){return i=new I(i,s,c,k,V,ae,Ee,Ge),s=1,M===!0&&(s|=24),M=Hr(3,null,null,s),i.current=M,M.stateNode=i,s=qs(),s.refCount++,i.pooledCache=s,s.refCount++,M.memoizedState={element:p,isDehydrated:c,cache:s},lc(M),i}function O(i){return i?(i=Vt,i):Vt}function N(i,s,c,p,x,M){x=O(x),p.context===null?p.context=x:p.pendingContext=x,p=qa(s),p.payload={element:c},M=M===void 0?null:M,M!==null&&(p.callback=M),c=ps(i,p,s),c!==null&&(Wr(c,i,s),ml(c,i,s))}function q(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function K(i,s){q(i,s),(i=i.alternate)&&q(i,s)}function pe(i){if(i.tag===13){var s=qr(i,67108864);s!==null&&Wr(s,i,67108864),K(i,67108864)}}var te=!0;function oe(i,s,c,p){var x=Be.T;Be.T=null;var M=ot.p;try{ot.p=2,Pe(i,s,c,p)}finally{ot.p=M,Be.T=x}}function Se(i,s,c,p){var x=Be.T;Be.T=null;var M=ot.p;try{ot.p=8,Pe(i,s,c,p)}finally{ot.p=M,Be.T=x}}function Pe(i,s,c,p){if(te){var x=Ve(p);if(x===null)lf(i,s,p,tt,c),Kt(i,p);else if(Bn(x,i,s,c,p))p.stopPropagation();else if(Kt(i,p),s&4&&-1<dt.indexOf(i)){for(;x!==null;){var M=kt(x);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var k=he(M.pendingLanes);if(k!==0){var V=M;for(V.pendingLanes|=2,V.entangledLanes|=2;k;){var ae=1<<31-ce(k);V.entanglements[1]|=ae,k&=~ae}Es(M),(Di&6)===0&&(ah=rr()+500,cu(0))}}break;case 13:V=qr(M,2),V!==null&&Wr(V,M,2),lh(),K(M,2)}if(M=Ve(p),M===null&&lf(i,s,p,tt,c),M===x)break;x=M}x!==null&&p.stopPropagation()}else lf(i,s,p,null,c)}}function Ve(i){return i=Yo(i),$e(i)}var tt=null;function $e(i){if(tt=null,i=jt(i),i!==null){var s=Je(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=D(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return tt=i,null}function it(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ia()){case ha:return 2;case eo:return 8;case da:case zs:return 32;case ts:return 268435456;default:return 32}default:return 32}}var pt=!1,Xe=null,We=null,Le=null,vt=new Map,Mt=new Map,ft=[],dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Kt(i,s){switch(i){case"focusin":case"focusout":Xe=null;break;case"dragenter":case"dragleave":We=null;break;case"mouseover":case"mouseout":Le=null;break;case"pointerover":case"pointerout":vt.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mt.delete(s.pointerId)}}function ki(i,s,c,p,x,M){return i===null||i.nativeEvent!==M?(i={blockedOn:s,domEventName:c,eventSystemFlags:p,nativeEvent:M,targetContainers:[x]},s!==null&&(s=kt(s),s!==null&&pe(s)),i):(i.eventSystemFlags|=p,s=i.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),i)}function Bn(i,s,c,p,x){switch(s){case"focusin":return Xe=ki(Xe,i,s,c,p,x),!0;case"dragenter":return We=ki(We,i,s,c,p,x),!0;case"mouseover":return Le=ki(Le,i,s,c,p,x),!0;case"pointerover":var M=x.pointerId;return vt.set(M,ki(vt.get(M)||null,i,s,c,p,x)),!0;case"gotpointercapture":return M=x.pointerId,Mt.set(M,ki(Mt.get(M)||null,i,s,c,p,x)),!0}return!1}function ir(i){var s=jt(i.target);if(s!==null){var c=Je(s);if(c!==null){if(s=c.tag,s===13){if(s=D(c),s!==null){i.blockedOn=s,Pn(i.priority,function(){if(c.tag===13){var p=Rr();p=Lt(p);var x=qr(c,p);x!==null&&Wr(x,c,p),K(c,p)}});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Fr(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=Ve(i.nativeEvent);if(c===null){c=i.nativeEvent;var p=new c.constructor(c.type,c);as=p,c.target.dispatchEvent(p),as=null}else return s=kt(c),s!==null&&pe(s),i.blockedOn=c,!1;s.shift()}return!0}function jr(i,s,c){Fr(i)&&c.delete(s)}function nr(){pt=!1,Xe!==null&&Fr(Xe)&&(Xe=null),We!==null&&Fr(We)&&(We=null),Le!==null&&Fr(Le)&&(Le=null),vt.forEach(jr),Mt.forEach(jr)}function Li(i,s){i.blockedOn===s&&(i.blockedOn=null,pt||(pt=!0,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,nr)))}var wn=null;function $n(i){wn!==i&&(wn=i,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,function(){wn===i&&(wn=null);for(var s=0;s<i.length;s+=3){var c=i[s],p=i[s+1],x=i[s+2];if(typeof p!="function"){if($e(p||c)===null)continue;break}var M=kt(c);M!==null&&(i.splice(s,3),s-=3,Ri(M,{pending:!0,data:x,method:c.method,action:p},p,x))}}))}function Tn(i){function s(ae){return Li(ae,i)}Xe!==null&&Li(Xe,i),We!==null&&Li(We,i),Le!==null&&Li(Le,i),vt.forEach(s),Mt.forEach(s);for(var c=0;c<ft.length;c++){var p=ft[c];p.blockedOn===i&&(p.blockedOn=null)}for(;0<ft.length&&(c=ft[0],c.blockedOn===null);)ir(c),c.blockedOn===null&&ft.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(p=0;p<c.length;p+=3){var x=c[p],M=c[p+1],k=x[Rt]||null;if(typeof M=="function")k||$n(c);else if(k){var V=null;if(M&&M.hasAttribute("formAction")){if(x=M,k=M[Rt]||null)V=k.formAction;else if($e(x)!==null)continue}else V=k.action;typeof V=="function"?c[p+1]=V:(c.splice(p,3),p-=3),$n(c)}}}function pr(i){this._internalRoot=i}Ur.prototype.render=pr.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(Y(409));var c=s.current,p=Rr();N(c,p,i,s,null,null)},Ur.prototype.unmount=pr.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;N(i.current,2,null,i,null,null),lh(),s[Gi]=null}};function Ur(i){this._internalRoot=i}Ur.prototype.unstable_scheduleHydration=function(i){if(i){var s=En();i={blockedOn:null,target:i,priority:s};for(var c=0;c<ft.length&&s!==0&&s<ft[c].priority;c++);ft.splice(c,0,i),c===0&&ir(i)}};var On=re.version;if(On!=="19.1.1")throw Error(Y(527,On,"19.1.1"));ot.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(Y(188)):(i=Object.keys(i).join(","),Error(Y(268,i)));return i=Re(s),i=i!==null?Ie(i):null,i=i===null?null:i.stateNode,i};var Jr={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Be,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dn=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dn.isDisabled&&dn.supportsFiber)try{ta=dn.inject(Jr),Mn=dn}catch{}}return vf.createRoot=function(i,s){if(!_e(i))throw Error(Y(299));var c=!1,p="",x=Gu,M=_d,k=Sf,V=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onUncaughtError!==void 0&&(x=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(k=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(V=s.unstable_transitionCallbacks)),s=B(i,1,!1,null,null,c,p,x,M,k,V,null),i[Gi]=s.current,of(i),new pr(s)},vf.hydrateRoot=function(i,s,c){if(!_e(i))throw Error(Y(299));var p=!1,x="",M=Gu,k=_d,V=Sf,ae=null,Ee=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(k=c.onCaughtError),c.onRecoverableError!==void 0&&(V=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(ae=c.unstable_transitionCallbacks),c.formState!==void 0&&(Ee=c.formState)),s=B(i,1,!0,s,c??null,p,x,M,k,V,ae,Ee),s.context=O(null),c=s.current,p=Rr(),p=Lt(p),x=qa(p),x.callback=null,ps(c,x,p),c=p,s.current.lanes=c,ge(s,c),Es(s),i[Gi]=s.current,of(i),new Ur(s)},vf.version="19.1.1",vf}var Qp;function Mm(){if(Qp)return Dp.exports;Qp=1;function Z(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Z)}catch(re){console.error(re)}}return Z(),Dp.exports=Sm(),Dp.exports}var Em=Mm();const Cm={height:"60px",width:"100vw",padding:"10px",textAlign:"center",fontSize:"30px"},Am=()=>fn.jsx("div",{style:Cm,children:fn.jsx("header",{children:"KART ????"})});var yp={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.7.3/LICENSE.txt
 */var zm=yp.exports,Jp;function Pm(){return Jp||(Jp=1,(function(Z,re){(function(ye,Y){Z.exports=Y()})(zm,(function(){var ye={},Y={};function _e(D,d,Re){if(Y[D]=Re,D==="index"){var Ie="var sharedModule = {}; ("+Y.shared+")(sharedModule); ("+Y.worker+")(sharedModule);",Ye={};return Y.shared(Ye),Y.index(ye,Ye),typeof window<"u"&&ye.setWorkerUrl(window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"}))),ye}}_e("shared",["exports"],(function(D){function d(r,t,n,o){return new(n||(n=Promise))((function(u,m){function _(S){try{b(o.next(S))}catch(C){m(C)}}function v(S){try{b(o.throw(S))}catch(C){m(C)}}function b(S){var C;S.done?u(S.value):(C=S.value,C instanceof n?C:new n((function(z){z(C)}))).then(_,v)}b((o=o.apply(r,t||[])).next())}))}function Re(r,t){this.x=r,this.y=t}function Ie(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ye,et;typeof SuppressedError=="function"&&SuppressedError,Re.prototype={clone(){return new Re(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,t){return this.clone()._rotateAround(r,t)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult(r){const t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const t=Math.cos(r),n=Math.sin(r),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround(r,t){const n=Math.cos(r),o=Math.sin(r),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Re},Re.convert=function(r){if(r instanceof Re)return r;if(Array.isArray(r))return new Re(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Re(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ue=(function(){if(et)return Ye;function r(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return et=1,Ye=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var m=this.sampleCurveX(o)-t;if(Math.abs(m)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=m/_}var v=0,b=1;for(o=t,u=0;u<20&&(m=this.sampleCurveX(o),!(Math.abs(m-t)<n));u++)t>m?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Ye})(),ve=Ie(Ue);let Nt,Gt;function Ht(){return Nt==null&&(Nt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Nt}function pi(){if(Gt==null&&(Gt=!1,Ht())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){Gt=!0;break}}}return Gt||!1}var zt=1e-6,Ct=typeof Float32Array<"u"?Float32Array:Array;function ii(){var r=new Ct(9);return Ct!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function mt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Qt(){var r=new Ct(3);return Ct!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function vi(r){var t=r[0],n=r[1],o=r[2];return Math.sqrt(t*t+n*n+o*o)}function Oi(r,t,n){var o=new Ct(3);return o[0]=r,o[1]=t,o[2]=n,o}function Ji(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function xi(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r}function on(r,t,n){var o=t[0],u=t[1],m=t[2],_=n[0],v=n[1],b=n[2];return r[0]=u*b-m*v,r[1]=m*_-o*b,r[2]=o*v-u*_,r}var ri,Xn=vi;function pn(r,t,n){var o=t[0],u=t[1],m=t[2],_=t[3];return r[0]=n[0]*o+n[4]*u+n[8]*m+n[12]*_,r[1]=n[1]*o+n[5]*u+n[9]*m+n[13]*_,r[2]=n[2]*o+n[6]*u+n[10]*m+n[14]*_,r[3]=n[3]*o+n[7]*u+n[11]*m+n[15]*_,r}function Zi(){var r=new Ct(4);return Ct!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Be(r,t,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",m=Math.PI/360;t*=m,o*=m,n*=m;var _=Math.sin(t),v=Math.cos(t),b=Math.sin(n),S=Math.cos(n),C=Math.sin(o),z=Math.cos(o);switch(u){case"xyz":r[0]=_*S*z+v*b*C,r[1]=v*b*z-_*S*C,r[2]=v*S*C+_*b*z,r[3]=v*S*z-_*b*C;break;case"xzy":r[0]=_*S*z-v*b*C,r[1]=v*b*z-_*S*C,r[2]=v*S*C+_*b*z,r[3]=v*S*z+_*b*C;break;case"yxz":r[0]=_*S*z+v*b*C,r[1]=v*b*z-_*S*C,r[2]=v*S*C-_*b*z,r[3]=v*S*z+_*b*C;break;case"yzx":r[0]=_*S*z+v*b*C,r[1]=v*b*z+_*S*C,r[2]=v*S*C-_*b*z,r[3]=v*S*z-_*b*C;break;case"zxy":r[0]=_*S*z-v*b*C,r[1]=v*b*z+_*S*C,r[2]=v*S*C+_*b*z,r[3]=v*S*z-_*b*C;break;case"zyx":r[0]=_*S*z-v*b*C,r[1]=v*b*z+_*S*C,r[2]=v*S*C-_*b*z,r[3]=v*S*z+_*b*C;break;default:throw new Error("Unknown angle order "+u)}return r}function ot(){var r=new Ct(2);return Ct!=Float32Array&&(r[0]=0,r[1]=0),r}function At(r,t){var n=new Ct(2);return n[0]=r,n[1]=t,n}Qt(),ri=new Ct(4),Ct!=Float32Array&&(ri[0]=0,ri[1]=0,ri[2]=0,ri[3]=0),Qt(),Oi(1,0,0),Oi(0,1,0),Zi(),Zi(),ii(),ot();const Tt=8192;function ue(r,t,n){return t*(Tt/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}function Ne(r,t){return(r%t+t)%t}function lt(r,t,n){return r*(1-n)+t*n}function at(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,n=t*r;return 4*(r<.5?n:3*(r-t)+n-.75)}function xt(r,t,n,o){const u=new ve(r,t,n,o);return m=>u.solve(m)}const Jt=xt(.25,.1,.25,1);function bt(r,t,n){return Math.min(n,Math.max(t,r))}function Fn(r,t,n){const o=n-t,u=((r-t)%o+o)%o+t;return u===t?n:u}function si(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let jn=1;function As(r,t,n){const o={};for(const u in r)o[u]=t.call(this,r[u],u,r);return o}function es(r,t,n){const o={};for(const u in r)t.call(this,r[u],u,r)&&(o[u]=r[u]);return o}function gr(r){return Array.isArray(r)?r.map(gr):typeof r=="object"&&r?As(r,gr):r}const Yi={};function en(r){Yi[r]||(typeof console<"u"&&console.warn(r),Yi[r]=!0)}function ua(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Da(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let rr=null;function Ia(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ha="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function eo(r,t,n,o,u){return d(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const _=m?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),b=new Uint8ClampedArray(o*u*4);if(yield m.copyTo(b,(function(S,C,z,I,B){const O=4*Math.max(-C,0),N=(Math.max(0,z)-z)*I*4+O,q=4*I,K=Math.max(0,C),pe=Math.max(0,z);return{rect:{x:K,y:pe,width:Math.min(S.width,C+I)-K,height:Math.min(S.height,z+B)-pe},layout:[{offset:N,stride:q}]}})(r,t,n,o,u)),v)for(let S=0;S<b.length;S+=4){const C=b[S];b[S]=b[S+2],b[S+2]=C}return b}finally{m.close()}}))}let da,zs;function ts(r,t,n,o){return r.addEventListener(t,n,o),{unsubscribe:()=>{r.removeEventListener(t,n,o)}}}function to(r){return r*Math.PI/180}function Ps(r){return r/Math.PI*180}const ta={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Mn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Nr="AbortError";function ce(){return new Error(Nr)}const F={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function j(r){return F.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const G="global-dispatcher";class ie extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const se=()=>Da(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,he=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=j(r.url);if(o)return o(r,t);if(Da(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:G},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(se())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return d(this,void 0,void 0,(function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:se(),signal:u.signal});let _,v;o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");try{_=yield fetch(m)}catch(S){throw new ie(0,S.message,o.url,new Blob)}if(!_.ok){const S=yield _.blob();throw new ie(_.status,_.statusText,o.url,S)}v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const b=yield v;if(u.signal.aborted)throw ce();return{data:b,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(r,t);if(Da(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:G},t)}var n;return(function(o,u){return new Promise(((m,_)=>{var v;const b=new XMLHttpRequest;b.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(b.responseType="arraybuffer");for(const S in o.headers)b.setRequestHeader(S,o.headers[S]);o.type==="json"&&(b.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=o.credentials==="include",b.onerror=()=>{_(new Error(b.statusText))},b.onload=()=>{if(!u.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let S=b.response;if(o.type==="json")try{S=JSON.parse(b.response)}catch(C){return void _(C)}m({data:S,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const S=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});_(new ie(b.status,b.statusText,o.url,S))}},u.signal.addEventListener("abort",(()=>{b.abort(),_(ce())})),b.send(o.body)}))})(r,t)};function Me(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function fe(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function ke(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class qe{constructor(t,n={}){si(this,n),this.type=t}}class Oe extends qe{constructor(t,n={}){super("error",si({error:t},n))}}class ct{on(t,n){return this._listeners=this._listeners||{},fe(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return ke(t,n,this._listeners),ke(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},fe(t,n,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,n){typeof t=="string"&&(t=new qe(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of u)v.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of m)ke(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(si(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Oe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Pt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xt(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return Pt.forEach((o=>{o in t&&(n[o]=t[o])})),n}function _t(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!_t(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!_t(r[n],t[n]))return!1;return!0}return r===t}function Lt(r,t){r.push(t)}function bi(r,t,n){Lt(n,{command:"addSource",args:[r,t[r]]})}function En(r,t,n){Lt(t,{command:"removeSource",args:[r]}),n[r]=!0}function Pn(r,t,n,o){En(r,n,o),bi(r,t,n)}function Ei(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!_t(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!_t(r[n][o],t[n][o]))return!1;return!0}function St(r,t,n,o,u,m){r=r||{},t=t||{};for(const _ in r)Object.prototype.hasOwnProperty.call(r,_)&&(_t(r[_],t[_])||n.push({command:m,args:[o,_,t[_],u]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(r,_)&&(_t(r[_],t[_])||n.push({command:m,args:[o,_,t[_],u]}))}function Rt(r){return r.id}function Gi(r,t){return r[t.id]=t,r}class He{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function ar(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class tn extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class is{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new is(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ka={kind:"null"},nt={kind:"number"},jt={kind:"string"},kt={kind:"boolean"},mn={kind:"color"},ia={kind:"projectionDefinition"},qi={kind:"object"},Ut={kind:"value"},Ll={kind:"collator"},Dr={kind:"formatted"},ns={kind:"padding"},La={kind:"colorArray"},io={kind:"numberArray"},nn={kind:"resolvedImage"},Ec={kind:"variableAnchorOffsetCollection"};function Yn(r,t){return{kind:"array",itemType:r,N:t}}function mi(r){if(r.kind==="array"){const t=mi(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const Ba=[ka,nt,jt,kt,mn,ia,Dr,qi,Yn(Ut),ns,io,La,nn,Ec];function no(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!no(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of Ba)if(!no(n,t))return null}}return`Expected ${mi(r)} but found ${mi(t)} instead.`}function Cc(r,t){return t.some((n=>n.kind===r.kind))}function Vr(r,t){return t.some((n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r))}function Oa(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Bl=.96422,Sh=.82521,vu=4/29,Kn=6/29,xu=3*Kn*Kn,ud=Kn*Kn*Kn,Ac=Math.PI/180,Mh=180/Math.PI;function $o(r){return(r%=360)<0&&(r+=360),r}function Xo([r,t,n,o]){let u,m;const _=Ol((.2225045*(r=Ir(r))+.7168786*(t=Ir(t))+.0606169*(n=Ir(n)))/1);r===t&&t===n?u=m=_:(u=Ol((.4360747*r+.3850649*t+.1430804*n)/Bl),m=Ol((.0139322*r+.0971045*t+.7141733*n)/Sh));const v=116*_-16;return[v<0?0:v,500*(u-_),200*(_-m),o]}function Ir(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ol(r){return r>ud?Math.pow(r,1/3):r/xu+vu}function ro([r,t,n,o]){let u=(r+16)/116,m=isNaN(t)?u:u+t/500,_=isNaN(n)?u:u-n/200;return u=1*Rs(u),m=Bl*Rs(m),_=Sh*Rs(_),[Fl(3.1338561*m-1.6168667*u-.4906146*_),Fl(-.9787684*m+1.9161415*u+.033454*_),Fl(.0719453*m-.2289914*u+1.4052427*_),o]}function Fl(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Rs(r){return r>Kn?r*r*r:xu*(r-vu)}const Eh=Object.hasOwn||function(r,t){return Object.prototype.hasOwnProperty.call(r,t)};function ao(r,t){return Eh(r,t)?r[t]:void 0}function Fa(r){return parseInt(r.padEnd(2,r),16)/255}function fa(r,t){return $t(t?r/100:r,0,1)}function $t(r,t,n){return Math.min(Math.max(t,r),n)}function Ds(r){return!r.some(Number.isNaN)}const ja={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function rs(r,t,n){return r+n*(t-r)}function so(r,t,n){return r.map(((o,u)=>rs(o,t[u],n)))}class qt{constructor(t,n,o,u=1,m=!0){this.r=t,this.g=n,this.b=o,this.a=u,m||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof qt)return t;if(typeof t!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=ao(ja,o);if(u){const[_,v,b]=u;return[_/255,v/255,b/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[Fa(o.slice(v,v+=_)),Fa(o.slice(v,v+=_)),Fa(o.slice(v,v+=_)),Fa(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,S,C,z,I,B,O,N,q,K,pe]=_,te=[C||" ",B||" ",q].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const oe=[S,I,N].join(""),Se=oe==="%%%"?100:oe===""?255:0;if(Se){const Pe=[$t(+b/Se,0,1),$t(+z/Se,0,1),$t(+O/Se,0,1),K?fa(+K,pe):1];if(Ds(Pe))return Pe}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[_,v,b,S,C,z,I,B,O]=m,N=[b||" ",C||" ",I].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const q=[+v,$t(+S,0,100),$t(+z,0,100),B?fa(+B,O):1];if(Ds(q))return(function([K,pe,te,oe]){function Se(Pe){const Ve=(Pe+K/30)%12,tt=pe*Math.min(te,1-te);return te-tt*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return K=$o(K),pe/=100,te/=100,[Se(0),Se(8),Se(4),oe]})(q)}}})(t);return n?new qt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,m=u||1/0;return this.overwriteGetter("rgb",[t/m,n/m,o/m,u])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,o,u,m]=Xo(t),_=Math.sqrt(o*o+u*u);return[Math.round(1e4*_)?$o(Math.atan2(u,o)*Mh):NaN,_,n,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Xo(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map((m=>Math.round(255*m))).join(",")},${u})`}static interpolate(t,n,o,u="rgb"){switch(u){case"rgb":{const[m,_,v,b]=so(t.rgb,n.rgb,o);return new qt(m,_,v,b,!1)}case"hcl":{const[m,_,v,b]=t.hcl,[S,C,z,I]=n.hcl;let B,O;if(isNaN(m)||isNaN(S))isNaN(m)?isNaN(S)?B=NaN:(B=S,v!==1&&v!==0||(O=C)):(B=m,z!==1&&z!==0||(O=_));else{let te=S-m;S>m&&te>180?te-=360:S<m&&m-S>180&&(te+=360),B=m+o*te}const[N,q,K,pe]=(function([te,oe,Se,Pe]){return te=isNaN(te)?0:te*Ac,ro([Se,Math.cos(te)*oe,Math.sin(te)*oe,Pe])})([B,O??rs(_,C,o),rs(v,z,o),rs(b,I,o)]);return new qt(N,q,K,pe,!1)}case"lab":{const[m,_,v,b]=ro(so(t.lab,n.lab,o));return new qt(m,_,v,b,!1)}}}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class as{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Yo=["bottom","center","top"];class ss{constructor(t,n,o,u,m,_){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=m,this.verticalAlign=_}}class Cn{constructor(t){this.sections=t}static fromString(t){return new Cn([new ss(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Cn?t:Cn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rn)return t;if(typeof t=="number")return new Rn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Rn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new Rn(so(t.values,n.values,o))}}class Wn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Wn)return t;if(typeof t=="number")return new Wn([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new Wn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new Wn(so(t.values,n.values,o))}}class gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gn)return t;if(typeof t=="string"){const o=qt.parse(t);return o?new gn([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const u=qt.parse(o);if(!u)return;n.push(u)}return new gn(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,u="rgb"){const m=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)m.push(qt.interpolate(t.values[_],n.values[_],o,u));return new gn(m)}}class di extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Ua=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Qn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!Ua.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new Qn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const u=t.values,m=n.values;if(u.length!==m.length)throw new di(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let v=0;v<u.length;v+=2){if(u[v]!==m[v])throw new di(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${u[v]}, to[${v}]: ${m[v]}`);_.push(u[v]);const[b,S]=u[v+1],[C,z]=m[v+1];_.push([rs(b,C,o),rs(S,z,o)])}return new Qn(_)}}class Jn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Jn({name:t,available:!1}):null}}class rn{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new rn(t,n,o)}static parse(t){return t instanceof rn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new rn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new rn(t.from,t.to,t.transition):typeof t=="string"?new rn(t,t,1):void 0}}function Ci(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Na(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof rn||r instanceof qt||r instanceof as||r instanceof Cn||r instanceof Rn||r instanceof Wn||r instanceof gn||r instanceof Qn||r instanceof Jn)return!0;if(Array.isArray(r)){for(const t of r)if(!Na(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Na(r[t]))return!1;return!0}return!1}function wt(r){if(r===null)return ka;if(typeof r=="string")return jt;if(typeof r=="boolean")return kt;if(typeof r=="number")return nt;if(r instanceof qt)return mn;if(r instanceof rn)return ia;if(r instanceof as)return Ll;if(r instanceof Cn)return Dr;if(r instanceof Rn)return ns;if(r instanceof Wn)return io;if(r instanceof gn)return La;if(r instanceof Qn)return Ec;if(r instanceof Jn)return nn;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const u=wt(o);if(n){if(n===u)continue;n=Ut;break}n=u}return Yn(n||Ut,t)}return qi}function Dt(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof qt||r instanceof rn||r instanceof Cn||r instanceof Rn||r instanceof Wn||r instanceof gn||r instanceof Qn||r instanceof Jn?r.toString():JSON.stringify(r)}class na{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Na(t[1]))return n.error("invalid value");const o=t[1];let u=wt(o);const m=n.expectedType;return u.kind!=="array"||u.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(u=m),new na(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ei={string:jt,number:nt,boolean:kt,object:qi};class Fi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const m=t[0];if(m==="array"){let v,b;if(t.length>2){const S=t[1];if(typeof S!="string"||!(S in ei)||S==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=ei[S],u++}else v=Ut;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=t[2],u++}o=Yn(v,b)}else{if(!ei[m])throw new Error(`Types doesn't contain name = ${m}`);o=ei[m]}const _=[];for(;u<t.length;u++){const v=n.parse(t[u],u,Ut);if(!v)return null;_.push(v)}return new Fi(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!no(this.type,wt(o)))return o;if(n===this.args.length-1)throw new di(`Expected value to be of type ${mi(this.type)}, but found ${mi(wt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const sr={"to-boolean":kt,"to-color":mn,"to-number":nt,"to-string":jt};class Zr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!sr[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=sr[o],m=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],_,Ut);if(!v)return null;m.push(v)}return new Zr(u,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof qt)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ci(n[0],n[1],n[2],n[3]),!o))return new qt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new di(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=Rn.parse(n);if(u)return u}throw new di(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=Wn.parse(n);if(u)return u}throw new di(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=gn.parse(n);if(u)return u}throw new di(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=Qn.parse(n);if(u)return u}throw new di(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new di(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Cn.fromString(Dt(this.args[0].evaluate(t)));case"resolvedImage":return Jn.fromString(Dt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Dt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Is=["Unknown","Point","LineString","Polygon"];class bu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Is[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=qt.parse(t),this._parseColorCache.set(t,n)),n}}class ks{constructor(t,n,o=[],u,m=new is,_=[]){this.registry=t,this.path=o,this.key=o.map((v=>`[${v}]`)).join(""),this.scope=m,this.errors=_,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,m={}){return n?this.concat(n,o,u)._parse(t,m):this._parse(t,m)}_parse(t,n){function o(u,m,_){return _==="assert"?new Fi(m,[u]):_==="coerce"?new Zr(m,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[u];if(m){let _=m.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(b.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(b.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(b.kind)||v.kind==="colorArray"&&["value","string","array"].includes(b.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(b.kind))_=o(_,v,n.typeAnnotation||"coerce");else if(this.checkSubtype(v,b))return null}else _=o(_,v,n.typeAnnotation||"assert")}if(!(_ instanceof na)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new bu;try{_=new na(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new ks(this.registry,this._isConstant,u,n||null,m,this.errors)}error(t,...n){const o=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new tn(o,t))}checkSubtype(t,n){const o=no(t,n);return o&&this.error(o),o}}class oo{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const _=t[m];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=n.parse(t[m+1],m+1);if(!v)return null;o.push([_,v])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new oo(o,u):null}outputDefined(){return this.result.outputDefined()}}class Ls{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new Ls(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class lo{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,nt),u=n.parse(t[2],2,Yn(n.expectedType||Ut));return o&&u?new lo(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new di(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new di(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new di(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class jl{constructor(t,n){this.type=kt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Ut),u=n.parse(t[2],2,Ut);return o&&u?Cc(o.type,[kt,jt,nt,ka,Ut])?new jl(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${mi(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Vr(n,["boolean","string","number","null"]))throw new di(`Expected first argument to be of type boolean, string, number or null, but found ${mi(wt(n))} instead.`);if(!Vr(o,["string","array"]))throw new di(`Expected second argument to be of type array or string, but found ${mi(wt(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class pa{constructor(t,n,o){this.type=nt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Ut),u=n.parse(t[2],2,Ut);if(!o||!u)return null;if(!Cc(o.type,[kt,jt,nt,ka,Ut]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${mi(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,nt);return m?new pa(o,u,m):null}return new pa(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Vr(n,["boolean","string","number","null"]))throw new di(`Expected first argument to be of type boolean, string, number or null, but found ${mi(wt(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),Vr(o,["string"])){const m=o.indexOf(n,u);return m===-1?-1:[...o.slice(0,m)].length}if(Vr(o,["array"]))return o.indexOf(n,u);throw new di(`Expected second argument to be of type array or string, but found ${mi(wt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Un{constructor(t,n,o,u,m,_){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=m,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const m={},_=[];for(let S=2;S<t.length-1;S+=2){let C=t[S];const z=t[S+1];Array.isArray(C)||(C=[C]);const I=n.concat(S);if(C.length===0)return I.error("Expected at least one branch label.");for(const O of C){if(typeof O!="number"&&typeof O!="string")return I.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,wt(O)))return null}else o=wt(O);if(m[String(O)]!==void 0)return I.error("Branch labels must be unique.");m[String(O)]=_.length}const B=n.parse(z,S,u);if(!B)return null;u=u||B.type,_.push(B)}const v=n.parse(t[1],1,Ut);if(!v)return null;const b=n.parse(t[t.length-1],t.length-1,u);return b?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new Un(o,u,v,m,_,b):null}evaluate(t){const n=this.input.evaluate(t);return(wt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Ko{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let _=1;_<t.length-1;_+=2){const v=n.parse(t[_],_,kt);if(!v)return null;const b=n.parse(t[_+1],_+1,o);if(!b)return null;u.push([v,b]),o=o||b.type}const m=n.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Ko(o,u,m)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class co{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Ut),u=n.parse(t[2],2,nt);if(!o||!u)return null;if(!Cc(o.type,[Yn(Ut),jt,Ut]))return n.error(`Expected first argument to be of type array or string, but found ${mi(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,nt);return m?new co(o.type,o,u,m):null}return new co(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),Vr(n,["string"]))return[...n].slice(o,u).join("");if(Vr(n,["array"]))return n.slice(o,u);throw new di(`Expected first argument to be of type array or string, but found ${mi(wt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function uo(r,t){const n=r.length-1;let o,u,m=0,_=n,v=0;for(;m<=_;)if(v=Math.floor((m+_)/2),o=r[v],u=r[v+1],o<=t){if(v===n||t<u)return v;m=v+1}else{if(!(o>t))throw new di("Input is not a number.");_=v-1}return 0}class ln{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,m]of o)this.labels.push(u),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,nt);if(!o)return null;const u=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],b=t[_+1],S=_,C=_+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const z=n.parse(b,C,m);if(!z)return null;m=m||z.type,u.push([v,z])}return new ln(m,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const m=n.length;return u>=n[m-1]?o[m-1].evaluate(t):o[uo(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Ch(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ul,wu,Ah=(function(){if(wu)return Ul;function r(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return wu=1,Ul=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var m=this.sampleCurveX(o)-t;if(Math.abs(m)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=m/_}var v=0,b=1;for(o=t,u=0;u<20&&(m=this.sampleCurveX(o),!(Math.abs(m-t)<n));u++)t>m?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Ul})(),Wo=Ch(Ah);class er{constructor(t,n,o,u,m){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of m)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,n,o,u){let m=0;if(t.name==="exponential")m=Nl(n,t.base,o,u);else if(t.name==="linear")m=Nl(n,1,o,u);else if(t.name==="cubic-bezier"){const _=t.controlPoints;m=new Wo(_[0],_[1],_[2],_[3]).solve(Nl(n,1,o,u))}return m}static parse(t,n){let[o,u,m,..._]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some((C=>typeof C!="number"||C<0||C>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,nt),!m)return null;const v=[];let b=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==La?n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType):b=mn;for(let S=0;S<_.length;S+=2){const C=_[S],z=_[S+1],I=S+3,B=S+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(v.length&&v[v.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const O=n.parse(z,B,b);if(!O)return null;b=b||O.type,v.push([C,O])}return Oa(b,nt)||Oa(b,ia)||Oa(b,mn)||Oa(b,ns)||Oa(b,io)||Oa(b,La)||Oa(b,Ec)||Oa(b,Yn(nt))?new er(b,o,u,m,v):n.error(`Type ${mi(b)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const m=n.length;if(u>=n[m-1])return o[m-1].evaluate(t);const _=uo(n,u),v=er.interpolationFactor(this.interpolation,u,n[_],n[_+1]),b=o[_].evaluate(t),S=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return rs(b,S,v);case"color":return qt.interpolate(b,S,v);case"padding":return Rn.interpolate(b,S,v);case"colorArray":return gn.interpolate(b,S,v);case"numberArray":return Wn.interpolate(b,S,v);case"variableAnchorOffsetCollection":return Qn.interpolate(b,S,v);case"array":return so(b,S,v);case"projectionDefinition":return rn.interpolate(b,S,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return qt.interpolate(b,S,v,"hcl");case"colorArray":return gn.interpolate(b,S,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return qt.interpolate(b,S,v,"lab");case"colorArray":return gn.interpolate(b,S,v,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Nl(r,t,n,o){const u=o-n,m=r-n;return u===0?0:t===1?m/u:(Math.pow(t,m)-1)/(Math.pow(t,u)-1)}const Va={color:qt.interpolate,number:rs,padding:Rn.interpolate,numberArray:Wn.interpolate,colorArray:gn.interpolate,variableAnchorOffsetCollection:Qn.interpolate,array:so};class ho{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const m=[];for(const v of t.slice(1)){const b=n.parse(v,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,m.push(b)}if(!o)throw new Error("No output type");const _=u&&m.some((v=>no(u,v.type)));return new ho(_?Ut:o,m)}evaluate(t){let n,o=null,u=0;for(const m of this.args)if(u++,o=m.evaluate(t),o&&o instanceof Jn&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Vl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Zl(r,t,n,o){return o.compare(t,n)===0}function or(r,t,n){const o=r!=="=="&&r!=="!=";return class cm{constructor(m,_,v){this.type=kt,this.lhs=m,this.rhs=_,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const v=m[0];let b=_.parse(m[1],1,Ut);if(!b)return null;if(!Vl(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${mi(b.type)}'.`);let S=_.parse(m[2],2,Ut);if(!S)return null;if(!Vl(v,S.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${mi(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${mi(b.type)}' and '${mi(S.type)}'.`);o&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Fi(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Fi(b.type,[S])));let C=null;if(m.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(m[3],3,Ll),!C)return null}return new cm(b,S,C)}evaluate(m){const _=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const b=wt(_),S=wt(v);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new di(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=wt(_),S=wt(v);if(b.kind!=="string"||S.kind!=="string")return t(m,_,v)}return this.collator?n(m,_,v,this.collator.evaluate(m)):t(m,_,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Tu=or("==",(function(r,t,n){return t===n}),Zl),zc=or("!=",(function(r,t,n){return t!==n}),(function(r,t,n,o){return!Zl(0,t,n,o)})),hd=or("<",(function(r,t,n){return t<n}),(function(r,t,n,o){return o.compare(t,n)<0})),Su=or(">",(function(r,t,n){return t>n}),(function(r,t,n,o){return o.compare(t,n)>0})),dd=or("<=",(function(r,t,n){return t<=n}),(function(r,t,n,o){return o.compare(t,n)<=0})),fd=or(">=",(function(r,t,n){return t>=n}),(function(r,t,n,o){return o.compare(t,n)>=0}));class Pc{constructor(t,n,o){this.type=Ll,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,kt);if(!u)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,kt);if(!m)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,jt),!_)?null:new Pc(u,m,_)}evaluate(t){return new as(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Mu{constructor(t,n,o,u,m){this.type=jt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,nt);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=n.parse(u.locale,1,jt),!m))return null;let _=null;if(u.currency&&(_=n.parse(u.currency,1,jt),!_))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,nt),!v))return null;let b=null;return u["max-fraction-digits"]&&(b=n.parse(u["max-fraction-digits"],1,nt),!b)?null:new Mu(o,m,_,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class fo{constructor(t){this.type=Dr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let m=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let b=null;if(v["font-scale"]&&(b=n.parse(v["font-scale"],1,nt),!b))return null;let S=null;if(v["text-font"]&&(S=n.parse(v["text-font"],1,Yn(jt)),!S))return null;let C=null;if(v["text-color"]&&(C=n.parse(v["text-color"],1,mn),!C))return null;let z=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Yo.includes(v["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(z=n.parse(v["vertical-align"],1,jt),!z)return null}const I=u[u.length-1];I.scale=b,I.font=S,I.textColor=C,I.verticalAlign=z}else{const b=n.parse(t[_],1,Ut);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new fo(u)}evaluate(t){return new Cn(this.sections.map((n=>{const o=n.content.evaluate(t);return wt(o)===nn?new ss("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new ss(Dt(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Eu{constructor(t){this.type=nn,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,jt);return o?new Eu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=Jn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Qo{constructor(t){this.type=nt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${mi(o.type)} instead.`):new Qo(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new di(`Expected value to be of type string or array, but found ${mi(wt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const _r=8192;function pd(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*_r),Math.round(o*u*_r)]}function Gl(r,t){const n=Math.pow(2,t.z);return[(u=(r[0]/_r+t.x)/n,360*u-180),(o=(r[1]/_r+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Jo(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function el(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function zh(r,t,n){const o=r[0]-t[0],u=r[1]-t[1],m=r[0]-n[0],_=r[1]-n[1];return o*_-m*u==0&&o*m<=0&&u*_<=0}function ql(r,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-u[1]*m[0]!=0&&!(!Au(r,t,n,o)||!Au(n,o,r,t));var u,m}function tl(r,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(ql(r,t,o[u],o[u+1]))return!0;return!1}function po(r,t,n=!1){let o=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(zh(r,v[b],v[b+1]))return n;(m=v[b])[1]>(u=r)[1]!=(_=v[b+1])[1]>u[1]&&u[0]<(_[0]-m[0])*(u[1]-m[1])/(_[1]-m[1])+m[0]&&(o=!o)}var u,m,_;return o}function Ph(r,t){for(const n of t)if(po(r,n))return!0;return!1}function Cu(r,t){for(const n of r)if(!po(n,t))return!1;for(let n=0;n<r.length-1;++n)if(tl(r[n],r[n+1],t))return!1;return!0}function Rh(r,t){for(const n of t)if(Cu(r,n))return!0;return!1}function Au(r,t,n,o){const u=o[0]-n[0],m=o[1]-n[1],_=(r[0]-n[0])*m-u*(r[1]-n[1]),v=(t[0]-n[0])*m-u*(t[1]-n[1]);return _>0&&v<0||_<0&&v>0}function mo(r,t,n){const o=[];for(let u=0;u<r.length;u++){const m=[];for(let _=0;_<r[u].length;_++){const v=pd(r[u][_],n);Jo(t,v),m.push(v)}o.push(m)}return o}function il(r,t,n){const o=[];for(let u=0;u<r.length;u++){const m=mo(r[u],t,n);o.push(m)}return o}function Rc(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const u=.5*o;let m=r[0]-n[0]>u?-o:n[0]-r[0]>u?o:0;m===0&&(m=r[0]-n[2]>u?-o:n[2]-r[0]>u?o:0),r[0]+=m}Jo(t,r)}function Hl(r,t,n,o){const u=Math.pow(2,o.z)*_r,m=[o.x*_r,o.y*_r],_=[];for(const v of r)for(const b of v){const S=[b.x+m[0],b.y+m[1]];Rc(S,t,n,u),_.push(S)}return _}function zu(r,t,n,o){const u=Math.pow(2,o.z)*_r,m=[o.x*_r,o.y*_r],_=[];for(const b of r){const S=[];for(const C of b){const z=[C.x+m[0],C.y+m[1]];Jo(t,z),S.push(z)}_.push(S)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const S of b)Rc(S,t,n,u)}var v;return _}class Bs{constructor(t,n){this.type=kt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Na(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const m of o.features){const{type:_,coordinates:v}=m.geometry;_==="Polygon"&&u.push(v),_==="MultiPolygon"&&u.push(...v)}if(u.length)return new Bs(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Bs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Bs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=mo(o.coordinates,m,_),b=Hl(n.geometry(),u,m,_);if(!el(u,m))return!1;for(const S of b)if(!po(S,v))return!1}if(o.type==="MultiPolygon"){const v=il(o.coordinates,m,_),b=Hl(n.geometry(),u,m,_);if(!el(u,m))return!1;for(const S of b)if(!Ph(S,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=mo(o.coordinates,m,_),b=zu(n.geometry(),u,m,_);if(!el(u,m))return!1;for(const S of b)if(!Cu(S,v))return!1}if(o.type==="MultiPolygon"){const v=il(o.coordinates,m,_),b=zu(n.geometry(),u,m,_);if(!el(u,m))return!1;for(const S of b)if(!Rh(S,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let $l=class{constructor(r=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const u=r-1>>1,m=t[u];if(n(o,m)>=0)break;t[r]=m,r=u}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,u=t[r];for(;r<o;){let m=1+(r<<1);const _=m+1;if(_<this.length&&n(t[_],t[m])<0&&(m=_),n(t[m],u)>=0)break;t[r]=t[m],r=m}t[r]=u}};function Xl(r,t,n=0,o=r.length-1,u=Dh){for(;o>n;){if(o-n>600){const b=o-n+1,S=t-n+1,C=Math.log(b),z=.5*Math.exp(2*C/3),I=.5*Math.sqrt(C*z*(b-z)/b)*(S-b/2<0?-1:1);Xl(r,t,Math.max(n,Math.floor(t-S*z/b+I)),Math.min(o,Math.floor(t+(b-S)*z/b+I)),u)}const m=r[t];let _=n,v=o;for(nl(r,n,t),u(r[o],m)>0&&nl(r,n,o);_<v;){for(nl(r,_,v),_++,v--;u(r[_],m)<0;)_++;for(;u(r[v],m)>0;)v--}u(r[n],m)===0?nl(r,n,v):(v++,nl(r,v,o)),v<=t&&(n=v+1),t<=v&&(o=v-1)}}function nl(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function Dh(r,t){return r<t?-1:r>t?1:0}function rl(r,t){if(r.length<=1)return[r];const n=[];let o,u;for(const m of r){const _=md(m);_!==0&&(m.area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(o&&n.push(o),o=[m]):o.push(m))}if(o&&n.push(o),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(Xl(n[m],t,1,n[m].length-1,Ih),n[m]=n[m].slice(0,t));return n}function Ih(r,t){return t.area-r.area}function md(r){let t=0;for(let n,o,u=0,m=r.length,_=m-1;u<m;_=u++)n=r[u],o=r[_],t+=(o.x-n.x)*(n.y+o.y);return t}const kh=1/298.257223563,Lh=kh*(2-kh),Pu=Math.PI/180;class yr{constructor(t){const n=6378.137*Pu*1e3,o=Math.cos(t*Pu),u=1/(1-Lh*(1-o*o)),m=Math.sqrt(u);this.kx=n*m*o,this.ky=n*m*u*(1-Lh)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,m,_,v=1/0;for(let b=0;b<t.length-1;b++){let S=t[b][0],C=t[b][1],z=this.wrap(t[b+1][0]-S)*this.kx,I=(t[b+1][1]-C)*this.ky,B=0;z===0&&I===0||(B=(this.wrap(n[0]-S)*this.kx*z+(n[1]-C)*this.ky*I)/(z*z+I*I),B>1?(S=t[b+1][0],C=t[b+1][1]):B>0&&(S+=z/this.kx*B,C+=I/this.ky*B)),z=this.wrap(n[0]-S)*this.kx,I=(n[1]-C)*this.ky;const O=z*z+I*I;O<v&&(v=O,o=S,u=C,m=b,_=B)}return{point:[o,u],index:m,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function al(r,t){return t[0]-r[0]}function Yl(r){return r[1]-r[0]+1}function Za(r,t){return r[1]>=r[0]&&r[1]<t}function oi(r,t){if(r[0]>r[1])return[null,null];const n=Yl(r);if(t){if(n===2)return[r,null];const u=Math.floor(n/2);return[[r[0],r[0]+u],[r[0]+u,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Dc(r,t){if(!Za(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Jo(n,r[o]);return n}function Kl(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)Jo(t,o);return t}function Bh(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Os(r,t,n){if(!Bh(r)||!Bh(t))return NaN;let o=0,u=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(u=r[1]-t[3]),r[3]<t[1]&&(u=t[1]-r[3]),n.distance([0,0],[o,u])}function os(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function go(r,t,n,o,u){const m=Math.min(os(r,[n,o],u),os(t,[n,o],u)),_=Math.min(os(n,[r,t],u),os(o,[r,t],u));return Math.min(m,_)}function Ru(r,t,n,o,u){if(!Za(t,r.length)||!Za(o,n.length))return 1/0;let m=1/0;for(let _=t[0];_<t[1];++_){const v=r[_],b=r[_+1];for(let S=o[0];S<o[1];++S){const C=n[S],z=n[S+1];if(ql(v,b,C,z))return 0;m=Math.min(m,go(v,b,C,z,u))}}return m}function Oh(r,t,n,o,u){if(!Za(t,r.length)||!Za(o,n.length))return NaN;let m=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(m=Math.min(m,u.distance(r[_],n[v])),m===0)return m;return m}function _o(r,t,n){if(po(r,t,!0))return 0;let o=1/0;for(const u of t){const m=u[0],_=u[u.length-1];if(m!==_&&(o=Math.min(o,os(r,[_,m],n)),o===0))return o;const v=n.pointOnLine(u,r);if(o=Math.min(o,n.distance(r,v.point)),o===0)return o}return o}function sl(r,t,n,o){if(!Za(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(po(r[m],n,!0))return 0;let u=1/0;for(let m=t[0];m<t[1];++m){const _=r[m],v=r[m+1];for(const b of n)for(let S=0,C=b.length,z=C-1;S<C;z=S++){const I=b[z],B=b[S];if(ql(_,v,I,B))return 0;u=Math.min(u,go(_,v,I,B,o))}}return u}function Ic(r,t){for(const n of r)for(const o of n)if(po(o,t,!0))return!0;return!1}function Fh(r,t,n,o=1/0){const u=Kl(r),m=Kl(t);if(o!==1/0&&Os(u,m,n)>=o)return o;if(el(u,m)){if(Ic(r,t))return 0}else if(Ic(t,r))return 0;let _=1/0;for(const v of r)for(let b=0,S=v.length,C=S-1;b<S;C=b++){const z=v[C],I=v[b];for(const B of t)for(let O=0,N=B.length,q=N-1;O<N;q=O++){const K=B[q],pe=B[O];if(ql(z,I,K,pe))return 0;_=Math.min(_,go(z,I,K,pe,n))}}return _}function Fs(r,t,n,o,u,m){if(!m)return;const _=Os(Dc(o,m),u,n);_<t&&r.push([_,m,[0,0]])}function Wl(r,t,n,o,u,m,_){if(!m||!_)return;const v=Os(Dc(o,m),Dc(u,_),n);v<t&&r.push([v,m,_])}function Ql(r,t,n,o,u=1/0){let m=Math.min(o.distance(r[0],n[0][0]),u);if(m===0)return m;const _=new $l([[0,[0,r.length-1],[0,0]]],al),v=Kl(n);for(;_.length>0;){const b=_.pop();if(b[0]>=m)continue;const S=b[1],C=t?50:100;if(Yl(S)<=C){if(!Za(S,r.length))return NaN;if(t){const z=sl(r,S,n,o);if(isNaN(z)||z===0)return z;m=Math.min(m,z)}else for(let z=S[0];z<=S[1];++z){const I=_o(r[z],n,o);if(m=Math.min(m,I),m===0)return 0}}else{const z=oi(S,t);Fs(_,m,o,r,v,z[0]),Fs(_,m,o,r,v,z[1])}}return m}function Jl(r,t,n,o,u,m=1/0){let _=Math.min(m,u.distance(r[0],n[0]));if(_===0)return _;const v=new $l([[0,[0,r.length-1],[0,n.length-1]]],al);for(;v.length>0;){const b=v.pop();if(b[0]>=_)continue;const S=b[1],C=b[2],z=t?50:100,I=o?50:100;if(Yl(S)<=z&&Yl(C)<=I){if(!Za(S,r.length)&&Za(C,n.length))return NaN;let B;if(t&&o)B=Ru(r,S,n,C,u),_=Math.min(_,B);else if(t&&!o){const O=r.slice(S[0],S[1]+1);for(let N=C[0];N<=C[1];++N)if(B=os(n[N],O,u),_=Math.min(_,B),_===0)return _}else if(!t&&o){const O=n.slice(C[0],C[1]+1);for(let N=S[0];N<=S[1];++N)if(B=os(r[N],O,u),_=Math.min(_,B),_===0)return _}else B=Oh(r,S,n,C,u),_=Math.min(_,B)}else{const B=oi(S,t),O=oi(C,o);Wl(v,_,u,r,n,B[0],O[0]),Wl(v,_,u,r,n,B[0],O[1]),Wl(v,_,u,r,n,B[1],O[0]),Wl(v,_,u,r,n,B[1],O[1])}}return _}function Du(r){return r.type==="MultiPolygon"?r.coordinates.map((t=>({type:"Polygon",coordinates:t}))):r.type==="MultiLineString"?r.coordinates.map((t=>({type:"LineString",coordinates:t}))):r.type==="MultiPoint"?r.coordinates.map((t=>({type:"Point",coordinates:t}))):[r]}class yo{constructor(t,n){this.type=nt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Na(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new yo(o,o.features.map((u=>Du(u.geometry))).flat());if(o.type==="Feature")return new yo(o,Du(o.geometry));if("type"in o&&"coordinates"in o)return new yo(o,Du(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const u=n.geometry(),m=u.flat().map((b=>Gl([b.x,b.y],n.canonical)));if(u.length===0)return NaN;const _=new yr(m[0][1]);let v=1/0;for(const b of o){switch(b.type){case"Point":v=Math.min(v,Jl(m,!1,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Jl(m,!1,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Ql(m,!1,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const u=n.geometry(),m=u.flat().map((b=>Gl([b.x,b.y],n.canonical)));if(u.length===0)return NaN;const _=new yr(m[0][1]);let v=1/0;for(const b of o){switch(b.type){case"Point":v=Math.min(v,Jl(m,!0,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Jl(m,!0,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Ql(m,!0,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const m=rl(u,0).map((b=>b.map((S=>S.map((C=>Gl([C.x,C.y],n.canonical))))))),_=new yr(m[0][0][0][1]);let v=1/0;for(const b of o)for(const S of m){switch(b.type){case"Point":v=Math.min(v,Ql([b.coordinates],!1,S,_,v));break;case"LineString":v=Math.min(v,Ql(b.coordinates,!0,S,_,v));break;case"Polygon":v=Math.min(v,Fh(S,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ec{constructor(t){this.type=Ut,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new ec(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?ao(o,this.key):null}eachChild(){}outputDefined(){return!1}}const vo={"==":Tu,"!=":zc,">":Su,"<":hd,">=":fd,"<=":dd,array:Fi,at:lo,boolean:Fi,case:Ko,coalesce:ho,collator:Pc,format:fo,image:Eu,in:jl,"index-of":pa,interpolate:er,"interpolate-hcl":er,"interpolate-lab":er,length:Qo,let:oo,literal:na,match:Un,number:Fi,"number-format":Mu,object:Fi,slice:co,step:ln,string:Fi,"to-boolean":Zr,"to-color":Zr,"to-number":Zr,"to-string":Zr,var:Ls,within:Bs,distance:yo,"global-state":ec};class Gr{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=Gr.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=_.filter((([S])=>!Array.isArray(S)||S.length===t.length-1));let b=null;for(const[S,C]of v){b=new ks(n.registry,vr,n.path,null,n.scope);const z=[];let I=!1;for(let B=1;B<t.length;B++){const O=t[B],N=Array.isArray(S)?S[B-1]:S.type,q=b.parse(O,1+z.length,N);if(!q){I=!0;break}z.push(q)}if(!I)if(Array.isArray(S)&&S.length!==z.length)b.error(`Expected ${S.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const O=Array.isArray(S)?S[B]:S.type,N=z[B];b.concat(B+1).checkSubtype(O,N.type)}if(b.errors.length===0)return new Gr(o,m,C,z)}}if(v.length===1)n.errors.push(...b.errors);else{const S=(v.length?v:_).map((([z])=>{return I=z,Array.isArray(I)?`(${I.map(mi).join(", ")})`:`(${mi(I.type)}...)`;var I})).join(" | "),C=[];for(let z=1;z<t.length;z++){const I=n.parse(t[z],1+C.length);if(!I)return null;C.push(mi(I.type))}n.error(`Expected arguments of type ${S}, but found (${C.join(", ")}) instead.`)}return null}static register(t,n){Gr.definitions=n;for(const o in n)t[o]=Gr}}function kc(r,[t,n,o,u]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=u?u.evaluate(r):1,_=Ci(t,n,o,m);if(_)throw new di(_);return new qt(t/255,n/255,o/255,m,!1)}function ra(r,t){return r in t}function Lc(r,t){const n=t[r];return n===void 0?null:n}function Nn(r){return{type:r}}function vr(r){if(r instanceof Ls)return vr(r.boundExpression);if(r instanceof Gr&&r.name==="error"||r instanceof Pc||r instanceof Bs||r instanceof yo||r instanceof ec)return!1;const t=r instanceof Zr||r instanceof Fi;let n=!0;return r.eachChild((o=>{n=t?n&&vr(o):n&&o instanceof na})),!!n&&ls(r)&&bo(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ls(r){if(r instanceof Gr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Bs||r instanceof yo)return!1;let t=!0;return r.eachChild((n=>{t&&!ls(n)&&(t=!1)})),t}function xo(r){if(r instanceof Gr&&r.name==="feature-state")return!1;let t=!0;return r.eachChild((n=>{t&&!xo(n)&&(t=!1)})),t}function bo(r,t){if(r instanceof Gr&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild((o=>{n&&!bo(o,t)&&(n=!1)})),n}function tc(r){return{result:"success",value:r}}function js(r){return{result:"error",value:r}}function qr(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Iu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function ol(r){return!!r.expression&&r.expression.interpolated}function Vt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function ic(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&wt(r)===qi}function Hr(r){return r}function Bc(r,t){const n=r.stops&&typeof r.stops[0][0]=="object",o=n||!(n||r.property!==void 0),u=r.type||(ol(t)?"exponential":"interval"),m=(function(C){switch(C.type){case"color":return qt.parse;case"padding":return Rn.parse;case"numberArray":return Wn.parse;case"colorArray":return gn.parse;default:return null}})(t);if(m&&((r=ar({},r)).stops&&(r.stops=r.stops.map((C=>[C[0],m(C[1])]))),r.default=m(r.default?r.default:t.default)),r.colorSpace&&(_=r.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var _;const v=(function(C){switch(C){case"exponential":return Us;case"interval":return Oc;case"categorical":return ku;case"identity":return Lu;default:throw new Error(`Unknown function type "${C}"`)}})(u);let b,S;if(u==="categorical"){b=Object.create(null);for(const C of r.stops)b[C[0]]=C[1];S=typeof r.stops[0][0]}if(n){const C={},z=[];for(let O=0;O<r.stops.length;O++){const N=r.stops[O],q=N[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:r.type,property:r.property,default:r.default,stops:[]},z.push(q)),C[q].stops.push([N[0].value,N[1]])}const I=[];for(const O of z)I.push([C[O].zoom,Bc(C[O],t)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:er.interpolationFactor.bind(void 0,B),zoomStops:I.map((O=>O[0])),evaluate:({zoom:O},N)=>Us({stops:I,base:r.base},t,O).evaluate(O,N)}}if(o){const C=u==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:er.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map((z=>z[0])),evaluate:({zoom:z})=>v(r,t,z,b,S)}}return{kind:"source",evaluate(C,z){const I=z&&z.properties?z.properties[r.property]:void 0;return I===void 0?lr(r.default,t.default):v(r,t,I,b,S)}}}function lr(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function ku(r,t,n,o,u){return lr(typeof n===u?o[n]:void 0,r.default,t.default)}function Oc(r,t,n){if(Vt(n)!=="number")return lr(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const u=uo(r.stops.map((m=>m[0])),n);return r.stops[u][1]}function Us(r,t,n){const o=r.base!==void 0?r.base:1;if(Vt(n)!=="number")return lr(r.default,t.default);const u=r.stops.length;if(u===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[u-1][0])return r.stops[u-1][1];const m=uo(r.stops.map((C=>C[0])),n),_=(function(C,z,I,B){const O=B-I,N=C-I;return O===0?0:z===1?N/O:(Math.pow(z,N)-1)/(Math.pow(z,O)-1)})(n,o,r.stops[m][0],r.stops[m+1][0]),v=r.stops[m][1],b=r.stops[m+1][1],S=Va[t.type]||Hr;return typeof v.evaluate=="function"?{evaluate(...C){const z=v.evaluate.apply(void 0,C),I=b.evaluate.apply(void 0,C);if(z!==void 0&&I!==void 0)return S(z,I,_,r.colorSpace)}}:S(v,b,_,r.colorSpace)}function Lu(r,t,n){switch(t.type){case"color":n=qt.parse(n);break;case"formatted":n=Cn.fromString(n.toString());break;case"resolvedImage":n=Jn.fromString(n.toString());break;case"padding":n=Rn.parse(n);break;case"colorArray":n=gn.parse(n);break;case"numberArray":n=Wn.parse(n);break;default:Vt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return lr(n,r.default,t.default)}Gr.register(vo,{error:[{kind:"error"},[jt],(r,[t])=>{throw new di(t.evaluate(r))}],typeof:[jt,[Ut],(r,[t])=>mi(wt(t.evaluate(r)))],"to-rgba":[Yn(nt,4),[mn],(r,[t])=>{const[n,o,u,m]=t.evaluate(r).rgb;return[255*n,255*o,255*u,m]}],rgb:[mn,[nt,nt,nt],kc],rgba:[mn,[nt,nt,nt,nt],kc],has:{type:kt,overloads:[[[jt],(r,[t])=>ra(t.evaluate(r),r.properties())],[[jt,qi],(r,[t,n])=>ra(t.evaluate(r),n.evaluate(r))]]},get:{type:Ut,overloads:[[[jt],(r,[t])=>Lc(t.evaluate(r),r.properties())],[[jt,qi],(r,[t,n])=>Lc(t.evaluate(r),n.evaluate(r))]]},"feature-state":[Ut,[jt],(r,[t])=>Lc(t.evaluate(r),r.featureState||{})],properties:[qi,[],r=>r.properties()],"geometry-type":[jt,[],r=>r.geometryType()],id:[Ut,[],r=>r.id()],zoom:[nt,[],r=>r.globals.zoom],"heatmap-density":[nt,[],r=>r.globals.heatmapDensity||0],elevation:[nt,[],r=>r.globals.elevation||0],"line-progress":[nt,[],r=>r.globals.lineProgress||0],accumulated:[Ut,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[nt,Nn(nt),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[nt,Nn(nt),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:nt,overloads:[[[nt,nt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[nt],(r,[t])=>-t.evaluate(r)]]},"/":[nt,[nt,nt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[nt,[nt,nt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[nt,[nt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[nt,[nt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[nt,[nt],(r,[t])=>Math.log(t.evaluate(r))],log2:[nt,[nt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[nt,[nt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[nt,[nt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[nt,[nt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[nt,[nt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[nt,[nt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[nt,[nt],(r,[t])=>Math.atan(t.evaluate(r))],min:[nt,Nn(nt),(r,t)=>Math.min(...t.map((n=>n.evaluate(r))))],max:[nt,Nn(nt),(r,t)=>Math.max(...t.map((n=>n.evaluate(r))))],abs:[nt,[nt],(r,[t])=>Math.abs(t.evaluate(r))],round:[nt,[nt],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[nt,[nt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[nt,[nt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[kt,[jt,Ut],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[kt,[Ut],(r,[t])=>r.id()===t.value],"filter-type-==":[kt,[jt],(r,[t])=>r.geometryType()===t.value],"filter-<":[kt,[jt,Ut],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[kt,[Ut],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[kt,[jt,Ut],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[kt,[Ut],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[kt,[jt,Ut],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[kt,[Ut],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[kt,[jt,Ut],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[kt,[Ut],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[kt,[Ut],(r,[t])=>t.value in r.properties()],"filter-has-id":[kt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[kt,[Yn(jt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[kt,[Yn(Ut)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[kt,[jt,Yn(Ut)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[kt,[jt,Yn(Ut)],(r,[t,n])=>(function(o,u,m,_){for(;m<=_;){const v=m+_>>1;if(u[v]===o)return!0;u[v]>o?_=v-1:m=v+1}return!1})(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[Nn(kt),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[Nn(kt),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[kt,[kt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[kt,[jt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[jt,[jt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[jt,[jt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[jt,Nn(Ut),(r,t)=>t.map((n=>Dt(n.evaluate(r)))).join("")],"resolved-locale":[jt,[Ll],(r,[t])=>t.evaluate(r).resolvedLocale()]});class nc{constructor(t,n,o){this.expression=t,this._warningHistory={},this._evaluator=new bu,this._defaultValue=n?(function(u){if(u.type==="color"&&ic(u.default))return new qt(0,0,0,0);switch(u.type){case"color":return qt.parse(u.default)||null;case"padding":return Rn.parse(u.default)||null;case"numberArray":return Wn.parse(u.default)||null;case"colorArray":return gn.parse(u.default)||null;case"variableAnchorOffsetCollection":return Qn.parse(u.default)||null;case"projectionDefinition":return rn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,m,_){return this._globalState&&(t=xr(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,m,_){this._globalState&&(t=xr(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new di(`Expected value to be one of ${Object.keys(this._enumValues).map((b=>JSON.stringify(b))).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function cs(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in vo}function Ga(r,t,n){const o=new ks(vo,vr,[],t?(function(m){const _={color:mn,string:jt,number:nt,enum:jt,boolean:kt,formatted:Dr,padding:ns,numberArray:io,colorArray:La,projectionDefinition:ia,resolvedImage:nn,variableAnchorOffsetCollection:Ec};return m.type==="array"?Yn(_[m.value]||Ut,m.length):_[m.type]})(t):void 0),u=o.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?tc(new nc(u,t,n)):js(o.errors)}class Ns{constructor(t,n,o){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!xo(n.expression),this.globalStateRefs=Xr(n.expression),this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,m,_){return this._globalState&&(t=xr(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,m,_)}evaluate(t,n,o,u,m,_){return this._globalState&&(t=xr(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,m,_)}}class ll{constructor(t,n,o,u,m){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!xo(n.expression),this.globalStateRefs=Xr(n.expression),this.interpolationType=u,this._globalState=m}evaluateWithoutErrorHandling(t,n,o,u,m,_){return this._globalState&&(t=xr(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,m,_)}evaluate(t,n,o,u,m,_){return this._globalState&&(t=xr(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,m,_)}interpolationFactor(t,n,o){return this.interpolationType?er.interpolationFactor(this.interpolationType,t,n,o):0}}function $r(r,t,n){const o=Ga(r,t,n);if(o.result==="error")return o;const u=o.value.expression,m=ls(u);if(!m&&!qr(t))return js([new tn("","data expressions not supported")]);const _=bo(u,["zoom"]);if(!_&&!Iu(t))return js([new tn("","zoom expressions not supported")]);const v=ma(u);return v||_?v instanceof tn?js([v]):v instanceof er&&!ol(t)?js([new tn("",'"interpolate" expressions cannot be used with this property')]):tc(v?new ll(m?"camera":"composite",o.value,v.labels,v instanceof er?v.interpolation:void 0,n):new Ns(m?"constant":"source",o.value,n)):js([new tn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cr{constructor(t,n){this._parameters=t,this._specification=n,ar(this,Bc(this._parameters,this._specification))}static deserialize(t){return new cr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ma(r){let t=null;if(r instanceof oo)t=ma(r.result);else if(r instanceof ho){for(const n of r.args)if(t=ma(n),t)break}else(r instanceof ln||r instanceof er)&&r.input instanceof Gr&&r.input.name==="zoom"&&(t=r);return t instanceof tn||r.eachChild((n=>{const o=ma(n);o instanceof tn?t=o:!t&&o?t=new tn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new tn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Xr(r,t=new Set){return r instanceof ec&&t.add(r.key),r.eachChild((n=>{Xr(n,t)})),t}function xr(r,t){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:m,isSupportedScript:_,accumulated:v}=r??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:m,isSupportedScript:_,accumulated:v,globalState:t}}function ga(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!ga(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Fc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function us(r,t){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ga(r)||(r=Hi(r));const n=Ga(r,Fc,t);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,m)=>n.value.evaluate(o,u,{},m),needGeometry:Dn(r),getGlobalStateRefs:()=>Xr(n.value.expression)}}function rc(r,t){return r<t?-1:r>t?1:0}function Dn(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Dn(r[t]))return!0;return!1}function Hi(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?hi(r[1],r[2],"=="):t==="!="?cl(hi(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?hi(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(Hi))):t==="all"?["all"].concat(r.slice(1).map(Hi)):t==="none"?["all"].concat(r.slice(1).map(Hi).map(cl)):t==="in"?Vs(r[1],r.slice(2)):t==="!in"?cl(Vs(r[1],r.slice(2))):t==="has"?_a(r[1]):t!=="!has"||cl(_a(r[1]));var n}function hi(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Vs(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",r,["literal",t.sort(rc)]]:["filter-in-small",r,["literal",t]]}}function _a(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function cl(r){return["!",r]}function hs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let u="[";for(const m of r)u+=`${hs(m)},`;return`${u}]`}const n=Object.keys(r).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${hs(r[n[u]])},`;return`${o}}`}function Bu(r){let t="";for(const n of Pt)t+=`/${hs(r[n])}`;return t}function jc(r){const t=r.value;return t?[new He(r.key,t,"constants have been deprecated as of v8")]:[]}function wi(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ya(r){if(Array.isArray(r))return r.map(ya);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=ya(r[n]);return t}return wi(r)}function kr(r){const t=r.key,n=r.value,o=r.valueSpec||{},u=r.objectElementValidators||{},m=r.style,_=r.styleSpec,v=r.validateSpec;let b=[];const S=Vt(n);if(S!=="object")return[new He(t,n,`object expected, ${S} found`)];for(const C in n){const z=C.split(".")[0],I=ao(o,z)||o["*"];let B;if(ao(u,z))B=u[z];else if(ao(o,z))B=v;else if(u["*"])B=u["*"];else{if(!o["*"]){b.push(new He(t,n[C],`unknown property "${C}"`));continue}B=v}b=b.concat(B({key:(t&&`${t}.`)+C,value:n[C],valueSpec:I,style:m,styleSpec:_,object:n,objectKey:C,validateSpec:v},n))}for(const C in o)u[C]||o[C].required&&o[C].default===void 0&&n[C]===void 0&&b.push(new He(t,n,`missing required property "${C}"`));return b}function Zs(r){const t=r.value,n=r.valueSpec,o=r.style,u=r.styleSpec,m=r.key,_=r.arrayElementValidator||r.validateSpec;if(Vt(t)!=="array")return[new He(m,t,`array expected, ${Vt(t)} found`)];if(n.length&&t.length!==n.length)return[new He(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new He(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};u.$version<7&&(v.function=n.function),Vt(n.value)==="object"&&(v=n.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(_({array:t,arrayIndex:S,value:t[S],valueSpec:v,validateSpec:r.validateSpec,style:o,styleSpec:u,key:`${m}[${S}]`}));return b}function ul(r){const t=r.key,n=r.value,o=r.valueSpec;let u=Vt(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new He(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new He(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new He(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ds(r){const t=r.valueSpec,n=wi(r.value.type);let o,u,m,_={};const v=n!=="categorical"&&r.value.property===void 0,b=!v,S=Vt(r.value.stops)==="array"&&Vt(r.value.stops[0])==="array"&&Vt(r.value.stops[0][0])==="object",C=kr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new He(B.key,B.value,'identity function may not have a "stops" property')];let O=[];const N=B.value;return O=O.concat(Zs({key:B.key,value:N,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:z})),Vt(N)==="array"&&N.length===0&&O.push(new He(B.key,N,"array must have at least one stop")),O},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&v&&C.push(new He(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||C.push(new He(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!ol(r.valueSpec)&&C.push(new He(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!qr(r.valueSpec)?C.push(new He(r.key,r.value,"property functions not supported")):v&&!Iu(r.valueSpec)&&C.push(new He(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!S||r.value.property!==void 0||C.push(new He(r.key,r.value,'"property" property is required')),C;function z(B){let O=[];const N=B.value,q=B.key;if(Vt(N)!=="array")return[new He(q,N,`array expected, ${Vt(N)} found`)];if(N.length!==2)return[new He(q,N,`array length 2 expected, length ${N.length} found`)];if(S){if(Vt(N[0])!=="object")return[new He(q,N,`object expected, ${Vt(N[0])} found`)];if(N[0].zoom===void 0)return[new He(q,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new He(q,N,"object stop key must have value")];if(m&&m>wi(N[0].zoom))return[new He(q,N[0].zoom,"stop zoom values must appear in ascending order")];wi(N[0].zoom)!==m&&(m=wi(N[0].zoom),u=void 0,_={}),O=O.concat(kr({key:`${q}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:ul,value:I}}))}else O=O.concat(I({key:`${q}[0]`,value:N[0],validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},N));return cs(ya(N[1]))?O.concat([new He(`${q}[1]`,N[1],"expressions are not allowed in function stops.")]):O.concat(B.validateSpec({key:`${q}[1]`,value:N[1],valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function I(B,O){const N=Vt(B.value),q=wi(B.value),K=B.value!==null?B.value:O;if(o){if(N!==o)return[new He(B.key,K,`${N} stop domain type must match previous stop domain type ${o}`)]}else o=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new He(B.key,K,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&n!=="categorical"){let pe=`number expected, ${N} found`;return qr(t)&&n===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(B.key,K,pe)]}return n!=="categorical"||N!=="number"||isFinite(q)&&Math.floor(q)===q?n!=="categorical"&&N==="number"&&u!==void 0&&q<u?[new He(B.key,K,"stop domain values must appear in ascending order")]:(u=q,n==="categorical"&&q in _?[new He(B.key,K,"stop domain values must be unique")]:(_[q]=!0,[])):[new He(B.key,K,`integer expected, found ${q}`)]}}function br(r){const t=(r.expressionContext==="property"?$r:Ga)(ya(r.value),r.valueSpec);if(t.result==="error")return t.value.map((o=>new He(`${r.key}${o.key}`,r.value,o.message)));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new He(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!xo(n))return[new He(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!xo(n))return[new He(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!bo(n,["zoom","feature-state"]))return[new He(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!ls(n))return[new He(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Lr(r){const t=r.key,n=r.value,o=Vt(n);return o!=="string"?[new He(t,n,`color expected, ${o} found`)]:qt.parse(String(n))?[]:[new He(t,n,`color expected, "${n}" found`)]}function Yr(r){const t=r.key,n=r.value,o=r.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(wi(n))===-1&&u.push(new He(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(wi(n))===-1&&u.push(new He(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function ac(r){return ga(ya(r.value))?br(ar({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Uc(r)}function Uc(r){const t=r.value,n=r.key;if(Vt(t)!=="array")return[new He(n,t,`array expected, ${Vt(t)} found`)];const o=r.styleSpec;let u,m=[];if(t.length<1)return[new He(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Yr({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),wi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&wi(t[1])==="$type"&&m.push(new He(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new He(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Vt(t[1]),u!=="string"&&m.push(new He(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let _=2;_<t.length;_++)u=Vt(t[_]),wi(t[1])==="$type"?m=m.concat(Yr({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&m.push(new He(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)m=m.concat(Uc({key:`${n}[${_}]`,value:t[_],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=Vt(t[1]),t.length!==2?m.push(new He(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&m.push(new He(`${n}[1]`,t[1],`string expected, ${u} found`))}return m}function hl(r,t){const n=r.key,o=r.validateSpec,u=r.style,m=r.styleSpec,_=r.value,v=r.objectKey,b=m[`${t}_${r.layerType}`];if(!b)return[];const S=v.match(/^(.*)-transition$/);if(t==="paint"&&S&&b[S[1]]&&b[S[1]].transition)return o({key:n,value:_,valueSpec:m.transition,style:u,styleSpec:m});const C=r.valueSpec||b[v];if(!C)return[new He(n,_,`unknown property "${v}"`)];let z;if(Vt(_)==="string"&&qr(C)&&!C.tokens&&(z=/^{([^}]+)}$/.exec(_)))return[new He(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const I=[];return r.layerType==="symbol"&&(v==="text-field"&&u&&!u.glyphs&&I.push(new He(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&ic(ya(_))&&wi(_.type)==="identity"&&I.push(new He(n,_,'"text-font" does not support identity functions'))),I.concat(o({key:r.key,value:_,valueSpec:C,style:u,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:v}))}function sc(r){return hl(r,"paint")}function Gs(r){return hl(r,"layout")}function _n(r){let t=[];const n=r.value,o=r.key,u=r.style,m=r.styleSpec;if(Vt(n)!=="object")return[new He(o,n,`object expected, ${Vt(n)} found`)];n.type||n.ref||t.push(new He(o,n,'either "type" or "ref" is required'));let _=wi(n.type);const v=wi(n.ref);if(n.id){const b=wi(n.id);for(let S=0;S<r.arrayIndex;S++){const C=u.layers[S];wi(C.id)===b&&t.push(new He(o,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach((S=>{S in n&&t.push(new He(o,n[S],`"${S}" is prohibited for ref layers`))})),u.layers.forEach((S=>{wi(S.id)===v&&(b=S)})),b?b.ref?t.push(new He(o,n.ref,"ref cannot reference another ref layer")):_=wi(b.type):t.push(new He(o,n.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(n.source){const b=u.sources&&u.sources[n.source],S=b&&wi(b.type);b?S==="vector"&&_==="raster"?t.push(new He(o,n.source,`layer "${n.id}" requires a raster source`)):S!=="raster-dem"&&_==="hillshade"||S!=="raster-dem"&&_==="color-relief"?t.push(new He(o,n.source,`layer "${n.id}" requires a raster-dem source`)):S==="raster"&&_!=="raster"?t.push(new He(o,n.source,`layer "${n.id}" requires a vector source`)):S!=="vector"||n["source-layer"]?S==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new He(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||t.push(new He(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new He(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new He(o,n.source,`source "${n.source}" not found`))}else t.push(new He(o,n,'missing required property "source"'));return t=t.concat(kr({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:ac,layout:b=>kr({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>Gs(ar({layerType:_},S))}}),paint:b=>kr({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>sc(ar({layerType:_},S))}})}})),t}function Br(r){const t=r.value,n=r.key,o=Vt(t);return o!=="string"?[new He(n,t,`string expected, ${o} found`)]:[]}const wr={promoteId:function({key:r,value:t}){if(Vt(t)==="string")return Br({key:r,value:t});{const n=[];for(const o in t)n.push(...Br({key:`${r}.${o}`,value:t[o]}));return n}}};function dl(r){const t=r.value,n=r.key,o=r.styleSpec,u=r.style,m=r.validateSpec;if(!t.type)return[new He(n,t,'"type" is required')];const _=wi(t.type);let v;switch(_){case"vector":case"raster":return v=kr({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:wr,validateSpec:m}),v;case"raster-dem":return v=(function(b){var S;const C=(S=b.sourceName)!==null&&S!==void 0?S:"",z=b.value,I=b.styleSpec,B=I.source_raster_dem,O=b.style;let N=[];const q=Vt(z);if(z===void 0)return N;if(q!=="object")return N.push(new He("source_raster_dem",z,`object expected, ${q} found`)),N;const K=wi(z.encoding)==="custom",pe=["redFactor","greenFactor","blueFactor","baseShift"],te=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const oe in z)!K&&pe.includes(oe)?N.push(new He(oe,z[oe],`In "${C}": "${oe}" is only valid when "encoding" is set to "custom". ${te} encoding found`)):B[oe]?N=N.concat(b.validateSpec({key:oe,value:z[oe],valueSpec:B[oe],validateSpec:b.validateSpec,style:O,styleSpec:I})):N.push(new He(oe,z[oe],`unknown property "${oe}"`));return N})({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:m}),v;case"geojson":if(v=kr({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:m,objectElementValidators:wr}),t.cluster)for(const b in t.clusterProperties){const[S,C]=t.clusterProperties[b],z=typeof S=="string"?[S,["accumulated"],["get",b]]:S;v.push(...br({key:`${n}.${b}.map`,value:C,expressionContext:"cluster-map"})),v.push(...br({key:`${n}.${b}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return v;case"video":return kr({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:m,styleSpec:o});case"image":return kr({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:m,styleSpec:o});case"canvas":return[new He(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yr({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ou(r){const t=r.value,n=r.styleSpec,o=n.light,u=r.style;let m=[];const _=Vt(t);if(t===void 0)return m;if(_!=="object")return m=m.concat([new He("light",t,`object expected, ${_} found`)]),m;for(const v in t){const b=v.match(/^(.*)-transition$/);m=m.concat(b&&o[b[1]]&&o[b[1]].transition?r.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:r.validateSpec,style:u,styleSpec:n}):o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:r.validateSpec,style:u,styleSpec:n}):[new He(v,t[v],`unknown property "${v}"`)])}return m}function jh(r){const t=r.value,n=r.styleSpec,o=n.sky,u=r.style,m=Vt(t);if(t===void 0)return[];if(m!=="object")return[new He("sky",t,`object expected, ${m} found`)];let _=[];for(const v in t)_=_.concat(o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new He(v,t[v],`unknown property "${v}"`)]);return _}function An(r){const t=r.value,n=r.styleSpec,o=n.terrain,u=r.style;let m=[];const _=Vt(t);if(t===void 0)return m;if(_!=="object")return m=m.concat([new He("terrain",t,`object expected, ${_} found`)]),m;for(const v in t)m=m.concat(o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:r.validateSpec,style:u,styleSpec:n}):[new He(v,t[v],`unknown property "${v}"`)]);return m}function qs(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const u=[],m=[];for(const _ in n)n[_].id&&u.includes(n[_].id)&&t.push(new He(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),u.push(n[_].id),n[_].url&&m.includes(n[_].url)&&t.push(new He(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),m.push(n[_].url),t=t.concat(kr({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Br({key:o,value:n})}function wo(r){return t=r.value,t&&t.constructor===Object?[]:[new He(r.key,r.value,`object expected, ${Vt(r.value)} found`)];var t}const Hs={"*":()=>[],array:Zs,boolean:function(r){const t=r.value,n=r.key,o=Vt(t);return o!=="boolean"?[new He(n,t,`boolean expected, ${o} found`)]:[]},number:ul,color:Lr,constants:jc,enum:Yr,filter:ac,function:ds,layer:_n,object:kr,source:dl,light:Ou,sky:jh,terrain:An,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,u=r.style,m=Vt(t);if(t===void 0)return[];if(m!=="object")return[new He("projection",t,`object expected, ${m} found`)];let _=[];for(const v in t)_=_.concat(o[v]?r.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new He(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(r){const t=r.key;let n=r.value;n=n instanceof String?n.valueOf():n;const o=Vt(n);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(o)?[]:[new He(t,n,`projection expected, invalid type "${o}" found`)]:[new He(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Br,formatted:function(r){return Br(r).length===0?[]:br(r)},resolvedImage:function(r){return Br(r).length===0?[]:br(r)},padding:function(r){const t=r.key,n=r.value;if(Vt(n)==="array"){if(n.length<1||n.length>4)return[new He(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let m=0;m<n.length;m++)u=u.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return u}return ul({key:t,value:n,valueSpec:{}})},numberArray:function(r){const t=r.key,n=r.value;if(Vt(n)==="array"){const o={type:"number"};if(n.length<1)return[new He(t,n,"array length at least 1 expected, length 0 found")];let u=[];for(let m=0;m<n.length;m++)u=u.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return u}return ul({key:t,value:n,valueSpec:{}})},colorArray:function(r){const t=r.key,n=r.value;if(Vt(n)==="array"){if(n.length<1)return[new He(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(Lr({key:`${t}[${u}]`,value:n[u]}));return o}return Lr({key:t,value:n})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=Vt(n),u=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new He(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let _=0;_<n.length;_+=2)m=m.concat(Yr({key:`${t}[${_}]`,value:n[_],valueSpec:u.layout_symbol["text-anchor"]})),m=m.concat(Zs({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:u}));return m},sprite:qs,state:wo};function fl(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=fl,n.expression&&ic(wi(t))?ds(r):n.expression&&cs(ya(t))?br(r):n.type&&Hs[n.type]?Hs[n.type](r):kr(ar({},r,{valueSpec:n.type?o[n.type]:n}))}function fs(r){const t=r.value,n=r.key,o=Br(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new He(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new He(n,t,'"glyphs" url must include a "{range}" token'))),o}function tr(r,t=ge){let n=[];return n=n.concat(fl({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:fl,objectElementValidators:{glyphs:fs,"*":()=>[]}})),r.constants&&(n=n.concat(jc({key:"constants",value:r.constants}))),Fu(n)}function Tr(r){return function(t){return r({...t,validateSpec:fl})}}function Fu(r){return[].concat(r).sort(((t,n)=>t.line-n.line))}function va(r){return function(...t){return Fu(r.apply(this,t))}}tr.source=va(Tr(dl)),tr.sprite=va(Tr(qs)),tr.glyphs=va(Tr(fs)),tr.light=va(Tr(Ou)),tr.sky=va(Tr(jh)),tr.terrain=va(Tr(An)),tr.state=va(Tr(wo)),tr.layer=va(Tr(_n)),tr.filter=va(Tr(ac)),tr.paintProperty=va(Tr(sc)),tr.layoutProperty=va(Tr(Gs));const To=tr,xa=To.light,ju=To.sky,Nc=To.paintProperty,oc=To.layoutProperty;function pl(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new Oe(new Error(o.message))),n=!0;return n}class $s{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let b=0;b<this.d*this.d;b++){const S=_[3+b],C=_[3+b+1];u.push(S===C?null:_.subarray(S,C))}const v=_[3+u.length+1];this.keys=_.subarray(_[3+u.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const m=o/n*t;this.min=-m,this.max=t+m}insert(t,n,o,u,m){this._forEachCell(n,o,u,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,m,_){this.cells[m].push(_)}query(t,n,o,u,m){const _=this.min,v=this.max;if(t<=_&&n<=_&&v<=o&&v<=u&&!m)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,n,o,u,this._queryCell,b,{},m),b}}_queryCell(t,n,o,u,m,_,v,b){const S=this.cells[m];if(S!==null){const C=this.keys,z=this.bboxes;for(let I=0;I<S.length;I++){const B=S[I];if(v[B]===void 0){const O=4*B;(b?b(z[O+0],z[O+1],z[O+2],z[O+3]):t<=z[O+2]&&n<=z[O+3]&&o>=z[O+0]&&u>=z[O+1])?(v[B]=!0,_.push(C[B])):v[B]=!1}}}}_forEachCell(t,n,o,u,m,_,v,b){const S=this._convertToCellCoord(t),C=this._convertToCellCoord(n),z=this._convertToCellCoord(o),I=this._convertToCellCoord(u);for(let B=S;B<=z;B++)for(let O=C;O<=I;O++){const N=this.d*O+B;if((!b||b(this._convertFromCellCoord(B),this._convertFromCellCoord(O),this._convertFromCellCoord(B+1),this._convertFromCellCoord(O+1)))&&m.call(this,t,n,o,u,N,_,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let m=n;for(let _=0;_<t.length;_++){const v=t[_];u[3+_]=m,u.set(v,m),m+=v.length}return u[3+t.length]=m,u.set(this.keys,m),m+=this.keys.length,u[3+t.length+1]=m,u.set(this.bboxes,m),m+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new $s(t.buffer)}}const Sr={};function st(r,t,n={}){if(Sr[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Sr[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}st("Object",Object),st("Set",Set),st("TransferableGridIndex",$s),st("Color",qt),st("Error",Error),st("AJAXError",ie),st("ResolvedImage",Jn),st("StylePropertyFunction",cr),st("StyleExpression",nc,{omit:["_evaluator"]}),st("ZoomDependentExpression",ll),st("ZoomConstantExpression",Ns),st("CompoundExpression",Gr,{omit:["_evaluate"]});for(const r in vo)vo[r]._classRegistryKey||st(`Expression_${r}`,vo[r]);function Vc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function So(r){return r.$name||r.constructor._classRegistryKey}function Zc(r){return!(function(t){if(t===null||typeof t!="object")return!1;const n=So(t);return!(!n||n==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Vc(r)||Ia(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function ba(r,t){if(Zc(r))return(Vc(r)||Ia(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const _ of r)m.push(ba(_,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=So(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Sr[n])throw new Error(`${n} is not registered.`);const{klass:o}=Sr[n],u=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Sr[n].omit.indexOf(m)>=0)continue;const _=r[m];u[m]=Sr[n].shallow.indexOf(m)>=0?_:ba(_,t)}r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function Mo(r){if(Zc(r))return r;if(Array.isArray(r))return r.map(Mo);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=So(r)||"Object";if(!Sr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Sr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const u of Object.keys(r)){if(u==="$name")continue;const m=r[u];o[u]=Sr[t].shallow.indexOf(u)>=0?m:Mo(m)}return o}class Gc{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Ot={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Hangul Syllables":r=>r>=44032&&r<=55215,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function lc(r){for(const t of r)if(cc(t.charCodeAt(0)))return!0;return!1}function qc(r){for(const t of r)if(!ml(t.charCodeAt(0)))return!1;return!0}function qa(r){const t=r.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const ps=qa(["Arab","Dupl","Mong","Ougr","Syrc"]);function ml(r){return!ps.test(String.fromCodePoint(r))}const Hc=qa(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function cc(r){return!(r!==746&&r!==747&&(r<4352||!(Ot["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ot["CJK Compatibility"](r)||Ot["CJK Strokes"](r)||!(!Ot["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ot["Enclosed CJK Letters and Months"](r)||Ot["Ideographic Description Characters"](r)||Ot.Kanbun(r)||Ot.Katakana(r)&&r!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ot["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ot["Vertical Forms"](r)||Ot["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||Hc.test(String.fromCodePoint(r)))))}function Eo(r){return!(cc(r)||(function(t){return!!(Ot["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ot["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ot["Letterlike Symbols"](t)||Ot["Number Forms"](t)||Ot["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ot["Control Pictures"](t)&&t!==9251||Ot["Optical Character Recognition"](t)||Ot["Enclosed Alphanumerics"](t)||Ot["Geometric Shapes"](t)||Ot["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ot["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ot["CJK Symbols and Punctuation"](t)||Ot.Katakana(t)||Ot["Private Use Area"](t)||Ot["CJK Compatibility Forms"](t)||Ot["Small Form Variants"](t)||Ot["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(r))}const gl=qa(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function $c(r){return gl.test(String.fromCodePoint(r))}function Uu(r,t){return!(!t&&$c(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ot.Khmer(r))}function ms(r){for(const t of r)if($c(t.charCodeAt(0)))return!0;return!1}const wa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(wa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return d(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const n=r.pluginURL,o=new Promise((m=>{this.loadScriptResolve=m}));t(n);const u=new Promise((m=>setTimeout((()=>m()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const m={pluginStatus:"loaded",pluginURL:n};return this.setState(m),m}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class gi{constructor(t,n){this.isSupportedScript=Nu,this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new Gc,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function Nu(r){return(function(t,n){for(const o of t)if(!Uu(o.charCodeAt(0),n))return!1;return!0})(r,wa.getRTLTextPluginStatus()==="loaded")}class _l{constructor(t,n,o){this.property=t,this.value=n,this.expression=(function(u,m,_){if(ic(u))return new cr(u,m);if(cs(u)){const v=$r(u,m,_);if(v.result==="error")throw new Error(v.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return v.value}{let v=u;return m.type==="color"&&typeof u=="string"?v=qt.parse(u):m.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?m.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?m.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?v=Qn.parse(u):m.type==="projectionDefinition"&&typeof u=="string"&&(v=rn.parse(u)):v=gn.parse(u):v=Wn.parse(u):v=Rn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}})(n===void 0?t.specification.default:n,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Ta{constructor(t,n){this.property=t,this.value=new _l(t,void 0,n)}transitioned(t,n){return new _i(this.property,this.value,n,si({},t.transition,this.transition),t.now)}untransitioned(){return new _i(this.property,this.value,null,{},0)}}class Yt{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=n}getValue(t){return gr(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ta(this._values[t].property,this._globalState)),this._values[t].value=new _l(this._values[t].property,n===null?void 0:gr(n),this._globalState)}getTransition(t){return gr(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ta(this._values[t].property,this._globalState)),this._values[t].transition=gr(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new yn(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new yn(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class _i{constructor(t,n,o,u,m){this.property=t,this.value=n,this.begin=m+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,m=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return _.possiblyEvaluate(t,n,o);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),m,at(v))}}return m}}class yn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new Ha(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Xc{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=n}hasValue(t){return this._values[t].value!==void 0}getValue(t){return gr(this._values[t].value)}setValue(t,n){this._values[t]=new _l(this._values[t].property,n===null?void 0:gr(n),this._globalState)}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new Ha(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(t,n,o);return u}}class Mr{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class Ha{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ut{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=Va[this.specification.type];return u?u(t,n,o):t}}class gt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new Mr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Mr(this,{kind:"constant",value:void 0},t.parameters);const u=Va[this.specification.type];if(u){const m=u(t.value.value,n.value.value,o);return new Mr(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,o,u,m,_){return t.kind==="constant"?t.value:t.evaluate(n,o,u,m,_)}}class gs extends gt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new Mr(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,u),_=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,v=this._calculate(_,_,_,n);return new Mr(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Mr(this,{kind:"constant",value:m},n)}return new Mr(this,t.expression,n)}evaluate(t,n,o,u,m,_){if(t.kind==="source"){const v=t.evaluate(n,o,u,m,_);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Vu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,u);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new gi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new gi(Math.floor(n.zoom),n)),t.expression.evaluate(new gi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Ki{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class Vn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new _l(o,void 0,void 0),m=this.defaultTransitionablePropertyValues[n]=new Ta(o,void 0);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}st("DataDrivenProperty",gt),st("DataConstantProperty",ut),st("CrossFadedDataDrivenProperty",gs),st("CrossFadedProperty",Vu),st("ColorRampProperty",Ki);const Yc="-transition";class aa extends ct{constructor(t,n,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=us(t.filter,o)),n.layout&&(this._unevaluatedLayout=new Xc(n.layout,o)),n.paint)){this._transitionablePaint=new Yt(n.paint,o);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ha(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=us(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())t.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}getPaintAffectingGlobalStateRefs(){var t;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const m of u.getGlobalStateRefs()){const _=(t=n.get(m))!==null&&t!==void 0?t:[];_.push({name:o,value:u.value}),n.set(m,_)}}return n}setLayoutProperty(t,n,o={}){n!=null&&this._validate(oc,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Yc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Nc,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(Yc))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],m=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),es(t,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(t,n,o,u,m={}){return(!m||m.validate!==!1)&&pl(this,t.call(To,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Mr&&qr(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Xs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yl{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wi(r,t=1){let n=0,o=0;return{members:r.map((u=>{const m=Xs[u.type].BYTES_PER_ELEMENT,_=n=vl(n,Math.max(t,m)),v=u.components||1;return o=Math.max(o,m),n+=m*v,{name:u.name,type:u.type,components:v,offset:_}})),size:vl(n,Math.max(o,t)),alignment:t}}function vl(r,t){return Math.ceil(r/t)*t}class Zn extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}Zn.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Zn);class ji extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,t}}ji.prototype.bytesPerElement=6,st("StructArrayLayout3i6",ji);class _s extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u)}emplace(t,n,o,u,m){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=m,t}}_s.prototype.bytesPerElement=8,st("StructArrayLayout4i8",_s);class Co extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,m,_)}emplace(t,n,o,u,m,_,v){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=m,this.int16[b+4]=_,this.int16[b+5]=v,t}}Co.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",Co);class Ao extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,m,_)}emplace(t,n,o,u,m,_,v){const b=4*t,S=8*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[S+4]=u,this.uint8[S+5]=m,this.uint8[S+6]=_,this.uint8[S+7]=v,t}}Ao.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",Ao);class Sa extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}Sa.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Sa);class Ma extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_,v,b,S,C){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,o,u,m,_,v,b,S,C)}emplace(t,n,o,u,m,_,v,b,S,C,z){const I=10*t;return this.uint16[I+0]=n,this.uint16[I+1]=o,this.uint16[I+2]=u,this.uint16[I+3]=m,this.uint16[I+4]=_,this.uint16[I+5]=v,this.uint16[I+6]=b,this.uint16[I+7]=S,this.uint16[I+8]=C,this.uint16[I+9]=z,t}}Ma.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",Ma);class xl extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_,v,b,S,C,z,I){const B=this.length;return this.resize(B+1),this.emplace(B,t,n,o,u,m,_,v,b,S,C,z,I)}emplace(t,n,o,u,m,_,v,b,S,C,z,I,B){const O=12*t;return this.int16[O+0]=n,this.int16[O+1]=o,this.int16[O+2]=u,this.int16[O+3]=m,this.uint16[O+4]=_,this.uint16[O+5]=v,this.uint16[O+6]=b,this.uint16[O+7]=S,this.int16[O+8]=C,this.int16[O+9]=z,this.int16[O+10]=I,this.int16[O+11]=B,t}}xl.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",xl);class bl extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,t}}bl.prototype.bytesPerElement=12,st("StructArrayLayout3f12",bl);class uc extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}uc.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",uc);class f extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_,v,b,S){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,o,u,m,_,v,b,S)}emplace(t,n,o,u,m,_,v,b,S,C){const z=10*t,I=5*t;return this.int16[z+0]=n,this.int16[z+1]=o,this.int16[z+2]=u,this.int16[z+3]=m,this.int16[z+4]=_,this.int16[z+5]=v,this.uint32[I+3]=b,this.uint16[z+8]=S,this.uint16[z+9]=C,t}}f.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",f);class e extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,m,_)}emplace(t,n,o,u,m,_,v){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=m,this.int16[b+4]=_,this.int16[b+5]=v,t}}e.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",e);class a extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,m)}emplace(t,n,o,u,m,_){const v=4*t,b=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=u,this.int16[b+6]=m,this.int16[b+7]=_,t}}a.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",a);class l extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,m,_)}emplace(t,n,o,u,m,_,v){const b=16*t,S=4*t,C=8*t;return this.uint8[b+0]=n,this.uint8[b+1]=o,this.float32[S+1]=u,this.float32[S+2]=m,this.int16[C+6]=_,this.int16[C+7]=v,t}}l.prototype.bytesPerElement=16,st("StructArrayLayout2ub2f2i16",l);class h extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=u,t}}h.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",h);class g extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K){const pe=this.length;return this.resize(pe+1),this.emplace(pe,t,n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K)}emplace(t,n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K,pe){const te=24*t,oe=12*t,Se=48*t;return this.int16[te+0]=n,this.int16[te+1]=o,this.uint16[te+2]=u,this.uint16[te+3]=m,this.uint32[oe+2]=_,this.uint32[oe+3]=v,this.uint32[oe+4]=b,this.uint16[te+10]=S,this.uint16[te+11]=C,this.uint16[te+12]=z,this.float32[oe+7]=I,this.float32[oe+8]=B,this.uint8[Se+36]=O,this.uint8[Se+37]=N,this.uint8[Se+38]=q,this.uint32[oe+10]=K,this.int16[te+22]=pe,t}}g.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",g);class y extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K,pe,te,oe,Se,Pe,Ve,tt,$e,it,pt,Xe){const We=this.length;return this.resize(We+1),this.emplace(We,t,n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K,pe,te,oe,Se,Pe,Ve,tt,$e,it,pt,Xe)}emplace(t,n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K,pe,te,oe,Se,Pe,Ve,tt,$e,it,pt,Xe,We){const Le=32*t,vt=16*t;return this.int16[Le+0]=n,this.int16[Le+1]=o,this.int16[Le+2]=u,this.int16[Le+3]=m,this.int16[Le+4]=_,this.int16[Le+5]=v,this.int16[Le+6]=b,this.int16[Le+7]=S,this.uint16[Le+8]=C,this.uint16[Le+9]=z,this.uint16[Le+10]=I,this.uint16[Le+11]=B,this.uint16[Le+12]=O,this.uint16[Le+13]=N,this.uint16[Le+14]=q,this.uint16[Le+15]=K,this.uint16[Le+16]=pe,this.uint16[Le+17]=te,this.uint16[Le+18]=oe,this.uint16[Le+19]=Se,this.uint16[Le+20]=Pe,this.uint16[Le+21]=Ve,this.uint16[Le+22]=tt,this.uint32[vt+12]=$e,this.float32[vt+13]=it,this.float32[vt+14]=pt,this.uint16[Le+30]=Xe,this.uint16[Le+31]=We,t}}y.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",y);class w extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}w.prototype.bytesPerElement=4,st("StructArrayLayout1f4",w);class T extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,t}}T.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",T);class E extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=u,t}}E.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",E);class A extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}A.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",A);class R extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}R.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",R);class P extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u)}emplace(t,n,o,u,m){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=m,t}}P.prototype.bytesPerElement=16,st("StructArrayLayout4f16",P);class L extends yl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Re(this.anchorPointX,this.anchorPointY)}}L.prototype.size=20;class U extends f{get(t){return new L(this,t)}}st("CollisionBoxArray",U);class H extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}H.prototype.size=48;class $ extends g{get(t){return new H(this,t)}}st("PlacedSymbolArray",$);class X extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}X.prototype.size=64;class W extends y{get(t){return new X(this,t)}}st("SymbolInstanceArray",W);class ee extends w{getoffsetX(t){return this.float32[1*t+0]}}st("GlyphOffsetArray",ee);class Q extends ji{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}st("SymbolLineVertexArray",Q);class ne extends yl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ne.prototype.size=12;class le extends T{get(t){return new ne(this,t)}}st("TextAnchorOffsetArray",le);class J extends yl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}J.prototype.size=8;class de extends E{get(t){return new J(this,t)}}st("FeatureIndexArray",de);class Ce extends Zn{}class be extends Zn{}class Te extends Zn{}class Ae extends Co{}class Qe extends Ao{}class Ke extends Sa{}class Fe extends Ma{}class ht extends xl{}class Zt extends bl{}class li extends uc{}class Ui extends e{}class Ti extends l{}class Si extends h{}class Ri extends A{}const Ai=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mi}=Ai;class ti{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,u){const m=this.segments[this.segments.length-1];return t>ti.MAX_VERTEX_ARRAY_LENGTH&&en(`Max vertices per segment is ${ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ti.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!m||m.vertexLength+t>ti.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u?this.createNewSegment(n,o,u):m}createNewSegment(t,n,o){const u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new ti([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function zn(r,t){return 256*(r=bt(Math.floor(r),0,255))+bt(Math.floor(t),0,255)}ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",ti);const vn=Wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Er,Ys,ys,Cr={exports:{}},vs={exports:{}},Ks={exports:{}},hc=(function(){if(ys)return Cr.exports;ys=1;var r=(Er||(Er=1,vs.exports=function(n,o){var u,m,_,v,b,S,C,z;for(m=n.length-(u=3&n.length),_=o,b=3432918353,S=461845907,z=0;z<m;)C=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,_=27492+(65535&(v=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&n.charCodeAt(z+2))<<16;case 2:C^=(255&n.charCodeAt(z+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&n.charCodeAt(z)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),vs.exports),t=(Ys||(Ys=1,Ks.exports=function(n,o){for(var u,m=n.length,_=o^m,v=0;m>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:_^=(255&n.charCodeAt(v+2))<<16;case 2:_^=(255&n.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Ks.exports);return Cr.exports=r,Cr.exports.murmur3=r,Cr.exports.murmur2=t,Cr.exports})(),xs=Ie(hc);class Gn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push($a(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=$a(t);let o=0,u=this.ids.length-1;for(;o<u;){const _=o+u>>1;this.ids[_]>=n?u=_:o=_+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Xa(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new Gn;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function $a(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:xs(String(r))}function Xa(r,t,n,o){for(;n<o;){const u=r[n+o>>1];let m=n-1,_=o+1;for(;;){do m++;while(r[m]<u);do _--;while(r[_]>u);if(m>=_)break;Ws(r,m,_),Ws(t,3*m,3*_),Ws(t,3*m+1,3*_+1),Ws(t,3*m+2,3*_+2)}_-n<o-_?(Xa(r,t,n,_),n=_+1):(Xa(r,t,_+1,o),o=_)}}function Ws(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}st("FeaturePositionMap",Gn);class fi{constructor(t,n){this.gl=t.gl,this.location=n}}class $i extends fi{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ur extends fi{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class an extends fi{constructor(t,n){super(t,n),this.current=qt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Kc=new Float32Array(16);function Wc(r){return[zn(255*r.r,255*r.g),zn(255*r.b,255*r.a)]}class wl{constructor(t,n,o){this.value=t,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new an(t,n):new $i(t,n)}}class Ea{constructor(t,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,u){const m=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new ur(t,n):new $i(t,n)}}class Ya{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(t,n,o){const u=this.paintVertexArray.length,m=this.expression.evaluate(new gi(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(u,t,m)}updatePaintArray(t,n,o,u,m){const _=this.expression.evaluate(new gi(0,m),o,u);this._setPaintValue(t,n,_)}_setPaintValue(t,n,o){if(this.type==="color"){const u=Wc(o);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cn{constructor(t,n,o,u,m,_){this.expression=t,this.uniformNames=n.map((v=>`u_${v}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map((v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,n,o){const u=this.expression.evaluate(new gi(this.zoom,o),n,{},o.canonical,[],o.formattedSection),m=this.expression.evaluate(new gi(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,u,m)}updatePaintArray(t,n,o,u,m){const _=this.expression.evaluate(new gi(this.zoom,m),o,u),v=this.expression.evaluate(new gi(this.zoom+1,m),o,u);this._setPaintValue(t,n,_,v)}_setPaintValue(t,n,o,u){if(this.type==="color"){const m=Wc(o),_=Wc(u);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,m[0],m[1],_[0],_[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=bt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new $i(t,n)}}class sn{constructor(t,n,o,u,m,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=_,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],o.imagePositions)}updatePaintArray(t,n,o,u,m){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],m.imagePositions)}_setPaintValues(t,n,o,u){if(!u||!o)return;const{min:m,mid:_,max:v}=o,b=u[m],S=u[_],C=u[v];if(b&&S&&C)for(let z=t;z<n;z++)this.zoomInPaintVertexArray.emplace(z,S.tl[0],S.tl[1],S.br[0],S.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],S.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,S.tl[0],S.tl[1],S.br[0],S.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],S.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,vn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,vn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ka{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const m in t.paint._values){if(!o(m))continue;const _=t.paint.get(m);if(!(_ instanceof Mr&&qr(_.property.specification)))continue;const v=ws(m,t.type),b=_.value,S=_.property.specification.type,C=_.property.useIntegerZoom,z=_.property.specification["property-type"],I=z==="cross-faded"||z==="cross-faded-data-driven";if(b.kind==="constant")this.binders[m]=I?new Ea(b.value,v):new wl(b.value,v,S),u.push(`/u_${m}`);else if(b.kind==="source"||I){const B=sa(m,S,"source");this.binders[m]=I?new sn(b,S,C,n,B,t.id):new Ya(b,v,S,B),u.push(`/a_${m}`)}else{const B=sa(m,S,"composite");this.binders[m]=new cn(b,v,S,C,n,B),u.push(`/z_${m}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ya||n instanceof cn?n.maxValue:0}populatePaintArrays(t,n,o){for(const u in this.binders){const m=this.binders[u];(m instanceof Ya||m instanceof cn||m instanceof sn)&&m.populatePaintArray(t,n,o)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ea&&u.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,u,m){let _=!1;for(const v in t){const b=n.getPositions(v);for(const S of b){const C=o.feature(S.index);for(const z in this.binders){const I=this.binders[z];if((I instanceof Ya||I instanceof cn||I instanceof sn)&&I.expression.isStateDependent===!0){const B=u.paint.get(z);I.expression=B.value,I.updatePaintArray(S.start,S.end,C,t[v],m),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof wl||o instanceof Ea)&&t.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ya||o instanceof cn)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof sn)for(let u=0;u<vn.members.length;u++)t.push(vn.members[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof wl||o instanceof Ea||o instanceof cn)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof wl||m instanceof Ea||m instanceof cn){for(const _ of m.uniformNames)if(n[_]){const v=m.getBinding(t,n[_],_);o.push({name:_,property:u,binding:v})}}}return o}setUniforms(t,n,o,u){for(const{name:m,property:_,binding:v}of n)this.binders[_].setUniform(v,u,o.get(_),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof sn){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Ya||o instanceof cn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ya||o instanceof cn||o instanceof sn)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ya||n instanceof cn||n instanceof sn)&&n.destroy()}}}class bs{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Ka(u,n,o);this.needsUpload=!1,this._featureMap=new Gn,this._bufferOffset=0}populatePaintArrays(t,n,o,u){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ws(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function sa(r,t,n){const o={color:{source:Sa,composite:P},number:{source:w,composite:Sa}},u=(function(m){return{"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe}}[m]})(r);return u&&u[n]||o[t][n]}st("ConstantBinder",wl),st("CrossFadedConstantBinder",Ea),st("SourceExpressionBinder",Ya),st("CrossFadedCompositeBinder",sn),st("CompositeExpressionBinder",cn),st("ProgramConfiguration",Ka,{omit:["_buffers"]}),st("ProgramConfigurationSet",bs);const un=Math.pow(2,14)-1,zo=-un-1;function Po(r){const t=Tt/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let m=0;m<u.length;m++){const _=u[m],v=Math.round(_.x*t),b=Math.round(_.y*t);_.x=bt(v,zo,un),_.y=bt(b,zo,un),(v<_.x||v>_.x+1||b<_.y||b>_.y+1)&&en("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ro(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Po(r):[]}}const gd=-32768;function Tf(r,t,n,o,u){r.emplaceBack(gd+8*t+o,gd+8*n+u)}class Do{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new be,this.indexArray=new Si,this.segments=new ti,this.programConfigurations=new bs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){const u=this.layers[0],m=[];let _=null,v=!1,b=u.type==="heatmap";if(u.type==="circle"){const C=u;_=C.layout.get("circle-sort-key"),v=!_.isConstant(),b=b||C.paint.get("circle-pitch-alignment")==="map"}const S=b?n.subdivisionGranularity.circle:1;for(const{feature:C,id:z,index:I,sourceLayerIndex:B}of t){const O=this.layers[0]._featureFilter.needGeometry,N=Ro(C,O);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),N,o))continue;const q=v?_.evaluate(N,{},o):void 0,K={id:z,properties:C.properties,type:C.type,sourceLayerIndex:B,index:I,geometry:O?N.geometry:Po(C),patterns:{},sortKey:q};m.push(K)}v&&m.sort(((C,z)=>C.sortKey-z.sortKey));for(const C of m){const{geometry:z,index:I,sourceLayerIndex:B}=C,O=t[I].feature;this.addFeature(C,z,I,o,S),n.featureIndex.insert(O,z,I,B,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u,m=1){let _;switch(m){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${m}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const b of n)for(const S of b){const C=S.x,z=S.y;if(C<0||C>=Tt||z<0||z>=Tt)continue;const I=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),B=I.vertexLength;for(let O=0;O<v;O++)for(let N=0;N<v;N++)Tf(this.layoutVertexArray,C,z,_[N],_[O]);for(let O=0;O<v-1;O++)for(let N=0;N<v-1;N++){const q=B+O*v+N,K=B+(O+1)*v+N;this.indexArray.emplaceBack(q,K+1,q+1),this.indexArray.emplaceBack(q,K,K+1)}I.vertexLength+=v*v,I.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:u})}}function Zu(r,t){for(let n=0;n<r.length;n++)if(Jc(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Jc(r,t[n]))return!0;return!!Qc(r,t)}function Gu(r,t,n){return!!Jc(r,t)||!!qu(t,r,n)}function _d(r,t){if(r.length===1)return vd(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(Jc(r,o[u]))return!0}for(let n=0;n<r.length;n++)if(vd(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Qc(r,t[n]))return!0;return!1}function Sf(r,t,n){if(r.length>1){if(Qc(r,t))return!0;for(let o=0;o<t.length;o++)if(qu(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(qu(r[o],t,n))return!0;return!1}function Qc(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],u=r[n+1];for(let m=0;m<t.length-1;m++)if(Mf(o,u,t[m],t[m+1]))return!0}return!1}function Mf(r,t,n,o){return ua(r,n,o)!==ua(t,n,o)&&ua(r,t,n)!==ua(r,t,o)}function qu(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(yd(r,t[u-1],t[u])<o)return!0;return!1}function yd(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const u=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function vd(r,t){let n,o,u,m=!1;for(let _=0;_<r.length;_++){n=r[_];for(let v=0,b=n.length-1;v<n.length;b=v++)o=n[v],u=n[b],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(m=!m)}return m}function Jc(r,t){let n=!1;for(let o=0,u=r.length-1;o<r.length;u=o++){const m=r[o],_=r[u];m.y>t.y!=_.y>t.y&&t.x<(_.x-m.x)*(t.y-m.y)/(_.y-m.y)+m.x&&(n=!n)}return n}function Ef(r,t,n){const o=n[0],u=n[2];if(r.x<o.x&&t.x<o.x||r.x>u.x&&t.x>u.x||r.y<o.y&&t.y<o.y||r.y>u.y&&t.y>u.y)return!1;const m=ua(r,t,n[0]);return m!==ua(r,t,n[1])||m!==ua(r,t,n[2])||m!==ua(r,t,n[3])}function xn(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function qn(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Hu(r,t,n,o,u){if(!t[0]&&!t[1])return r;const m=Re.convert(t)._mult(u);n==="viewport"&&m._rotate(-o);const _=[];for(let v=0;v<r.length;v++)_.push(r[v].sub(m));return _}function Cf({queryGeometry:r,size:t},n){return Gu(r,n,t)}function Af({queryGeometry:r,size:t,transform:n,unwrappedTileID:o,getElevation:u},m){return Gu(r,m,t*(n.projectTileCoordinates(m.x,m.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function zf({queryGeometry:r,size:t,transform:n,unwrappedTileID:o,getElevation:u},m){const _=n.projectTileCoordinates(m.x,m.y,o,u).signedDistanceFromCamera,v=t*(n.cameraToCenterDistance/_);return Gu(r,Xu(m,n,o,u),v)}function Pf({queryGeometry:r,size:t,transform:n,unwrappedTileID:o,getElevation:u},m){return Gu(r,Xu(m,n,o,u),t)}function $u({queryGeometry:r,size:t,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:m="map",pitchScale:_="map"},v){const b=m==="map"?_==="map"?Cf:Af:_==="map"?zf:Pf,S={queryGeometry:r,size:t,transform:n,unwrappedTileID:o,getElevation:u};for(const C of v)for(const z of C)if(b(S,z))return!0;return!1}function Xu(r,t,n,o){const u=t.projectTileCoordinates(r.x,r.y,n,o).point;return new Re((.5*u.x+.5)*t.width,(.5*-u.y+.5)*t.height)}let xd,bd;st("CircleBucket",Do,{omit:["layers"]});var Rf={get paint(){return bd=bd||new Vn({"circle-radius":new gt(ge.paint_circle["circle-radius"]),"circle-color":new gt(ge.paint_circle["circle-color"]),"circle-blur":new gt(ge.paint_circle["circle-blur"]),"circle-opacity":new gt(ge.paint_circle["circle-opacity"]),"circle-translate":new ut(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gt(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gt(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gt(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return xd=xd||new Vn({"circle-sort-key":new gt(ge.layout_circle["circle-sort-key"])})}};class wd extends aa{constructor(t,n){super(t,Rf,n)}createBucket(t){return new Do(t)}queryRadius(t){const n=t;return xn("circle-radius",this,n)+xn("circle-stroke-width",this,n)+qn(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:m,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){const S=Hu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-m.bearingInRadians,_),C=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),z=this.paint.get("circle-pitch-scale"),I=this.paint.get("circle-pitch-alignment");let B,O;return I==="map"?(B=S,O=C*_):(B=(function(N,q,K,pe){return N.map((te=>Xu(te,q,K,pe)))})(S,m,v,b),O=C),$u({queryGeometry:B,size:O,transform:m,unwrappedTileID:v,getElevation:b,pitchAlignment:I,pitchScale:z},u)}}class Uh extends Do{}let Nh;st("HeatmapBucket",Uh,{omit:["layers"]});var Df={get paint(){return Nh=Nh||new Vn({"heatmap-radius":new gt(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gt(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ki(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(ge.paint_heatmap["heatmap-opacity"])})}};function Yu(r,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=u,r}function Ku(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const u=Yu({},{width:t,height:n},o);Wu(r,u,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=u.data}function Wu(r,t,n,o,u,m){if(u.width===0||u.height===0)return t;if(u.width>r.width||u.height>r.height||n.x>r.width-u.width||n.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=r.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<u.height;b++){const S=((n.y+b)*r.width+n.x)*m,C=((o.y+b)*t.width+o.x)*m;for(let z=0;z<u.width*m;z++)v[C+z]=_[S+z]}return t}class eu{constructor(t,n){Yu(this,t,1,n)}resize(t){Ku(this,t,1)}clone(){return new eu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,m){Wu(t,n,o,u,m,1)}}class Ar{constructor(t,n){Yu(this,t,4,n)}resize(t){Ku(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ar({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,m){Wu(t,n,o,u,m,4)}setPixel(t,n,o){const u=4*(t*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Td(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,u=r.image||new Ar({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(_,v,b)=>{t[r.evaluationKey]=b;const S=r.expression.evaluate(t);u.setPixel(_/4/n,v/4,S)};if(r.clips)for(let _=0,v=0;_<o;++_,v+=4*n)for(let b=0,S=0;b<n;b++,S+=4){const C=b/(n-1),{start:z,end:I}=r.clips[_];m(v,S,z*(1-C)+I*C)}else for(let _=0,v=0;_<n;_++,v+=4)m(0,v,_/(n-1));return u}st("AlphaImage",eu),st("RGBAImage",Ar);const Ts="big-fb";class Sd extends aa{createBucket(t){return new Uh(t)}constructor(t,n){super(t,Df,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Td({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ts)&&this.heatmapFbos.delete(Ts)}queryRadius(t){return xn("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:m,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){return $u({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,o)*_,transform:m,unwrappedTileID:v,getElevation:b},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let If;var kf={get paint(){return If=If||new Vn({"hillshade-illumination-direction":new ut(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ut(ge.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ut(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(ge.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ut(ge.paint_hillshade["hillshade-method"])})}};class Io extends aa{constructor(t,n){super(t,kf,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const m=Math.max(t.length,n.length,o.length,u.length);t=t.concat(Array(m-t.length).fill(t.at(-1))),n=n.concat(Array(m-n.length).fill(n.at(-1))),o=o.concat(Array(m-o.length).fill(o.at(-1))),u=u.concat(Array(m-u.length).fill(u.at(-1)));const _=n.map(to);return{directionRadians:t.map(to),altitudeRadians:_,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Md;var Vh={get paint(){return Md=Md||new Vn({"color-relief-opacity":new ut(ge["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Ki(ge["paint_color-relief"]["color-relief-color"])})}};class dc{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:m}=t,_=!(this.size&&this.size[0]===u&&this.size[1]===m||o),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(n&&n.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[u,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Ia(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,u,m,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:S,y:C}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Ia(t)?b.texSubImage2D(b.TEXTURE_2D,0,S,C,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,S,C,u,m,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,o){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),o!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class hn{constructor(t,n,o,u=1,m=1,_=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void en(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const b=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=m,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<b;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(b,S)]=this.data[this._idx(b-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,b)]=this.data[this._idx(S,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<b;S++)for(let C=0;C<b;C++){const z=this.get(S,C);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return Lf(t,this.getUnpackVector())}getPixels(){return new Ar({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,m=n*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:u=m-1;break;case 1:m=u+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const b=-n*this.dim,S=-o*this.dim;for(let C=_;C<v;C++)for(let z=u;z<m;z++)this.data[this._idx(z,C)]=t.data[this._idx(z+b,C+S)]}}function Lf(r,t){const n=t[0],o=t[1],u=t[2],m=t[3],_=Math.min(n,o,u),v=Math.round((r+m)/_);return{r:Math.floor(v*_/n)%256,g:Math.floor(v*_/o)%256,b:Math.floor(v*_/u)%256}}st("DEMData",hn);class xp extends aa{constructor(t,n){super(t,Vh,n)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Ns&&o._styleExpression.expression instanceof er){this.colorRampExpression=o;const _=o._styleExpression.expression;n.elevationStops=_.labels,n.colorStops=[];for(const v of n.elevationStops)n.colorStops.push(_.evaluate({globals:{elevation:v}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[qt.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const u={elevationStops:[],colorStops:[]},m=(n.elevationStops.length-1)/(t-1);for(let _=0;_<n.elevationStops.length-.5;_+=m)u.elevationStops.push(n.elevationStops[Math.round(_)]),u.colorStops.push(n.colorStops[Math.round(_)]);return en(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),m=new Ar({width:u.colorStops.length,height:1}),_=new Ar({width:u.colorStops.length,height:1});for(let v=0;v<u.elevationStops.length;v++){const b=Lf(u.elevationStops[v],o);_.setPixel(0,v,new qt(b.r/255,b.g/255,b.b/255,1)),m.setPixel(0,v,u.colorStops[v])}return this.colorRampTextures={elevationTexture:new dc(t,_,t.gl.RGBA),colorTexture:new dc(t,m,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Bf=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qu}=Bf;function Qs(r,t,n){const o=n.patternDependencies;let u=!1;for(const m of t){const _=m.paint.get(`${r}-pattern`);_.isConstant()||(u=!0);const v=_.constantOr(null);v&&(u=!0,o[v.to]=!0,o[v.from]=!0)}return u}function Zh(r,t,n,o,u){const{zoom:m}=o,_=u.patternDependencies;for(const v of t){const b=v.paint.get(`${r}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:m-1},n,{},u.availableImages),C=b.evaluate({zoom:m},n,{},u.availableImages),z=b.evaluate({zoom:m+1},n,{},u.availableImages);S=S&&S.name?S.name:S,C=C&&C.name?C.name:C,z=z&&z.name?z.name:z,_[S]=!0,_[C]=!0,_[z]=!0,n.patterns[v.id]={min:S,mid:C,max:z}}}return n}function Ed(r,t,n,o,u){let m;if(u===(function(_,v,b,S){let C=0;for(let z=v,I=b-S;z<b;z+=S)C+=(_[I]-_[z])*(_[z+1]+_[I+1]),I=z;return C})(r,t,n,o)>0)for(let _=t;_<n;_+=o)m=Dd(_/o|0,r[_],r[_+1],m);else for(let _=n-o;_>=t;_-=o)m=Dd(_/o|0,r[_],r[_+1],m);return m&&fc(m,m.next)&&(Ju(m),m=m.next),m}function Ss(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!fc(o,o.next)&&bn(o.prev,o,o.next)!==0)o=o.next;else{if(Ju(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function oa(r,t,n,o,u,m,_){if(!r)return;!_&&m&&(function(b,S,C,z){let I=b;do I.z===0&&(I.z=Ms(I.x,I.y,S,C,z)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==b);I.prevZ.nextZ=null,I.prevZ=null,(function(B){let O,N=1;do{let q,K=B;B=null;let pe=null;for(O=0;K;){O++;let te=K,oe=0;for(let Pe=0;Pe<N&&(oe++,te=te.nextZ,te);Pe++);let Se=N;for(;oe>0||Se>0&&te;)oe!==0&&(Se===0||!te||K.z<=te.z)?(q=K,K=K.nextZ,oe--):(q=te,te=te.nextZ,Se--),pe?pe.nextZ=q:B=q,q.prevZ=pe,pe=q;K=te}pe.nextZ=null,N*=2}while(O>1)})(I)})(r,o,u,m);let v=r;for(;r.prev!==r.next;){const b=r.prev,S=r.next;if(m?Cd(r,o,u,m):Of(r))t.push(b.i,r.i,S.i),Ju(r),r=S.next,v=S.next;else if((r=S)===v){_?_===1?oa(r=Ff(Ss(r),t),t,n,o,u,m,2):_===2&&Ad(r,t,n,o,u,m):oa(Ss(r),t,n,o,u,m,1);break}}}function Of(r){const t=r.prev,n=r,o=r.next;if(bn(t,n,o)>=0)return!1;const u=t.x,m=n.x,_=o.x,v=t.y,b=n.y,S=o.y,C=Math.min(u,m,_),z=Math.min(v,b,S),I=Math.max(u,m,_),B=Math.max(v,b,S);let O=o.next;for(;O!==t;){if(O.x>=C&&O.x<=I&&O.y>=z&&O.y<=B&&tu(u,v,m,b,_,S,O.x,O.y)&&bn(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Cd(r,t,n,o){const u=r.prev,m=r,_=r.next;if(bn(u,m,_)>=0)return!1;const v=u.x,b=m.x,S=_.x,C=u.y,z=m.y,I=_.y,B=Math.min(v,b,S),O=Math.min(C,z,I),N=Math.max(v,b,S),q=Math.max(C,z,I),K=Ms(B,O,t,n,o),pe=Ms(N,q,t,n,o);let te=r.prevZ,oe=r.nextZ;for(;te&&te.z>=K&&oe&&oe.z<=pe;){if(te.x>=B&&te.x<=N&&te.y>=O&&te.y<=q&&te!==u&&te!==_&&tu(v,C,b,z,S,I,te.x,te.y)&&bn(te.prev,te,te.next)>=0||(te=te.prevZ,oe.x>=B&&oe.x<=N&&oe.y>=O&&oe.y<=q&&oe!==u&&oe!==_&&tu(v,C,b,z,S,I,oe.x,oe.y)&&bn(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;te&&te.z>=K;){if(te.x>=B&&te.x<=N&&te.y>=O&&te.y<=q&&te!==u&&te!==_&&tu(v,C,b,z,S,I,te.x,te.y)&&bn(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;oe&&oe.z<=pe;){if(oe.x>=B&&oe.x<=N&&oe.y>=O&&oe.y<=q&&oe!==u&&oe!==_&&tu(v,C,b,z,S,I,oe.x,oe.y)&&bn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function Ff(r,t){let n=r;do{const o=n.prev,u=n.next.next;!fc(o,u)&&Pd(o,n,n.next,u)&&Ca(o,u)&&Ca(u,o)&&(t.push(o.i,n.i,u.i),Ju(n),Ju(n.next),n=r=u),n=n.next}while(n!==r);return Ss(n)}function Ad(r,t,n,o,u,m){let _=r;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&hr(_,v)){let b=Rd(_,v);return _=Ss(_,_.next),b=Ss(b,b.next),oa(_,t,n,o,u,m,0),void oa(b,t,n,o,u,m,0)}v=v.next}_=_.next}while(_!==r)}function zd(r,t){let n=r.x-t.x;return n===0&&(n=r.y-t.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Gh(r,t){const n=(function(u,m){let _=m;const v=u.x,b=u.y;let S,C=-1/0;if(fc(u,_))return _;do{if(fc(u,_.next))return _.next;if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){const N=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(N<=v&&N>C&&(C=N,S=_.x<_.next.x?_:_.next,N===v))return S}_=_.next}while(_!==m);if(!S)return null;const z=S,I=S.x,B=S.y;let O=1/0;_=S;do{if(v>=_.x&&_.x>=I&&v!==_.x&&qh(b<B?v:C,b,I,B,b<B?C:v,b,_.x,_.y)){const N=Math.abs(b-_.y)/(v-_.x);Ca(_,u)&&(N<O||N===O&&(_.x>S.x||_.x===S.x&&jf(S,_)))&&(S=_,O=N)}_=_.next}while(_!==z);return S})(r,t);if(!n)return t;const o=Rd(n,r);return Ss(o,o.next),Ss(n,n.next)}function jf(r,t){return bn(r.prev,r,t.prev)<0&&bn(t.next,r,r.next)<0}function Ms(r,t,n,o,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function In(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function qh(r,t,n,o,u,m,_,v){return(u-_)*(t-v)>=(r-_)*(m-v)&&(r-_)*(o-v)>=(n-_)*(t-v)&&(n-_)*(m-v)>=(u-_)*(o-v)}function tu(r,t,n,o,u,m,_,v){return!(r===_&&t===v)&&qh(r,t,n,o,u,m,_,v)}function hr(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!(function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&Pd(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1})(r,t)&&(Ca(r,t)&&Ca(t,r)&&(function(n,o){let u=n,m=!1;const _=(n.x+o.x)/2,v=(n.y+o.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next;while(u!==n);return m})(r,t)&&(bn(r.prev,r,t.prev)||bn(r,t.prev,t))||fc(r,t)&&bn(r.prev,r,r.next)>0&&bn(t.prev,t,t.next)>0)}function bn(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function fc(r,t){return r.x===t.x&&r.y===t.y}function Pd(r,t,n,o){const u=zr(bn(r,t,n)),m=zr(bn(r,t,o)),_=zr(bn(n,o,r)),v=zr(bn(n,o,t));return u!==m&&_!==v||!(u!==0||!Xi(r,n,t))||!(m!==0||!Xi(r,o,t))||!(_!==0||!Xi(n,r,o))||!(v!==0||!Xi(n,t,o))}function Xi(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function zr(r){return r>0?1:r<0?-1:0}function Ca(r,t){return bn(r.prev,r,r.next)<0?bn(r,t,r.next)>=0&&bn(r,r.prev,t)>=0:bn(r,t,r.prev)<0||bn(r,r.next,t)<0}function Rd(r,t){const n=eh(r.i,r.x,r.y),o=eh(t.i,t.x,t.y),u=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=u,u.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function Dd(r,t,n,o){const u=eh(r,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Ju(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function eh(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class dr{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class la{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}la.noSubdivision=new la({fill:new dr(0,0),line:new dr(0,0),tile:new dr(0,0),stencil:new dr(0,0),circle:1}),st("SubdivisionGranularityExpression",dr),st("SubdivisionGranularitySetting",la);const pc=-32768,Pr=32767;class Uf{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Tt/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),u=0|Math.round(n),m=this._getKey(o,u);if(this._vertexDictionary.has(m))return this._vertexDictionary.get(m);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(m,_),this._vertexBuffer.push(o,u),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(u,m){const _=[];for(let v=0;v<m.length;v+=3){const b=m[v],S=m[v+1],C=m[v+2],z=u[2*b],I=u[2*b+1];(u[2*S]-z)*(u[2*C+1]-I)-(u[2*S+1]-I)*(u[2*C]-z)>0?(_.push(b),_.push(C),_.push(S)):(_.push(b),_.push(S),_.push(C))}return _})(this._vertexBuffer,t);const n=[],o=t.length;for(let u=0;u<o;u+=3){const m=[t[u+0],t[u+1],t[u+2]],_=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let v=1/0,b=1/0,S=-1/0,C=-1/0;for(let N=0;N<3;N++){const q=_[2*N],K=_[2*N+1];v=Math.min(v,q),S=Math.max(S,q),b=Math.min(b,K),C=Math.max(C,K)}if(v===S||b===C)continue;const z=Math.floor(v/this._granularityCellSize),I=Math.ceil(S/this._granularityCellSize),B=Math.floor(b/this._granularityCellSize),O=Math.ceil(C/this._granularityCellSize);if(z!==I||B!==O)for(let N=B;N<O;N++){const q=this._scanlineGenerateVertexRingForCellRow(N,_,m);Tl(this._vertexBuffer,q,n)}else n.push(...m)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const u=t*this._granularityCellSize,m=u+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const b=n[2*v],S=n[2*v+1],C=n[2*(v+1)%6],z=n[(2*(v+1)+1)%6],I=n[2*(v+2)%6],B=n[(2*(v+2)+1)%6],O=C-b,N=z-S,q=O===0,K=N===0,pe=(u-S)/N,te=(m-S)/N,oe=Math.min(pe,te),Se=Math.max(pe,te);if(!K&&(oe>=1||Se<=0)||K&&(S<u||S>m)){z>=u&&z<=m&&_.push(o[(v+1)%3]);continue}!K&&oe>0&&_.push(this._vertexToIndex(b+O*oe,S+N*oe));const Pe=b+O*Math.max(oe,0),Ve=b+O*Math.min(Se,1);q||this._generateIntraEdgeVertices(_,b,S,C,z,Pe,Ve),!K&&Se<1&&_.push(this._vertexToIndex(b+O*Se,S+N*Se)),(K||z>=u&&z<=m)&&_.push(o[(v+1)%3]),!K&&(z<=u||z>=m)&&this._generateInterEdgeVertices(_,b,S,C,z,I,B,Ve,u,m)}return _}_generateIntraEdgeVertices(t,n,o,u,m,_,v){const b=u-n,S=m-o,C=S===0,z=C?Math.min(n,u):Math.min(_,v),I=C?Math.max(n,u):Math.max(_,v),B=Math.floor(z/this._granularityCellSize)+1,O=Math.ceil(I/this._granularityCellSize)-1;if(C?n<u:_<v)for(let N=B;N<=O;N++){const q=N*this._granularityCellSize;t.push(this._vertexToIndex(q,o+S*(q-n)/b))}else for(let N=O;N>=B;N--){const q=N*this._granularityCellSize;t.push(this._vertexToIndex(q,o+S*(q-n)/b))}}_generateInterEdgeVertices(t,n,o,u,m,_,v,b,S,C){const z=m-o,I=_-u,B=v-m,O=(S-m)/B,N=(C-m)/B,q=Math.min(O,N),K=Math.max(O,N),pe=u+I*q;let te=Math.floor(Math.min(pe,b)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(pe,b)/this._granularityCellSize)-1,Se=b<pe;const Pe=B===0;if(Pe&&(v===S||v===C))return;if(Pe||q>=1||K<=0){const tt=o-v,$e=_+(n-_)*Math.min((S-v)/tt,(C-v)/tt);te=Math.floor(Math.min($e,b)/this._granularityCellSize)+1,oe=Math.ceil(Math.max($e,b)/this._granularityCellSize)-1,Se=b<$e}const Ve=z>0?C:S;if(Se)for(let tt=te;tt<=oe;tt++)t.push(this._vertexToIndex(tt*this._granularityCellSize,Ve));else for(let tt=oe;tt>=te;tt--)t.push(this._vertexToIndex(tt*this._granularityCellSize,Ve))}_generateOutline(t){const n=[];for(const o of t){const u=Aa(o,this._granularity,!0),m=this._pointArrayToIndices(u),_=[];for(let v=1;v<m.length;v++)_.push(m[v-1]),_.push(m[v]);n.push(_)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===pc&&(t[n+1]=-32767),o===Pr&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,u,m,_){u>m!=(_===pc)?(t.push(n),t.push(o),t.push(this._vertexToIndex(u,_)),t.push(o),t.push(this._vertexToIndex(m,_)),t.push(this._vertexToIndex(u,_))):(t.push(o),t.push(n),t.push(this._vertexToIndex(u,_)),t.push(this._vertexToIndex(m,_)),t.push(o),t.push(this._vertexToIndex(u,_)))}_fillPoles(t,n,o){const u=this._vertexBuffer,m=Tt,_=t.length;for(let v=2;v<_;v+=3){const b=t[v-2],S=t[v-1],C=t[v],z=u[2*b],I=u[2*b+1],B=u[2*S],O=u[2*S+1],N=u[2*C],q=u[2*C+1];n&&(I===0&&O===0&&this._generatePoleQuad(t,b,S,z,B,pc),O===0&&q===0&&this._generatePoleQuad(t,S,C,B,N,pc),q===0&&I===0&&this._generatePoleQuad(t,C,b,N,z,pc)),o&&(I===m&&O===m&&this._generatePoleQuad(t,b,S,z,B,Pr),O===m&&q===m&&this._generatePoleQuad(t,S,C,B,N,Pr),q===m&&I===m&&this._generatePoleQuad(t,C,b,N,z,Pr))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(v){const b=[],S=[];for(const C of v)if(C.length!==0){C!==v[0]&&b.push(S.length/2);for(let z=0;z<C.length;z++)S.push(C[z].x),S.push(C[z].y)}return{flattened:S,holeIndices:b}})(t);let m;this._initializeVertices(o);try{const v=(function(S,C,z=2){const I=C&&C.length,B=I?C[0]*z:S.length;let O=Ed(S,0,B,z,!0);const N=[];if(!O||O.next===O.prev)return N;let q,K,pe;if(I&&(O=(function(te,oe,Se,Pe){const Ve=[];for(let tt=0,$e=oe.length;tt<$e;tt++){const it=Ed(te,oe[tt]*Pe,tt<$e-1?oe[tt+1]*Pe:te.length,Pe,!1);it===it.next&&(it.steiner=!0),Ve.push(In(it))}Ve.sort(zd);for(let tt=0;tt<Ve.length;tt++)Se=Gh(Ve[tt],Se);return Se})(S,C,O,z)),S.length>80*z){q=S[0],K=S[1];let te=q,oe=K;for(let Se=z;Se<B;Se+=z){const Pe=S[Se],Ve=S[Se+1];Pe<q&&(q=Pe),Ve<K&&(K=Ve),Pe>te&&(te=Pe),Ve>oe&&(oe=Ve)}pe=Math.max(te-q,oe-K),pe=pe!==0?32767/pe:0}return oa(O,N,z,q,K,pe,0),N})(o,u),b=this._convertIndices(o,v);m=this._subdivideTrianglesScanline(b)}catch(v){console.error(v)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(m),{verticesFlattened:this._vertexBuffer,indicesTriangles:m,indicesLineList:_}}_convertIndices(t,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(t[2*n[u]],t[2*n[u]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const u=t[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function ko(r,t,n,o=!0){return new Uf(n,t).subdividePolygonInternal(r,o)}function Aa(r,t,n=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],u=r[r.length-1],m=n&&(o.x!==u.x||o.y!==u.y);if(t<2)return m?[...r,r[0]]:[...r];const _=Math.floor(Tt/t),v=[];v.push(new Re(r[0].x,r[0].y));const b=r.length,S=m?b:b-1;for(let C=0;C<S;C++){const z=r[C],I=C<b-1?r[C+1]:r[0],B=z.x,O=z.y,N=I.x,q=I.y,K=B!==N,pe=O!==q;if(!K&&!pe)continue;const te=N-B,oe=q-O,Se=Math.abs(te),Pe=Math.abs(oe);let Ve=B,tt=O;for(;;){const it=te>0?(Math.floor(Ve/_)+1)*_:(Math.ceil(Ve/_)-1)*_,pt=oe>0?(Math.floor(tt/_)+1)*_:(Math.ceil(tt/_)-1)*_,Xe=Math.abs(Ve-it),We=Math.abs(tt-pt),Le=Math.abs(Ve-N),vt=Math.abs(tt-q),Mt=K?Xe/Se:Number.POSITIVE_INFINITY,ft=pe?We/Pe:Number.POSITIVE_INFINITY;if((Le<=Xe||!K)&&(vt<=We||!pe))break;if(Mt<ft&&K||!pe){Ve=it,tt+=oe*Mt;const dt=new Re(Ve,Math.round(tt));v[v.length-1].x===dt.x&&v[v.length-1].y===dt.y||v.push(dt)}else{Ve+=te*ft,tt=pt;const dt=new Re(Math.round(Ve),tt);v[v.length-1].x===dt.x&&v[v.length-1].y===dt.y||v.push(dt)}}const $e=new Re(N,q);v[v.length-1].x===$e.x&&v[v.length-1].y===$e.y||v.push($e)}return v}function Tl(r,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=r[2*t[0]];for(let b=1;b<t.length;b++){const S=r[2*t[b]];S<u&&(u=S,o=b)}const m=t.length;let _=o,v=(_+1)%m;for(;;){const b=_-1>=0?_-1:m-1,S=(v+1)%m,C=r[2*t[b]],z=r[2*t[S]],I=r[2*t[_]],B=r[2*t[_]+1],O=r[2*t[v]+1];let N=!1;if(C<z)N=!0;else if(C>z)N=!1;else{const q=O-B,K=-(r[2*t[v]]-I),pe=B<O?1:-1;((C-I)*q+(r[2*t[b]+1]-B)*K)*pe>((z-I)*q+(r[2*t[S]+1]-B)*K)*pe&&(N=!0)}if(N){const q=t[b],K=t[_],pe=t[v];q!==K&&q!==pe&&K!==pe&&n.push(pe,K,q),_--,_<0&&(_=m-1)}else{const q=t[S],K=t[_],pe=t[v];q!==K&&q!==pe&&K!==pe&&n.push(pe,K,q),v++,v>=m&&(v=0)}if(b===S)break}}function Hh(r,t,n,o,u,m,_,v,b){const S=u.length/2,C=_&&v&&b;if(S<ti.MAX_VERTEX_ARRAY_LENGTH){const z=t.prepareSegment(S,n,o),I=z.vertexLength;for(let N=0;N<m.length;N+=3)o.emplaceBack(I+m[N],I+m[N+1],I+m[N+2]);let B,O;z.vertexLength+=S,z.primitiveLength+=m.length/3,C&&(O=_.prepareSegment(S,n,v),B=O.vertexLength,O.vertexLength+=S);for(let N=0;N<u.length;N+=2)r(u[N],u[N+1]);if(C)for(let N=0;N<b.length;N++){const q=b[N];for(let K=1;K<q.length;K+=2)v.emplaceBack(B+q[K-1],B+q[K]);O.primitiveLength+=q.length/2}}else(function(z,I,B,O,N,q){const K=[];for(let Pe=0;Pe<O.length/2;Pe++)K.push(-1);const pe={count:0};let te=0,oe=z.getOrCreateLatestSegment(I,B),Se=oe.vertexLength;for(let Pe=2;Pe<N.length;Pe+=3){const Ve=N[Pe-2],tt=N[Pe-1],$e=N[Pe];let it=K[Ve]<te,pt=K[tt]<te,Xe=K[$e]<te;oe.vertexLength+((it?1:0)+(pt?1:0)+(Xe?1:0))>ti.MAX_VERTEX_ARRAY_LENGTH&&(oe=z.createNewSegment(I,B),te=pe.count,it=!0,pt=!0,Xe=!0,Se=0);const We=mc(K,O,q,pe,Ve,it,oe),Le=mc(K,O,q,pe,tt,pt,oe),vt=mc(K,O,q,pe,$e,Xe,oe);B.emplaceBack(Se+We-te,Se+Le-te,Se+vt-te),oe.primitiveLength++}})(t,n,o,u,m,r),C&&(function(z,I,B,O,N,q){const K=[];for(let Pe=0;Pe<O.length/2;Pe++)K.push(-1);const pe={count:0};let te=0,oe=z.getOrCreateLatestSegment(I,B),Se=oe.vertexLength;for(let Pe=0;Pe<N.length;Pe++){const Ve=N[Pe];for(let tt=1;tt<N[Pe].length;tt+=2){const $e=Ve[tt-1],it=Ve[tt];let pt=K[$e]<te,Xe=K[it]<te;oe.vertexLength+((pt?1:0)+(Xe?1:0))>ti.MAX_VERTEX_ARRAY_LENGTH&&(oe=z.createNewSegment(I,B),te=pe.count,pt=!0,Xe=!0,Se=0);const We=mc(K,O,q,pe,$e,pt,oe),Le=mc(K,O,q,pe,it,Xe,oe);B.emplaceBack(Se+We-te,Se+Le-te),oe.primitiveLength++}}})(_,n,v,u,b,r),t.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function mc(r,t,n,o,u,m,_){if(m){const v=o.count;return n(t[2*u],t[2*u+1]),r[u]=o.count,o.count++,_.vertexLength++,v}return r[u]}class Wa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Te,this.indexArray=new Si,this.indexArray2=new Ri,this.programConfigurations=new bs(t.layers,t.zoom),this.segments=new ti,this.segments2=new ti,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasPattern=Qs("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),m=!u.isConstant(),_=[];for(const{feature:v,id:b,index:S,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,I=Ro(v,z);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),I,o))continue;const B=m?u.evaluate(I,{},o,n.availableImages):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:S,geometry:z?I.geometry:Po(v),patterns:{},sortKey:B};_.push(O)}m&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:S,sourceLayerIndex:C}=v;if(this.hasPattern){const z=Zh("fill",this.layers,v,{zoom:this.zoom},n);this.patternFeatures.push(z)}else this.addFeature(v,b,S,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[S].feature,b,S,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,m,_){for(const v of rl(n,500)){const b=ko(v,u,_.fill.getGranularityForZoomLevel(u.z)),S=this.layoutVertexArray;Hh(((C,z)=>{S.emplaceBack(C,z)}),this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:m,canonical:u})}}let Id,gc;st("FillBucket",Wa,{omit:["layers","patternFeatures"]});var th={get paint(){return gc=gc||new Vn({"fill-antialias":new ut(ge.paint_fill["fill-antialias"]),"fill-opacity":new gt(ge.paint_fill["fill-opacity"]),"fill-color":new gt(ge.paint_fill["fill-color"]),"fill-outline-color":new gt(ge.paint_fill["fill-outline-color"]),"fill-translate":new ut(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new gs(ge.paint_fill["fill-pattern"])})},get layout(){return Id=Id||new Vn({"fill-sort-key":new gt(ge.layout_fill["fill-sort-key"])})}};class ih extends aa{constructor(t,n){super(t,th,n)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Wa(t)}queryRadius(){return qn(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:u}){return _d(Hu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const iu=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Nf=Wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vf}=iu;class Js{constructor(t,n,o,u,m){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=u,this._values=m,t.readFields(Zf,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,o=[];let u,m=1,_=0,v=0,b=0;for(;t.pos<n;){if(_<=0){const S=t.readVarint();m=7&S,_=S>>3}if(_--,m===1||m===2)v+=t.readSVarint(),b+=t.readSVarint(),m===1&&(u&&o.push(u),u=[]),u&&u.push(new Re(v,b));else{if(m!==7)throw new Error(`unknown command ${m}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let o=1,u=0,m=0,_=0,v=1/0,b=-1/0,S=1/0,C=-1/0;for(;t.pos<n;){if(u<=0){const z=t.readVarint();o=7&z,u=z>>3}if(u--,o===1||o===2)m+=t.readSVarint(),_+=t.readSVarint(),m<v&&(v=m),m>b&&(b=m),_<S&&(S=_),_>C&&(C=_);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,S,b,C]}toGeoJSON(t,n,o){const u=this.extent*Math.pow(2,o),m=this.extent*t,_=this.extent*n,v=this.loadGeometry();function b(I){return[360*(I.x+m)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(I.y+_)/u)*Math.PI))-90]}function S(I){return I.map(b)}let C;if(this.type===1){const I=[];for(const O of v)I.push(O[0]);const B=S(I);C=I.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const I=v.map(S);C=I.length===1?{type:"LineString",coordinates:I[0]}:{type:"MultiLineString",coordinates:I}}else{if(this.type!==3)throw new Error("unknown feature type");{const I=(function(O){const N=O.length;if(N<=1)return[O];const q=[];let K,pe;for(let te=0;te<N;te++){const oe=$h(O[te]);oe!==0&&(pe===void 0&&(pe=oe<0),pe===oe<0?(K&&q.push(K),K=[O[te]]):K&&K.push(O[te]))}return K&&q.push(K),q})(v),B=[];for(const O of I)B.push(O.map(S));C=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const z={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function Zf(r,t,n){r===1?t.id=n.readVarint():r===2?(function(o,u){const m=o.readVarint()+o.pos;for(;o.pos<m;){const _=u._keys[o.readVarint()],v=u._values[o.readVarint()];u.properties[_]=v}})(n,t):r===3?t.type=n.readVarint():r===4&&(t._geometry=n.pos)}function $h(r){let t=0;for(let n,o,u=0,m=r.length,_=m-1;u<m;_=u++)n=r[u],o=r[_],t+=(o.x-n.x)*(n.y+o.y);return t}Js.types=["Unknown","Point","LineString","Polygon"];class kd{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(bp,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new Js(this._pbf,n,this.extent,this._keys,this._values)}}function bp(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push((function(o){let u=null;const m=o.readVarint()+o.pos;for(;o.pos<m;){const _=o.readVarint()>>3;u=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class Gf{constructor(t,n){this.layers=t.readFields(Di,{},n)}}function Di(r,t,n){if(r===3){const o=new kd(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}const Ni=Math.pow(2,13);function Wt(r,t,n,o,u,m,_,v){r.emplaceBack(t,n,2*Math.floor(o*Ni)+_,u*Ni*2,m*Ni*2,Math.round(v))}class ui{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ae,this.centroidVertexArray=new Ce,this.indexArray=new Si,this.programConfigurations=new bs(t.layers,t.zoom),this.segments=new ti,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.features=[],this.hasPattern=Qs("fill-extrusion",this.layers,n);for(const{feature:u,id:m,index:_,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,S=Ro(u,b);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),S,o))continue;const C={id:m,sourceLayerIndex:v,index:_,geometry:b?S.geometry:Po(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(Zh("fill-extrusion",this.layers,C,{zoom:this.zoom},n)):this.addFeature(C,C.geometry,_,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,C.geometry,_,v,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:m}=u;this.addFeature(u,m,u.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vf),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Nf.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,m,_){for(const v of rl(n,500)){const b={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(b,u,t,v,_);const C=this.layoutVertexArray.length-S,z=Math.floor(b.x/b.sampleCount),I=Math.floor(b.y/b.sampleCount);for(let B=0;B<C;B++)this.centroidVertexArray.emplaceBack(z,I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:m,canonical:u})}processPolygon(t,n,o,u,m){if(u.length<1||Lo(u[0]))return;for(const z of u)z.length!==0&&Ii(t,z);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=m.fill.getGranularityForZoomLevel(n.z),b=Js.types[o.type]==="Polygon";for(const z of u){if(z.length===0||Lo(z))continue;const I=Aa(z,v,b);this._generateSideFaces(I,_)}if(!b)return;const S=ko(u,n,v,!1),C=this.layoutVertexArray;Hh(((z,I)=>{Wt(C,z,I,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let u=1;u<t.length;u++){const m=t[u],_=t[u-1];if(za(m,_))continue;n.segment.vertexLength+4>ti.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=m.sub(_)._perp()._unit(),b=_.dist(m);o+b>32768&&(o=0),Wt(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,0,o),Wt(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,1,o),o+=b,Wt(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Wt(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o);const S=n.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function Ii(r,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function za(r,t){return r.x===t.x&&(r.x<0||r.x>Tt)||r.y===t.y&&(r.y<0||r.y>Tt)}function Lo(r){return r.every((t=>t.x<0))||r.every((t=>t.x>Tt))||r.every((t=>t.y<0))||r.every((t=>t.y>Tt))}let _c;st("FillExtrusionBucket",ui,{omit:["layers","features"]});var Ld={get paint(){return _c=_c||new Vn({"fill-extrusion-opacity":new ut(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gt(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gs(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gt(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gt(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Bo extends aa{constructor(t,n){super(t,Ld,n)}createBucket(t){return new ui(t)}queryRadius(){return qn(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:m,pixelsToTileUnits:_,pixelPosMatrix:v}){const b=Hu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-m.bearingInRadians,_),S=this.paint.get("fill-extrusion-height").evaluate(n,o),C=this.paint.get("fill-extrusion-base").evaluate(n,o),z=(function(B,O){const N=[];for(const q of B){const K=[q.x,q.y,0,1];pn(K,K,O),N.push(new Re(K[0]/K[3],K[1]/K[3]))}return N})(b,v),I=(function(B,O,N,q){const K=[],pe=[],te=q[8]*O,oe=q[9]*O,Se=q[10]*O,Pe=q[11]*O,Ve=q[8]*N,tt=q[9]*N,$e=q[10]*N,it=q[11]*N;for(const pt of B){const Xe=[],We=[];for(const Le of pt){const vt=Le.x,Mt=Le.y,ft=q[0]*vt+q[4]*Mt+q[12],dt=q[1]*vt+q[5]*Mt+q[13],Kt=q[2]*vt+q[6]*Mt+q[14],ki=q[3]*vt+q[7]*Mt+q[15],Bn=Kt+Se,ir=ki+Pe,Fr=ft+Ve,jr=dt+tt,nr=Kt+$e,Li=ki+it,wn=new Re((ft+te)/ir,(dt+oe)/ir);wn.z=Bn/ir,Xe.push(wn);const $n=new Re(Fr/Li,jr/Li);$n.z=nr/Li,We.push($n)}K.push(Xe),pe.push(We)}return[K,pe]})(u,C,S,v);return(function(B,O,N){let q=1/0;_d(N,O)&&(q=Oo(N,O[0]));for(let K=0;K<O.length;K++){const pe=O[K],te=B[K];for(let oe=0;oe<pe.length-1;oe++){const Se=pe[oe],Pe=[Se,pe[oe+1],te[oe+1],te[oe],Se];Zu(N,Pe)&&(q=Math.min(q,Oo(N,Pe)))}}return q!==1/0&&q})(I[0],I[1],z)}}function Qi(r,t){return r.x*t.x+r.y*t.y}function Oo(r,t){if(r.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const m=t[n],_=r[0],v=u.sub(o),b=m.sub(o),S=_.sub(o),C=Qi(v,v),z=Qi(v,b),I=Qi(b,b),B=Qi(S,v),O=Qi(S,b),N=C*I-z*z,q=(I*B-z*O)/N,K=(C*O-z*B)/N,pe=o.z*(1-q-K)+u.z*q+m.z*K;if(isFinite(pe))return pe}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const yc=Wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Bd}=yc,Qa=Wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:nu}=Qa,nh=Math.cos(Math.PI/180*37.5),Kr=Math.pow(2,14)/.5;class rh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Qe,this.layoutVertexArray2=new Ke,this.indexArray=new Si,this.programConfigurations=new bs(t.layers,t.zoom),this.segments=new ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasPattern=Qs("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),m=!u.isConstant(),_=[];for(const{feature:v,id:b,index:S,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,I=Ro(v,z);if(!this.layers[0]._featureFilter.filter(new gi(this.zoom),I,o))continue;const B=m?u.evaluate(I,{},o):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:S,geometry:z?I.geometry:Po(v),patterns:{},sortKey:B};_.push(O)}m&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:S,sourceLayerIndex:C}=v;if(this.hasPattern){const z=Zh("line",this.layers,v,{zoom:this.zoom},n);this.patternFeatures.push(z)}else this.addFeature(v,b,S,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[S].feature,b,S,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,nu)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,m,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(t,{}),S=v.get("line-cap"),C=v.get("line-miter-limit"),z=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const I of n)this.addLine(I,t,b,S,C,z,u,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:m,canonical:u})}addLine(t,n,o,u,m,_,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Aa(t,v?b.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<t.length-1;te++)this.totalDistance+=t[te].dist(t[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=Js.types[n.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let z=0;for(;z<C-1&&t[z].equals(t[z+1]);)z++;if(C<(S?3:2))return;o==="bevel"&&(m=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let O,N,q,K,pe;this.e1=this.e2=-1,S&&(O=t[C-2],pe=t[z].sub(O)._unit()._perp());for(let te=z;te<C;te++){if(q=te===C-1?S?t[z+1]:void 0:t[te+1],q&&t[te].equals(q))continue;pe&&(K=pe),O&&(N=O),O=t[te],pe=q?q.sub(O)._unit()._perp():K,K=K||pe;let oe=K.add(pe);oe.x===0&&oe.y===0||oe._unit();const Se=K.x*pe.x+K.y*pe.y,Pe=oe.x*pe.x+oe.y*pe.y,Ve=Pe!==0?1/Pe:1/0,tt=2*Math.sqrt(2-2*Pe),$e=Pe<nh&&N&&q,it=K.x*pe.y-K.y*pe.x>0;if($e&&te>z){const We=O.dist(N);if(We>2*I){const Le=O.sub(O.sub(N)._mult(I/We)._round());this.updateDistance(N,Le),this.addCurrentVertex(Le,K,0,0,B),N=Le}}const pt=N&&q;let Xe=pt?o:S?"butt":u;if(pt&&Xe==="round"&&(Ve<_?Xe="miter":Ve<=2&&(Xe="fakeround")),Xe==="miter"&&Ve>m&&(Xe="bevel"),Xe==="bevel"&&(Ve>2&&(Xe="flipbevel"),Ve<m&&(Xe="miter")),N&&this.updateDistance(N,O),Xe==="miter")oe._mult(Ve),this.addCurrentVertex(O,oe,0,0,B);else if(Xe==="flipbevel"){if(Ve>100)oe=pe.mult(-1);else{const We=Ve*K.add(pe).mag()/K.sub(pe).mag();oe._perp()._mult(We*(it?-1:1))}this.addCurrentVertex(O,oe,0,0,B),this.addCurrentVertex(O,oe.mult(-1),0,0,B)}else if(Xe==="bevel"||Xe==="fakeround"){const We=-Math.sqrt(Ve*Ve-1),Le=it?We:0,vt=it?0:We;if(N&&this.addCurrentVertex(O,K,Le,vt,B),Xe==="fakeround"){const Mt=Math.round(180*tt/Math.PI/20);for(let ft=1;ft<Mt;ft++){let dt=ft/Mt;if(dt!==.5){const ki=dt-.5;dt+=dt*ki*(dt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*ki*ki+(.848013+Se*(.215638*Se-1.06021)))}const Kt=pe.sub(K)._mult(dt)._add(K)._unit()._mult(it?-1:1);this.addHalfVertex(O,Kt.x,Kt.y,!1,it,0,B)}}q&&this.addCurrentVertex(O,pe,-Le,-vt,B)}else if(Xe==="butt")this.addCurrentVertex(O,oe,0,0,B);else if(Xe==="square"){const We=N?1:-1;this.addCurrentVertex(O,oe,We,We,B)}else Xe==="round"&&(N&&(this.addCurrentVertex(O,K,0,0,B),this.addCurrentVertex(O,K,1,1,B,!0)),q&&(this.addCurrentVertex(O,pe,-1,-1,B,!0),this.addCurrentVertex(O,pe,0,0,B)));if($e&&te<C-1){const We=O.dist(q);if(We>2*I){const Le=O.add(q.sub(O)._mult(I/We)._round());this.updateDistance(O,Le),this.addCurrentVertex(Le,pe,0,0,B),O=Le}}}}addCurrentVertex(t,n,o,u,m,_=!1){const v=n.y*u-n.x,b=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,m),this.addHalfVertex(t,v,b,_,!0,-u,m),this.distance>Kr/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,m,_))}addHalfVertex({x:t,y:n},o,u,m,_,v,b){const S=.5*(this.lineClips?this.scaledDistance*(Kr-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),b.primitiveLength++),_?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Xh,ah;st("LineBucket",rh,{omit:["layers","patternFeatures"]});var sh={get paint(){return ah=ah||new Vn({"line-opacity":new gt(ge.paint_line["line-opacity"]),"line-color":new gt(ge.paint_line["line-color"]),"line-translate":new ut(ge.paint_line["line-translate"]),"line-translate-anchor":new ut(ge.paint_line["line-translate-anchor"]),"line-width":new gt(ge.paint_line["line-width"]),"line-gap-width":new gt(ge.paint_line["line-gap-width"]),"line-offset":new gt(ge.paint_line["line-offset"]),"line-blur":new gt(ge.paint_line["line-blur"]),"line-dasharray":new Vu(ge.paint_line["line-dasharray"]),"line-pattern":new gs(ge.paint_line["line-pattern"]),"line-gradient":new Ki(ge.paint_line["line-gradient"])})},get layout(){return Xh=Xh||new Vn({"line-cap":new ut(ge.layout_line["line-cap"]),"line-join":new gt(ge.layout_line["line-join"]),"line-miter-limit":new ut(ge.layout_line["line-miter-limit"]),"line-round-limit":new ut(ge.layout_line["line-round-limit"]),"line-sort-key":new gt(ge.layout_line["line-sort-key"])})}};class Sl extends gt{possiblyEvaluate(t,n){return n=new gi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=si({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let Hn;class Ml extends aa{constructor(t,n){super(t,sh,n),this.gradientVersion=0,Hn||(Hn=new Sl(sh.paint.properties["line-width"].specification),Hn.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof ln,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Hn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new rh(t)}queryRadius(t){const n=t,o=vc(xn("line-width",this,n),xn("line-gap-width",this,n)),u=xn("line-offset",this,n);return o/2+Math.abs(u)+qn(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:m,pixelsToTileUnits:_}){const v=Hu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-m.bearingInRadians,_),b=_/2*vc(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),S=this.paint.get("line-offset").evaluate(n,o);return S&&(u=(function(C,z){const I=[];for(let B=0;B<C.length;B++){const O=C[B],N=[];for(let q=0;q<O.length;q++){const K=O[q-1],pe=O[q],te=O[q+1],oe=q===0?new Re(0,0):pe.sub(K)._unit()._perp(),Se=q===O.length-1?new Re(0,0):te.sub(pe)._unit()._perp(),Pe=oe._add(Se)._unit(),Ve=Pe.x*Se.x+Pe.y*Se.y;Ve!==0&&Pe._mult(1/Ve),N.push(Pe._mult(z)._add(pe))}I.push(N)}return I})(u,S*_)),(function(C,z,I){for(let B=0;B<z.length;B++){const O=z[B];if(C.length>=3){for(let N=0;N<O.length;N++)if(Jc(C,O[N]))return!0}if(Sf(C,O,I))return!0}return!1})(v,u,b)}isTileClipped(){return!0}}function vc(r,t){return t>0?t+2*r:r}const ru=Wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Od=Wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fd=Wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jd=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oh=Wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ud(r,t,n){return r.sections.forEach((o=>{o.text=(function(u,m,_){const v=m.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),wa.applyArabicShaping&&(u=wa.applyArabicShaping(u)),u})(o.text,t,n)})),r}Wi([{name:"triangle",components:3,type:"Uint16"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wi([{type:"Float32",name:"offsetX"}]),Wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rr={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var kn=24;const Wr=4294967296,Nd=1/Wr,Vd=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Zd{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),m=u>>3,_=this.pos;this.type=7&u,t(m,n,this),this.pos===_&&this.skip(u)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Wr;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Wr;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,(function(m,_,v){const b=v.buf;let S,C;if(C=b[v.pos++],S=(112&C)>>4,C<128||(C=b[v.pos++],S|=(127&C)<<3,C<128)||(C=b[v.pos++],S|=(127&C)<<10,C<128)||(C=b[v.pos++],S|=(127&C)<<17,C<128)||(C=b[v.pos++],S|=(127&C)<<24,C<128)||(C=b[v.pos++],S|=(1&C)<<31,C<128))return Pa(m,S,_);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&Vd?Vd.decode(this.buf.subarray(n,t)):(function(o,u,m){let _="",v=u;for(;v<m;){const b=o[v];let S,C,z,I=null,B=b>239?4:b>223?3:b>191?2:1;if(v+B>m)break;B===1?b<128&&(I=b):B===2?(S=o[v+1],(192&S)==128&&(I=(31&b)<<6|63&S,I<=127&&(I=null))):B===3?(S=o[v+1],C=o[v+2],(192&S)==128&&(192&C)==128&&(I=(15&b)<<12|(63&S)<<6|63&C,(I<=2047||I>=55296&&I<=57343)&&(I=null))):B===4&&(S=o[v+1],C=o[v+2],z=o[v+3],(192&S)==128&&(192&C)==128&&(192&z)==128&&(I=(15&b)<<18|(63&S)<<12|(63&C)<<6|63&z,(I<=65535||I>=1114112)&&(I=null))),I===null?(I=65533,B=1):I>65535&&(I-=65536,_+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),_+=String.fromCharCode(I),v+=B}return _})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Nd),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Nd),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,o){let u,m;if(n>=0?(u=n%4294967296|0,m=n/4294967296|0):(u=~(-n%4294967296),m=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,m=m+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(_,v,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)})(u,0,o),(function(_,v){const b=(7&_)<<4;v.buf[v.pos++]|=b|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))})(m,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(u,m,_){for(let v,b,S=0;S<m.length;S++){if(v=m.charCodeAt(S),v>55295&&v<57344){if(!b){v>56319||S+1===m.length?(u[_++]=239,u[_++]=191,u[_++]=189):b=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(u[_++]=239,u[_++]=191,u[_++]=189,b=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _})(this.buf,t,this.pos);const o=this.pos-n;o>=128&&lh(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,n){this.pos++;const o=this.pos;t(n,this);const u=this.pos-o;u>=128&&lh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(t,n,o){this.writeTag(t,2),this.writeRawMessage(n,o)}writePackedVarint(t,n){n.length&&this.writeMessage(t,Gd,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,au,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,$f,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,qf,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,Hf,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,qd,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,Hd,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,wp,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,Tp,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function Pa(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function lh(r,t,n){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=r;u--)n.buf[u+o]=n.buf[u]}function Gd(r,t){for(let n=0;n<r.length;n++)t.writeVarint(r[n])}function au(r,t){for(let n=0;n<r.length;n++)t.writeSVarint(r[n])}function qf(r,t){for(let n=0;n<r.length;n++)t.writeFloat(r[n])}function Hf(r,t){for(let n=0;n<r.length;n++)t.writeDouble(r[n])}function $f(r,t){for(let n=0;n<r.length;n++)t.writeBoolean(r[n])}function qd(r,t){for(let n=0;n<r.length;n++)t.writeFixed32(r[n])}function Hd(r,t){for(let n=0;n<r.length;n++)t.writeSFixed32(r[n])}function wp(r,t){for(let n=0;n<r.length;n++)t.writeFixed64(r[n])}function Tp(r,t){for(let n=0;n<r.length;n++)t.writeSFixed64(r[n])}function Sp(r,t,n){r===1&&n.readMessage(Xf,t)}function Xf(r,t,n){if(r===3){const{id:o,bitmap:u,width:m,height:_,left:v,top:b,advance:S}=n.readMessage(Yf,{});t.push({id:o,bitmap:new eu({width:m+6,height:_+6},u),metrics:{width:m,height:_,left:v,top:b,advance:S}})}}function Yf(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}function xc(r){let t=0,n=0;for(const _ of r)t+=_.w*_.h,n=Math.max(n,_.w);r.sort(((_,v)=>v.h-_.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,m=0;for(const _ of r)for(let v=o.length-1;v>=0;v--){const b=o[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,m=Math.max(m,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===b.w&&_.h===b.h){const S=o.pop();S&&v<o.length&&(o[v]=S)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(o.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:u,h:m,fill:t/(u*m)||0}}class su{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:m,content:_,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=m,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $d{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(n,u,m);const{w:_,h:v}=xc(m),b=new Ar({width:_||1,height:v||1});for(const S in t){const C=t[S],z=o[S].paddedRect;Ar.copy(C.data,b,{x:0,y:0},{x:z.x+1,y:z.y+1},C.data)}for(const S in n){const C=n[S],z=u[S].paddedRect,I=z.x+1,B=z.y+1,O=C.data.width,N=C.data.height;Ar.copy(C.data,b,{x:0,y:0},{x:I,y:B},C.data),Ar.copy(C.data,b,{x:0,y:N-1},{x:I,y:B-1},{width:O,height:1}),Ar.copy(C.data,b,{x:0,y:0},{x:I,y:B+N},{width:O,height:1}),Ar.copy(C.data,b,{x:O-1,y:0},{x:I-1,y:B},{width:1,height:N}),Ar.copy(C.data,b,{x:0,y:0},{x:I+O,y:B},{width:1,height:N})}this.image=b,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const m=t[u],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};o.push(_),n[u]=new su(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,m]=t.tl;o.update(n.data,void 0,{x:u,y:m})}}var Fo;st("ImagePosition",su),st("ImageAtlas",$d),D.ao=void 0,(Fo=D.ao||(D.ao={}))[Fo.none=0]="none",Fo[Fo.horizontal=1]="horizontal",Fo[Fo.vertical=2]="vertical",Fo[Fo.horizontalOnly=3]="horizontalOnly";class ou{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const u=new ou;return u.scale=t||1,u.fontStack=n,u.verticalAlign=o||"bottom",u}static forImage(t,n){const o=new ou;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class bc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new bc;for(let u=0;u<t.sections.length;u++){const m=t.sections[u];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;n+=u&&Eo(u)&&!Rr[t[o+1]]||m&&Eo(m)&&!Rr[t[o-1]]||!Rr[t[o]]?t[o]:Rr[t[o]]}return n})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&uh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&uh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new bc;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,o=0;for(let u=0;u<this.length();u++){const m=this.getSection(u);if(m.imageName){const _=t[m.imageName];if(!_)continue;const v=_.displaySize;n=Math.max(n,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(ou.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void en("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(ou.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):en("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ch(r,t,n,o,u,m,_,v,b,S,C,z,I,B,O){const N=bc.fromFeature(r,u);let q;z===D.ao.vertical&&N.verticalizePunctuation();const{processBidirectionalText:K,processStyledBidirectionalText:pe}=wa;if(K&&N.sections.length===1){q=[];const Se=K(N.toString(),Wd(N,S,m,t,o,B));for(const Pe of Se){const Ve=new bc;Ve.text=Pe,Ve.sections=N.sections;for(let tt=0;tt<Pe.length;tt++)Ve.sectionIndex.push(0);q.push(Ve)}}else if(pe){q=[];const Se=pe(N.text,N.sectionIndex,Wd(N,S,m,t,o,B));for(const Pe of Se){const Ve=new bc;Ve.text=Pe[0],Ve.sectionIndex=Pe[1],Ve.sections=N.sections,q.push(Ve)}}else q=(function(Se,Pe){const Ve=[],tt=Se.text;let $e=0;for(const it of Pe)Ve.push(Se.substring($e,it)),$e=it;return $e<tt.length&&Ve.push(Se.substring($e,tt.length)),Ve})(N,Wd(N,S,m,t,o,B));const te=[],oe={positionedLines:te,text:N.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:z,iconsInText:!1,verticalizable:!1};return(function(Se,Pe,Ve,tt,$e,it,pt,Xe,We,Le,vt,Mt){let ft=0,dt=0,Kt=0,ki=0;const Bn=Xe==="right"?1:Xe==="left"?0:.5,ir=kn/Mt;let Fr=0;for(const Li of $e){Li.trim();const wn=Li.getMaxScale(),$n={positionedGlyphs:[],lineOffset:0};Se.positionedLines[Fr]=$n;const Tn=$n.positionedGlyphs;let pr=0;if(!Li.length()){dt+=it,++Fr;continue}const Ur=Mp(tt,Li,ir);for(let Jr=0;Jr<Li.length();Jr++){const dn=Li.getSection(Jr),i=Li.getSectionIndex(Jr),s=Li.getCharCode(Jr),c=lu(We,vt,s);let p;if(dn.imageName){if(Se.iconsInText=!0,dn.scale=dn.scale*ir,p=Kh(dn,c,wn,Ur,tt),!p)continue;pr=Math.max(pr,p.imageOffset)}else if(p=Jd(dn,s,c,Ur,Pe,Ve),!p)continue;const{rect:x,metrics:M,baselineOffset:k}=p;Tn.push({glyph:s,imageName:dn.imageName,x:ft,y:dt+k+-17,vertical:c,scale:dn.scale,fontStack:dn.fontStack,sectionIndex:i,metrics:M,rect:x}),c?(Se.verticalizable=!0,ft+=(dn.imageName?M.advance:kn)*dn.scale+Le):ft+=M.advance*dn.scale+Le}Tn.length!==0&&(Kt=Math.max(ft-Le,Kt),ef(Tn,0,Tn.length-1,Bn)),ft=0,$n.lineOffset=Math.max(pr,(wn-1)*kn);const On=it*wn+pr;dt+=On,ki=Math.max(On,ki),++Fr}const{horizontalAlign:jr,verticalAlign:nr}=Qd(pt);(function(Li,wn,$n,Tn,pr,Ur,On,Jr,dn){const i=(wn-$n)*pr;let s=0;s=Ur!==On?-Jr*Tn- -17:-Tn*dn*On+.5*On;for(const c of Li)for(const p of c.positionedGlyphs)p.x+=i,p.y+=s})(Se.positionedLines,Bn,jr,nr,Kt,ki,it,dt,$e.length),Se.top+=-nr*dt,Se.bottom=Se.top+dt,Se.left+=-jr*Kt,Se.right=Se.left+Kt})(oe,t,n,o,q,_,v,b,z,S,I,O),!(function(Se){for(const Pe of Se)if(Pe.positionedGlyphs.length!==0)return!1;return!0})(te)&&oe}const uh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yh={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Kf={40:!0};function Xd(r,t,n,o,u,m){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*kn/m+u:0}{const _=n[t.fontStack],v=_&&_[r];return v?v.metrics.advance*t.scale+u:0}}function Vi(r,t,n,o){const u=Math.pow(r-t,2);return o?r<t?u/2:2*u:u+Math.abs(n)*n}function Yd(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Wf(r,t,n,o,u,m){let _=null,v=Vi(t,n,u,m);for(const b of o){const S=Vi(t-b.x,n,u,m)+b.badness;S<=v&&(_=b,v=S)}return{index:r,x:t,priorBreak:_,badness:v}}function Kd(r){return r?Kd(r.priorBreak).concat(r.index):[]}function Wd(r,t,n,o,u,m){if(!r)return[];const _=[],v=(function(z,I,B,O,N,q){let K=0;for(let pe=0;pe<z.length();pe++){const te=z.getSection(pe);K+=Xd(z.getCharCode(pe),te,O,N,I,q)}return K/Math.max(1,Math.ceil(K/B))})(r,t,n,o,u,m),b=r.text.indexOf("")>=0;let S=0;for(let z=0;z<r.length();z++){const I=r.getSection(z),B=r.getCharCode(z);if(uh[B]||(S+=Xd(B,I,o,u,t,m)),z<r.length()-1){const O=!((C=B)<11904)&&(!!Ot["CJK Compatibility Forms"](C)||!!Ot["CJK Compatibility"](C)||!!Ot["CJK Strokes"](C)||!!Ot["CJK Symbols and Punctuation"](C)||!!Ot["Enclosed CJK Letters and Months"](C)||!!Ot["Halfwidth and Fullwidth Forms"](C)||!!Ot["Ideographic Description Characters"](C)||!!Ot["Vertical Forms"](C)||Hc.test(String.fromCodePoint(C)));(Yh[B]||O||I.imageName||z!==r.length()-2&&Kf[r.getCharCode(z+1)])&&_.push(Wf(z+1,S,v,_,Yd(B,r.getCharCode(z+1),O&&b),!1))}}var C;return Kd(Wf(r.length(),S,v,_,0,!0))}function Qd(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Mp(r,t,n){const o=t.getMaxScale()*kn,{maxImageWidth:u,maxImageHeight:m}=t.getMaxImageSize(r),_=Math.max(o,m*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:_}}function hh(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function lu(r,t,n){return!(r===D.ao.horizontal||!t&&!cc(n)||t&&(uh[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Jd(r,t,n,o,u,m){const _=m[r.fontStack],v=(function(S,C,z,I){if(S&&S.rect)return S;const B=C[z.fontStack],O=B&&B[I];return O?{rect:null,metrics:O.metrics}:null})(_&&_[t],u,r,t);if(v===null)return null;let b;if(n)b=o.verticalLineContentWidth-r.scale*kn;else{const S=hh(r.verticalAlign);b=(o.horizontalLineContentHeight-r.scale*kn)*S}return{rect:v.rect,metrics:v.metrics,baselineOffset:b}}function Kh(r,t,n,o,u){const m=u[r.imageName];if(!m)return null;const _=m.paddedRect,v=m.displaySize,b={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]};let S;if(t)S=o.verticalLineContentWidth-v[1]*r.scale;else{const C=hh(r.verticalAlign);S=(o.horizontalLineContentHeight-v[1]*r.scale)*C}return{rect:_,metrics:b,baselineOffset:S,imageOffset:(t?v[0]:v[1])*r.scale-kn*n}}function ef(r,t,n,o){if(o===0)return;const u=r[n],m=(r[n].x+u.metrics.advance*u.scale)*o;for(let _=t;_<=n;_++)r[_].x-=m}function wc(r,t,n){const{horizontalAlign:o,verticalAlign:u}=Qd(n),m=t[0]-r.displaySize[0]*o,_=t[1]-r.displaySize[1]*u;return{image:r,top:_,bottom:_+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Es(r){var t,n;let o=r.left,u=r.top,m=r.right-o,_=r.bottom-u;const v=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",S=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&m/_<S||v==="proportional"){const C=Math.ceil(_*S);o*=C/m,m=C}}else if(v==="proportional"&&b==="stretchOnly"&&S!==0&&m/_>S){const C=Math.ceil(m/S);u*=C/_,_=C}return{x1:o,y1:u,x2:o+m,y2:u+_}}function cu(r,t,n,o,u,m){const _=r.image;let v;if(_.content){const q=_.content,K=_.pixelRatio||1;v=[q[0]/K,q[1]/K,_.displaySize[0]-q[2]/K,_.displaySize[1]-q[3]/K]}const b=t.left*m,S=t.right*m;let C,z,I,B;n==="width"||n==="both"?(B=u[0]+b-o[3],z=u[0]+S+o[1]):(B=u[0]+(b+S-_.displaySize[0])/2,z=B+_.displaySize[0]);const O=t.top*m,N=t.bottom*m;return n==="height"||n==="both"?(C=u[1]+O-o[0],I=u[1]+N+o[2]):(C=u[1]+(O+N-_.displaySize[1])/2,I=C+_.displaySize[1]),{image:_,top:C,right:z,bottom:I,left:B,collisionPadding:v}}const jo=128,Uo=32640;function tf(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new gi(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let _=m;for(;_<o.length&&o[_]<r+1;)_++;_=Math.min(o.length-1,_);const v=o[m],b=o[_];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:b,minSize:n.evaluate(new gi(v)),maxSize:n.evaluate(new gi(b)),interpolationType:u}}}function Wh(r,t,n){let o="never";const u=r.get(t);return u?o=u:r.get(n)&&(o="always"),o}const Qf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qh(r,t,n,o,u,m,_,v,b,S,C,z,I){const B=v?Math.min(Uo,Math.round(v[0])):0,O=v?Math.min(Uo,Math.round(v[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),m,_,(B<<1)+(b?1:0),O,16*S,16*C,256*z,256*I)}function dh(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function Jf(r){for(const t of r.sections)if(ms(t.text))return!0;return!1}class Jh{constructor(t){this.layoutVertexArray=new ht,this.indexArray=new Si,this.programConfigurations=t,this.segments=new ti,this.dynamicLayoutVertexArray=new Zt,this.opacityVertexArray=new li,this.hasVisibleVertices=!1,this.placedSymbolArray=new $}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ru.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Od.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Qf,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",Jh);class nf{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new ti,this.collisionVertexArray=new Ti}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Fd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",nf);class El{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tf(this.zoom,n["text-size"]),this.iconSizeData=tf(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=Wh(o,"text-overlap","text-allow-overlap")!=="never"||Wh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((_=>D.ao[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Jh(new bs(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Jh(new bs(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new ee,this.lineVertexArray=new Q,this.symbolInstances=new W,this.textAnchorOffsets=new le}calculateGlyphDependencies(t,n,o,u,m){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||u)&&m){const v=Rr[t.charAt(_)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],m=u.layout,_=m.get("text-font"),v=m.get("text-field"),b=m.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof Cn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),C=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!S&&!C)return;const I=n.iconDependencies,B=n.glyphDependencies,O=n.availableImages,N=new gi(this.zoom);for(const{feature:q,id:K,index:pe,sourceLayerIndex:te}of t){const oe=u._featureFilter.needGeometry,Se=Ro(q,oe);if(!u._featureFilter.filter(N,Se,o))continue;let Pe,Ve;if(oe||(Se.geometry=Po(q)),S){const $e=u.getValueAndResolveTokens("text-field",Se,o,O),it=Cn.factory($e),pt=this.hasRTLText=this.hasRTLText||Jf(it);(!pt||wa.getRTLTextPluginStatus()==="unavailable"||pt&&wa.isParsed())&&(Pe=Ud(it,u,Se))}if(C){const $e=u.getValueAndResolveTokens("icon-image",Se,o,O);Ve=$e instanceof Jn?$e:Jn.fromString($e)}if(!Pe&&!Ve)continue;const tt=this.sortFeaturesByKey?z.evaluate(Se,{},o):void 0;if(this.features.push({id:K,text:Pe,icon:Ve,index:pe,sourceLayerIndex:te,geometry:Se.geometry,properties:q.properties,type:Js.types[q.type],sortKey:tt}),Ve&&(I[Ve.name]=!0),Pe){const $e=_.evaluate(Se,{},o).join(","),it=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(D.ao.vertical)>=0;for(const pt of Pe.sections)if(pt.image)I[pt.image.name]=!0;else{const Xe=lc(Pe.toString()),We=pt.fontStack||$e,Le=B[We]=B[We]||{};this.calculateGlyphDependencies(pt.text,Le,it,this.allowVerticalPlacement,Xe)}}}m.get("symbol-placement")==="line"&&(this.features=(function(q){const K={},pe={},te=[];let oe=0;function Se($e){te.push(q[$e]),oe++}function Pe($e,it,pt){const Xe=pe[$e];return delete pe[$e],pe[it]=Xe,te[Xe].geometry[0].pop(),te[Xe].geometry[0]=te[Xe].geometry[0].concat(pt[0]),Xe}function Ve($e,it,pt){const Xe=K[it];return delete K[it],K[$e]=Xe,te[Xe].geometry[0].shift(),te[Xe].geometry[0]=pt[0].concat(te[Xe].geometry[0]),Xe}function tt($e,it,pt){const Xe=pt?it[0][it[0].length-1]:it[0][0];return`${$e}:${Xe.x}:${Xe.y}`}for(let $e=0;$e<q.length;$e++){const it=q[$e],pt=it.geometry,Xe=it.text?it.text.toString():null;if(!Xe){Se($e);continue}const We=tt(Xe,pt),Le=tt(Xe,pt,!0);if(We in pe&&Le in K&&pe[We]!==K[Le]){const vt=Ve(We,Le,pt),Mt=Pe(We,Le,te[vt].geometry);delete K[We],delete pe[Le],pe[tt(Xe,te[Mt].geometry,!0)]=Mt,te[vt].geometry=null}else We in pe?Pe(We,Le,pt):Le in K?Ve(We,Le,pt):(Se($e),K[We]=oe-1,pe[Le]=oe-1)}return te.filter(($e=>$e.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((q,K)=>q.sortKey-K.sortKey))}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const _={};for(let v=t.segment+1;v<n.length;v++)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:u},v<n.length-1&&(u+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:m},v>0&&(m+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,m,_,v,b,S,C,z,I){const B=t.indexArray,O=t.layoutVertexArray,N=t.segments.prepareSegment(4*n.length,O,B,this.canOverlap?_.sortKey:void 0),q=this.glyphOffsetArray.length,K=N.vertexLength,pe=this.allowVerticalPlacement&&v===D.ao.vertical?Math.PI/2:0,te=_.text&&_.text.sections;for(let oe=0;oe<n.length;oe++){const{tl:Se,tr:Pe,bl:Ve,br:tt,tex:$e,pixelOffsetTL:it,pixelOffsetBR:pt,minFontScaleX:Xe,minFontScaleY:We,glyphOffset:Le,isSDF:vt,sectionIndex:Mt}=n[oe],ft=N.vertexLength,dt=Le[1];Qh(O,b.x,b.y,Se.x,dt+Se.y,$e.x,$e.y,o,vt,it.x,it.y,Xe,We),Qh(O,b.x,b.y,Pe.x,dt+Pe.y,$e.x+$e.w,$e.y,o,vt,pt.x,it.y,Xe,We),Qh(O,b.x,b.y,Ve.x,dt+Ve.y,$e.x,$e.y+$e.h,o,vt,it.x,pt.y,Xe,We),Qh(O,b.x,b.y,tt.x,dt+tt.y,$e.x+$e.w,$e.y+$e.h,o,vt,pt.x,pt.y,Xe,We),dh(t.dynamicLayoutVertexArray,b,pe),B.emplaceBack(ft,ft+2,ft+1),B.emplaceBack(ft+1,ft+2,ft+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Le[0]),oe!==n.length-1&&Mt===n[oe+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,_,_.index,{imagePositions:{},canonical:I,formattedSection:te&&te[Mt]})}t.placedSymbolArray.emplaceBack(b.x,b.y,q,this.glyphOffsetArray.length-q,K,S,C,b.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],v,0,!1,0,z)}_addCollisionDebugVertex(t,n,o,u,m,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,m,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,u,m,_,v){const b=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),S=b.vertexLength,C=m.layoutVertexArray,z=m.collisionVertexArray,I=v.anchorX,B=v.anchorY;this._addCollisionDebugVertex(C,z,_,I,B,new Re(t,n)),this._addCollisionDebugVertex(C,z,_,I,B,new Re(o,n)),this._addCollisionDebugVertex(C,z,_,I,B,new Re(o,u)),this._addCollisionDebugVertex(C,z,_,I,B,new Re(t,u)),b.vertexLength+=4;const O=m.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),b.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let m=t;m<n;m++){const _=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,u?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nf(Ui,jd.members,Ri),this.iconCollisionBox=new nf(Ui,jd.members,Ri);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,m,_,v,b,S){const C={};for(let z=n;z<o;z++){const I=t.get(z);C.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},C.textFeatureIndex=I.featureIndex;break}for(let z=u;z<m;z++){const I=t.get(z);C.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},C.verticalTextFeatureIndex=I.featureIndex;break}for(let z=_;z<v;z++){const I=t.get(z);C.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},C.iconFeatureIndex=I.featureIndex;break}for(let z=b;z<S;z++){const I=t.get(z);C.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},C.verticalIconFeatureIndex=I.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<u;m+=4)t.indexArray.emplaceBack(m,m+2,m+1),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],m=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);u.push(0|Math.round(n*b.anchorX+o*b.anchorY)),m.push(b.featureIndex)}return _.sort(((v,b)=>u[v]-u[b]||m[b]-m[v])),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,m,_)=>{u>=0&&_.indexOf(u)===m&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ed,ep;st("SymbolBucket",El,{omit:["layers","collisionBoxArray","features","compareText"]}),El.MAX_GLYPHS=65535,El.addDynamicAttributes=dh;var rf={get paint(){return ep=ep||new Vn({"icon-opacity":new gt(ge.paint_symbol["icon-opacity"]),"icon-color":new gt(ge.paint_symbol["icon-color"]),"icon-halo-color":new gt(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new gt(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gt(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new gt(ge.paint_symbol["text-opacity"]),"text-color":new gt(ge.paint_symbol["text-color"],{runtimeType:mn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new gt(ge.paint_symbol["text-halo-color"]),"text-halo-width":new gt(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new gt(ge.paint_symbol["text-halo-blur"]),"text-translate":new ut(ge.paint_symbol["text-translate"]),"text-translate-anchor":new ut(ge.paint_symbol["text-translate-anchor"])})},get layout(){return ed=ed||new Vn({"symbol-placement":new ut(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gt(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ut(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ut(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new gt(ge.layout_symbol["icon-size"]),"icon-text-fit":new ut(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new gt(ge.layout_symbol["icon-image"]),"icon-rotate":new gt(ge.layout_symbol["icon-rotate"]),"icon-padding":new gt(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new gt(ge.layout_symbol["icon-offset"]),"icon-anchor":new gt(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(ge.layout_symbol["text-rotation-alignment"]),"text-field":new gt(ge.layout_symbol["text-field"]),"text-font":new gt(ge.layout_symbol["text-font"]),"text-size":new gt(ge.layout_symbol["text-size"]),"text-max-width":new gt(ge.layout_symbol["text-max-width"]),"text-line-height":new ut(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new gt(ge.layout_symbol["text-letter-spacing"]),"text-justify":new gt(ge.layout_symbol["text-justify"]),"text-radial-offset":new gt(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new gt(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new gt(ge.layout_symbol["text-anchor"]),"text-max-angle":new ut(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(ge.layout_symbol["text-writing-mode"]),"text-rotate":new gt(ge.layout_symbol["text-rotate"]),"text-padding":new ut(ge.layout_symbol["text-padding"]),"text-keep-upright":new ut(ge.layout_symbol["text-keep-upright"]),"text-transform":new gt(ge.layout_symbol["text-transform"]),"text-offset":new gt(ge.layout_symbol["text-offset"]),"text-allow-overlap":new ut(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new ut(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new ut(ge.layout_symbol["text-ignore-placement"]),"text-optional":new ut(ge.layout_symbol["text-optional"])})}};class uu{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ka,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",uu,{omit:["defaultValue"]});class td extends aa{constructor(t,n){super(t,rf,n)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const m of o)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const m=this.layout.get(t).evaluate(n,{},o,u),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||cs(_.value)||!m?m:(function(v,b){return b.replace(/{([^{}]+)}/g,((S,C)=>v&&C in v?String(v[C]):""))})(n.properties,m)}createBucket(t){return new El(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of rf.paint.overridableProperties){if(!td.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new uu(n),u=new nc(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Ns("source",u):new ll("composite",u,n.value.zoomStops),this.paint._values[t]=new Mr(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&td.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=rf.paint.properties[n];let m=!1;const _=v=>{for(const b of v)if(u.overrides&&u.overrides.hasOverride(b))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Cn)_(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const v=S=>{m||(S instanceof na&&wt(S.value)===Dr?_(S.value.sections):S instanceof fo?_(S.sections):S.eachChild(v))},b=o.value;b._styleExpression&&v(b._styleExpression.expression)}return m}}let af;var ci={get paint(){return af=af||new Vn({"background-color":new ut(ge.paint_background["background-color"]),"background-pattern":new Vu(ge.paint_background["background-pattern"]),"background-opacity":new ut(ge.paint_background["background-opacity"])})}};class sf extends aa{constructor(t,n){super(t,ci,n)}}let fh;var of={get paint(){return fh=fh||new Vn({"raster-opacity":new ut(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(ge.paint_raster["raster-saturation"]),"raster-contrast":new ut(ge.paint_raster["raster-contrast"]),"raster-resampling":new ut(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(ge.paint_raster["raster-fade-duration"])})}};class tp extends aa{constructor(t,n){super(t,of,n)}}class lf extends aa{constructor(t,n){super(t,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ph{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const id={once:!0},Cl=63710088e-1;class No{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new No(Fn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,m=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return Cl*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof No)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new No(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new No(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ip=2*Math.PI*Cl;function np(r){return ip*Math.cos(r*Math.PI/180)}function cf(r){return(180+r)/360}function uf(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function mh(r,t){return r/np(t)}function zi(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function nd(r,t){return r*np(zi(t))}class Ln{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=No.convert(t);return new Ln(cf(o.lng),uf(o.lat),mh(n,o.lat))}toLngLat(){return new No(360*this.x-180,zi(this.y))}toAltitude(){return nd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ip*(t=zi(this.y),1/Math.cos(t*Math.PI/180));var t}}function rp(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class gh{constructor(t,n,o){if(!(function(u,m,_){return!(u<0||u>25||_<0||_>=Math.pow(2,u)||m<0||m>=Math.pow(2,u))})(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=Tc(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(_=this.y,v=this.z,b=rp(256*(m=this.x),256*(_=Math.pow(2,v)-_-1),v),S=rp(256*(m+1),256*(_+1),v),b[0]+","+b[1]+","+S[0]+","+S[1]);var m,_,v,b,S;const C=(function(z,I,B){let O,N="";for(let q=z;q>0;q--)O=1<<q-1,N+=(I&O?1:0)+(B&O?2:0);return N})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Re((t.x*n-this.x)*Tt,(t.y*n-this.y)*Tt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class rd{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Tc(t,n.z,n.z,n.x,n.y)}}class Or{constructor(t,n,o,u,m){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new gh(o,+u,+m),this.key=Tc(n,t,o,u,m)}clone(){return new Or(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Or(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Or(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Tc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Tc(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-t.canonical.z;return!(n<0)&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Or(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Or(n,this.wrap,n,o,u),new Or(n,this.wrap,n,o+1,u),new Or(n,this.wrap,n,o,u+1),new Or(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Or(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Or(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new rd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ln(t.x-this.wrap,t.y))}}function Tc(r,t,n,o,u){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*u+o).toString(36)+n.toString(36)+t.toString(36)}function hu(r,t){return t?r.properties[t]:r.id}st("CanonicalTileID",gh),st("OverscaledTileID",Or,{omit:["terrainRttPosMatrix32f"]});class Vo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new Vo;return n.extend(t(new Re(this.minX,this.minY))),n.extend(t(new Re(this.maxX,this.minY))),n.extend(t(new Re(this.minX,this.maxY))),n.extend(t(new Re(this.maxX,this.maxY))),n}static fromPoints(t){const n=new Vo;for(const o of t)n.extend(o);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class ad{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ap{constructor(t,n,o,u,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class hf{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $s(Tt,16,0),this.grid3D=new $s(Tt,16,0),this.featureIndexArray=new de,this.promoteId=n}insert(t,n,o,u,m,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,m);const b=_?this.grid3D:this.grid;for(let S=0;S<n.length;S++){const C=n[S],z=[1/0,1/0,-1/0,-1/0];for(let I=0;I<C.length;I++){const B=C[I];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}z[0]<Tt&&z[1]<Tt&&z[2]>=0&&z[3]>=0&&b.insert(v,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Gf(new Zd(this.rawTileData)).layers,this.sourceLayerCoder=new ad(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const m=t.params,_=Tt/t.tileSize/t.scale,v=us(m.filter,m.globalState),b=t.queryGeometry,S=t.queryPadding*_,C=Vo.fromPoints(b),z=this.grid.query(C.minX-S,C.minY-S,C.maxX+S,C.maxY+S),I=Vo.fromPoints(t.cameraQueryGeometry).expandBy(S),B=this.grid3D.query(I.minX,I.minY,I.maxX,I.maxY,((q,K,pe,te)=>(function(oe,Se,Pe,Ve,tt){for(const it of oe)if(Se<=it.x&&Pe<=it.y&&Ve>=it.x&&tt>=it.y)return!0;const $e=[new Re(Se,Pe),new Re(Se,tt),new Re(Ve,tt),new Re(Ve,Pe)];if(oe.length>2){for(const it of $e)if(Jc(oe,it))return!0}for(let it=0;it<oe.length-1;it++)if(Ef(oe[it],oe[it+1],$e))return!0;return!1})(t.cameraQueryGeometry,q-S,K-S,pe+S,te+S)));for(const q of B)z.push(q);z.sort(op);const O={};let N;for(let q=0;q<z.length;q++){const K=z[q];if(K===N)continue;N=K;const pe=this.featureIndexArray.get(K);let te=null;this.loadMatchingFeature(O,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,v,m.layers,m.availableImages,n,o,u,((oe,Se,Pe)=>(te||(te=Po(oe)),Se.queryIntersectsFeature({queryGeometry:b,feature:oe,featureState:Pe,geometry:te,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return O}loadMatchingFeature(t,n,o,u,m,_,v,b,S,C,z){const I=this.bucketLayerIDs[n];if(_&&!I.some((q=>_.has(q))))return;const B=this.sourceLayerCoder.decode(o),O=this.vtLayers[B].feature(u);if(m.needGeometry){const q=Ro(O,!0);if(!m.filter(new gi(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!m.filter(new gi(this.tileID.overscaledZ),O))return;const N=this.getId(O,B);for(let q=0;q<I.length;q++){const K=I[q];if(_&&!_.has(K))continue;const pe=b[K];if(!pe)continue;let te={};N&&C&&(te=C.getState(pe.sourceLayer||"_geojsonTileLayer",N));const oe=si({},S[K]);oe.paint=sp(oe.paint,pe.paint,O,te,v),oe.layout=sp(oe.layout,pe.layout,O,te,v);const Se=!z||z(O,pe,te);if(!Se)continue;const Pe=new ap(O,this.z,this.x,this.y,N);Pe.layer=oe;let Ve=t[K];Ve===void 0&&(Ve=t[K]=[]),Ve.push({featureIndex:u,feature:Pe,intersectionZ:Se})}}lookupSymbolFeatures(t,n,o,u,m,_,v,b){const S={};this.loadVTLayers();const C=us(m.filterSpec,m.globalState);for(const z of t)this.loadMatchingFeature(S,o,u,z,C,_,v,b,n);return S}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function sp(r,t,n,o,u){return As(r,((m,_)=>{const v=t instanceof Ha?t.get(_):null;return v&&v.evaluate?v.evaluate(n,o,u):v}))}function op(r,t){return t-r}function lp(r,t,n,o,u){const m=[];for(let _=0;_<r.length;_++){const v=r[_];let b;for(let S=0;S<v.length-1;S++){let C=v[S],z=v[S+1];C.x<t&&z.x<t||(C.x<t?C=new Re(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x<t&&(z=new Re(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y<n&&z.y<n||(C.y<n?C=new Re(C.x+(n-C.y)/(z.y-C.y)*(z.x-C.x),n)._round():z.y<n&&(z=new Re(C.x+(n-C.y)/(z.y-C.y)*(z.x-C.x),n)._round()),C.x>=o&&z.x>=o||(C.x>=o?C=new Re(o,C.y+(o-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x>=o&&(z=new Re(o,C.y+(o-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y>=u&&z.y>=u||(C.y>=u?C=new Re(C.x+(u-C.y)/(z.y-C.y)*(z.x-C.x),u)._round():z.y>=u&&(z=new Re(C.x+(u-C.y)/(z.y-C.y)*(z.x-C.x),u)._round()),b&&C.equals(b[b.length-1])||(b=[C],m.push(b)),b.push(z)))))}}return m}st("FeatureIndex",hf,{omit:["rawTileData","sourceLayerCoder"]});class Al extends Re{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Al(this.x,this.y,this.angle,this.segment)}}function Zo(r,t,n,o,u){if(t.segment===void 0||n===0)return!0;let m=t,_=t.segment+1,v=0;for(;v>-n/2;){if(_--,_<0)return!1;v-=r[_].dist(m),m=r[_]}v+=r[_].dist(r[_+1]),_++;const b=[];let S=0;for(;v<n/2;){const C=r[_],z=r[_+1];if(!z)return!1;let I=r[_-1].angleTo(C)-C.angleTo(z);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:I}),S+=I;v-b[0].distance>o;)S-=b.shift().angleDelta;if(S>u)return!1;_++,v+=C.dist(z)}return!0}function df(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function sd(r,t,n){return r?.6*t*n:0}function cp(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Ep(r,t,n,o,u,m){const _=sd(n,u,m),v=cp(n,o)*m;let b=0;const S=df(r)/2;for(let C=0;C<r.length-1;C++){const z=r[C],I=r[C+1],B=z.dist(I);if(b+B>S){const O=(S-b)/B,N=Va.number(z.x,I.x,O),q=Va.number(z.y,I.y,O),K=new Al(N,q,I.angleTo(z),C);return K._round(),!_||Zo(r,K,v,_,t)?K:void 0}b+=B}}function ff(r,t,n,o,u,m,_,v,b){const S=sd(o,m,_),C=cp(o,u),z=C*_,I=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return t-z<t/4&&(t=z+t/4),up(r,I?t/2*v%t:(C/2+2*m)*_*v%t,t,S,n,z,I,!1,b)}function up(r,t,n,o,u,m,_,v,b){const S=m/2,C=df(r);let z=0,I=t-n,B=[];for(let O=0;O<r.length-1;O++){const N=r[O],q=r[O+1],K=N.dist(q),pe=q.angleTo(N);for(;I+n<z+K;){I+=n;const te=(I-z)/K,oe=Va.number(N.x,q.x,te),Se=Va.number(N.y,q.y,te);if(oe>=0&&oe<b&&Se>=0&&Se<b&&I-S>=0&&I+S<=C){const Pe=new Al(oe,Se,pe,O);Pe._round(),o&&!Zo(r,Pe,m,o,u)||B.push(Pe)}}z+=K}return v||B.length||_||(B=up(r,z/2,n,o,u,m,_,!0,b)),B}function Ja(r,t,n,o){const u=[],m=r.image,_=m.pixelRatio,v=m.paddedRect.w-2,b=m.paddedRect.h-2;let S={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const C=m.stretchX||[[0,v]],z=m.stretchY||[[0,b]],I=(Le,vt)=>Le+vt[1]-vt[0],B=C.reduce(I,0),O=z.reduce(I,0),N=v-B,q=b-O;let K=0,pe=B,te=0,oe=O,Se=0,Pe=N,Ve=0,tt=q;if(m.content&&o){const Le=m.content,vt=Le[2]-Le[0],Mt=Le[3]-Le[1];(m.textFitWidth||m.textFitHeight)&&(S=Es(r)),K=du(C,0,Le[0]),te=du(z,0,Le[1]),pe=du(C,Le[0],Le[2]),oe=du(z,Le[1],Le[3]),Se=Le[0]-K,Ve=Le[1]-te,Pe=vt-pe,tt=Mt-oe}const $e=S.x1,it=S.y1,pt=S.x2-$e,Xe=S.y2-it,We=(Le,vt,Mt,ft)=>{const dt=_h(Le.stretch-K,pe,pt,$e),Kt=zl(Le.fixed-Se,Pe,Le.stretch,B),ki=_h(vt.stretch-te,oe,Xe,it),Bn=zl(vt.fixed-Ve,tt,vt.stretch,O),ir=_h(Mt.stretch-K,pe,pt,$e),Fr=zl(Mt.fixed-Se,Pe,Mt.stretch,B),jr=_h(ft.stretch-te,oe,Xe,it),nr=zl(ft.fixed-Ve,tt,ft.stretch,O),Li=new Re(dt,ki),wn=new Re(ir,ki),$n=new Re(ir,jr),Tn=new Re(dt,jr),pr=new Re(Kt/_,Bn/_),Ur=new Re(Fr/_,nr/_),On=t*Math.PI/180;if(On){const i=Math.sin(On),s=Math.cos(On),c=[s,-i,i,s];Li._matMult(c),wn._matMult(c),Tn._matMult(c),$n._matMult(c)}const Jr=Le.stretch+Le.fixed,dn=vt.stretch+vt.fixed;return{tl:Li,tr:wn,bl:Tn,br:$n,tex:{x:m.paddedRect.x+1+Jr,y:m.paddedRect.y+1+dn,w:Mt.stretch+Mt.fixed-Jr,h:ft.stretch+ft.fixed-dn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pr,pixelOffsetBR:Ur,minFontScaleX:Pe/_/pt,minFontScaleY:tt/_/Xe,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const Le=pf(C,N,B),vt=pf(z,q,O);for(let Mt=0;Mt<Le.length-1;Mt++){const ft=Le[Mt],dt=Le[Mt+1];for(let Kt=0;Kt<vt.length-1;Kt++)u.push(We(ft,vt[Kt],dt,vt[Kt+1]))}}else u.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return u}function du(r,t,n){let o=0;for(const u of r)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function pf(r,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,m]of r){const _=o[o.length-1];o.push({fixed:u-_.stretch,stretch:_.stretch}),o.push({fixed:u-_.stretch,stretch:_.stretch+(m-u)})}return o.push({fixed:t+1,stretch:n}),o}function _h(r,t,n,o){return r/t*n+o}function zl(r,t,n,o){return r-t*n/o}st("Anchor",Al);class Qr{constructor(t,n,o,u,m,_,v,b,S,C){var z;if(this.boxStartIndex=t.length,S){let I=_.top,B=_.bottom;const O=_.collisionPadding;O&&(I-=O[1],B+=O[3]);let N=B-I;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const I=!((z=_.image)===null||z===void 0)&&z.content&&(_.image.textFitWidth||_.image.textFitHeight)?Es(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};I.y1=I.y1*v-b[0],I.y2=I.y2*v+b[2],I.x1=I.x1*v-b[3],I.x2=I.x2*v+b[1];const B=_.collisionPadding;if(B&&(I.x1-=B[0]*v,I.y1-=B[1]*v,I.x2+=B[2]*v,I.y2+=B[3]*v),C){const O=new Re(I.x1,I.y1),N=new Re(I.x2,I.y1),q=new Re(I.x1,I.y2),K=new Re(I.x2,I.y2),pe=C*Math.PI/180;O._rotate(pe),N._rotate(pe),q._rotate(pe),K._rotate(pe),I.x1=Math.min(O.x,N.x,q.x,K.x),I.x2=Math.max(O.x,N.x,q.x,K.x),I.y1=Math.min(O.y,N.y,q.y,K.y),I.y2=Math.max(O.y,N.y,q.y,K.y)}t.emplaceBack(n.x,n.y,I.x1,I.y1,I.x2,I.y2,o,u,m)}this.boxEndIndex=t.length}}class hp{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const m=t-1>>1,_=n[m];if(o(u,_)>=0)break;n[t]=_,t=m}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,m=n[t];for(;t<u;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(n[v],n[_])<0&&(_=v),o(n[_],m)>=0)break;n[t]=n[_],t=_}n[t]=m}}function od(r,t=1,n=!1){const o=Vo.fromPoints(r[0]),u=Math.min(o.width(),o.height());let m=u/2;const _=new hp([],Go),{minX:v,minY:b,maxX:S,maxY:C}=o;if(u===0)return new Re(v,b);for(let B=v;B<S;B+=u)for(let O=b;O<C;O+=u)_.push(new fu(B+m,O+m,m,r));let z=(function(B){let O=0,N=0,q=0;const K=B[0];for(let pe=0,te=K.length,oe=te-1;pe<te;oe=pe++){const Se=K[pe],Pe=K[oe],Ve=Se.x*Pe.y-Pe.x*Se.y;N+=(Se.x+Pe.x)*Ve,q+=(Se.y+Pe.y)*Ve,O+=3*Ve}return new fu(N/O,q/O,0,B)})(r),I=_.length;for(;_.length;){const B=_.pop();(B.d>z.d||!z.d)&&(z=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,I)),B.max-z.d<=t||(m=B.h/2,_.push(new fu(B.p.x-m,B.p.y-m,m,r)),_.push(new fu(B.p.x+m,B.p.y-m,m,r)),_.push(new fu(B.p.x-m,B.p.y+m,m,r)),_.push(new fu(B.p.x+m,B.p.y+m,m,r)),I+=4)}return n&&(console.log(`num probes: ${I}`),console.log(`best distance: ${z.d}`)),z.p}function Go(r,t){return t.max-r.max}function fu(r,t,n,o){this.p=new Re(r,t),this.h=n,this.d=(function(u,m){let _=!1,v=1/0;for(let b=0;b<m.length;b++){const S=m[b];for(let C=0,z=S.length,I=z-1;C<z;I=C++){const B=S[C],O=S[I];B.y>u.y!=O.y>u.y&&u.x<(O.x-B.x)*(u.y-B.y)/(O.y-B.y)+B.x&&(_=!_),v=Math.min(v,yd(u,B,O))}}return(_?1:-1)*Math.sqrt(v)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var fr;D.aE=void 0,(fr=D.aE||(D.aE={}))[fr.center=1]="center",fr[fr.left=2]="left",fr[fr.right=3]="right",fr[fr.top=4]="top",fr[fr.bottom=5]="bottom",fr[fr["top-left"]=6]="top-left",fr[fr["top-right"]=7]="top-right",fr[fr["bottom-left"]=8]="bottom-left",fr[fr["bottom-right"]=9]="bottom-right";const Pl=Number.POSITIVE_INFINITY;function mf(r,t){return t[1]!==Pl?(function(n,o,u){let m=0,_=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,_]})(r,t[0],t[1]):(function(n,o){let u=0,m=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(n){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=o;break;case"right":u=-o}return[u,m]})(r,t[0])}function dp(r,t,n){var o;const u=r.layout,m=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(m){const v=m.values,b=[];for(let S=0;S<v.length;S+=2){const C=b[S]=v[S],z=v[S+1].map((I=>I*kn));C.startsWith("top")?z[1]-=7:C.startsWith("bottom")&&(z[1]+=7),b[S+1]=z}return new Qn(b)}const _=u.get("text-variable-anchor");if(_){let v;v=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*kn,Pl]:u.get("text-offset").evaluate(t,{},n).map((S=>S*kn));const b=[];for(const S of _)b.push(S,mf(S,v));return new Qn(b)}return null}function gf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cp(r,t,n,o,u,m,_,v,b,S,C,z){let I=m.textMaxSize.evaluate(t,{});I===void 0&&(I=_);const B=r.layers[0].layout,O=B.get("icon-offset").evaluate(t,{},C),N=pp(n.horizontal),q=_/24,K=r.tilePixelRatio*q,pe=r.tilePixelRatio*I/24,te=r.tilePixelRatio*v,oe=r.tilePixelRatio*B.get("symbol-spacing"),Se=B.get("text-padding")*r.tilePixelRatio,Pe=(function(Mt,ft,dt,Kt=1){const ki=Mt.get("icon-padding").evaluate(ft,{},dt),Bn=ki&&ki.values;return[Bn[0]*Kt,Bn[1]*Kt,Bn[2]*Kt,Bn[3]*Kt]})(B,t,C,r.tilePixelRatio),Ve=B.get("text-max-angle")/180*Math.PI,tt=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",$e=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",it=B.get("symbol-placement"),pt=oe/2,Xe=B.get("icon-text-fit");let We;o&&Xe!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(We=cu(o,n.vertical,Xe,B.get("icon-text-fit-padding"),O,q)),N&&(o=cu(o,N,Xe,B.get("icon-text-fit-padding"),O,q)));const Le=C?z.line.getGranularityForZoomLevel(C.z):1,vt=(Mt,ft)=>{ft.x<0||ft.x>=Tt||ft.y<0||ft.y>=Tt||(function(dt,Kt,ki,Bn,ir,Fr,jr,nr,Li,wn,$n,Tn,pr,Ur,On,Jr,dn,i,s,c,p,x,M,k,V){const ae=dt.addToLineVertexArray(Kt,ki);let Ee,je,Ge,ze,De=0,Ft=0,It=0,Bi=0,xe=-1,me=-1;const we={};let Ze=xs("");if(dt.allowVerticalPlacement&&Bn.vertical){const ea=nr.layout.get("text-rotate").evaluate(p,{},k)+90;Ge=new Qr(Li,Kt,wn,$n,Tn,Bn.vertical,pr,Ur,On,ea),jr&&(ze=new Qr(Li,Kt,wn,$n,Tn,jr,dn,i,On,ea))}if(ir){const ea=nr.layout.get("icon-rotate").evaluate(p,{}),Cs=nr.layout.get("icon-text-fit")!=="none",bh=Ja(ir,ea,M,Cs),Ho=jr?Ja(jr,ea,M,Cs):void 0;je=new Qr(Li,Kt,wn,$n,Tn,ir,dn,i,!1,ea),De=4*bh.length;const wh=dt.iconSizeData;let kl=null;wh.kind==="source"?(kl=[jo*nr.layout.get("icon-size").evaluate(p,{})],kl[0]>Uo&&en(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):wh.kind==="composite"&&(kl=[jo*x.compositeIconSizes[0].evaluate(p,{},k),jo*x.compositeIconSizes[1].evaluate(p,{},k)],(kl[0]>Uo||kl[1]>Uo)&&en(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,bh,kl,c,s,p,D.ao.none,Kt,ae.lineStartIndex,ae.lineLength,-1,k),xe=dt.icon.placedSymbolArray.length-1,Ho&&(Ft=4*Ho.length,dt.addSymbols(dt.icon,Ho,kl,c,s,p,D.ao.vertical,Kt,ae.lineStartIndex,ae.lineLength,-1,k),me=dt.icon.placedSymbolArray.length-1)}const yt=Object.keys(Bn.horizontal);for(const ea of yt){const Cs=Bn.horizontal[ea];if(!Ee){Ze=xs(Cs.text);const Ho=nr.layout.get("text-rotate").evaluate(p,{},k);Ee=new Qr(Li,Kt,wn,$n,Tn,Cs,pr,Ur,On,Ho)}const bh=Cs.positionedLines.length===1;if(It+=fp(dt,Kt,Cs,Fr,nr,On,p,Jr,ae,Bn.vertical?D.ao.horizontal:D.ao.horizontalOnly,bh?yt:[ea],we,xe,x,k),bh)break}Bn.vertical&&(Bi+=fp(dt,Kt,Bn.vertical,Fr,nr,On,p,Jr,ae,D.ao.vertical,["vertical"],we,me,x,k));const ai=Ee?Ee.boxStartIndex:dt.collisionBoxArray.length,Et=Ee?Ee.boxEndIndex:dt.collisionBoxArray.length,Bt=Ge?Ge.boxStartIndex:dt.collisionBoxArray.length,mr=Ge?Ge.boxEndIndex:dt.collisionBoxArray.length,yi=je?je.boxStartIndex:dt.collisionBoxArray.length,Il=je?je.boxEndIndex:dt.collisionBoxArray.length,zp=ze?ze.boxStartIndex:dt.collisionBoxArray.length,fm=ze?ze.boxEndIndex:dt.collisionBoxArray.length;let qo=-1;const _p=(ea,Cs)=>ea&&ea.circleDiameter?Math.max(ea.circleDiameter,Cs):Cs;qo=_p(Ee,qo),qo=_p(Ge,qo),qo=_p(je,qo),qo=_p(ze,qo);const Vp=qo>-1?1:0;Vp&&(qo*=V/kn),dt.glyphOffsetArray.length>=El.MAX_GLYPHS&&en("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),p.sortKey!==void 0&&dt.addToSortKeyRanges(dt.symbolInstances.length,p.sortKey);const pm=dp(nr,p,k),[mm,gm]=(function(ea,Cs){const bh=ea.length,Ho=Cs?.values;if(Ho?.length>0)for(let wh=0;wh<Ho.length;wh+=2){const kl=Ho[wh+1];ea.emplaceBack(D.aE[Ho[wh]],kl[0],kl[1])}return[bh,ea.length]})(dt.textAnchorOffsets,pm);dt.symbolInstances.emplaceBack(Kt.x,Kt.y,we.right>=0?we.right:-1,we.center>=0?we.center:-1,we.left>=0?we.left:-1,we.vertical||-1,xe,me,Ze,ai,Et,Bt,mr,yi,Il,zp,fm,wn,It,Bi,De,Ft,Vp,0,pr,qo,mm,gm)})(r,ft,Mt,n,o,u,We,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,K,[Se,Se,Se,Se],tt,b,te,Pe,$e,O,t,m,S,C,_)};if(it==="line")for(const Mt of lp(t.geometry,0,0,Tt,Tt)){const ft=Aa(Mt,Le),dt=ff(ft,oe,Ve,n.vertical||N,o,24,pe,r.overscaling,Tt);for(const Kt of dt)N&&Ap(r,N.text,pt,Kt)||vt(ft,Kt)}else if(it==="line-center"){for(const Mt of t.geometry)if(Mt.length>1){const ft=Aa(Mt,Le),dt=Ep(ft,Ve,n.vertical||N,o,24,pe);dt&&vt(ft,dt)}}else if(t.type==="Polygon")for(const Mt of rl(t.geometry,0)){const ft=od(Mt,16);vt(Aa(Mt[0],Le,!0),new Al(ft.x,ft.y,0))}else if(t.type==="LineString")for(const Mt of t.geometry){const ft=Aa(Mt,Le);vt(ft,new Al(ft[0].x,ft[0].y,0))}else if(t.type==="Point")for(const Mt of t.geometry)for(const ft of Mt)vt([ft],new Al(ft.x,ft.y,0))}function fp(r,t,n,o,u,m,_,v,b,S,C,z,I,B,O){const N=(function(pe,te,oe,Se,Pe,Ve,tt,$e){const it=Se.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,pt=[];for(const Xe of te.positionedLines)for(const We of Xe.positionedGlyphs){if(!We.rect)continue;const Le=We.rect||{};let vt=4,Mt=!0,ft=1,dt=0;const Kt=(Pe||$e)&&We.vertical,ki=We.metrics.advance*We.scale/2;if($e&&te.verticalizable&&(dt=Xe.lineOffset/2-(We.imageName?-(kn-We.metrics.width*We.scale)/2:(We.scale-1)*kn)),We.imageName){const i=tt[We.imageName];Mt=i.sdf,ft=i.pixelRatio,vt=1/ft}const Bn=Pe?[We.x+ki,We.y]:[0,0];let ir=Pe?[0,0]:[We.x+ki+oe[0],We.y+oe[1]-dt],Fr=[0,0];Kt&&(Fr=ir,ir=[0,0]);const jr=We.metrics.isDoubleResolution?2:1,nr=(We.metrics.left-vt)*We.scale-ki+ir[0],Li=(-We.metrics.top-vt)*We.scale+ir[1],wn=nr+Le.w/jr*We.scale/ft,$n=Li+Le.h/jr*We.scale/ft,Tn=new Re(nr,Li),pr=new Re(wn,Li),Ur=new Re(nr,$n),On=new Re(wn,$n);if(Kt){const i=new Re(-ki,ki- -17),s=-Math.PI/2,c=12-ki,p=new Re(22-c,-(We.imageName?c:0)),x=new Re(...Fr);Tn._rotateAround(s,i)._add(p)._add(x),pr._rotateAround(s,i)._add(p)._add(x),Ur._rotateAround(s,i)._add(p)._add(x),On._rotateAround(s,i)._add(p)._add(x)}if(it){const i=Math.sin(it),s=Math.cos(it),c=[s,-i,i,s];Tn._matMult(c),pr._matMult(c),Ur._matMult(c),On._matMult(c)}const Jr=new Re(0,0),dn=new Re(0,0);pt.push({tl:Tn,tr:pr,bl:Ur,br:On,tex:Le,writingMode:te.writingMode,glyphOffset:Bn,sectionIndex:We.sectionIndex,isSDF:Mt,pixelOffsetTL:Jr,pixelOffsetBR:dn,minFontScaleX:0,minFontScaleY:0})}return pt})(0,n,v,u,m,_,o,r.allowVerticalPlacement),q=r.textSizeData;let K=null;q.kind==="source"?(K=[jo*u.layout.get("text-size").evaluate(_,{})],K[0]>Uo&&en(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(K=[jo*B.compositeTextSizes[0].evaluate(_,{},O),jo*B.compositeTextSizes[1].evaluate(_,{},O)],(K[0]>Uo||K[1]>Uo)&&en(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,N,K,v,m,_,S,t,b.lineStartIndex,b.lineLength,I,O);for(const pe of C)z[pe]=r.text.placedSymbolArray.length-1;return 4*N.length}function pp(r){for(const t in r)return r[t];return null}function Ap(r,t,n,o){const u=r.compareText;if(t in u){const m=u[t];for(let _=m.length-1;_>=0;_--)if(o.dist(m[_])<n)return!0}else u[t]=[];return u[t].push(o),!1}const mp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ld{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const m=mp[15&o];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new ld(v,_,m,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=mp.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Rl(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:v}=this,b=[0,m.length-1,0],S=[];for(;b.length;){const C=b.pop()||0,z=b.pop()||0,I=b.pop()||0;if(z-I<=v){for(let q=I;q<=z;q++){const K=_[2*q],pe=_[2*q+1];K>=t&&K<=o&&pe>=n&&pe<=u&&S.push(m[q])}continue}const B=I+z>>1,O=_[2*B],N=_[2*B+1];O>=t&&O<=o&&N>=n&&N<=u&&S.push(m[B]),(C===0?t<=O:n<=N)&&(b.push(I),b.push(B-1),b.push(1-C)),(C===0?o>=O:u>=N)&&(b.push(B+1),b.push(z),b.push(1-C))}return S}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:_}=this,v=[0,u.length-1,0],b=[],S=o*o;for(;v.length;){const C=v.pop()||0,z=v.pop()||0,I=v.pop()||0;if(z-I<=_){for(let q=I;q<=z;q++)Sc(m[2*q],m[2*q+1],t,n)<=S&&b.push(u[q]);continue}const B=I+z>>1,O=m[2*B],N=m[2*B+1];Sc(O,N,t,n)<=S&&b.push(u[B]),(C===0?t-o<=O:n-o<=N)&&(v.push(I),v.push(B-1),v.push(1-C)),(C===0?t+o>=O:n+o>=N)&&(v.push(B+1),v.push(z),v.push(1-C))}return b}}function Rl(r,t,n,o,u,m){if(u-o<=n)return;const _=o+u>>1;pu(r,t,_,o,u,m),Rl(r,t,n,o,_-1,1-m),Rl(r,t,n,_+1,u,1-m)}function pu(r,t,n,o,u,m){for(;u>o;){if(u-o>600){const S=u-o+1,C=n-o+1,z=Math.log(S),I=.5*Math.exp(2*z/3),B=.5*Math.sqrt(z*I*(S-I)/S)*(C-S/2<0?-1:1);pu(r,t,n,Math.max(o,Math.floor(n-C*I/S+B)),Math.min(u,Math.floor(n+(S-C)*I/S+B)),m)}const _=t[2*n+m];let v=o,b=u;for(mu(r,t,o,n),t[2*u+m]>_&&mu(r,t,o,u);v<b;){for(mu(r,t,v,b),v++,b--;t[2*v+m]<_;)v++;for(;t[2*b+m]>_;)b--}t[2*o+m]===_?mu(r,t,o,b):(b++,mu(r,t,b,u)),b<=n&&(o=b+1),n<=b&&(u=b-1)}}function mu(r,t,n,o){_f(r,n,o),_f(t,2*n,2*o),_f(t,2*n+1,2*o+1)}function _f(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function Sc(r,t,n,o){const u=r-n,m=t-o;return u*u+m*m}var Mc;D.cx=void 0,(Mc=D.cx||(D.cx={})).create="create",Mc.load="load",Mc.fullLoad="fullLoad";let yh=null,Dl=[];const vh=1e3/60,xh="loadTime",gu="fullLoadTime",gp={mark(r){performance.mark(r)},frame(r){const t=r;yh!=null&&Dl.push(t-yh),yh=t},clearMetrics(){yh=null,Dl=[],performance.clearMeasures(xh),performance.clearMeasures(gu);for(const r in D.cx)performance.clearMarks(D.cx[r])},getPerformanceMetrics(){performance.measure(xh,D.cx.create,D.cx.load),performance.measure(gu,D.cx.create,D.cx.fullLoad);const r=performance.getEntriesByName(xh)[0].duration,t=performance.getEntriesByName(gu)[0].duration,n=Dl.length,o=1/(Dl.reduce(((m,_)=>m+_),0)/n/1e3),u=Dl.filter((m=>m>vh)).reduce(((m,_)=>m+(_-vh)/vh),0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};D.$=Tt,D.A=Ct,D.B=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},D.C=Va,D.D=ut,D.E=ct,D.F=gi,D.G=ju,D.H=function(r){if(rr==null){const t=r.navigator?r.navigator.userAgent:null;rr=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return rr},D.I=su,D.J=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ph((()=>this.process())),this.subscription=ts(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Da(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise(((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),m=t?ts(t.signal,"abort",(()=>{m?.unsubscribe(),delete this.resolveRejects[u];const b={id:u,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)}),id):null;this.resolveRejects[u]={resolve:b=>{m?.unsubscribe(),n(b)},reject:b=>{m?.unsubscribe(),o(b)}};const _=[],v=Object.assign(Object.assign({},r),{id:u,sourceMapId:this.mapId,origin:location.origin,data:ba(r.data,_)});this.target.postMessage(v,{transfer:_})}))}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Da(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,(function*(){if(t.type==="<response>"){const u=this.resolveRejects[r];return delete this.resolveRejects[r],u?void(t.error?u.reject(Mo(t.error)):u.resolve(Mo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Mo(t.data),o=new AbortController;this.abortControllers[r]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,u)}catch(u){this.completeTask(r,u)}}))}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const u={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ba(t):null,data:ba(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},D.K=G,D.L=function(){var r=new Ct(16);return Ct!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},D.M=function(r,t,n){var o,u,m,_,v,b,S,C,z,I,B,O,N=n[0],q=n[1],K=n[2];return t===r?(r[12]=t[0]*N+t[4]*q+t[8]*K+t[12],r[13]=t[1]*N+t[5]*q+t[9]*K+t[13],r[14]=t[2]*N+t[6]*q+t[10]*K+t[14],r[15]=t[3]*N+t[7]*q+t[11]*K+t[15]):(u=t[1],m=t[2],_=t[3],v=t[4],b=t[5],S=t[6],C=t[7],z=t[8],I=t[9],B=t[10],O=t[11],r[0]=o=t[0],r[1]=u,r[2]=m,r[3]=_,r[4]=v,r[5]=b,r[6]=S,r[7]=C,r[8]=z,r[9]=I,r[10]=B,r[11]=O,r[12]=o*N+v*q+z*K+t[12],r[13]=u*N+b*q+I*K+t[13],r[14]=m*N+S*q+B*K+t[14],r[15]=_*N+C*q+O*K+t[15]),r},D.N=function(r,t,n){var o=n[0],u=n[1],m=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*u,r[5]=t[5]*u,r[6]=t[6]*u,r[7]=t[7]*u,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},D.O=function(r,t,n){var o=t[0],u=t[1],m=t[2],_=t[3],v=t[4],b=t[5],S=t[6],C=t[7],z=t[8],I=t[9],B=t[10],O=t[11],N=t[12],q=t[13],K=t[14],pe=t[15],te=n[0],oe=n[1],Se=n[2],Pe=n[3];return r[0]=te*o+oe*v+Se*z+Pe*N,r[1]=te*u+oe*b+Se*I+Pe*q,r[2]=te*m+oe*S+Se*B+Pe*K,r[3]=te*_+oe*C+Se*O+Pe*pe,r[4]=(te=n[4])*o+(oe=n[5])*v+(Se=n[6])*z+(Pe=n[7])*N,r[5]=te*u+oe*b+Se*I+Pe*q,r[6]=te*m+oe*S+Se*B+Pe*K,r[7]=te*_+oe*C+Se*O+Pe*pe,r[8]=(te=n[8])*o+(oe=n[9])*v+(Se=n[10])*z+(Pe=n[11])*N,r[9]=te*u+oe*b+Se*I+Pe*q,r[10]=te*m+oe*S+Se*B+Pe*K,r[11]=te*_+oe*C+Se*O+Pe*pe,r[12]=(te=n[12])*o+(oe=n[13])*v+(Se=n[14])*z+(Pe=n[15])*N,r[13]=te*u+oe*b+Se*I+Pe*q,r[14]=te*m+oe*S+Se*B+Pe*K,r[15]=te*_+oe*C+Se*O+Pe*pe,r},D.P=Re,D.Q=function(r,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in r&&(n[u]=r[u])}return n},D.R=Ar,D.S=No,D.T=dc,D.U=uf,D.V=cf,D.W=Ht,D.X=pi,D.Y=eo,D.Z=Or,D._=d,D.a=F,D.a$=Xn,D.a0=function(r,t){var n,o,u,m,_;if(!r)return t??{};if(!t)return r;let v=Object.assign({},r);if(t.removeAll&&(v={removeAll:!0}),t.remove){const b=new Set(t.remove);v.add&&(v.add=v.add.filter((C=>!b.has(C.id)))),v.update&&(v.update=v.update.filter((C=>!b.has(C.id))));const S=new Set(((n=r.add)!==null&&n!==void 0?n:[]).map((C=>C.id)));t.remove=t.remove.filter((C=>!S.has(C)))}if(t.remove){const b=new Set(v.remove?v.remove.concat(t.remove):t.remove);v.remove=Array.from(b.values())}if(t.add){const b=v.add?v.add.concat(t.add):t.add,S=new Map(b.map((C=>[C.id,C])));v.add=Array.from(S.values())}if(t.update){const b=new Map((o=v.update)===null||o===void 0?void 0:o.map((S=>[S.id,S])));for(const S of t.update){const C=(u=b.get(S.id))!==null&&u!==void 0?u:{id:S.id};S.newGeometry&&(C.newGeometry=S.newGeometry),S.addOrUpdateProperties&&(C.addOrUpdateProperties=((m=C.addOrUpdateProperties)!==null&&m!==void 0?m:[]).concat(S.addOrUpdateProperties)),S.removeProperties&&(C.removeProperties=((_=C.removeProperties)!==null&&_!==void 0?_:[]).concat(S.removeProperties)),S.removeAllProperties&&(C.removeAllProperties=!0),b.set(S.id,C)}v.update=Array.from(b.values())}return v.remove&&v.add&&(v.remove=v.remove.filter((b=>v.add.findIndex((S=>S.id===b))===-1))),v},D.a1=Ln,D.a2=Vo,D.a3=25,D.a4=gh,D.a5=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const o of r){const u=window.document.createElement("source");Me(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}}))},D.a6=He,D.a7=function(){return jn++},D.a8=U,D.a9=El,D.aA=function(r){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),u=Math.max(u,m.y);return[t,n,o,u]},D.aB=kn,D.aC=ue,D.aD=function(r,t,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const m=u?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(m){const _=Math.sin(m),v=Math.cos(m);n=[n[0]*v-n[1]*_,n[0]*_+n[1]*v]}return[u?n[0]:ue(t,n[0],r.zoom),u?n[1]:ue(t,n[1],r.zoom)]},D.aF=Wh,D.aG=gf,D.aH=Qd,D.aI=ld,D.aJ=Wi,D.aK=la,D.aL=Ce,D.aM=ti,D.aN=Si,D.aO=Fn,D.aP=Ps,D.aQ=nd,D.aR=xi,D.aS=Ji,D.aT=function(r){var t=new Ct(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},D.aU=function(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r},D.aV=function(r,t){var n=t[0],o=t[1],u=t[2],m=n*n+o*o+u*u;return m>0&&(m=1/Math.sqrt(m)),r[0]=t[0]*m,r[1]=t[1]*m,r[2]=t[2]*m,r},D.aW=on,D.aX=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},D.aY=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},D.aZ=vi,D.a_=function(r,t,n){const o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return o===0?null:(-(r[0]*n[0]+r[1]*n[1]+r[2]*n[2])-n[3])/o},D.aa=us,D.ab=Ro,D.ac=ap,D.ad=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,u,m)=>{const _=u||m;return t[o]=!_||_.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},D.ae=to,D.af=function(r){return Math.pow(2,r)},D.ag=mt,D.ah=bt,D.ai=85.051129,D.aj=mh,D.ak=function(r){return Math.log(r)/Math.LN2},D.al=function(r){var t=r[0],n=r[1];return t*t+n*n},D.am=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},D.an=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:u,minZoom:m,maxZoom:_}=r,v=u?bt(er.interpolationFactor(u,t,m,_),0,1):0;r.kind==="camera"?o=Va.number(r.minSize,r.maxSize,v):n=v}return{uSizeT:n,uSize:o}},D.ap=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return r.kind==="source"?o/jo:r.kind==="composite"?Va.number(o/jo,u/jo,n):t},D.aq=function(r,t){var n=t[0],o=t[1],u=t[2],m=t[3],_=t[4],v=t[5],b=t[6],S=t[7],C=t[8],z=t[9],I=t[10],B=t[11],O=t[12],N=t[13],q=t[14],K=t[15],pe=n*v-o*_,te=n*b-u*_,oe=n*S-m*_,Se=o*b-u*v,Pe=o*S-m*v,Ve=u*S-m*b,tt=C*N-z*O,$e=C*q-I*O,it=C*K-B*O,pt=z*q-I*N,Xe=z*K-B*N,We=I*K-B*q,Le=pe*We-te*Xe+oe*pt+Se*it-Pe*$e+Ve*tt;return Le?(r[0]=(v*We-b*Xe+S*pt)*(Le=1/Le),r[1]=(u*Xe-o*We-m*pt)*Le,r[2]=(N*Ve-q*Pe+K*Se)*Le,r[3]=(I*Pe-z*Ve-B*Se)*Le,r[4]=(b*it-_*We-S*$e)*Le,r[5]=(n*We-u*it+m*$e)*Le,r[6]=(q*oe-O*Ve-K*te)*Le,r[7]=(C*Ve-I*oe+B*te)*Le,r[8]=(_*Xe-v*it+S*tt)*Le,r[9]=(o*it-n*Xe-m*tt)*Le,r[10]=(O*Pe-N*oe+K*pe)*Le,r[11]=(z*oe-C*Pe-B*pe)*Le,r[12]=(v*$e-_*pt-b*tt)*Le,r[13]=(n*pt-o*$e+u*tt)*Le,r[14]=(N*te-O*Se-q*pe)*Le,r[15]=(C*Se-z*te+I*pe)*Le,r):null},D.ar=ot,D.as=function(r){var t=r[0],n=r[1];return Math.sqrt(t*t+n*n)},D.at=function(r){return r[0]=0,r[1]=0,r},D.au=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r},D.av=dh,D.aw=pn,D.ax=function(r,t,n,o){const u=t.y-r.y,m=t.x-r.x,_=o.y-n.y,v=o.x-n.x,b=_*m-v*u;if(b===0)return null;const S=(v*(r.y-n.y)-_*(r.x-n.x))/b;return new Re(r.x+S*m,r.y+S*u)},D.ay=lp,D.az=Zu,D.b=Ia,D.b$=class extends a{},D.b0=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r},D.b1=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},D.b2=rd,D.b3=Tc,D.b4=function(r,t,n,o,u){var m=1/Math.tan(t/2);if(r[0]=m/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0){var _=1/(o-u);r[10]=(u+o)*_,r[14]=2*u*o*_}else r[10]=-1,r[14]=-2*o;return r},D.b5=function(r){var t=new Ct(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},D.b6=function(r,t,n){var o=Math.sin(n),u=Math.cos(n),m=t[0],_=t[1],v=t[2],b=t[3],S=t[4],C=t[5],z=t[6],I=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*u+S*o,r[1]=_*u+C*o,r[2]=v*u+z*o,r[3]=b*u+I*o,r[4]=S*u-m*o,r[5]=C*u-_*o,r[6]=z*u-v*o,r[7]=I*u-b*o,r},D.b7=function(r,t,n){var o=Math.sin(n),u=Math.cos(n),m=t[4],_=t[5],v=t[6],b=t[7],S=t[8],C=t[9],z=t[10],I=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*u+S*o,r[5]=_*u+C*o,r[6]=v*u+z*o,r[7]=b*u+I*o,r[8]=S*u-m*o,r[9]=C*u-_*o,r[10]=z*u-v*o,r[11]=I*u-b*o,r},D.b8=function(){const r=new Float32Array(16);return mt(r),r},D.b9=function(){const r=new Float64Array(16);return mt(r),r},D.bA=function(r,t){const n=Ne(r,360),o=Ne(t,360),u=o-n,m=o>n?u-360:u+360;return Math.abs(u)<Math.abs(m)?u:m},D.bB=function(r){return r[0]=0,r[1]=0,r[2]=0,r},D.bC=function(r,t,n,o){const u=Math.sqrt(r*r+t*t),m=Math.sqrt(n*n+o*o);r/=u,t/=u,n/=m,o/=m;const _=Math.acos(r*n+t*o);return-t*n+r*o>0?_:-_},D.bD=function(r,t){const n=Ne(r,2*Math.PI),o=Ne(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},D.bE=function(){const r={},t=ge.$version;for(const n in ge.$root){const o=ge.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(r[n]=u)}}return r},D.bF=Gc,D.bG=se,D.bH=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},D.bI=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Xt(r[n],t[r[n].ref]));return r},D.bJ=function(r,t){if(r.type==="custom")return new lf(r,t);switch(r.type){case"background":return new sf(r,t);case"circle":return new wd(r,t);case"color-relief":return new xp(r,t);case"fill":return new ih(r,t);case"fill-extrusion":return new Bo(r,t);case"heatmap":return new Sd(r,t);case"hillshade":return new Io(r,t);case"line":return new Ml(r,t);case"raster":return new tp(r,t);case"symbol":return new td(r,t)}},D.bK=gr,D.bL=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!_t(r.version,t.version))return[{command:"setStyle",args:[t]}];_t(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),_t(r.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),_t(r.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),_t(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),_t(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),_t(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),_t(r.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),_t(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),_t(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),_t(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),_t(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),_t(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),_t(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),_t(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(_,v,b,S){let C;for(C in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(v,C)||En(C,b,S));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(_,C)?_t(_[C],v[C])||(_[C].type==="geojson"&&v[C].type==="geojson"&&Ei(_,v,C)?Lt(b,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):Pn(C,v,b,S)):bi(C,v,b))})(r.sources,t.sources,u,o);const m=[];r.layers&&r.layers.forEach((_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):m.push(_)})),n=n.concat(u),(function(_,v,b){v=v||[];const S=(_=_||[]).map(Rt),C=v.map(Rt),z=_.reduce(Gi,{}),I=v.reduce(Gi,{}),B=S.slice(),O=Object.create(null);let N,q,K,pe,te;for(let oe=0,Se=0;oe<S.length;oe++)N=S[oe],Object.prototype.hasOwnProperty.call(I,N)?Se++:(Lt(b,{command:"removeLayer",args:[N]}),B.splice(B.indexOf(N,Se),1));for(let oe=0,Se=0;oe<C.length;oe++)N=C[C.length-1-oe],B[B.length-1-oe]!==N&&(Object.prototype.hasOwnProperty.call(z,N)?(Lt(b,{command:"removeLayer",args:[N]}),B.splice(B.lastIndexOf(N,B.length-Se),1)):Se++,pe=B[B.length-oe],Lt(b,{command:"addLayer",args:[I[N],pe]}),B.splice(B.length-oe,0,N),O[N]=!0);for(let oe=0;oe<C.length;oe++)if(N=C[oe],q=z[N],K=I[N],!O[N]&&!_t(q,K))if(_t(q.source,K.source)&&_t(q["source-layer"],K["source-layer"])&&_t(q.type,K.type)){for(te in St(q.layout,K.layout,b,N,null,"setLayoutProperty"),St(q.paint,K.paint,b,N,null,"setPaintProperty"),_t(q.filter,K.filter)||Lt(b,{command:"setFilter",args:[N,K.filter]}),_t(q.minzoom,K.minzoom)&&_t(q.maxzoom,K.maxzoom)||Lt(b,{command:"setLayerZoomRange",args:[N,K.minzoom,K.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,te)&&te!=="layout"&&te!=="paint"&&te!=="filter"&&te!=="metadata"&&te!=="minzoom"&&te!=="maxzoom"&&(te.indexOf("paint.")===0?St(q[te],K[te],b,N,te.slice(6),"setPaintProperty"):_t(q[te],K[te])||Lt(b,{command:"setLayerProperty",args:[N,te,K[te]]}));for(te in K)Object.prototype.hasOwnProperty.call(K,te)&&!Object.prototype.hasOwnProperty.call(q,te)&&te!=="layout"&&te!=="paint"&&te!=="filter"&&te!=="metadata"&&te!=="minzoom"&&te!=="maxzoom"&&(te.indexOf("paint.")===0?St(q[te],K[te],b,N,te.slice(6),"setPaintProperty"):_t(q[te],K[te])||Lt(b,{command:"setLayerProperty",args:[N,te,K[te]]}))}else Lt(b,{command:"removeLayer",args:[N]}),pe=B[B.lastIndexOf(N)+1],Lt(b,{command:"addLayer",args:[K,pe]})})(m,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},D.bM=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},D.bN=As,D.bO=es,D.bP=class extends fi{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},D.bQ=an,D.bR=class extends fi{constructor(r,t){super(r,t),this.current=Kc}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},D.bS=ur,D.bT=class extends fi{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},D.bU=class extends fi{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},D.bV=ii,D.bW=function(r,t){var n=Math.sin(t),o=Math.cos(t);return r[0]=o,r[1]=n,r[2]=0,r[3]=-n,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},D.bX=function(r,t,n){var o=t[0],u=t[1],m=t[2];return r[0]=o*n[0]+u*n[3]+m*n[6],r[1]=o*n[1]+u*n[4]+m*n[7],r[2]=o*n[2]+u*n[5]+m*n[8],r},D.bY=function(r,t,n,o,u,m,_){var v=1/(t-n),b=1/(o-u),S=1/(m-_);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*S,r[11]=0,r[12]=(t+n)*v,r[13]=(u+o)*b,r[14]=(_+m)*S,r[15]=1,r},D.bZ=class extends fi{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(4*r.length);for(let n=0;n<r.length;n++)t[4*n]=r[n].r,t[4*n+1]=r[n].g,t[4*n+2]=r[n].b,t[4*n+3]=r[n].a;this.gl.uniform4fv(this.location,t)}}},D.b_=class extends fi{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(r);this.gl.uniform1fv(this.location,t)}}},D.ba=function(){return new Float64Array(16)},D.bb=function(r,t,n){const o=new Float64Array(4);return Be(o,r,t-90,n),o},D.bc=function(r,t,n,o){var u,m,_,v,b,S=t[0],C=t[1],z=t[2],I=t[3],B=n[0],O=n[1],N=n[2],q=n[3];return(m=S*B+C*O+z*N+I*q)<0&&(m=-m,B=-B,O=-O,N=-N,q=-q),1-m>zt?(u=Math.acos(m),_=Math.sin(u),v=Math.sin((1-o)*u)/_,b=Math.sin(o*u)/_):(v=1-o,b=o),r[0]=v*S+b*B,r[1]=v*C+b*O,r[2]=v*z+b*N,r[3]=v*I+b*q,r},D.bd=function(r){const t=new Float64Array(9);var n,o,u,m,_,v,b,S,C,z,I,B,O,N,q,K,pe,te;z=(u=(o=r)[0])*(b=u+u),I=(m=o[1])*b,O=(_=o[2])*b,N=_*(S=m+m),K=(v=o[3])*b,pe=v*S,te=v*(C=_+_),(n=t)[0]=1-(B=m*S)-(q=_*C),n[3]=I-te,n[6]=O+pe,n[1]=I+te,n[4]=1-z-q,n[7]=N-K,n[2]=O-pe,n[5]=N+K,n[8]=1-z-B;const oe=Ps(-Math.asin(bt(t[2],-1,1)));let Se,Pe;return Math.hypot(t[5],t[8])<.001?(Se=0,Pe=-Ps(Math.atan2(t[3],t[4]))):(Se=Ps(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Pe=Ps(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Se,pitch:oe+90,bearing:Pe}},D.be=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},D.bf=qt,D.bg=$i,D.bh=pc,D.bi=Pr,D.bj=dr,D.bk=lt,D.bl=at,D.bm=rn,D.bn=function(r,t,n,o,u){return lt(o,u,bt((r-t)/(n-t),0,1))},D.bo=Ne,D.bp=function(){return new Float64Array(3)},D.bq=function(r,t,n,o){return r[0]=t[0]+n[0]*o,r[1]=t[1]+n[1]*o,r[2]=t[2]+n[2]*o,r},D.br=Be,D.bs=function(r,t,n){var o=n[0],u=n[1],m=n[2],_=n[3],v=t[0],b=t[1],S=t[2],C=u*S-m*b,z=m*v-o*S,I=o*b-u*v;return r[0]=v+_*(C+=C)+u*(I+=I)-m*(z+=z),r[1]=b+_*z+m*C-o*I,r[2]=S+_*I+o*z-u*C,r},D.bt=function(r,t,n){const o=(u=[r[0],r[1],r[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((C=u[8])*(_=u[4])-(v=u[5])*(S=u[7]))+u[1]*(-C*(m=u[3])+v*(b=u[6]))+u[2]*(S*m-_*b);var u,m,_,v,b,S,C;if(o===0)return null;const z=on([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),I=on([],[n[0],n[1],n[2]],[r[0],r[1],r[2]]),B=on([],[r[0],r[1],r[2]],[t[0],t[1],t[2]]),O=xi([],z,-r[3]);return Ji(O,O,xi([],I,-t[3])),Ji(O,O,xi([],B,-n[3])),xi(O,O,1/o),O},D.bu=Cl,D.bv=function(){return new Float64Array(4)},D.bw=function(r,t,n,o){var u=[],m=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],m[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),m[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),m[2]=u[2],r[0]=m[0]+n[0],r[1]=m[1]+n[1],r[2]=m[2]+n[2],r},D.bx=function(r,t,n,o){var u=[],m=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],m[0]=u[0],m[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),m[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),r[0]=m[0]+n[0],r[1]=m[1]+n[1],r[2]=m[2]+n[2],r},D.by=function(r,t,n,o){var u=[],m=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],m[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),m[1]=u[1],m[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),r[0]=m[0]+n[0],r[1]=m[1]+n[1],r[2]=m[2]+n[2],r},D.bz=function(r,t,n){var o=Math.sin(n),u=Math.cos(n),m=t[0],_=t[1],v=t[2],b=t[3],S=t[8],C=t[9],z=t[10],I=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*u-S*o,r[1]=_*u-C*o,r[2]=v*u-z*o,r[3]=b*u-I*o,r[8]=m*o+S*u,r[9]=_*o+C*u,r[10]=v*o+z*u,r[11]=b*o+I*u,r},D.c=ce,D.c0=oh,D.c1=class extends h{},D.c2=Ts,D.c3=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},D.c4=Td,D.c5=function(r,t,n){var o=t[0],u=t[1],m=t[2],_=n[3]*o+n[7]*u+n[11]*m+n[15];return r[0]=(n[0]*o+n[4]*u+n[8]*m+n[12])/(_=_||1),r[1]=(n[1]*o+n[5]*u+n[9]*m+n[13])/_,r[2]=(n[2]*o+n[6]*u+n[10]*m+n[14])/_,r},D.c6=class extends _s{},D.c7=class extends R{},D.c8=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},D.c9=function(r,t){var n=r[0],o=r[1],u=r[2],m=r[3],_=r[4],v=r[5],b=r[6],S=r[7],C=r[8],z=r[9],I=r[10],B=r[11],O=r[12],N=r[13],q=r[14],K=r[15],pe=t[0],te=t[1],oe=t[2],Se=t[3],Pe=t[4],Ve=t[5],tt=t[6],$e=t[7],it=t[8],pt=t[9],Xe=t[10],We=t[11],Le=t[12],vt=t[13],Mt=t[14],ft=t[15];return Math.abs(n-pe)<=zt*Math.max(1,Math.abs(n),Math.abs(pe))&&Math.abs(o-te)<=zt*Math.max(1,Math.abs(o),Math.abs(te))&&Math.abs(u-oe)<=zt*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(m-Se)<=zt*Math.max(1,Math.abs(m),Math.abs(Se))&&Math.abs(_-Pe)<=zt*Math.max(1,Math.abs(_),Math.abs(Pe))&&Math.abs(v-Ve)<=zt*Math.max(1,Math.abs(v),Math.abs(Ve))&&Math.abs(b-tt)<=zt*Math.max(1,Math.abs(b),Math.abs(tt))&&Math.abs(S-$e)<=zt*Math.max(1,Math.abs(S),Math.abs($e))&&Math.abs(C-it)<=zt*Math.max(1,Math.abs(C),Math.abs(it))&&Math.abs(z-pt)<=zt*Math.max(1,Math.abs(z),Math.abs(pt))&&Math.abs(I-Xe)<=zt*Math.max(1,Math.abs(I),Math.abs(Xe))&&Math.abs(B-We)<=zt*Math.max(1,Math.abs(B),Math.abs(We))&&Math.abs(O-Le)<=zt*Math.max(1,Math.abs(O),Math.abs(Le))&&Math.abs(N-vt)<=zt*Math.max(1,Math.abs(N),Math.abs(vt))&&Math.abs(q-Mt)<=zt*Math.max(1,Math.abs(q),Math.abs(Mt))&&Math.abs(K-ft)<=zt*Math.max(1,Math.abs(K),Math.abs(ft))},D.cA=function(r,t){F.REGISTERED_PROTOCOLS[r]=t},D.cB=function(r){delete F.REGISTERED_PROTOCOLS[r]},D.cC=function(r,t){const n={};for(let u=0;u<r.length;u++){const m=t&&t[r[u].id]||Bu(r[u]);t&&(t[r[u].id]=m);let _=n[m];_||(_=n[m]=[]),_.push(r[u])}const o=[];for(const u in n)o.push(n[u]);return o},D.cD=st,D.cE=ad,D.cF=hf,D.cG=$d,D.cH=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Tt/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new gi(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new gi(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new gi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:C}=r.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new gi(S),r.canonical),o["text-size"].possiblyEvaluate(new gi(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:C}=r.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new gi(S),r.canonical),o["icon-size"].possiblyEvaluate(new gi(C),r.canonical)]}const m=n.get("text-line-height")*kn,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),b=n.get("text-size");for(const S of r.bucket.features){const C=n.get("text-font").evaluate(S,{},r.canonical).join(","),z=b.evaluate(S,{},r.canonical),I=u.layoutTextSize.evaluate(S,{},r.canonical),B=u.layoutIconSize.evaluate(S,{},r.canonical),O={horizontal:{},vertical:void 0},N=S.text;let q,K=[0,0];if(N){const oe=N.toString(),Se=n.get("text-letter-spacing").evaluate(S,{},r.canonical)*kn,Pe=qc(oe)?Se:0,Ve=n.get("text-anchor").evaluate(S,{},r.canonical),tt=dp(t,S,r.canonical);if(!tt){const Xe=n.get("text-radial-offset").evaluate(S,{},r.canonical);K=Xe?mf(Ve,[Xe*kn,Pl]):n.get("text-offset").evaluate(S,{},r.canonical).map((We=>We*kn))}let $e=_?"center":n.get("text-justify").evaluate(S,{},r.canonical);const it=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(S,{},r.canonical)*kn:1/0,pt=()=>{r.bucket.allowVerticalPlacement&&lc(oe)&&(O.vertical=ch(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,it,m,Ve,"left",Pe,K,D.ao.vertical,!0,I,z))};if(!_&&tt){const Xe=new Set;if($e==="auto")for(let Le=0;Le<tt.values.length;Le+=2)Xe.add(gf(tt.values[Le]));else Xe.add($e);let We=!1;for(const Le of Xe)if(!O.horizontal[Le])if(We)O.horizontal[Le]=O.horizontal[0];else{const vt=ch(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,it,m,"center",Le,Pe,K,D.ao.horizontal,!1,I,z);vt&&(O.horizontal[Le]=vt,We=vt.positionedLines.length===1)}pt()}else{$e==="auto"&&($e=gf(Ve));const Xe=ch(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,it,m,Ve,$e,Pe,K,D.ao.horizontal,!1,I,z);Xe&&(O.horizontal[$e]=Xe),pt(),lc(oe)&&_&&v&&(O.vertical=ch(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,it,m,Ve,$e,Pe,K,D.ao.vertical,!1,I,z))}}let pe=!1;if(S.icon&&S.icon.name){const oe=r.imageMap[S.icon.name];oe&&(q=wc(r.imagePositions[S.icon.name],n.get("icon-offset").evaluate(S,{},r.canonical),n.get("icon-anchor").evaluate(S,{},r.canonical)),pe=!!oe.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=pe:r.bucket.sdfIcons!==pe&&en("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const te=pp(O.horizontal)||O.vertical;r.bucket.iconsInText=!!te&&te.iconsInText,(te||q)&&Cp(r.bucket,S,O,q,r.imageMap,u,I,B,K,pe,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},D.cI=rh,D.cJ=Wa,D.cK=ui,D.cL=Gf,D.cM=Zd,D.cN=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},D.cO=function(r,t,n,o,u){return d(this,void 0,void 0,(function*(){if(pi())try{return yield eo(r,t,n,o,u)}catch{}return(function(m,_,v,b,S){const C=m.width,z=m.height;da&&zs||(da=new OffscreenCanvas(C,z),zs=da.getContext("2d",{willReadFrequently:!0})),da.width=C,da.height=z,zs.drawImage(m,0,0,C,z);const I=zs.getImageData(_,v,b,S);return zs.clearRect(0,0,C,z),I.data})(r,t,n,o,u)}))},D.cP=hn,D.cQ=Ie,D.cR=kd,D.cS=Js,D.cT=Ga,D.cU=function(r,t){const n=new Map;if(r!=null)if(r.type==="Feature")n.set(hu(r,t),r);else for(const o of r.features)n.set(hu(o,t),o);return n},D.cV=function(r,t){if(r==null)return!0;if(r.type==="Feature")return hu(r,t)!=null;if(r.type==="FeatureCollection"){const n=new Set;for(const o of r.features){const u=hu(o,t);if(u==null||n.has(u))return!1;n.add(u)}return!0}return!1},D.cW=function(r,t,n){var o,u,m,_;if(t.removeAll&&r.clear(),t.remove)for(const v of t.remove)r.delete(v);if(t.add)for(const v of t.add){const b=hu(v,n);b!=null&&r.set(b,v)}if(t.update)for(const v of t.update){let b=r.get(v.id);if(b==null)continue;const S=!v.removeAllProperties&&(((o=v.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=v.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0);if((v.newGeometry||v.removeAllProperties||S)&&(b=Object.assign({},b),r.set(v.id,b),S&&(b.properties=Object.assign({},b.properties))),v.newGeometry&&(b.geometry=v.newGeometry),v.removeAllProperties)b.properties={};else if(((m=v.removeProperties)===null||m===void 0?void 0:m.length)>0)for(const C of v.removeProperties)Object.prototype.hasOwnProperty.call(b.properties,C)&&delete b.properties[C];if(((_=v.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(const{key:C,value:z}of v.addOrUpdateProperties)b.properties[C]=z}},D.cX=wa,D.ca=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},D.cb=r=>r.type==="symbol",D.cc=r=>r.type==="circle",D.cd=r=>r.type==="heatmap",D.ce=r=>r.type==="line",D.cf=r=>r.type==="fill",D.cg=r=>r.type==="fill-extrusion",D.ch=r=>r.type==="hillshade",D.ci=r=>r.type==="color-relief",D.cj=r=>r.type==="raster",D.ck=r=>r.type==="background",D.cl=r=>r.type==="custom",D.cm=xt,D.cn=function(r,t,n){const o=At(t.x-n.x,t.y-n.y),u=At(r.x-n.x,r.y-n.y);var m,_;return Ps(Math.atan2(o[0]*u[1]-o[1]*u[0],(m=o)[0]*(_=u)[0]+m[1]*_[1]))},D.co=Jt,D.cp=function(r,t){return Mn[t]&&(r instanceof MouseEvent||r instanceof WheelEvent)},D.cq=function(r,t){return ta[t]&&"touches"in r},D.cr=function(r){return ta[r]||Mn[r]},D.cs=function(r,t,n){var o=t[0],u=t[1];return r[0]=n[0]*o+n[4]*u+n[12],r[1]=n[1]*o+n[5]*u+n[13],r},D.ct=function(r,t){const{x:n,y:o}=Ln.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},D.cu=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},D.cv=class extends ji{},D.cw=gp,D.cy=function(r){return r.message===Nr},D.cz=ie,D.d=Me,D.e=si,D.f=r=>d(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),D.g=j,D.h=r=>new Promise(((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ha}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(u):ha})),D.i=Da,D.j=(r,t)=>he(si(r,{type:"json"}),t),D.k=Oe,D.l=qe,D.m=he,D.n=(r,t)=>he(si(r,{type:"arrayBuffer"}),t),D.o=function(r){return new Zd(r).readFields(Sp,[])},D.p=xc,D.q=eu,D.r=Vn,D.s=ts,D.t=Yt,D.u=Ot,D.v=ge,D.w=en,D.x=xa,D.y=pl,D.z=To})),_e("worker",["./shared"],(function(D){class d{constructor(F,j){this.keyCache={},F&&this.replace(F,j)}replace(F,j){this._layerConfigs={},this._layers={},this.update(F,[],j)}update(F,j,G){for(const se of F){this._layerConfigs[se.id]=se;const he=this._layers[se.id]=D.bJ(se,G);he._featureFilter=D.aa(he.filter,G),this.keyCache[se.id]&&delete this.keyCache[se.id]}for(const se of j)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ie=D.cC(Object.values(this._layerConfigs),this.keyCache);for(const se of ie){const he=se.map((ct=>this._layers[ct.id])),Me=he[0];if(Me.visibility==="none")continue;const fe=Me.source||"";let ke=this.familiesBySource[fe];ke||(ke=this.familiesBySource[fe]={});const qe=Me.sourceLayer||"_geojsonTileLayer";let Oe=ke[qe];Oe||(Oe=ke[qe]=[]),Oe.push(he)}}}class Re{constructor(F){const j={},G=[];for(const Me in F){const fe=F[Me],ke=j[Me]={};for(const qe in fe){const Oe=fe[+qe];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const ct={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};G.push(ct),ke[qe]={rect:ct,metrics:Oe.metrics}}}const{w:ie,h:se}=D.p(G),he=new D.q({width:ie||1,height:se||1});for(const Me in F){const fe=F[Me];for(const ke in fe){const qe=fe[+ke];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Oe=j[Me][ke].rect;D.q.copy(qe.bitmap,he,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},qe.bitmap)}}this.image=he,this.positions=j}}D.cD("GlyphAtlas",Re);class Ie{constructor(F){this.tileID=new D.Z(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,j,G,ie,se){return D._(this,void 0,void 0,(function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new D.a8;const he=new D.cE(Object.keys(F.layers).sort()),Me=new D.cF(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const fe={},ke={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G,subdivisionGranularity:se},qe=j.familiesBySource[this.source];for(const St in qe){const Rt=F.layers[St];if(!Rt)continue;Rt.version===1&&D.w(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Gi=he.encode(St),He=[];for(let ar=0;ar<Rt.length;ar++){const tn=Rt.feature(ar),is=Me.getId(tn,St);He.push({feature:tn,id:is,index:ar,sourceLayerIndex:Gi})}for(const ar of qe[St]){const tn=ar[0];tn.source!==this.source&&D.w(`layer.source = ${tn.source} does not equal this.source = ${this.source}`),tn.minzoom&&this.zoom<Math.floor(tn.minzoom)||tn.maxzoom&&this.zoom>=tn.maxzoom||tn.visibility!=="none"&&(Ye(ar,this.zoom,G),(fe[tn.id]=tn.createBucket({index:Me.bucketLayerIDs.length,layers:ar,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Gi,sourceID:this.source})).populate(He,ke,this.tileID.canonical),Me.bucketLayerIDs.push(ar.map((is=>is.id))))}}const Oe=D.bN(ke.glyphDependencies,(St=>Object.keys(St).map(Number)));this.inFlightDependencies.forEach((St=>St?.abort())),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(Oe).length){const St=new AbortController;this.inFlightDependencies.push(St),ct=ie.sendAsync({type:"GG",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},St)}const ge=Object.keys(ke.iconDependencies);let Pt=Promise.resolve({});if(ge.length){const St=new AbortController;this.inFlightDependencies.push(St),Pt=ie.sendAsync({type:"GI",data:{icons:ge,source:this.source,tileID:this.tileID,type:"icons"}},St)}const Xt=Object.keys(ke.patternDependencies);let _t=Promise.resolve({});if(Xt.length){const St=new AbortController;this.inFlightDependencies.push(St),_t=ie.sendAsync({type:"GI",data:{icons:Xt,source:this.source,tileID:this.tileID,type:"patterns"}},St)}const[Lt,bi,En]=yield Promise.all([ct,Pt,_t]),Pn=new Re(Lt),Ei=new D.cG(bi,En);for(const St in fe){const Rt=fe[St];Rt instanceof D.a9?(Ye(Rt.layers,this.zoom,G),D.cH({bucket:Rt,glyphMap:Lt,glyphPositions:Pn.positions,imageMap:bi,imagePositions:Ei.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ke.subdivisionGranularity})):Rt.hasPattern&&(Rt instanceof D.cI||Rt instanceof D.cJ||Rt instanceof D.cK)&&(Ye(Rt.layers,this.zoom,G),Rt.addFeatures(ke,this.tileID.canonical,Ei.patternPositions))}return this.status="done",{buckets:Object.values(fe).filter((St=>!St.isEmpty())),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pn.image,imageAtlas:Ei,glyphMap:this.returnDependencies?Lt:null,iconMap:this.returnDependencies?bi:null,glyphPositions:this.returnDependencies?Pn.positions:null}}))}}function Ye(ce,F,j){const G=new D.F(F);for(const ie of ce)ie.recalculate(G,j)}class et{constructor(F,j,G){this.actor=F,this.layerIndex=j,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,j){return D._(this,void 0,void 0,(function*(){const G=yield D.n(F.request,j);try{return{vectorTile:new D.cL(new D.cM(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(ie){const se=new Uint8Array(G.data);let he=`Unable to parse the tile at ${F.request.url}, `;throw he+=se[0]===31&&se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.message}`,new Error(he)}}))}loadTile(F){return D._(this,void 0,void 0,(function*(){const j=F.uid,G=!!(F&&F.request&&F.request.collectResourceTiming)&&new D.cN(F.request),ie=new Ie(F);this.loading[j]=ie;const se=new AbortController;ie.abort=se;try{const he=yield this.loadVectorTile(F,se);if(delete this.loading[j],!he)return null;const Me=he.rawData,fe={};he.expires&&(fe.expires=he.expires),he.cacheControl&&(fe.cacheControl=he.cacheControl);const ke={};if(G){const Oe=G.finish();Oe&&(ke.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ie.vectorTile=he.vectorTile;const qe=ie.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);this.loaded[j]=ie,this.fetching[j]={rawTileData:Me,cacheControl:fe,resourceTiming:ke};try{const Oe=yield qe;return D.e({rawTileData:Me.slice(0)},Oe,fe,ke)}finally{delete this.fetching[j]}}catch(he){throw delete this.loading[j],ie.status="done",this.loaded[j]=ie,he}}))}reloadTile(F){return D._(this,void 0,void 0,(function*(){const j=F.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[j];if(G.showCollisionBoxes=F.showCollisionBoxes,G.status==="parsing"){const ie=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);let se;if(this.fetching[j]){const{rawTileData:he,cacheControl:Me,resourceTiming:fe}=this.fetching[j];delete this.fetching[j],se=D.e({rawTileData:he.slice(0)},ie,Me,fe)}else se=ie;return se}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity)}))}abortTile(F){return D._(this,void 0,void 0,(function*(){const j=this.loading,G=F.uid;j&&j[G]&&j[G].abort&&(j[G].abort.abort(),delete j[G])}))}removeTile(F){return D._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]}))}}class Ue{constructor(){this.loaded={}}loadTile(F){return D._(this,void 0,void 0,(function*(){const{uid:j,encoding:G,rawImageData:ie,redFactor:se,greenFactor:he,blueFactor:Me,baseShift:fe}=F,ke=ie.width+2,qe=ie.height+2,Oe=D.b(ie)?new D.R({width:ke,height:qe},yield D.cO(ie,-1,-1,ke,qe)):ie,ct=new D.cP(j,Oe,G,se,he,Me,fe);return this.loaded=this.loaded||{},this.loaded[j]=ct,ct}))}removeTile(F){const j=this.loaded,G=F.uid;j&&j[G]&&delete j[G]}}var ve,Nt,Gt=(function(){if(Nt)return ve;function ce(j,G){if(j.length!==0){F(j[0],G);for(var ie=1;ie<j.length;ie++)F(j[ie],!G)}}function F(j,G){for(var ie=0,se=0,he=0,Me=j.length,fe=Me-1;he<Me;fe=he++){var ke=(j[he][0]-j[fe][0])*(j[fe][1]+j[he][1]),qe=ie+ke;se+=Math.abs(ie)>=Math.abs(ke)?ie-qe+ke:ke-qe+ie,ie=qe}ie+se>=0!=!!G&&j.reverse()}return Nt=1,ve=function j(G,ie){var se,he=G&&G.type;if(he==="FeatureCollection")for(se=0;se<G.features.length;se++)j(G.features[se],ie);else if(he==="GeometryCollection")for(se=0;se<G.geometries.length;se++)j(G.geometries[se],ie);else if(he==="Feature")j(G.geometry,ie);else if(he==="Polygon")ce(G.coordinates,ie);else if(he==="MultiPolygon")for(se=0;se<G.coordinates.length;se++)ce(G.coordinates[se],ie);return G}})(),Ht=D.cQ(Gt);class pi extends D.cS{constructor(F,j){super(new D.cM,0,j,[],[]),this.feature=F,this.type=F.type,this.properties=F.tags?F.tags:{},"id"in F&&(typeof F.id=="string"?this.id=parseInt(F.id,10):typeof F.id!="number"||isNaN(F.id)||(this.id=F.id))}loadGeometry(){const F=[],j=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const G of j){const ie=[];for(const se of G)ie.push(new D.P(se[0],se[1]));F.push(ie)}return F}}class zt extends D.cR{constructor(F,j){super(new D.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=j?j.version:1,this.extent=j?j.extent:4096,this.length=F.length,this.features=F}feature(F){return new pi(this.features[F],this.extent)}}function Ct(ce,F){F.writeVarintField(15,ce.version||1),F.writeStringField(1,ce.name||""),F.writeVarintField(5,ce.extent||4096);const j={keys:[],values:[],keycache:{},valuecache:{}};for(let se=0;se<ce.length;se++)j.feature=ce.feature(se),F.writeMessage(2,ii,j);const G=j.keys;for(const se of G)F.writeStringField(3,se);const ie=j.values;for(const se of ie)F.writeMessage(4,Ji,se)}function ii(ce,F){if(!ce.feature)return;const j=ce.feature;j.id!==void 0&&F.writeVarintField(1,j.id),F.writeMessage(2,mt,ce),F.writeVarintField(3,j.type),F.writeMessage(4,Oi,j)}function mt(ce,F){for(const j in ce.feature?.properties){let G=ce.feature.properties[j],ie=ce.keycache[j];if(G===null)continue;ie===void 0&&(ce.keys.push(j),ie=ce.keys.length-1,ce.keycache[j]=ie),F.writeVarint(ie),typeof G!="string"&&typeof G!="boolean"&&typeof G!="number"&&(G=JSON.stringify(G));const se=typeof G+":"+G;let he=ce.valuecache[se];he===void 0&&(ce.values.push(G),he=ce.values.length-1,ce.valuecache[se]=he),F.writeVarint(he)}}function Qt(ce,F){return(F<<3)+(7&ce)}function vi(ce){return ce<<1^ce>>31}function Oi(ce,F){const j=ce.loadGeometry(),G=ce.type;let ie=0,se=0;for(const he of j){let Me=1;G===1&&(Me=he.length),F.writeVarint(Qt(1,Me));const fe=G===3?he.length-1:he.length;for(let ke=0;ke<fe;ke++){ke===1&&G!==1&&F.writeVarint(Qt(2,fe-1));const qe=he[ke].x-ie,Oe=he[ke].y-se;F.writeVarint(vi(qe)),F.writeVarint(vi(Oe)),ie+=qe,se+=Oe}ce.type===3&&F.writeVarint(Qt(7,1))}}function Ji(ce,F){const j=typeof ce;j==="string"?F.writeStringField(1,ce):j==="boolean"?F.writeBooleanField(7,ce):j==="number"&&(ce%1!=0?F.writeDoubleField(3,ce):ce<0?F.writeSVarintField(6,ce):F.writeVarintField(5,ce))}const xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},on=Math.fround||(ri=new Float32Array(1),ce=>(ri[0]=+ce,ri[0]));var ri;class Xn{constructor(F){this.options=Object.assign(Object.create(xi),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:j,minZoom:G,maxZoom:ie}=this.options;j&&console.time("total time");const se=`prepare ${F.length} points`;j&&console.time(se),this.points=F;const he=[];for(let fe=0;fe<F.length;fe++){const ke=F[fe];if(!ke.geometry)continue;const[qe,Oe]=ke.geometry.coordinates,ct=on(Be(qe)),ge=on(ot(Oe));he.push(ct,ge,1/0,fe,-1,1),this.options.reduce&&he.push(0)}let Me=this.trees[ie+1]=this._createTree(he);j&&console.timeEnd(se);for(let fe=ie;fe>=G;fe--){const ke=+Date.now();Me=this.trees[fe]=this._createTree(this._cluster(Me,fe)),j&&console.log("z%d: %d clusters in %dms",fe,Me.numItems,+Date.now()-ke)}return j&&console.timeEnd("total time"),this}getClusters(F,j){let G=((F[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,F[1]));let se=F[2]===180?180:((F[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)G=-180,se=180;else if(G>se){const Oe=this.getClusters([G,ie,180,he],j),ct=this.getClusters([-180,ie,se,he],j);return Oe.concat(ct)}const Me=this.trees[this._limitZoom(j)],fe=Me.range(Be(G),ot(he),Be(se),ot(ie)),ke=Me.data,qe=[];for(const Oe of fe){const ct=this.stride*Oe;qe.push(ke[ct+5]>1?pn(ke,ct,this.clusterProps):this.points[ke[ct+3]])}return qe}getChildren(F){const j=this._getOriginId(F),G=this._getOriginZoom(F),ie="No cluster with the specified id.",se=this.trees[G];if(!se)throw new Error(ie);const he=se.data;if(j*this.stride>=he.length)throw new Error(ie);const Me=this.options.radius/(this.options.extent*Math.pow(2,G-1)),fe=se.within(he[j*this.stride],he[j*this.stride+1],Me),ke=[];for(const qe of fe){const Oe=qe*this.stride;he[Oe+4]===F&&ke.push(he[Oe+5]>1?pn(he,Oe,this.clusterProps):this.points[he[Oe+3]])}if(ke.length===0)throw new Error(ie);return ke}getLeaves(F,j,G){const ie=[];return this._appendLeaves(ie,F,j=j||10,G=G||0,0),ie}getTile(F,j,G){const ie=this.trees[this._limitZoom(F)],se=Math.pow(2,F),{extent:he,radius:Me}=this.options,fe=Me/he,ke=(G-fe)/se,qe=(G+1+fe)/se,Oe={features:[]};return this._addTileFeatures(ie.range((j-fe)/se,ke,(j+1+fe)/se,qe),ie.data,j,G,se,Oe),j===0&&this._addTileFeatures(ie.range(1-fe/se,ke,1,qe),ie.data,se,G,se,Oe),j===se-1&&this._addTileFeatures(ie.range(0,ke,fe/se,qe),ie.data,-1,G,se,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(F){let j=this._getOriginZoom(F)-1;for(;j<=this.options.maxZoom;){const G=this.getChildren(F);if(j++,G.length!==1)break;F=G[0].properties.cluster_id}return j}_appendLeaves(F,j,G,ie,se){const he=this.getChildren(j);for(const Me of he){const fe=Me.properties;if(fe&&fe.cluster?se+fe.point_count<=ie?se+=fe.point_count:se=this._appendLeaves(F,fe.cluster_id,G,ie,se):se<ie?se++:F.push(Me),F.length===G)break}return se}_createTree(F){const j=new D.aI(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<F.length;G+=this.stride)j.add(F[G],F[G+1]);return j.finish(),j.data=F,j}_addTileFeatures(F,j,G,ie,se,he){for(const Me of F){const fe=Me*this.stride,ke=j[fe+5]>1;let qe,Oe,ct;if(ke)qe=Zi(j,fe,this.clusterProps),Oe=j[fe],ct=j[fe+1];else{const Xt=this.points[j[fe+3]];qe=Xt.properties;const[_t,Lt]=Xt.geometry.coordinates;Oe=Be(_t),ct=ot(Lt)}const ge={type:1,geometry:[[Math.round(this.options.extent*(Oe*se-G)),Math.round(this.options.extent*(ct*se-ie))]],tags:qe};let Pt;Pt=ke||this.options.generateId?j[fe+3]:this.points[j[fe+3]].id,Pt!==void 0&&(ge.id=Pt),he.features.push(ge)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,j){const{radius:G,extent:ie,reduce:se,minPoints:he}=this.options,Me=G/(ie*Math.pow(2,j)),fe=F.data,ke=[],qe=this.stride;for(let Oe=0;Oe<fe.length;Oe+=qe){if(fe[Oe+2]<=j)continue;fe[Oe+2]=j;const ct=fe[Oe],ge=fe[Oe+1],Pt=F.within(fe[Oe],fe[Oe+1],Me),Xt=fe[Oe+5];let _t=Xt;for(const Lt of Pt){const bi=Lt*qe;fe[bi+2]>j&&(_t+=fe[bi+5])}if(_t>Xt&&_t>=he){let Lt,bi=ct*Xt,En=ge*Xt,Pn=-1;const Ei=(Oe/qe<<5)+(j+1)+this.points.length;for(const St of Pt){const Rt=St*qe;if(fe[Rt+2]<=j)continue;fe[Rt+2]=j;const Gi=fe[Rt+5];bi+=fe[Rt]*Gi,En+=fe[Rt+1]*Gi,fe[Rt+4]=Ei,se&&(Lt||(Lt=this._map(fe,Oe,!0),Pn=this.clusterProps.length,this.clusterProps.push(Lt)),se(Lt,this._map(fe,Rt)))}fe[Oe+4]=Ei,ke.push(bi/_t,En/_t,1/0,Ei,-1,_t),se&&ke.push(Pn)}else{for(let Lt=0;Lt<qe;Lt++)ke.push(fe[Oe+Lt]);if(_t>1)for(const Lt of Pt){const bi=Lt*qe;if(!(fe[bi+2]<=j)){fe[bi+2]=j;for(let En=0;En<qe;En++)ke.push(fe[bi+En])}}}}return ke}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,j,G){if(F[j+5]>1){const he=this.clusterProps[F[j+6]];return G?Object.assign({},he):he}const ie=this.points[F[j+3]].properties,se=this.options.map(ie);return G&&se===ie?Object.assign({},se):se}}function pn(ce,F,j){return{type:"Feature",id:ce[F+3],properties:Zi(ce,F,j),geometry:{type:"Point",coordinates:[(G=ce[F],360*(G-.5)),At(ce[F+1])]}};var G}function Zi(ce,F,j){const G=ce[F+5],ie=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,se=ce[F+6],he=se===-1?{}:Object.assign({},j[se]);return Object.assign(he,{cluster:!0,cluster_id:ce[F+3],point_count:G,point_count_abbreviated:ie})}function Be(ce){return ce/360+.5}function ot(ce){const F=Math.sin(ce*Math.PI/180),j=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return j<0?0:j>1?1:j}function At(ce){const F=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Tt(ce,F,j,G){let ie=G;const se=F+(j-F>>1);let he,Me=j-F;const fe=ce[F],ke=ce[F+1],qe=ce[j],Oe=ce[j+1];for(let ct=F+3;ct<j;ct+=3){const ge=ue(ce[ct],ce[ct+1],fe,ke,qe,Oe);if(ge>ie)he=ct,ie=ge;else if(ge===ie){const Pt=Math.abs(ct-se);Pt<Me&&(he=ct,Me=Pt)}}ie>G&&(he-F>3&&Tt(ce,F,he,G),ce[he+2]=ie,j-he>3&&Tt(ce,he,j,G))}function ue(ce,F,j,G,ie,se){let he=ie-j,Me=se-G;if(he!==0||Me!==0){const fe=((ce-j)*he+(F-G)*Me)/(he*he+Me*Me);fe>1?(j=ie,G=se):fe>0&&(j+=he*fe,G+=Me*fe)}return he=ce-j,Me=F-G,he*he+Me*Me}function Ne(ce,F,j,G){const ie={id:ce??null,type:F,geometry:j,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(F==="Point"||F==="MultiPoint"||F==="LineString")lt(ie,j);else if(F==="Polygon")lt(ie,j[0]);else if(F==="MultiLineString")for(const se of j)lt(ie,se);else if(F==="MultiPolygon")for(const se of j)lt(ie,se[0]);return ie}function lt(ce,F){for(let j=0;j<F.length;j+=3)ce.minX=Math.min(ce.minX,F[j]),ce.minY=Math.min(ce.minY,F[j+1]),ce.maxX=Math.max(ce.maxX,F[j]),ce.maxY=Math.max(ce.maxY,F[j+1])}function at(ce,F,j,G){if(!F.geometry)return;const ie=F.geometry.coordinates;if(ie&&ie.length===0)return;const se=F.geometry.type,he=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let Me=[],fe=F.id;if(j.promoteId?fe=F.properties[j.promoteId]:j.generateId&&(fe=G||0),se==="Point")xt(ie,Me);else if(se==="MultiPoint")for(const ke of ie)xt(ke,Me);else if(se==="LineString")Jt(ie,Me,he,!1);else if(se==="MultiLineString"){if(j.lineMetrics){for(const ke of ie)Me=[],Jt(ke,Me,he,!1),ce.push(Ne(fe,"LineString",Me,F.properties));return}bt(ie,Me,he,!1)}else if(se==="Polygon")bt(ie,Me,he,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(const ke of F.geometry.geometries)at(ce,{id:fe,geometry:ke,properties:F.properties},j,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of ie){const qe=[];bt(ke,qe,he,!0),Me.push(qe)}}ce.push(Ne(fe,se,Me,F.properties))}function xt(ce,F){F.push(Fn(ce[0]),si(ce[1]),0)}function Jt(ce,F,j,G){let ie,se,he=0;for(let fe=0;fe<ce.length;fe++){const ke=Fn(ce[fe][0]),qe=si(ce[fe][1]);F.push(ke,qe,0),fe>0&&(he+=G?(ie*qe-ke*se)/2:Math.sqrt(Math.pow(ke-ie,2)+Math.pow(qe-se,2))),ie=ke,se=qe}const Me=F.length-3;F[2]=1,Tt(F,0,Me,j),F[Me+2]=1,F.size=Math.abs(he),F.start=0,F.end=F.size}function bt(ce,F,j,G){for(let ie=0;ie<ce.length;ie++){const se=[];Jt(ce[ie],se,j,G),F.push(se)}}function Fn(ce){return ce/360+.5}function si(ce){const F=Math.sin(ce*Math.PI/180),j=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return j<0?0:j>1?1:j}function jn(ce,F,j,G,ie,se,he,Me){if(G/=F,se>=(j/=F)&&he<G)return ce;if(he<j||se>=G)return null;const fe=[];for(const ke of ce){const qe=ke.geometry;let Oe=ke.type;const ct=ie===0?ke.minX:ke.minY,ge=ie===0?ke.maxX:ke.maxY;if(ct>=j&&ge<G){fe.push(ke);continue}if(ge<j||ct>=G)continue;let Pt=[];if(Oe==="Point"||Oe==="MultiPoint")As(qe,Pt,j,G,ie);else if(Oe==="LineString")es(qe,Pt,j,G,ie,!1,Me.lineMetrics);else if(Oe==="MultiLineString")Yi(qe,Pt,j,G,ie,!1);else if(Oe==="Polygon")Yi(qe,Pt,j,G,ie,!0);else if(Oe==="MultiPolygon")for(const Xt of qe){const _t=[];Yi(Xt,_t,j,G,ie,!0),_t.length&&Pt.push(_t)}if(Pt.length){if(Me.lineMetrics&&Oe==="LineString"){for(const Xt of Pt)fe.push(Ne(ke.id,Oe,Xt,ke.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(Pt.length===1?(Oe="LineString",Pt=Pt[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=Pt.length===3?"Point":"MultiPoint"),fe.push(Ne(ke.id,Oe,Pt,ke.tags))}}return fe.length?fe:null}function As(ce,F,j,G,ie){for(let se=0;se<ce.length;se+=3){const he=ce[se+ie];he>=j&&he<=G&&en(F,ce[se],ce[se+1],ce[se+2])}}function es(ce,F,j,G,ie,se,he){let Me=gr(ce);const fe=ie===0?ua:Da;let ke,qe,Oe=ce.start;for(let _t=0;_t<ce.length-3;_t+=3){const Lt=ce[_t],bi=ce[_t+1],En=ce[_t+2],Pn=ce[_t+3],Ei=ce[_t+4],St=ie===0?Lt:bi,Rt=ie===0?Pn:Ei;let Gi=!1;he&&(ke=Math.sqrt(Math.pow(Lt-Pn,2)+Math.pow(bi-Ei,2))),St<j?Rt>j&&(qe=fe(Me,Lt,bi,Pn,Ei,j),he&&(Me.start=Oe+ke*qe)):St>G?Rt<G&&(qe=fe(Me,Lt,bi,Pn,Ei,G),he&&(Me.start=Oe+ke*qe)):en(Me,Lt,bi,En),Rt<j&&St>=j&&(qe=fe(Me,Lt,bi,Pn,Ei,j),Gi=!0),Rt>G&&St<=G&&(qe=fe(Me,Lt,bi,Pn,Ei,G),Gi=!0),!se&&Gi&&(he&&(Me.end=Oe+ke*qe),F.push(Me),Me=gr(ce)),he&&(Oe+=ke)}let ct=ce.length-3;const ge=ce[ct],Pt=ce[ct+1],Xt=ie===0?ge:Pt;Xt>=j&&Xt<=G&&en(Me,ge,Pt,ce[ct+2]),ct=Me.length-3,se&&ct>=3&&(Me[ct]!==Me[0]||Me[ct+1]!==Me[1])&&en(Me,Me[0],Me[1],Me[2]),Me.length&&F.push(Me)}function gr(ce){const F=[];return F.size=ce.size,F.start=ce.start,F.end=ce.end,F}function Yi(ce,F,j,G,ie,se){for(const he of ce)es(he,F,j,G,ie,se,!1)}function en(ce,F,j,G){ce.push(F,j,G)}function ua(ce,F,j,G,ie,se){const he=(se-F)/(G-F);return en(ce,se,j+(ie-j)*he,1),he}function Da(ce,F,j,G,ie,se){const he=(se-j)/(ie-j);return en(ce,F+(G-F)*he,se,1),he}function rr(ce,F){const j=[];for(let G=0;G<ce.length;G++){const ie=ce[G],se=ie.type;let he;if(se==="Point"||se==="MultiPoint"||se==="LineString")he=Ia(ie.geometry,F);else if(se==="MultiLineString"||se==="Polygon"){he=[];for(const Me of ie.geometry)he.push(Ia(Me,F))}else if(se==="MultiPolygon"){he=[];for(const Me of ie.geometry){const fe=[];for(const ke of Me)fe.push(Ia(ke,F));he.push(fe)}}j.push(Ne(ie.id,se,he,ie.tags))}return j}function Ia(ce,F){const j=[];j.size=ce.size,ce.start!==void 0&&(j.start=ce.start,j.end=ce.end);for(let G=0;G<ce.length;G+=3)j.push(ce[G]+F,ce[G+1],ce[G+2]);return j}function ha(ce,F){if(ce.transformed)return ce;const j=1<<ce.z,G=ce.x,ie=ce.y;for(const se of ce.features){const he=se.geometry,Me=se.type;if(se.geometry=[],Me===1)for(let fe=0;fe<he.length;fe+=2)se.geometry.push(eo(he[fe],he[fe+1],F,j,G,ie));else for(let fe=0;fe<he.length;fe++){const ke=[];for(let qe=0;qe<he[fe].length;qe+=2)ke.push(eo(he[fe][qe],he[fe][qe+1],F,j,G,ie));se.geometry.push(ke)}}return ce.transformed=!0,ce}function eo(ce,F,j,G,ie,se){return[Math.round(j*(ce*G-ie)),Math.round(j*(F*G-se))]}function da(ce,F,j,G,ie){const se=F===ie.maxZoom?0:ie.tolerance/((1<<F)*ie.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:ce.length,source:null,x:j,y:G,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Me of ce)zs(he,Me,se,ie);return he}function zs(ce,F,j,G){const ie=F.geometry,se=F.type,he=[];if(ce.minX=Math.min(ce.minX,F.minX),ce.minY=Math.min(ce.minY,F.minY),ce.maxX=Math.max(ce.maxX,F.maxX),ce.maxY=Math.max(ce.maxY,F.maxY),se==="Point"||se==="MultiPoint")for(let Me=0;Me<ie.length;Me+=3)he.push(ie[Me],ie[Me+1]),ce.numPoints++,ce.numSimplified++;else if(se==="LineString")ts(he,ie,ce,j,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(let Me=0;Me<ie.length;Me++)ts(he,ie[Me],ce,j,se==="Polygon",Me===0);else if(se==="MultiPolygon")for(let Me=0;Me<ie.length;Me++){const fe=ie[Me];for(let ke=0;ke<fe.length;ke++)ts(he,fe[ke],ce,j,!0,ke===0)}if(he.length){let Me=F.tags||null;if(se==="LineString"&&G.lineMetrics){Me={};for(const ke in F.tags)Me[ke]=F.tags[ke];Me.mapbox_clip_start=ie.start/ie.size,Me.mapbox_clip_end=ie.end/ie.size}const fe={geometry:he,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:Me};F.id!==null&&(fe.id=F.id),ce.features.push(fe)}}function ts(ce,F,j,G,ie,se){const he=G*G;if(G>0&&F.size<(ie?he:G))return void(j.numPoints+=F.length/3);const Me=[];for(let fe=0;fe<F.length;fe+=3)(G===0||F[fe+2]>he)&&(j.numSimplified++,Me.push(F[fe],F[fe+1])),j.numPoints++;ie&&(function(fe,ke){let qe=0;for(let Oe=0,ct=fe.length,ge=ct-2;Oe<ct;ge=Oe,Oe+=2)qe+=(fe[Oe]-fe[ge])*(fe[Oe+1]+fe[ge+1]);if(qe>0===ke)for(let Oe=0,ct=fe.length;Oe<ct/2;Oe+=2){const ge=fe[Oe],Pt=fe[Oe+1];fe[Oe]=fe[ct-2-Oe],fe[Oe+1]=fe[ct-1-Oe],fe[ct-2-Oe]=ge,fe[ct-1-Oe]=Pt}})(Me,se),ce.push(Me)}const to={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ps{constructor(F,j){const G=(j=this.options=(function(se,he){for(const Me in he)se[Me]=he[Me];return se})(Object.create(to),j)).debug;if(G&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let ie=(function(se,he){const Me=[];if(se.type==="FeatureCollection")for(let fe=0;fe<se.features.length;fe++)at(Me,se.features[fe],he,fe);else at(Me,se.type==="Feature"?se:{geometry:se},he);return Me})(F,j);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=(function(se,he){const Me=he.buffer/he.extent;let fe=se;const ke=jn(se,1,-1-Me,Me,0,-1,2,he),qe=jn(se,1,1-Me,2+Me,0,-1,2,he);return(ke||qe)&&(fe=jn(se,1,-Me,1+Me,0,-1,2,he)||[],ke&&(fe=rr(ke,1).concat(fe)),qe&&(fe=fe.concat(rr(qe,-1)))),fe})(ie,j),ie.length&&this.splitTile(ie,0,0,0),G&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(F,j,G,ie,se,he,Me){const fe=[F,j,G,ie],ke=this.options,qe=ke.debug;for(;fe.length;){ie=fe.pop(),G=fe.pop(),j=fe.pop(),F=fe.pop();const Oe=1<<j,ct=ta(j,G,ie);let ge=this.tiles[ct];if(!ge&&(qe>1&&console.time("creation"),ge=this.tiles[ct]=da(F,j,G,ie,ke),this.tileCoords.push({z:j,x:G,y:ie}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,G,ie,ge.numFeatures,ge.numPoints,ge.numSimplified),console.timeEnd("creation"));const Gi=`z${j}`;this.stats[Gi]=(this.stats[Gi]||0)+1,this.total++}if(ge.source=F,se==null){if(j===ke.indexMaxZoom||ge.numPoints<=ke.indexMaxPoints)continue}else{if(j===ke.maxZoom||j===se)continue;if(se!=null){const Gi=se-j;if(G!==he>>Gi||ie!==Me>>Gi)continue}}if(ge.source=null,F.length===0)continue;qe>1&&console.time("clipping");const Pt=.5*ke.buffer/ke.extent,Xt=.5-Pt,_t=.5+Pt,Lt=1+Pt;let bi=null,En=null,Pn=null,Ei=null,St=jn(F,Oe,G-Pt,G+_t,0,ge.minX,ge.maxX,ke),Rt=jn(F,Oe,G+Xt,G+Lt,0,ge.minX,ge.maxX,ke);F=null,St&&(bi=jn(St,Oe,ie-Pt,ie+_t,1,ge.minY,ge.maxY,ke),En=jn(St,Oe,ie+Xt,ie+Lt,1,ge.minY,ge.maxY,ke),St=null),Rt&&(Pn=jn(Rt,Oe,ie-Pt,ie+_t,1,ge.minY,ge.maxY,ke),Ei=jn(Rt,Oe,ie+Xt,ie+Lt,1,ge.minY,ge.maxY,ke),Rt=null),qe>1&&console.timeEnd("clipping"),fe.push(bi||[],j+1,2*G,2*ie),fe.push(En||[],j+1,2*G,2*ie+1),fe.push(Pn||[],j+1,2*G+1,2*ie),fe.push(Ei||[],j+1,2*G+1,2*ie+1)}}getTile(F,j,G){F=+F,j=+j,G=+G;const ie=this.options,{extent:se,debug:he}=ie;if(F<0||F>24)return null;const Me=1<<F,fe=ta(F,j=j+Me&Me-1,G);if(this.tiles[fe])return ha(this.tiles[fe],se);he>1&&console.log("drilling down to z%d-%d-%d",F,j,G);let ke,qe=F,Oe=j,ct=G;for(;!ke&&qe>0;)qe--,Oe>>=1,ct>>=1,ke=this.tiles[ta(qe,Oe,ct)];return ke&&ke.source?(he>1&&(console.log("found parent tile z%d-%d-%d",qe,Oe,ct),console.time("drilling down")),this.splitTile(ke.source,qe,Oe,ct,F,j,G),he>1&&console.timeEnd("drilling down"),this.tiles[fe]?ha(this.tiles[fe],se):null):null}}function ta(ce,F,j){return 32*((1<<ce)*j+F)+ce}class Mn extends et{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,j){return D._(this,void 0,void 0,(function*(){const G=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ie=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!ie)return null;const se=new zt(ie.features,{version:2,extent:D.$});let he=(function(Me){const fe=new D.cM;return(function(ke,qe){for(const Oe in ke.layers)qe.writeMessage(3,Ct,ke.layers[Oe])})(Me,fe),fe.finish()})(se);return he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),{vectorTile:se,rawData:he.buffer}}))}loadData(F){return D._(this,void 0,void 0,(function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const G=!!(F&&F.request&&F.request.collectResourceTiming)&&new D.cN(F.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(F,this._pendingRequest);const ie=yield this._pendingData;this._geoJSONIndex=F.cluster?new Xn((function({superclusterOptions:he,clusterProperties:Me}){if(!Me||!he)return he;const fe={},ke={},qe={accumulated:null,zoom:0},Oe={properties:null},ct=Object.keys(Me);for(const ge of ct){const[Pt,Xt]=Me[ge],_t=D.cT(Xt),Lt=D.cT(typeof Pt=="string"?[Pt,["accumulated"],["get",ge]]:Pt);fe[ge]=_t.value,ke[ge]=Lt.value}return he.map=ge=>{Oe.properties=ge;const Pt={};for(const Xt of ct)Pt[Xt]=fe[Xt].evaluate(qe,Oe);return Pt},he.reduce=(ge,Pt)=>{Oe.properties=Pt;for(const Xt of ct)qe.accumulated=ge[Xt],ge[Xt]=ke[Xt].evaluate(qe,Oe)},he})(F)).load(ie.features):(function(he,Me){return new Ps(he,Me)})(ie,F.geojsonVtOptions),this.loaded={};const se={data:ie};if(G){const he=G.finish();he&&(se.resourceTiming={},se.resourceTiming[F.source]=JSON.parse(JSON.stringify(he)))}return se}catch(ie){if(delete this._pendingRequest,D.cy(ie))return{abandoned:!0};throw ie}}))}getData(){return D._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(F){const j=this.loaded;return j&&j[F.uid]?super.reloadTile(F):this.loadTile(F)}loadAndProcessGeoJSON(F,j){return D._(this,void 0,void 0,(function*(){let G=yield this.loadGeoJSON(F,j);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(Ht(G,!0),F.filter){const ie=D.cT(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map((he=>`${he.key}: ${he.message}`)).join(", "));G={type:"FeatureCollection",features:G.features.filter((he=>ie.value.evaluate({zoom:0},he)))}}return G}))}loadGeoJSON(F,j){return D._(this,void 0,void 0,(function*(){const{promoteId:G}=F;if(F.request){const ie=yield D.j(F.request,j);return this._dataUpdateable=D.cV(ie.data,G)?D.cU(ie.data,G):void 0,ie.data}if(typeof F.data=="string")try{const ie=JSON.parse(F.data);return this._dataUpdateable=D.cV(ie,G)?D.cU(ie,G):void 0,ie}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return D.cW(this._dataUpdateable,F.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(F){return D._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class Nr{constructor(F){this.self=F,this.actor=new D.J(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(j,G)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=G},this.self.addProtocol=D.cA,this.self.removeProtocol=D.cB,this.self.registerRTLTextPlugin=j=>{D.cX.setMethods(j)},this.actor.registerMessageHandler("LDT",((j,G)=>this._getDEMWorkerSource(j,G.source).loadTile(G))),this.actor.registerMessageHandler("RDT",((j,G)=>D._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(j,G.source).removeTile(G)})))),this.actor.registerMessageHandler("GCEZ",((j,G)=>D._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,G.type,G.source).getClusterExpansionZoom(G)})))),this.actor.registerMessageHandler("GCC",((j,G)=>D._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,G.type,G.source).getClusterChildren(G)})))),this.actor.registerMessageHandler("GCL",((j,G)=>D._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,G.type,G.source).getClusterLeaves(G)})))),this.actor.registerMessageHandler("LD",((j,G)=>this._getWorkerSource(j,G.type,G.source).loadData(G))),this.actor.registerMessageHandler("GD",((j,G)=>this._getWorkerSource(j,G.type,G.source).getData())),this.actor.registerMessageHandler("LT",((j,G)=>this._getWorkerSource(j,G.type,G.source).loadTile(G))),this.actor.registerMessageHandler("RT",((j,G)=>this._getWorkerSource(j,G.type,G.source).reloadTile(G))),this.actor.registerMessageHandler("AT",((j,G)=>this._getWorkerSource(j,G.type,G.source).abortTile(G))),this.actor.registerMessageHandler("RMT",((j,G)=>this._getWorkerSource(j,G.type,G.source).removeTile(G))),this.actor.registerMessageHandler("RS",((j,G)=>D._(this,void 0,void 0,(function*(){if(!this.workerSources[j]||!this.workerSources[j][G.type]||!this.workerSources[j][G.type][G.source])return;const ie=this.workerSources[j][G.type][G.source];delete this.workerSources[j][G.type][G.source],ie.removeSource!==void 0&&ie.removeSource(G)})))),this.actor.registerMessageHandler("RM",(j=>D._(this,void 0,void 0,(function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],this.globalStates.delete(j)})))),this.actor.registerMessageHandler("SR",((j,G)=>D._(this,void 0,void 0,(function*(){this.referrer=G})))),this.actor.registerMessageHandler("SRPS",((j,G)=>this._syncRTLPluginState(j,G))),this.actor.registerMessageHandler("IS",((j,G)=>D._(this,void 0,void 0,(function*(){this.self.importScripts(G)})))),this.actor.registerMessageHandler("SI",((j,G)=>this._setImages(j,G))),this.actor.registerMessageHandler("UL",((j,G)=>D._(this,void 0,void 0,(function*(){this._getLayerIndex(j).update(G.layers,G.removedIds,this._getGlobalState(j))})))),this.actor.registerMessageHandler("UGS",((j,G)=>D._(this,void 0,void 0,(function*(){const ie=this._getGlobalState(j);for(const se in G)ie[se]=G[se]})))),this.actor.registerMessageHandler("SL",((j,G)=>D._(this,void 0,void 0,(function*(){this._getLayerIndex(j).replace(G,this._getGlobalState(j))}))))}_getGlobalState(F){let j=this.globalStates.get(F);return j||(j={},this.globalStates.set(F,j)),j}_setImages(F,j){return D._(this,void 0,void 0,(function*(){this.availableImages[F]=j;for(const G in this.workerSources[F]){const ie=this.workerSources[F][G];for(const se in ie)ie[se].availableImages=j}}))}_syncRTLPluginState(F,j){return D._(this,void 0,void 0,(function*(){return yield D.cX.syncState(j,this.self.importScripts)}))}_getAvailableImages(F){let j=this.availableImages[F];return j||(j=[]),j}_getLayerIndex(F){let j=this.layerIndexes[F];return j||(j=this.layerIndexes[F]=new d),j}_getWorkerSource(F,j,G){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][j]||(this.workerSources[F][j]={}),!this.workerSources[F][j][G]){const ie={sendAsync:(se,he)=>(se.targetMapId=F,this.actor.sendAsync(se,he))};switch(j){case"vector":this.workerSources[F][j][G]=new et(ie,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][j][G]=new Mn(ie,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][j][G]=new this.externalWorkerSourceTypes[j](ie,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][j][G]}_getDEMWorkerSource(F,j){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][j]||(this.demWorkerSources[F][j]=new Ue),this.demWorkerSources[F][j]}}return D.i(self)&&(self.worker=new Nr(self)),Nr})),_e("index",["exports","./shared"],(function(D,d){var Re="5.7.3";function Ie(){var f=new d.A(4);return d.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}let Ye,et;const Ue={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(f,e,a){const l=requestAnimationFrame((g=>{h(),e(g)})),{unsubscribe:h}=d.s(f.signal,"abort",(()=>{h(),cancelAnimationFrame(l),a(d.c())}),!1)},frameAsync(f){return new Promise(((e,a)=>{this.frame(f,e,a)}))},getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,a.drawImage(f,0,0,f.width,f.height),a},resolveURL:f=>(Ye||(Ye=document.createElement("a")),Ye.href=f,Ye.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(et==null&&(et=matchMedia("(prefers-reduced-motion: reduce)")),et.matches)}};class ve{static testProp(e){if(!ve.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in ve.docStyle)return e[a];return e[0]}static create(e,a,l){const h=window.document.createElement(e);return a!==void 0&&(h.className=a),l&&l.appendChild(h),h}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){ve.docStyle&&ve.selectProp&&(ve.userSelect=ve.docStyle[ve.selectProp],ve.docStyle[ve.selectProp]="none")}static enableDrag(){ve.docStyle&&ve.selectProp&&(ve.docStyle[ve.selectProp]=ve.userSelect)}static setTransform(e,a){e.style[ve.transformProp]=a}static addEventListener(e,a,l,h={}){e.addEventListener(a,l,"passive"in h?h:h.capture)}static removeEventListener(e,a,l,h={}){e.removeEventListener(a,l,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ve.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ve.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ve.suppressClickInternal,!0)}),0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,l){const h=a.boundingClientRect;return new d.P((l.clientX-h.left)/a.x-e.clientLeft,(l.clientY-h.top)/a.y-e.clientTop)}static mousePos(e,a){const l=ve.getScale(e);return ve.getPoint(e,l,a)}static touchPos(e,a){const l=[],h=ve.getScale(e);for(let g=0;g<a.length;g++)l.push(ve.getPoint(e,h,a[g]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=a.querySelectorAll("script");for(const h of l)h.remove();return ve.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){const l=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const a=e.children;for(const l of a)ve.removeAttributes(l),ve.clean(l)}static removeAttributes(e){for(const{name:a,value:l}of e.attributes)ve.isPossiblyDangerous(a,l)&&e.removeAttribute(a)}}ve.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ve.selectProp=ve.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ve.transformProp=ve.testProp(["transform","WebkitTransform"]);const Nt={supported:!1,testSupport:function(f){!pi&&Ht&&(zt?Ct(f):Gt=f)}};let Gt,Ht,pi=!1,zt=!1;function Ct(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Ht),f.isContextLost())return;Nt.supported=!0}catch{}f.deleteTexture(e),pi=!0}var ii;typeof document<"u"&&(Ht=document.createElement("img"),Ht.onload=()=>{Gt&&Ct(Gt),Gt=null,zt=!0},Ht.onerror=()=>{pi=!0,Gt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(f){let e,a,l,h;f.resetRequestQueue=()=>{e=[],a=0,l=0,h={}},f.addThrottleControl=T=>{const E=l++;return h[E]=T,E},f.removeThrottleControl=T=>{delete h[T],y()},f.getImage=(T,E,A=!0)=>new Promise(((R,P)=>{Nt.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:A,state:"queued",onError:L=>{P(L)},onSuccess:L=>{R(L)}}),y()}));const g=T=>d._(this,void 0,void 0,(function*(){T.state="running";const{requestParameters:E,supportImageRefresh:A,onError:R,onSuccess:P,abortController:L}=T,U=A===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce(((X,W)=>X&&W==="accept"),!0));a++;const H=U?w(E,L):d.m(E,L);try{const X=yield H;delete T.abortController,T.state="completed",X.data instanceof HTMLImageElement||d.b(X.data)?P(X):X.data&&P({data:yield($=X.data,typeof createImageBitmap=="function"?d.f($):d.h($)),cacheControl:X.cacheControl,expires:X.expires})}catch(X){delete T.abortController,R(X)}finally{a--,y()}var $})),y=()=>{const T=(()=>{for(const E of Object.keys(h))if(h[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=a;E<T&&e.length>0;E++){const A=e.shift();A.abortController.signal.aborted?E--:g(A)}},w=(T,E)=>new Promise(((A,R)=>{const P=new Image,L=T.url,U=T.credentials;U&&U==="include"?P.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.d(L))&&(P.crossOrigin="anonymous"),E.signal.addEventListener("abort",(()=>{P.src="",R(d.c())})),P.fetchPriority="high",P.onload=()=>{P.onerror=P.onload=null,A({data:P})},P.onerror=()=>{P.onerror=P.onload=null,E.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},P.src=L}))})(ii||(ii={})),ii.resetRequestQueue();class mt{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Qt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const a=[];for(const{id:l,url:h}of f){const g=`${l}${h}`;a.indexOf(g)===-1&&(a.push(g),e.push({id:l,url:h}))}}return e}function vi(f,e,a){try{const l=new URL(f);return l.pathname+=`${e}${a}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${f}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Oi(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ji extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let l=!0;const h=a.data||a.spriteData;return this._validateStretch(a.stretchX,h&&h.width)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,h&&h.height)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,a){if(!e)return!0;let l=0;for(const h of e){if(h[0]<l||h[1]<h[0]||a<h[1])return!1;l=h[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const l=a.spriteData,h=l&&l.width||a.data.width,g=l&&l.height||a.data.height;return!(e[0]<0||h<e[0]||e[1]<0||g<e[1]||e[2]<0||h<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,l=!0){const h=this.getImage(e);if(l&&(h.data.width!==a.data.width||h.data.height!==a.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=h.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((a,l)=>{let h=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(h=!1);this.isLoaded()||h?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})}))}_getImagesForIds(e){const a={};for(const l of e){let h=this.getImage(l);h||(this.fire(new d.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?a[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],l=this.getImage(e);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new d.I(h,l);this.patterns[e]={bin:h,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:a,h:l}=d.p(e),h=this.atlasImage;h.resize({width:a||1,height:l||1});for(const g in this.patterns){const{bin:y}=this.patterns[g],w=y.x+1,T=y.y+1,E=this.getImage(g).data,A=E.width,R=E.height;d.R.copy(E,h,{x:0,y:0},{x:w,y:T},{width:A,height:R}),d.R.copy(E,h,{x:0,y:R-1},{x:w,y:T-1},{width:A,height:1}),d.R.copy(E,h,{x:0,y:0},{x:w,y:T+R},{width:A,height:1}),d.R.copy(E,h,{x:A-1,y:0},{x:w-1,y:T},{width:1,height:R}),d.R.copy(E,h,{x:0,y:0},{x:w+A,y:T},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||d.w(`Image with ID: "${a}" was not found`),Oi(l)&&this.updateImage(a,l)}}}const xi=1e20;function on(f,e,a,l,h,g,y,w,T){for(let E=e;E<e+l;E++)ri(f,a*g+E,g,h,y,w,T);for(let E=a;E<a+h;E++)ri(f,E*g+e,1,l,y,w,T)}function ri(f,e,a,l,h,g,y){g[0]=0,y[0]=-xi,y[1]=xi,h[0]=f[e];for(let w=1,T=0,E=0;w<l;w++){h[w]=f[e+w*a];const A=w*w;do{const R=g[T];E=(h[w]-h[R]+A-R*R)/(w-R)/2}while(E<=y[T]&&--T>-1);T++,g[T]=w,y[T]=E,y[T+1]=xi}for(let w=0,T=0;w<l;w++){for(;y[T+1]<w;)T++;const E=g[T],A=w-E;f[e+w*a]=h[E]+A*A}}class Xn{constructor(e,a,l){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=l}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,(function*(){const a=[];for(const g in e)for(const y of e[g])a.push(this._getAndCacheGlyphsPromise(g,y));const l=yield Promise.all(a),h={};for(const{stack:g,id:y,glyph:w}of l)h[g]||(h[g]={}),h[g][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h}))}_getAndCacheGlyphsPromise(e,a){return d._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[a];if(h!==void 0)return{stack:e,id:a,glyph:h};if(h=this._tinySDF(l,e,a),h)return l.glyphs[a]=h,{stack:e,id:a,glyph:h};const g=Math.floor(a/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[g])return{stack:e,id:a,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[g]){const w=Xn.loadGlyphRange(e,g,this.url,this.requestManager);l.requests[g]=w}const y=yield l.requests[g];for(const w in y)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=y[+w]);return l.ranges[g]=!0,{stack:e,id:a,glyph:y[a]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||d.u["CJK Unified Ideographs"](e)||d.u["Hangul Syllables"](e)||d.u.Hiragana(e)||d.u.Katakana(e)||d.u["CJK Symbols and Punctuation"](e)||d.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,a,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let g=e.tinySDF;if(!g){let w="400";/bold/i.test(a)?w="900":/medium/i.test(a)?w="500":/light/i.test(a)&&(w="200"),g=e.tinySDF=new Xn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:h,fontWeight:w})}const y=g.draw(String.fromCharCode(l));return{id:l,bitmap:new d.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}Xn.loadGlyphRange=function(f,e,a,l){return d._(this,void 0,void 0,(function*(){const h=256*e,g=h+255,y=l.transformRequest(a.replace("{fontstack}",f).replace("{range}",`${h}-${g}`),"Glyphs"),w=yield d.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${g}`);const T={};for(const E of d.o(w.data))T[E.id]=E;return T}))},Xn.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:a=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=a,this.lang=w;const T=this.size=f+4*e,E=this._createCanvas(T),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${g} ${f}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(f),y=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),E=w+2*this.buffer,A=T+2*this.buffer,R=Math.max(E*A,0),P=new Uint8ClampedArray(R),L={data:P,width:E,height:A,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return L;const{ctx:U,buffer:H,gridInner:$,gridOuter:X}=this;this.lang&&(U.lang=this.lang),U.clearRect(H,H,w,T),U.fillText(f,H,H+y);const W=U.getImageData(H,H,w,T);X.fill(xi,0,R),$.fill(0,0,R);for(let ee=0;ee<T;ee++)for(let Q=0;Q<w;Q++){const ne=W.data[4*(ee*w+Q)+3]/255;if(ne===0)continue;const le=(ee+H)*E+Q+H;if(ne===1)X[le]=0,$[le]=xi;else{const J=.5-ne;X[le]=J>0?J*J:0,$[le]=J<0?J*J:0}}on(X,0,0,E,A,E,this.f,this.v,this.z),on($,H,H,w,T,E,this.f,this.v,this.z);for(let ee=0;ee<R;ee++){const Q=Math.sqrt(X[ee])-Math.sqrt($[ee]);P[ee]=Math.round(255-255*(Q/this.radius+this.cutoff))}return L}};class pn{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,a){return d.B(e.expression.evaluate(a))}interpolate(e,a,l){return{x:d.C.number(e.x,a.x,l),y:d.C.number(e.y,a.y,l),z:d.C.number(e.z,a.z,l)}}}let Zi;class Be extends d.E{constructor(e){super(),Zi=Zi||new d.r({anchor:new d.D(d.v.light.anchor),position:new pn,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.t(Zi,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(d.x,e,a))for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,l){return(!l||l.validate!==!1)&&d.y(this,e.call(d.z,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const ot=new d.r({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class At extends d.E{constructor(e){super(),this._transitionable=new d.t(ot,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.F(0))}setSky(e,a={}){if(!this._validate(d.G,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,l={}){return l?.validate!==!1&&d.y(this,e.call(d.z,d.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Tt{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const l=e.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,a)),this.dashEntry[l]}getDashRanges(e,a,l){const h=[];let g=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,w=!0;h.push({left:g,right:y,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){w=!w;const A=e[E];g=T*l,T+=A,y=T*l,h.push({left:g,right:y,isDash:w,zeroLength:A===0})}return h}addRoundDash(e,a,l){const h=a/2;for(let g=-l;g<=l;g++){const y=this.width*(this.nextRow+l+g);let w=0,T=e[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++w]);const A=Math.abs(E-T.left),R=Math.abs(E-T.right),P=Math.min(A,R);let L;const U=g/l*(h+1);if(T.isDash){const H=h-Math.abs(U);L=Math.sqrt(P*P+H*H)}else L=h-Math.sqrt(P*P+U*U);this.data[y+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],E=e[w+1];T.zeroLength?e.splice(w,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(w,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const T=Math.abs(w-y.left),E=Math.abs(w-y.right),A=Math.min(T,E);this.data[h+w]=Math.max(0,Math.min(255,(y.isDash?A:-A)+128))}}addDash(e,a){const l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<e.length;w++)g+=e[w];if(g!==0){const w=this.width/g,T=this.getDashRanges(e,this.width,w);a?this.addRoundDash(T,w,l):this.addRegularDash(T)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:g};return this.nextRow+=h,this.dirty=!0,y}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const ue="maplibre_preloaded_worker_pool";class Ne{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ne.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ue]}numActive(){return Object.keys(this.active).length}}const lt=Math.floor(Ue.hardwareConcurrency/2);let at,xt;function Jt(){return at||(at=new Ne),at}Ne.workerCount=d.H(globalThis)?Math.max(Math.min(lt,3),1):1;class bt{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let h=0;h<l.length;h++){const g=new d.J(l[h],a);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:e,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const l of this.actors)l.registerMessageHandler(e,a)}}function Fn(){return xt||(xt=new bt(Jt(),d.K),xt.registerMessageHandler("GR",((f,e,a)=>d.m(e,a)))),xt}function si(f,e){const a=d.L();return d.M(a,a,[1,1,0]),d.N(a,a,[.5*f.width,.5*f.height,1]),f.calculatePosMatrix?d.O(a,a,f.calculatePosMatrix(e.toUnwrapped())):a}function jn(f,e,a,l,h,g,y){var w;const T=(function(P,L,U){if(P)for(const H of P){const $=L[H];if($&&$.source===U&&$.type==="fill-extrusion")return!0}else for(const H in L){const $=L[H];if($.source===U&&$.type==="fill-extrusion")return!0}return!1})((w=h?.layers)!==null&&w!==void 0?w:null,e,f.id),E=g.maxPitchScaleFactor(),A=f.tilesIn(l,E,T);A.sort(As);const R=[];for(const P of A)R.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(e,a,f._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,h,g,E,si(f.transform,P.tileID),y?(L,U)=>y(P.tileID,L,U):void 0)});return(function(P,L){for(const U in P)for(const H of P[U])es(H,L);return P})((function(P){const L={},U={};for(const H of P){const $=H.queryResults,X=H.wrappedTileID,W=U[X]=U[X]||{};for(const ee in $){const Q=$[ee],ne=W[ee]=W[ee]||{},le=L[ee]=L[ee]||[];for(const J of Q)ne[J.featureIndex]||(ne[J.featureIndex]=!0,le.push(J))}}return L})(R),f)}function As(f,e){const a=f.tileID,l=e.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function es(f,e){const a=f.feature,l=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=l}function gr(f,e,a){return d._(this,void 0,void 0,(function*(){let l=f;if(f.url?l=(yield d.j(e.transformRequest(f.url,"Source"),a)).data:yield Ue.frameAsync(a),!l)return null;const h=d.Q(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((g=>g.id))),h}))}class Yi{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.S?new d.S(e.lng,e.lat):d.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.S?new d.S(e.lng,e.lat):d.S.convert(e),this}extend(e){const a=this._sw,l=this._ne;let h,g;if(e instanceof d.S)h=e,g=e;else{if(!(e instanceof Yi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Yi.convert(e)):this.extend(d.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.S.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return a||l?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new d.S(h.lng,h.lat),this._ne=new d.S(g.lng,g.lat)),this}getCenter(){return new d.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.S(this.getWest(),this.getNorth())}getSouthEast(){return new d.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:l}=d.S.convert(e);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return e instanceof Yi?e:e&&new Yi(e)}static fromLngLat(e,a=0){const l=360*a/40075017,h=l/Math.cos(Math.PI/180*e.lat);return new Yi(new d.S(e.lng-h,e.lat-l),new d.S(e.lng+h,e.lat+l))}adjustAntiMeridian(){const e=new d.S(this._sw.lng,this._sw.lat),a=new d.S(this._ne.lng,this._ne.lat);return new Yi(e,e.lng>a.lng?new d.S(a.lng+360,a.lat):a)}}class en{constructor(e,a,l){this.bounds=Yi.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),l=Math.floor(d.V(this.bounds.getWest())*a),h=Math.floor(d.U(this.bounds.getNorth())*a),g=Math.ceil(d.V(this.bounds.getEast())*a),y=Math.ceil(d.U(this.bounds.getSouth())*a);return e.x>=l&&e.x<g&&e.y>=h&&e.y<y}}class ua extends d.E{constructor(e,a,l,h){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.Q(a,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new en(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,y)=>{e.reloadPromise={resolve:g,reject:y}}))}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:h,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Da extends d.E{constructor(e,a,l,h){super(),this.id=e,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.Q(a,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(d.e(this,a),a.bounds&&(this.tileBounds=new en(a.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(a))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield ii.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,g=h.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new d.T(h,y,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class rr extends Da{constructor(e,a,l,h){super(e,a,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield ii.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const g=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=d.b(g)&&d.W()?g:yield this.readImageNow(g),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}}))}readImageNow(e){return d._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&d.X()){const a=e.width+2,l=e.height+2;try{return new d.R({width:a,height:l},yield d.Y(e,-1,-1,a,l))}catch{}}return Ue.getImageData(e,1)}))}_getNeighboringTiles(e){const a=e.canonical,l=Math.pow(2,a.z),h=(a.x-1+l)%l,g=a.x===0?e.wrap-1:e.wrap,y=(a.x+1+l)%l,w=a.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.Z(e.overscaledZ,g,a.z,h,a.y).key]={backfilled:!1},T[new d.Z(e.overscaledZ,w,a.z,y,a.y).key]={backfilled:!1},a.y>0&&(T[new d.Z(e.overscaledZ,g,a.z,h,a.y-1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,w,a.z,y,a.y-1).key]={backfilled:!1}),a.y+1<l&&(T[new d.Z(e.overscaledZ,g,a.z,h,a.y+1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},T[new d.Z(e.overscaledZ,w,a.z,y,a.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Ia extends d.E{constructor(e,a,l,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=a.data,this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:d.$,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.$,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(d.$/this.tileSize)}_getClusterMaxZoom(e){const a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return d._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=d.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return d._(this,void 0,void 0,(function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((a=>a.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return d._(this,void 0,void 0,(function*(){const e=new Yi,a=yield this.getData();let l;switch(a.type){case"FeatureCollection":l=a.features.map((h=>this.getCoordinatesFromGeometry(h.geometry))).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(a.geometry);break;default:l=this.getCoordinatesFromGeometry(a)}if(l.length==0)return e;for(let h=0;h<l.length-1;h+=2)e.extend([l[h],l[h+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:l}})}_updateWorkerData(){return d._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:a}=this._pendingWorkerUpdate;if(!e&&!a)return void d.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const l=d.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(l.request=this.map._requestManager.transformRequest(Ue.resolveURL(e),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):a&&(l.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));this._data=h.data;let g=null;h.resourceTiming&&h.resourceTiming[this.id]&&(g=h.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&d.e(y,{resourceTiming:g}),this.fire(new d.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(h))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:a,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,a==="RT")}))}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ha extends d.E{constructor(e,a,l,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=a}load(e){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield ii.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new d.k(a))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(d.a1.fromLngLat);var l;return this.tileID=(function(h){const g=d.a2.fromPoints(h),y=g.width(),w=g.height(),T=Math.max(y,w),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),A=Math.pow(2,E);return new d.a4(E,Math.floor((g.minX+g.maxX)/2*A),Math.floor((g.minY+g.maxY)/2*A))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new d.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:a,minY:l,maxX:h,maxY:g}=d.a2.fromPoints(e),y={};for(let w=0;w<=d.a3;w++){const T=Math.pow(2,w),E=Math.floor(a*T),A=Math.floor(l*T),R=Math.floor(h*T),P=Math.floor(g*T);y[w]={minTileX:E,minTileY:A,maxTileX:R,maxTileY:P}}return y}}class eo extends ha{constructor(e,a,l,h){super(e,a,l,h),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield d.a5(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new d.k(new d.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class da extends ha{constructor(e,a,l,h){super(e,a,l,h),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((y=>typeof y!="number"))))||this.fire(new d.k(new d.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.a6(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.k(new d.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(a,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const zs={},ts=f=>{switch(f){case"geojson":return Ia;case"image":return ha;case"raster":return Da;case"raster-dem":return rr;case"vector":return ua;case"video":return eo;case"canvas":return da}return zs[f]},to="RTLPluginLoaded";class Ps extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Fn()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,(function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ue.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return d._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(to))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ta=null;function Mn(){return ta||(ta=new Ps),ta}class Nr{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a7(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(h,g){const y={};if(!g)return y;for(const w of h){const T=w.layerIds.map((E=>g.getLayer(E))).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((E=>T.filter((A=>A.id===E))[0])));for(const E of T)y[E.id]=w}}return y})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof d.a9){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof d.a9&&g.hasRTLText){this.hasRTLText=!0,Mn().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,l,h,g,y,w,T,E,A,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:y,tileSize:this.tileSize,pixelPosMatrix:A,transform:T,params:w,queryPadding:this.queryPadding*E,getElevation:R},e,a,l):{}}querySourceFeatures(e,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),g=a&&a.sourceLayer?a.sourceLayer:"",y=h._geojsonTileLayer||h[g];if(!y)return;const w=d.aa(a?.filter,a?.globalState),{z:T,x:E,y:A}=this.tileID.canonical,R={z:T,x:E,y:A};for(let P=0;P<y.length;P++){const L=y.feature(P);if(w.needGeometry){const $=d.ab(L,!0);if(!w.filter(new d.F(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!w.filter(new d.F(this.tileID.overscaledZ),L))continue;const U=l.getId(L,g),H=new d.ac(L,T,E,A,U);H.tile=R,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const l=d.ad(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const g=this.expirationTime-a;g?this.expirationTime=l+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!a.style.hasLayer(h))continue;const g=this.buckets[h],y=g.layers[0].sourceLayer||"_geojsonTileLayer",w=l[y],T=e[y];if(!w||!T||Object.keys(T).length===0)continue;g.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=a&&a.style&&a.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ue.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ue.now()+e}setDependencies(e,a){const l={};for(const h of a)l[h]=!0;this.dependencies[e]=l}hasDependency(e,a){for(const l of e){const h=this.dependencies[l];if(h){for(const g of a)if(h[g])return!0}}return!1}}class ce{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const g={value:a,timeout:void 0};if(l!==void 0&&(g.timeout=setTimeout((()=>{this.remove(e,g)}),l)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const l=e.wrapped().key,h=a===void 0?0:this.data[l].indexOf(a),g=this.data[l][h];return this.data[l].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(g.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||a.push(h);for(const l of a)this.remove(l.value.tileID,l)}}class F{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,l){const h=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},d.e(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==h&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const g in this.state[e][h])l[g]||(this.deletedStates[e][h][g]=null)}else for(const g in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][g]===null&&delete this.deletedStates[e][h][g]}removeFeatureState(e,a,l){if(this.deletedStates[e]===null)return;const h=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&a!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,a){const l=String(a),h=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][a];if(g===null)return{};for(const y in g)delete h[y]}return h}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),d.e(this.state[h][y],this.stateChanges[h][y]),g[y]=this.state[h][y];l[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(this.deletedStates[h]===null)for(const y in this.state[h])g[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const w of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][w];g[y]=this.state[h][y]}l[h]=l[h]||{},d.e(l[h],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,a)}}const j=89.25;function G(f,e){const a=d.ah(e.lat,-d.ai,d.ai);return new d.P(d.V(e.lng)*f,d.U(a)*f)}function ie(f,e){return new d.a1(e.x/f,e.y/f).toLngLat()}function se(f){return f.cameraToCenterDistance*Math.min(.85*Math.tan(d.ae(90-f.pitch)),Math.tan(d.ae(j-f.pitch)))}function he(f,e){const a=f.canonical,l=e/d.af(a.z),h=a.x+Math.pow(2,a.z)*f.wrap,g=d.ag(new Float64Array(16));return d.M(g,g,[h*l,a.y*l,0]),d.N(g,g,[l/d.$,l/d.$,1]),g}function Me(f,e,a,l,h){const g=d.a1.fromLngLat(f,e),y=h*d.aj(1,f.lat),w=y*Math.cos(d.ae(a)),T=Math.sqrt(y*y-w*w),E=T*Math.sin(d.ae(-l)),A=T*Math.cos(d.ae(-l));return new d.a1(g.x+E,g.y+A,g.z+w)}function fe(f,e,a){const l=e.intersectsFrustum(f);if(!a||l===0)return l;const h=e.intersectsPlane(a);return h===0?0:l===2&&h===2?2:1}function ke(f,e,a){let l=0;const h=(a-e)/10;for(let g=0;g<10;g++)l+=h*Math.pow(Math.cos(e+(g+.5)/10*(a-e)),f);return l}function qe(f,e){return function(a,l,h,g,y){const w=2*((f-1)/d.ak(Math.cos(d.ae(j-y))/Math.cos(d.ae(j)))-1),T=Math.acos(h/g),E=2*ke(w-1,0,d.ae(y/2)),A=Math.min(d.ae(j),T+d.ae(y/2)),R=ke(w-1,Math.min(A,T-d.ae(y/2)),A),P=Math.atan(l/h),L=Math.hypot(l,h);let U=a;return U+=d.ak(g/L/Math.max(.5,Math.cos(d.ae(y/2)))),U+=w*d.ak(Math.cos(P))/2,U-=d.ak(Math.max(1,R/E/e))/2,U}}const Oe=qe(9.314,3);function ct(f,e){const a=(e.roundZoom?Math.round:Math.floor)(f.zoom+d.ak(f.tileSize/e.tileSize));return Math.max(0,a)}function ge(f,e){const a=f.getCameraFrustum(),l=f.getClippingPlane(),h=f.screenPointToMercatorCoordinate(f.getCameraPoint()),g=d.a1.fromLngLat(f.center,f.elevation);h.z=g.z+Math.cos(f.pitchInRadians)*f.cameraToCenterDistance/f.worldSize;const y=f.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(f,e),T=ct(f,e),E=e.minzoom||0,A=e.maxzoom!==void 0?e.maxzoom:f.maxZoom,R=Math.min(Math.max(0,T),A),P=Math.pow(2,R),L=[P*h.x,P*h.y,0],U=[P*g.x,P*g.y,0],H=Math.hypot(g.x-h.x,g.y-h.y),$=Math.abs(g.z-h.z),X=Math.hypot(H,$),W=ne=>({zoom:0,x:0,y:0,wrap:ne,fullyVisible:!1}),ee=[],Q=[];if(f.renderWorldCopies&&y.allowWorldCopies())for(let ne=1;ne<=3;ne++)ee.push(W(-ne)),ee.push(W(ne));for(ee.push(W(0));ee.length>0;){const ne=ee.pop(),le=ne.x,J=ne.y;let de=ne.fullyVisible;const Ce={x:le,y:J,z:ne.zoom},be=y.getTileBoundingVolume(Ce,ne.wrap,f.elevation,e);if(!de){const Ke=fe(a,be,l);if(Ke===0)continue;de=Ke===2}const Te=y.distanceToTile2d(h.x,h.y,Ce,be);let Ae=T;w&&(Ae=(e.calculateTileZoom||Oe)(f.zoom+d.ak(f.tileSize/e.tileSize),Te,$,X,f.fov)),Ae=(e.roundZoom?Math.round:Math.floor)(Ae),Ae=Math.max(0,Ae);const Qe=Math.min(Ae,A);if(ne.wrap=y.getWrap(g,Ce,ne.wrap),ne.zoom>=Qe){if(ne.zoom<E)continue;const Ke=R-ne.zoom,Fe=L[0]-.5-(le<<Ke),ht=L[1]-.5-(J<<Ke),Zt=e.reparseOverscaled?Math.max(ne.zoom,Ae):ne.zoom;Q.push({tileID:new d.Z(ne.zoom===A?Zt:ne.zoom,ne.wrap,ne.zoom,le,J),distanceSq:d.al([U[0]-.5-le,U[1]-.5-J]),tileDistanceToCamera:Math.sqrt(Fe*Fe+ht*ht)})}else for(let Ke=0;Ke<4;Ke++)ee.push({zoom:ne.zoom+1,x:(le<<1)+Ke%2,y:(J<<1)+(Ke>>1),wrap:ne.wrap,fullyVisible:de})}return Q.sort(((ne,le)=>ne.distanceSq-le.distanceSq)).map((ne=>ne.tileID))}const Pt=d.a2.fromPoints([new d.P(0,0),new d.P(d.$,d.$)]);class Xt extends d.E{constructor(e,a,l){super(),this.id=e,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,g,y,w)=>{const T=new(ts(g.type))(h,g,y,w);if(T.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${T.id}`);return T})(e,a,l,this),this._tiles={},this._cache=new ce(0,(h=>this._unloadTile(h))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new F,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,l){return d._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,l)}catch(h){e.state="errored",h.status!==404?this._source.fire(new d.k(h,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const l=this._tiles[a];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(_t).map((e=>e.key))}getRenderableIds(e){const a=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&a.push(this._tiles[l]);return e?a.sort(((l,h)=>{const g=l.tileID,y=h.tileID,w=new d.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),T=new d.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x})).map((l=>l.tileID.key)):a.map((l=>l.tileID)).sort(_t).map((l=>l.key))}hasRenderableParent(e){const a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)e?this._reloadTile(a,"expired"):this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(e,a){return d._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,e,a))}))}_tileLoaded(e,a,l){e.timeAdded=Ue.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const g=a[h];if(e.neighboringTiles&&e.neighboringTiles[g]){const y=this.getTileByID(g);l(e,y),l(y,e)}}function l(h,g){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let y=g.tileID.canonical.x-h.tileID.canonical.x;const w=g.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),E=g.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,y,w),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){const l=Object.values(e),h=this._getLoadedDescendents(l);for(const g of l){const y=h[g.key];if(!y)continue;const w=g.overscaledZ+Xt.maxUnderzooming;let T=1/0;for(const E of y){const A=E.tileID.overscaledZ;A<=w&&A<T&&(T=A)}if(T!==1/0)for(const E of y)E.tileID.overscaledZ===T&&(a[E.tileID.key]=E.tileID)}}_getLoadedDescendents(e){var a;const l={};for(const h in this._tiles){const g=this._tiles[h];if(g.hasData())for(const y of e)g.tileID.isChildOf(y)&&(l[a=y.key]||(l[a]=[])).push(g)}return l}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=a?l:null}for(let l=e.overscaledZ-1;l>=a;l--){const h=e.scaledTo(l),g=this._getLoadedTile(h);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(g)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const l={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),l[g.tileID.key]=g}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(e,a,l,h){const g={},y={},w=Object.keys(e),T=Ue.now();for(const E of w){const A=e[E],R=this._tiles[E];if(!R||R.fadeEndTime!==0&&R.fadeEndTime<=T)continue;const P=this.findLoadedParent(A,a),L=this.findLoadedSibling(A),U=P||L||null;U&&(this._addTile(U.tileID),g[U.tileID.key]=U.tileID),y[E]=A}this._retainLoadedChildren(y,e);for(const E in g)e[E]||(this._coveredTiles[E]=!0,e[E]=g[E]);if(h){const E={},A={};for(const R of l)this._tiles[R.key].hasData()?E[R.key]=R:A[R.key]=R;for(const R in A){const P=A[R].children(this._source.maxzoom);this._tiles[P[0].key]&&this._tiles[P[1].key]&&this._tiles[P[2].key]&&this._tiles[P[3].key]&&(E[P[0].key]=e[P[0].key]=P[0],E[P[1].key]=e[P[1].key]=P[1],E[P[2].key]=e[P[2].key]=P[2],E[P[3].key]=e[P[3].key]=P[3],delete A[R])}for(const R in A){const P=A[R],L=this.findLoadedParent(P,this._source.minzoom),U=this.findLoadedSibling(P),H=L||U||null;if(H){E[H.tileID.key]=e[H.tileID.key]=H.tileID;for(const $ in E)E[$].isChildOf(H.tileID)&&delete E[$]}}for(const R in this._tiles)E[R]||(this._coveredTiles[R]=!0)}}update(e,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new d.Z(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(l=ge(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((E=>this._source.hasTile(E))))):l=[];const h=ct(e,this._source),g=Math.max(h-Xt.maxOverzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const A of l)if(A.canonical.z>this._source.minzoom){const R=A.scaledTo(A.canonical.z-1);E[R.key]=R;const P=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));E[P.key]=P}l=l.concat(Object.values(E))}const y=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const w=this._updateRetainedTiles(l,h);Lt(this._source.type)&&this._updateCoveredAndRetainedTiles(w,g,l,a);for(const E in w)this._tiles[E].clearFadeHold();const T=d.am(this._tiles,w);for(const E of T){const A=this._tiles[E];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var l;const h={},g={},y=Math.max(a-Xt.maxOverzooming,this._source.minzoom),w={};for(const T of e){const E=this._addTile(T);h[T.key]=T,E.hasData()||a<this._source.maxzoom&&(w[T.key]=T)}this._retainLoadedChildren(w,h);for(const T of e){let E=this._tiles[T.key];if(E.hasData())continue;if(a+1>this._source.maxzoom){const R=T.children(this._source.maxzoom)[0],P=this.getTile(R);if(P&&P.hasData()){h[R.key]=R;continue}}else{const R=T.children(this._source.maxzoom);if(R.length===4&&h[R[0].key]&&h[R[1].key]&&h[R[2].key]&&h[R[3].key]||R.length===1&&h[R[0].key])continue}let A=E.wasRequested();for(let R=T.overscaledZ-1;R>=y;--R){const P=T.scaledTo(R);if(g[P.key])break;if(g[P.key]=!0,E=this.getTile(P),!E&&A&&(E=this._addTile(P)),E){const L=E.hasData();if((L||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||A)&&(h[P.key]=P),A=E.wasRequested(),L)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const a=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}a.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(g),l)break;h=g}for(const g of a)this._loadedParentTiles[g]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const a=this._tiles[e].tileID,l=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=l}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));const l=a;return a||(a=new Nr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,l||this._source.fire(new d.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=a.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}refreshTiles(e){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some((l=>l.equals(this._tiles[a].tileID.canonical)))&&this._reloadTile(a,"expired")}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){const a=e.sourceDataType;e.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&a==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,l){const h=[],g=this.transform;if(!g)return h;const y=g.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?g.getCameraQueryGeometry(e):e,T=L=>g.screenPointToMercatorCoordinate(L,this.terrain),E=this.transformBbox(e,T,!y),A=this.transformBbox(w,T,!y),R=this.getIds(),P=d.a2.fromPoints(A);for(let L=0;L<R.length;L++){const U=this._tiles[R[L]];if(U.holdingForFade())continue;const H=y?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],$=Math.pow(2,g.zoom-U.tileID.overscaledZ),X=a*U.queryPadding*d.$/U.tileSize/$;for(const W of H){const ee=P.map((Q=>W.getTilePoint(new d.a1(Q.x,Q.y))));if(ee.expandBy(X),ee.intersects(Pt)){const Q=E.map((le=>W.getTilePoint(le))),ne=A.map((le=>W.getTilePoint(le)));h.push({tile:U,tileID:y?W:W.unwrapTo(0),queryGeometry:Q,cameraQueryGeometry:ne,scale:$})}}}return h}transformBbox(e,a,l){let h=e.map(a);if(l){const g=d.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const y=g.map(a);d.a2.fromPoints(h).covers(y)||(h=h.map((w=>w.x>.5?new d.a1(w.x-1,w.y,w.z):w)))}return h}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(Lt(this._source.type)){const e=Ue.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,l){this._state.updateState(e=e||"_geojsonTileLayer",a,l)}removeFeatureState(e,a,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,l)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,l){const h=this._tiles[e];h&&h.setDependencies(a,l)}reloadTilesForDependencies(e,a){for(const l in this._tiles)this._tiles[l].hasDependency(e,a)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,a)))}}function _t(f,e){const a=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-a||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Lt(f){return f==="raster"||f==="image"||f==="video"}Xt.maxOverzooming=10,Xt.maxUnderzooming=3;class bi{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ah(e,0,1);let a=1,l=this._distances[a];const h=e*this.paddedLength+this.padding;for(;l<h&&a<this._distances.length;)l=this._distances[++a];const g=a-1,y=this._distances[g],w=l-y,T=w>0?(h-y)/w:0;return this.points[g].mult(1-T).add(this.points[a].mult(T))}}function En(f,e){let a=!0;return f==="always"||f!=="never"&&e!=="never"||(a=!1),a}class Pn{constructor(e,a,l){const h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(a/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,l,h,g){this._forEachCell(a,l,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g)}insertCircle(e,a,l,h){this._forEachCell(a-h,l-h,a+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(l),this.circles.push(h)}_insertBoxCell(e,a,l,h,g,y){this.boxCells[g].push(y)}_insertCircleCell(e,a,l,h,g,y){this.circleCells[g].push(y)}_query(e,a,l,h,g,y,w){if(l<0||e>this.width||h<0||a>this.height)return[];const T=[];if(e<=0&&a<=0&&this.width<=l&&this.height<=h){if(g)return[{key:null,x1:e,y1:a,x2:l,y2:h}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const A=this.circles[3*E],R=this.circles[3*E+1],P=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:A-P,y1:R-P,x2:A+P,y2:R+P})}}else this._forEachCell(e,a,l,h,this._queryCell,T,{hitTest:g,overlapMode:y,seenUids:{box:{},circle:{}}},w);return T}query(e,a,l,h){return this._query(e,a,l,h,!1,null)}hitTest(e,a,l,h,g,y){return this._query(e,a,l,h,!0,g,y).length>0}hitTestCircle(e,a,l,h,g){const y=e-l,w=e+l,T=a-l,E=a+l;if(w<0||y>this.width||E<0||T>this.height)return!1;const A=[];return this._forEachCell(y,T,w,E,this._queryCellCircle,A,{hitTest:!0,overlapMode:h,circle:{x:e,y:a,radius:l},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(e,a,l,h,g,y,w,T){const{seenUids:E,hitTest:A,overlapMode:R}=w,P=this.boxCells[g];if(P!==null){const U=this.bboxes;for(const H of P)if(!E.box[H]){E.box[H]=!0;const $=4*H,X=this.boxKeys[H];if(e<=U[$+2]&&a<=U[$+3]&&l>=U[$+0]&&h>=U[$+1]&&(!T||T(X))&&(!A||!En(R,X.overlapMode))&&(y.push({key:X,x1:U[$],y1:U[$+1],x2:U[$+2],y2:U[$+3]}),A))return!0}}const L=this.circleCells[g];if(L!==null){const U=this.circles;for(const H of L)if(!E.circle[H]){E.circle[H]=!0;const $=3*H,X=this.circleKeys[H];if(this._circleAndRectCollide(U[$],U[$+1],U[$+2],e,a,l,h)&&(!T||T(X))&&(!A||!En(R,X.overlapMode))){const W=U[$],ee=U[$+1],Q=U[$+2];if(y.push({key:X,x1:W-Q,y1:ee-Q,x2:W+Q,y2:ee+Q}),A)return!0}}}return!1}_queryCellCircle(e,a,l,h,g,y,w,T){const{circle:E,seenUids:A,overlapMode:R}=w,P=this.boxCells[g];if(P!==null){const U=this.bboxes;for(const H of P)if(!A.box[H]){A.box[H]=!0;const $=4*H,X=this.boxKeys[H];if(this._circleAndRectCollide(E.x,E.y,E.radius,U[$+0],U[$+1],U[$+2],U[$+3])&&(!T||T(X))&&!En(R,X.overlapMode))return y.push(!0),!0}}const L=this.circleCells[g];if(L!==null){const U=this.circles;for(const H of L)if(!A.circle[H]){A.circle[H]=!0;const $=3*H,X=this.circleKeys[H];if(this._circlesCollide(U[$],U[$+1],U[$+2],E.x,E.y,E.radius)&&(!T||T(X))&&!En(R,X.overlapMode))return y.push(!0),!0}}}_forEachCell(e,a,l,h,g,y,w,T){const E=this._convertToXCellCoord(e),A=this._convertToYCellCoord(a),R=this._convertToXCellCoord(l),P=this._convertToYCellCoord(h);for(let L=E;L<=R;L++)for(let U=A;U<=P;U++)if(g.call(this,e,a,l,h,this.xCellCount*U+L,y,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,l,h,g,y){const w=h-e,T=g-a,E=l+y;return E*E>w*w+T*T}_circleAndRectCollide(e,a,l,h,g,y,w){const T=(y-h)/2,E=Math.abs(e-(h+T));if(E>T+l)return!1;const A=(w-g)/2,R=Math.abs(a-(g+A));if(R>A+l)return!1;if(E<=T||R<=A)return!0;const P=E-T,L=R-A;return P*P+L*L<=l*l}}function Ei(f,e,a){const l=d.L();if(!f){const{vecSouth:R,vecEast:P}=Rt(e),L=Ie();L[0]=P[0],L[1]=P[1],L[2]=R[0],L[3]=R[1],h=L,(A=(y=(g=L)[0])*(E=g[3])-(T=g[2])*(w=g[1]))&&(h[0]=E*(A=1/A),h[1]=-w*A,h[2]=-T*A,h[3]=y*A),l[0]=L[0],l[1]=L[1],l[4]=L[2],l[5]=L[3]}var h,g,y,w,T,E,A;return d.N(l,l,[1/a,1/a,1]),l}function St(f,e,a,l){if(f){const h=d.L();if(!e){const{vecSouth:g,vecEast:y}=Rt(a);h[0]=y[0],h[1]=y[1],h[4]=g[0],h[5]=g[1]}return d.N(h,h,[l,l,1]),h}return a.pixelsToClipSpaceMatrix}function Rt(f){const e=Math.cos(f.rollInRadians),a=Math.sin(f.rollInRadians),l=Math.cos(f.pitchInRadians),h=Math.cos(f.bearingInRadians),g=Math.sin(f.bearingInRadians),y=d.ar();y[0]=-h*l*a-g*e,y[1]=-g*l*a+h*e;const w=d.as(y);w<1e-9?d.at(y):d.au(y,y,1/w);const T=d.ar();T[0]=h*l*e-g*a,T[1]=g*l*e+h*a;const E=d.as(T);return E<1e-9?d.at(T):d.au(T,T,1/E),{vecEast:T,vecSouth:y}}function Gi(f,e,a,l){let h;l?(h=[f,e,l(f,e),1],d.aw(h,h,a)):(h=[f,e,0,1],io(h,h,a));const g=h[3];return{point:new d.P(h[0]/g,h[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function He(f,e){return .5+f/e*.5}function ar(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function tn(f,e,a,l,h,g,y,w,T,E,A,R,P){const L=a?f.textSizeData:f.iconSizeData,U=d.an(L,e.transform.zoom),H=[256/e.width*2+1,256/e.height*2+1],$=a?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();const X=f.lineVertexArray,W=a?f.text.placedSymbolArray:f.icon.placedSymbolArray,ee=e.transform.width/e.transform.height;let Q=!1;for(let ne=0;ne<W.length;ne++){const le=W.get(ne);if(le.hidden||le.writingMode===d.ao.vertical&&!Q){La(le.numGlyphs,$);continue}Q=!1;const J=new d.P(le.anchorX,le.anchorY),de={getElevation:P,pitchedLabelPlaneMatrix:l,lineVertexArray:X,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:J,unwrappedTileID:T,width:E,height:A,translation:R},Ce=qi(le.anchorX,le.anchorY,de);if(!ar(Ce.point,H)){La(le.numGlyphs,$);continue}const be=He(e.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),Te=d.ap(L,U,le),Ae=g?Te*e.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,T)/be:Te*be,Qe=nt({projectionContext:de,pitchedLabelPlaneMatrixInverse:h,symbol:le,fontSize:Ae,flip:!1,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:$,aspectRatio:ee,rotateToLine:w});Q=Qe.useVertical,(Qe.notEnoughRoom||Q||Qe.needsFlipping&&nt({projectionContext:de,pitchedLabelPlaneMatrixInverse:h,symbol:le,fontSize:Ae,flip:!0,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:$,aspectRatio:ee,rotateToLine:w}).notEnoughRoom)&&La(le.numGlyphs,$)}a?f.text.dynamicLayoutVertexBuffer.updateData($):f.icon.dynamicLayoutVertexBuffer.updateData($)}function is(f,e,a,l,h,g,y,w){const T=g.glyphStartIndex+g.numGlyphs,E=g.lineStartIndex,A=g.lineStartIndex+g.lineLength,R=e.getoffsetX(g.glyphStartIndex),P=e.getoffsetX(T-1),L=Dr(f*R,a,l,h,g.segment,E,A,w,y);if(!L)return null;const U=Dr(f*P,a,l,h,g.segment,E,A,w,y);return U?w.projectionCache.anyProjectionOccluded?null:{first:L,last:U}:null}function ka(f,e,a,l){return f===d.ao.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*l?{useVertical:!0}:(f===d.ao.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function nt(f){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:l,fontSize:h,flip:g,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:T,aspectRatio:E,rotateToLine:A}=f,R=h/24,P=l.lineOffsetX*R,L=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const H=l.glyphStartIndex+l.numGlyphs,$=l.lineStartIndex,X=l.lineStartIndex+l.lineLength,W=is(R,w,P,L,g,l,A,e);if(!W)return{notEnoughRoom:!0};const ee=ia(W.first.point.x,W.first.point.y,e,a),Q=ia(W.last.point.x,W.last.point.y,e,a);if(y&&!g){const ne=ka(l.writingMode,ee,Q,E);if(ne)return ne}U=[W.first];for(let ne=l.glyphStartIndex+1;ne<H-1;ne++){const le=Dr(R*w.getoffsetX(ne),P,L,g,l.segment,$,X,e,A);if(!le)return{notEnoughRoom:!0};U.push(le)}U.push(W.last)}else{if(y&&!g){const $=mn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,X=l.lineStartIndex+l.segment+1,W=new d.P(e.lineVertexArray.getx(X),e.lineVertexArray.gety(X)),ee=mn(W.x,W.y,e),Q=ee.signedDistanceFromCamera>0?ee.point:jt(e.tileAnchorPoint,W,$,1,e),ne=ia($.x,$.y,e,a),le=ia(Q.x,Q.y,e,a),J=ka(l.writingMode,ne,le,E);if(J)return J}const H=Dr(R*w.getoffsetX(l.glyphStartIndex),P,L,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,A);if(!H||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[H]}for(const H of U)d.av(T,H.point,H.angle);return{}}function jt(f,e,a,l,h){const g=f.add(f.sub(e)._unit()),y=mn(g.x,g.y,h).point,w=a.sub(y);return a.add(w._mult(l/w.mag()))}function kt(f,e,a){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const h=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),g=mn(h.x,h.y,e);if(g.signedDistanceFromCamera>0)return l.projections[f]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const y=f-a.direction;return jt(a.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),h,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function mn(f,e,a){const l=f+a.translation[0],h=e+a.translation[1];let g;return a.pitchWithMap?(g=Gi(l,h,a.pitchedLabelPlaneMatrix,a.getElevation),g.isOccluded=!1):(g=a.transform.projectTileCoordinates(l,h,a.unwrappedTileID,a.getElevation),g.point.x=(.5*g.point.x+.5)*a.width,g.point.y=(.5*-g.point.y+.5)*a.height),g}function ia(f,e,a,l){if(a.pitchWithMap){const h=[f,e,0,1];return d.aw(h,h,l),a.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],a.unwrappedTileID,a.getElevation).point}return{x:f/a.width*2-1,y:1-e/a.height*2}}function qi(f,e,a){return a.transform.projectTileCoordinates(f,e,a.unwrappedTileID,a.getElevation)}function Ut(f,e,a){return f._unit()._perp()._mult(e*a)}function Ll(f,e,a,l,h,g,y,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const E=a.add(e);if(f+T.direction<l||f+T.direction>=h)return w.projectionCache.offsets[f]=E,E;const A=kt(f+T.direction,w,T),R=Ut(A.sub(a),y,T.direction),P=a.add(R),L=A.add(R);return w.projectionCache.offsets[f]=d.ax(g,E,P,L)||E,w.projectionCache.offsets[f]}function Dr(f,e,a,l,h,g,y,w,T){const E=l?f-e:f+e;let A=E>0?1:-1,R=0;l&&(A*=-1,R=Math.PI),A<0&&(R+=Math.PI);let P,L=A>0?g+h:g+h+1;w.projectionCache.cachedAnchorPoint?P=w.projectionCache.cachedAnchorPoint:(P=mn(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=P);let U,H,$=P,X=P,W=0,ee=0;const Q=Math.abs(E),ne=[];let le;for(;W+ee<=Q;){if(L+=A,L<g||L>=y)return null;W+=ee,X=$,H=U;const Ce={absOffsetX:Q,direction:A,distanceFromAnchor:W,previousVertex:X};if($=kt(L,w,Ce),a===0)ne.push(X),le=$.sub(X);else{let be;const Te=$.sub(X);be=Te.mag()===0?Ut(kt(L+A,w,Ce).sub($),a,A):Ut(Te,a,A),H||(H=X.add(be)),U=Ll(L,be,$,g,y,H,a,w,Ce),ne.push(H),le=U.sub(H)}ee=le.mag()}const J=le._mult((Q-W)/ee)._add(H||X),de=R+Math.atan2($.y-X.y,$.x-X.x);return ne.push(J),{point:J,angle:T?de:0,path:ne}}const ns=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function La(f,e){for(let a=0;a<f;a++){const l=e.length;e.resize(l+4),e.float32.set(ns,3*l)}}function io(f,e,a){const l=e[0],h=e[1];return f[0]=a[0]*l+a[4]*h+a[12],f[1]=a[1]*l+a[5]*h+a[13],f[3]=a[3]*l+a[7]*h+a[15],f}const nn=100;class Ec{constructor(e,a=new Pn(e.width+200,e.height+200,25),l=new Pn(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+nn,this.screenBottomBoundary=e.height+nn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,l,h,g,y,w,T,E,A,R,P){const L=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],g,A,P),U=l*L.perspectiveRatio;let H;if(y||w)H=this._projectCollisionBox(e,U,h,g,y,w,T,L,A,R,P);else{const le=L.x+(R?R.x*U:0),J=L.y+(R?R.y*U:0);H={allPointsOccluded:!1,box:[le+e.x1*U,J+e.y1*U,le+e.x2*U,J+e.y2*U]}}const[$,X,W,ee]=H.box,Q=y?H.allPointsOccluded:L.isOccluded;let ne=Q;return ne||(ne=L.perspectiveRatio<this.perspectiveRatioCutoff),ne||(ne=!this.isInsideGrid($,X,W,ee)),ne||a!=="always"&&this.grid.hitTest($,X,W,ee,a,E)?{box:[$,X,W,ee],placeable:!1,offscreen:!1,occluded:Q}:{box:[$,X,W,ee],placeable:!0,offscreen:this.isOffscreen($,X,W,ee),occluded:Q}}placeCollisionCircles(e,a,l,h,g,y,w,T,E,A,R,P,L,U){const H=[],$=new d.P(a.anchorX,a.anchorY),X=this.getPerspectiveRatio($.x,$.y,y,U),W=(E?g*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,y)/X:g*X)/d.aB,ee={getElevation:U,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:$,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:L},Q=is(W,h,a.lineOffsetX*W,a.lineOffsetY*W,!1,a,!1,ee);let ne=!1,le=!1,J=!0;if(Q){const de=.5*R*X+P,Ce=new d.P(-100,-100),be=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Te=new bi,Ae=Q.first,Qe=Q.last;let Ke=[];for(let Zt=Ae.path.length-1;Zt>=1;Zt--)Ke.push(Ae.path[Zt]);for(let Zt=1;Zt<Qe.path.length;Zt++)Ke.push(Qe.path[Zt]);const Fe=2.5*de;if(E){const Zt=this.projectPathToScreenSpace(Ke,ee);Ke=Zt.some((li=>li.signedDistanceFromCamera<=0))?[]:Zt.map((li=>li.point))}let ht=[];if(Ke.length>0){const Zt=Ke[0].clone(),li=Ke[0].clone();for(let Ui=1;Ui<Ke.length;Ui++)Zt.x=Math.min(Zt.x,Ke[Ui].x),Zt.y=Math.min(Zt.y,Ke[Ui].y),li.x=Math.max(li.x,Ke[Ui].x),li.y=Math.max(li.y,Ke[Ui].y);ht=Zt.x>=Ce.x&&li.x<=be.x&&Zt.y>=Ce.y&&li.y<=be.y?[Ke]:li.x<Ce.x||Zt.x>be.x||li.y<Ce.y||Zt.y>be.y?[]:d.ay([Ke],Ce.x,Ce.y,be.x,be.y)}for(const Zt of ht){Te.reset(Zt,.25*de);let li=0;li=Te.length<=.5*de?1:Math.ceil(Te.paddedLength/Fe)+1;for(let Ui=0;Ui<li;Ui++){const Ti=Ui/Math.max(li-1,1),Si=Te.lerp(Ti),Ri=Si.x+nn,Ai=Si.y+nn;H.push(Ri,Ai,de,0);const Mi=Ri-de,ti=Ai-de,zn=Ri+de,vn=Ai+de;if(J=J&&this.isOffscreen(Mi,ti,zn,vn),le=le||this.isInsideGrid(Mi,ti,zn,vn),e!=="always"&&this.grid.hitTestCircle(Ri,Ai,de,e,A)&&(ne=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ne}}}}return{circles:!T&&ne||!le||X<this.perspectiveRatioCutoff?[]:H,offscreen:J,collisionDetected:ne}}projectPathToScreenSpace(e,a){const l=(function(h,g){const y=d.L();return d.aq(y,g.pitchedLabelPlaneMatrix),h.map((w=>{const T=Gi(w.x,w.y,y,g.getElevation),E=g.transform.projectTileCoordinates(T.point.x,T.point.y,g.unwrappedTileID,g.getElevation);return E.point.x=(.5*E.point.x+.5)*g.width,E.point.y=(.5*-E.point.y+.5)*g.height,E}))})(e,a);return(function(h){let g=0,y=0,w=0,T=0;for(let E=0;E<h.length;E++)h[E].isOccluded?(w=E+1,T=0):(T++,T>y&&(y=T,g=w));return h.slice(g,g+y)})(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],l=new d.a2;for(const R of e){const P=new d.P(R.x+nn,R.y+nn);l.extend(P),a.push(P)}const{minX:h,minY:g,maxX:y,maxY:w}=l,T=this.grid.query(h,g,y,w).concat(this.ignoredGrid.query(h,g,y,w)),E={},A={};for(const R of T){const P=R.key;if(E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]={}),E[P.bucketInstanceId][P.featureIndex])continue;const L=[new d.P(R.x1,R.y1),new d.P(R.x2,R.y1),new d.P(R.x2,R.y2),new d.P(R.x1,R.y2)];d.az(a,L)&&(E[P.bucketInstanceId][P.featureIndex]=!0,A[P.bucketInstanceId]===void 0&&(A[P.bucketInstanceId]=[]),A[P.bucketInstanceId].push(P.featureIndex))}return A}insertCollisionBox(e,a,l,h,g,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:y,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,l,h,g,y){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:y,overlapMode:a};for(let E=0;E<e.length;E+=4)w.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,a,l,h,g){if(g){let y;h?(y=[e,a,h(e,a),1],d.aw(y,y,g)):(y=[e,a,0,1],io(y,y,g));const w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+nn,y:(-y[1]/w+1)/2*this.transform.height+nn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const y=this.transform.projectTileCoordinates(e,a,l,h);return{x:(y.point.x+1)/2*this.transform.width+nn,y:(1-y.point.y)/2*this.transform.height+nn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,l,h){const g=this.transform.projectTileCoordinates(e,a,l,h);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,a,l,h){return l<nn||e>=this.screenRightBoundary||h<nn||a>this.screenBottomBoundary}isInsideGrid(e,a,l,h){return l>=0&&e<this.gridRightBoundary&&h>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=d.ag([]);return d.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,l,h,g,y,w,T,E,A,R){let P=1,L=0,U=0,H=1;const $=e.anchorPointX+w[0],X=e.anchorPointY+w[1];if(y&&!g){const Ke=this.projectAndGetPerspectiveRatio($+1,X,h,E,R),Fe=Ke.x-T.x,ht=Math.atan((Ke.y-T.y)/Fe)+(Fe<0?Math.PI:0),Zt=Math.sin(ht),li=Math.cos(ht);P=li,L=Zt,U=-Zt,H=li}else if(!y&&g){const Ke=Rt(this.transform);P=Ke.vecEast[0],L=Ke.vecEast[1],U=Ke.vecSouth[0],H=Ke.vecSouth[1]}let W=T.x,ee=T.y,Q=a;g&&(W=$,ee=X,Q=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),Q*=this.transform.getPitchedTextCorrection($,X,h),A||(Q*=d.ah(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),A&&(W+=P*A.x*Q+U*A.y*Q,ee+=L*A.x*Q+H*A.y*Q);const ne=e.x1*Q,le=e.x2*Q,J=(ne+le)/2,de=e.y1*Q,Ce=e.y2*Q,be=(de+Ce)/2,Te=[{offsetX:ne,offsetY:de},{offsetX:J,offsetY:de},{offsetX:le,offsetY:de},{offsetX:le,offsetY:be},{offsetX:le,offsetY:Ce},{offsetX:J,offsetY:Ce},{offsetX:ne,offsetY:Ce},{offsetX:ne,offsetY:be}];let Ae=[];for(const{offsetX:Ke,offsetY:Fe}of Te)Ae.push(new d.P(W+P*Ke+U*Fe,ee+L*Ke+H*Fe));let Qe=!1;if(g){const Ke=Ae.map((Fe=>this.projectAndGetPerspectiveRatio(Fe.x,Fe.y,h,E,R)));Qe=Ke.some((Fe=>!Fe.isOccluded)),Ae=Ke.map((Fe=>new d.P(Fe.x,Fe.y)))}else Qe=!0;return{box:d.aA(Ae),allPointsOccluded:!Qe}}}class Yn{constructor(e,a,l,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class mi{constructor(e,a,l,h,g){this.text=new Yn(e?e.text:null,a,l,g),this.icon=new Yn(e?e.icon:null,a,h,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ba{constructor(e,a,l){this.text=e,this.icon=a,this.skipFade=l}}class no{constructor(e,a,l,h,g){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=g}}class Cc{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[e]}}function Vr(f,e,a,l,h){const{horizontalAlign:g,verticalAlign:y}=d.aH(f);return new d.P(-(g-.5)*e+l[0]*h,-(y-.5)*a+l[1]*h)}class Oa{constructor(e,a,l,h,g){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new Ec(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Cc(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(l,h)=>a.getElevation(e,l,h):null}getBucketParts(e,a,l,h){const g=l.getBucket(a),y=l.latestFeatureIndex;if(!g||!y||a.id!==g.layerIds[0])return;const w=l.collisionBoxArray,T=g.layers[0].layout,E=g.layers[0].paint,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/d.$,P=l.tileID.toUnwrapped(),L=T.get("text-rotation-alignment")==="map",U=d.aC(l,1,this.transform.zoom),H=d.aD(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),$=d.aD(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),X=Ei(L,this.transform,U);this.retainedQueryData[g.bucketInstanceId]=new no(g.bucketInstanceId,y,g.sourceLayerIndex,g.index,l.tileID);const W={bucket:g,layout:T,translationText:H,translationIcon:$,unwrappedTileID:P,pitchedLabelPlaneMatrix:X,scale:A,textPixelRatio:R,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(const ee of g.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ne,symbolInstanceEnd:le}=ee;e.push({sortKey:Q,symbolInstanceStart:ne,symbolInstanceEnd:le,parameters:W})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:W})}attemptAnchorPlacement(e,a,l,h,g,y,w,T,E,A,R,P,L,U,H,$,X,W,ee,Q){const ne=d.aE[e.textAnchor],le=[e.textOffset0,e.textOffset1],J=Vr(ne,l,h,le,g),de=this.collisionIndex.placeCollisionBox(a,P,T,E,A,w,y,$,R.predicate,ee,J,Q);if((!W||this.collisionIndex.placeCollisionBox(W,P,T,E,A,w,y,X,R.predicate,ee,J,Q).placeable)&&de.placeable){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:le,width:l,height:h,anchor:ne,textBoxScale:g,prevAnchor:Ce},this.markUsedJustification(U,ne,L,H),U.allowVerticalPlacement&&(this.markUsedOrientation(U,H,L),this.placedOrientations[L.crossTileID]=H),{shift:J,placedGlyphBoxes:de}}}placeLayerBucketPart(e,a,l){const{bucket:h,layout:g,translationText:y,translationIcon:w,unwrappedTileID:T,pitchedLabelPlaneMatrix:E,textPixelRatio:A,holdingForFade:R,collisionBoxArray:P,partiallyEvaluatedTextSize:L,collisionGroup:U}=e.parameters,H=g.get("text-optional"),$=g.get("icon-optional"),X=d.aF(g,"text-overlap","text-allow-overlap"),W=X==="always",ee=d.aF(g,"icon-overlap","icon-allow-overlap"),Q=ee==="always",ne=g.get("text-rotation-alignment")==="map",le=g.get("text-pitch-alignment")==="map",J=g.get("icon-text-fit")!=="none",de=g.get("symbol-z-order")==="viewport-y",Ce=W&&(Q||!h.hasIconData()||$),be=Q&&(W||!h.hasTextData()||H);!h.collisionArrays&&P&&h.deserializeCollisionBoxes(P);const Te=this.retainedQueryData[h.bucketInstanceId].tileID,Ae=this._getTerrainElevationFunc(Te),Qe=this.transform.getFastPathSimpleProjectionMatrix(Te),Ke=(Fe,ht,Zt)=>{var li,Ui;if(a[Fe.crossTileID])return;if(R)return void(this.placements[Fe.crossTileID]=new Ba(!1,!1,!1));let Ti=!1,Si=!1,Ri=!0,Ai=null,Mi={box:null,placeable:!1,offscreen:null,occluded:!1},ti={placeable:!1},zn=null,vn=null,Er=null,Ys=0,ys=0,Cr=0;ht.textFeatureIndex?Ys=ht.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(Ys=Fe.featureIndex),ht.verticalTextFeatureIndex&&(ys=ht.verticalTextFeatureIndex);const vs=ht.textBox;if(vs){const Gn=fi=>{let $i=d.ao.horizontal;if(h.allowVerticalPlacement&&!fi&&this.prevPlacement){const ur=this.prevPlacement.placedOrientations[Fe.crossTileID];ur&&(this.placedOrientations[Fe.crossTileID]=ur,$i=ur,this.markUsedOrientation(h,$i,Fe))}return $i},$a=(fi,$i)=>{if(h.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const ur of h.writingModes)if(ur===d.ao.vertical?(Mi=$i(),ti=Mi):Mi=fi(),Mi&&Mi.placeable)break}else Mi=fi()},Xa=Fe.textAnchorOffsetStartIndex,Ws=Fe.textAnchorOffsetEndIndex;if(Ws===Xa){const fi=($i,ur)=>{const an=this.collisionIndex.placeCollisionBox($i,X,A,Te,T,le,ne,y,U.predicate,Ae,void 0,Qe);return an&&an.placeable&&(this.markUsedOrientation(h,ur,Fe),this.placedOrientations[Fe.crossTileID]=ur),an};$a((()=>fi(vs,d.ao.horizontal)),(()=>{const $i=ht.verticalTextBox;return h.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&$i?fi($i,d.ao.vertical):{box:null,offscreen:null}})),Gn(Mi&&Mi.placeable)}else{let fi=d.aE[(Ui=(li=this.prevPlacement)===null||li===void 0?void 0:li.variableOffsets[Fe.crossTileID])===null||Ui===void 0?void 0:Ui.anchor];const $i=(an,Kc,Wc)=>{const wl=an.x2-an.x1,Ea=an.y2-an.y1,Ya=Fe.textBoxScale,cn=J&&ee==="never"?Kc:null;let sn=null,Ka=X==="never"?1:2,bs="never";fi&&Ka++;for(let ws=0;ws<Ka;ws++){for(let sa=Xa;sa<Ws;sa++){const un=h.textAnchorOffsets.get(sa);if(fi&&un.textAnchor!==fi)continue;const zo=this.attemptAnchorPlacement(un,an,wl,Ea,Ya,ne,le,A,Te,T,U,bs,Fe,h,Wc,y,w,cn,Ae);if(zo&&(sn=zo.placedGlyphBoxes,sn&&sn.placeable))return Ti=!0,Ai=zo.shift,sn}fi?fi=null:bs=X}return l&&!sn&&(sn={box:this.collisionIndex.placeCollisionBox(vs,"always",A,Te,T,le,ne,y,U.predicate,Ae,void 0,Qe).box,offscreen:!1,placeable:!1,occluded:!1}),sn};$a((()=>$i(vs,ht.iconBox,d.ao.horizontal)),(()=>{const an=ht.verticalTextBox;return h.allowVerticalPlacement&&(!Mi||!Mi.placeable)&&Fe.numVerticalGlyphVertices>0&&an?$i(an,ht.verticalIconBox,d.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Mi&&(Ti=Mi.placeable,Ri=Mi.offscreen);const ur=Gn(Mi&&Mi.placeable);if(!Ti&&this.prevPlacement){const an=this.prevPlacement.variableOffsets[Fe.crossTileID];an&&(this.variableOffsets[Fe.crossTileID]=an,this.markUsedJustification(h,an.anchor,Fe,ur))}}}if(zn=Mi,Ti=zn&&zn.placeable,Ri=zn&&zn.offscreen,Fe.useRuntimeCollisionCircles){const Gn=h.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex),$a=d.ap(h.textSizeData,L,Gn),Xa=g.get("text-padding");vn=this.collisionIndex.placeCollisionCircles(X,Gn,h.lineVertexArray,h.glyphOffsetArray,$a,T,E,l,le,U.predicate,Fe.collisionCircleDiameter,Xa,y,Ae),vn.circles.length&&vn.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),Ti=W||vn.circles.length>0&&!vn.collisionDetected,Ri=Ri&&vn.offscreen}if(ht.iconFeatureIndex&&(Cr=ht.iconFeatureIndex),ht.iconBox){const Gn=$a=>this.collisionIndex.placeCollisionBox($a,ee,A,Te,T,le,ne,w,U.predicate,Ae,J&&Ai?Ai:void 0,Qe);ti&&ti.placeable&&ht.verticalIconBox?(Er=Gn(ht.verticalIconBox),Si=Er.placeable):(Er=Gn(ht.iconBox),Si=Er.placeable),Ri=Ri&&Er.offscreen}const Ks=H||Fe.numHorizontalGlyphVertices===0&&Fe.numVerticalGlyphVertices===0,hc=$||Fe.numIconVertices===0;Ks||hc?hc?Ks||(Si=Si&&Ti):Ti=Si&&Ti:Si=Ti=Si&&Ti;const xs=Si&&Er.placeable;if(Ti&&zn.placeable&&this.collisionIndex.insertCollisionBox(zn.box,X,g.get("text-ignore-placement"),h.bucketInstanceId,ti&&ti.placeable&&ys?ys:Ys,U.ID),xs&&this.collisionIndex.insertCollisionBox(Er.box,ee,g.get("icon-ignore-placement"),h.bucketInstanceId,Cr,U.ID),vn&&Ti&&this.collisionIndex.insertCollisionCircles(vn.circles,X,g.get("text-ignore-placement"),h.bucketInstanceId,Ys,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,Zt,ht,zn,Er,vn),Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fe.crossTileID]=new Ba((Ti||Ce)&&!zn?.occluded,(Si||be)&&!Er?.occluded,Ri||h.justReloaded),a[Fe.crossTileID]=!0};if(de){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fe=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ht=Fe.length-1;ht>=0;--ht){const Zt=Fe[ht];Ke(h.symbolInstances.get(Zt),h.collisionArrays[Zt],Zt)}}else for(let Fe=e.symbolInstanceStart;Fe<e.symbolInstanceEnd;Fe++)Ke(h.symbolInstances.get(Fe),h.collisionArrays[Fe],Fe);h.justReloaded=!1}storeCollisionData(e,a,l,h,g,y){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(a)?T=w.get(a):(T={text:null,icon:null},w.set(a,T)),l.textBox&&(T.text=h.box),l.iconBox&&(T.icon=g.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)w.push(y.circles[T+0]-nn),w.push(y.circles[T+1]-nn),w.push(y.circles[T+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,a,l,h){let g;g=h===d.ao.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.aG(a)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:l.crossTileID)}markUsedOrientation(e,a,l){const h=a===d.ao.horizontal||a===d.ao.horizontalOnly?a:0,g=a===d.ao.vertical?a:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of y)e.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const h=a?a.symbolFadeChange(e):1,g=a?a.opacities:{},y=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],A=g[T];A?(this.opacities[T]=new mi(A,h,E.text,E.icon),l=l||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[T]=new mi(null,h,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in g){const E=g[T];if(!this.opacities[T]){const A=new mi(E,h,!1,!1);A.isHidden()||(this.opacities[T]=A,l=l||E.text.placed||E.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const l={};for(const h of a){const g=h.getBucket(e);g&&h.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(e,a,l,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],y=g.layout,w=new mi(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),E=y.get("icon-allow-overlap"),A=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=y.get("text-rotation-alignment")==="map",P=y.get("text-pitch-alignment")==="map",L=y.get("icon-text-fit")!=="none",U=new mi(null,0,T&&(E||!e.hasIconData()||y.get("icon-optional")),E&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const H=(X,W,ee)=>{for(let Q=0;Q<W/4;Q++)X.opacityVertexArray.emplaceBack(ee);X.hasVisibleVertices=X.hasVisibleVertices||ee!==Xo},$=this.collisionBoxArrays.get(e.bucketInstanceId);for(let X=0;X<e.symbolInstances.length;X++){const W=e.symbolInstances.get(X),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:Q,crossTileID:ne}=W;let le=this.opacities[ne];l[ne]?le=w:le||(le=U,this.opacities[ne]=le),l[ne]=!0;const J=W.numIconVertices>0,de=this.placedOrientations[W.crossTileID],Ce=de===d.ao.vertical,be=de===d.ao.horizontal||de===d.ao.horizontalOnly;if(ee>0||Q>0){const Ae=$o(le.text);H(e.text,ee,Ce?Xo:Ae),H(e.text,Q,be?Xo:Ae);const Qe=le.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach((ht=>{ht>=0&&(e.text.placedSymbolArray.get(ht).hidden=Qe||Ce?1:0)})),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Qe||be?1:0);const Ke=this.variableOffsets[W.crossTileID];Ke&&this.markUsedJustification(e,Ke.anchor,W,de);const Fe=this.placedOrientations[W.crossTileID];Fe&&(this.markUsedJustification(e,"left",W,Fe),this.markUsedOrientation(e,Fe,W))}if(J){const Ae=$o(le.icon),Qe=!(L&&W.verticalPlacedIconSymbolIndex&&Ce);W.placedIconSymbolIndex>=0&&(H(e.icon,W.numIconVertices,Qe?Ae:Xo),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=le.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,W.numVerticalIconVertices,Qe?Xo:Ae),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const Te=$&&$.has(X)?$.get(X):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ae=e.collisionArrays[X];if(Ae){let Qe=new d.P(0,0);if(Ae.textBox||Ae.verticalTextBox){let Ke=!0;if(A){const Fe=this.variableOffsets[ne];Fe?(Qe=Vr(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale),R&&Qe._rotate(P?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ke=!1}if(Ae.textBox||Ae.verticalTextBox){let Fe;Ae.textBox&&(Fe=Ce),Ae.verticalTextBox&&(Fe=be),Bl(e.textCollisionBox.collisionVertexArray,le.text.placed,!Ke||Fe,Te.text,Qe.x,Qe.y)}}if(Ae.iconBox||Ae.verticalIconBox){const Ke=!!(!be&&Ae.verticalIconBox);let Fe;Ae.iconBox&&(Fe=Ke),Ae.verticalIconBox&&(Fe=!Ke),Bl(e.iconCollisionBox.collisionVertexArray,le.icon.placed,Fe,Te.icon,L?Qe.x:0,L?Qe.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Bl(f,e,a,l,h,g){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-nn,w=l[1]-nn,T=l[2]-nn,E=l[3]-nn;f.emplaceBack(e?1:0,a?1:0,h||0,g||0,y,w),f.emplaceBack(e?1:0,a?1:0,h||0,g||0,T,w),f.emplaceBack(e?1:0,a?1:0,h||0,g||0,T,E),f.emplaceBack(e?1:0,a?1:0,h||0,g||0,y,E)}const Sh=Math.pow(2,25),vu=Math.pow(2,24),Kn=Math.pow(2,17),xu=Math.pow(2,16),ud=Math.pow(2,9),Ac=Math.pow(2,8),Mh=Math.pow(2,1);function $o(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,a=Math.floor(127*f.opacity);return a*Sh+e*vu+a*Kn+e*xu+a*ud+e*Ac+a*Mh+e}const Xo=0;class Ir{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,l,h,g){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(y,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort(((w,T)=>w.sortKey-T.sortKey)));this._currentPartIndex<y.length;)if(a.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class Ol{constructor(e,a,l,h,g,y,w,T){this.placement=new Oa(e,a,y,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,a,l){const h=Ue.now(),g=()=>!this._forceFullPlacement&&Ue.now()-h>2;for(;this._currentPlacementIndex>=0;){const y=a[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Ir(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ro=512/d.$/2;class Fl{constructor(e,a,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let g=0;g<a.length;g++){const y=a.get(g),w=y.key,T=h.get(w);T?T.push(y):h.set(w,[y])}for(const[g,y]of h){const w={positions:y.map((T=>({x:Math.floor(T.anchorX*ro),y:Math.floor(T.anchorY*ro)}))),crossTileIDs:y.map((T=>T.crossTileID))};if(w.positions.length>128){const T=new d.aI(w.positions.length,16,Uint16Array);for(const{x:E,y:A}of w.positions)T.add(E,A);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[g]=w}}getScaledCoordinates(e,a){const{x:l,y:h,z:g}=this.tileID.canonical,{x:y,y:w,z:T}=a.canonical,E=ro/Math.pow(2,T-g),A=(w*d.$+e.anchorY)*E,R=h*d.$*ro;return{x:Math.floor((y*d.$+e.anchorX)*E-l*d.$*ro),y:Math.floor(A-R)}}findMatches(e,a,l){const h=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<e.length;g++){const y=e.get(g);if(y.crossTileID)continue;const w=this._symbolsByKey[y.key];if(!w)continue;const T=this.getScaledCoordinates(y,a);if(w.index){const E=w.index.range(T.x-h,T.y-h,T.x+h,T.y+h).sort();for(const A of E){const R=w.crossTileIDs[A];if(!l[R]){l[R]=!0,y.crossTileID=R;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const A=w.positions[E],R=w.crossTileIDs[E];if(Math.abs(A.x-T.x)<=h&&Math.abs(A.y-T.y)<=h&&!l[R]){l[R]=!0,y.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Rs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Eh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const l in this.indexes){const h=this.indexes[l],g={};for(const y in h){const w=h[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),g[w.tileID.key]=w}this.indexes[l]=g}this.lng=e}addBucket(e,a,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const y=this.indexes[g];if(Number(g)>e.overscaledZ)for(const w in y){const T=y[w];T.tileID.isChildOf(e)&&T.findMatches(a.symbolInstances,e,h)}else{const w=y[e.scaledTo(Number(g)).key];w&&w.findMatches(a.symbolInstances,e,h)}}for(let g=0;g<a.symbolInstances.length;g++){const y=a.symbolInstances.get(g);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Fl(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const l of a.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let a=!1;for(const l in this.indexes){const h=this.indexes[l];for(const g in h)e[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[g]),delete h[g],a=!0)}return a}}class ao{constructor(){this.layerIndexes={},this.crossTileIDs=new Rs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,l){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new Eh);let g=!1;const y={};h.handleWrapJump(l);for(const w of a){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,T,this.crossTileIDs)&&(g=!0),y[T.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(g=!0),g}pruneUnusedLayers(e){const a={};e.forEach((l=>{a[l]=!0}));for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}var Fa="void main() {fragColor=vec4(1.0);}";const fa={prelude:$t(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:$t("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:$t("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:$t(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:$t(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:$t(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:$t(Fa,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:$t(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:$t(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:$t("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:$t(Fa,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:$t(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:$t(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:$t(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:$t(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:$t(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:$t(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:$t(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:$t(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:$t(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:$t(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:$t("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:$t("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:$t("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:$t("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:$t(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:$t("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function $t(f,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),h=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=g?g.concat(h):h,w={};return{fragmentSource:f=f.replace(a,((T,E,A,R,P)=>(w[P]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${P}
in ${A} ${R} ${P};
#else
uniform ${A} ${R} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${A} ${R} ${P} = u_${P};
#endif
`))),vertexSource:e=e.replace(a,((T,E,A,R,P)=>{const L=R==="float"?"vec2":"vec4",U=P.match(/color/)?"color":L;return w[P]?E==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${A} ${L} a_${P};
out ${A} ${R} ${P};
#else
uniform ${A} ${R} u_${P};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${A} ${R} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${U}(a_${P}, u_${P}_t);
#else
    ${A} ${R} ${P} = u_${P};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${A} ${L} a_${P};
#else
uniform ${A} ${R} u_${P};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${A} ${R} ${P} = a_${P};
#else
    ${A} ${R} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${A} ${R} ${P} = unpack_mix_${U}(a_${P}, u_${P}_t);
#else
    ${A} ${R} ${P} = u_${P};
#endif
`})),staticAttributes:l,staticUniforms:y}}class Ds{constructor(e,a,l){this.vertexBuffer=e,this.indexBuffer=a,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ja=d.aJ([{name:"a_pos",type:"Int16",components:2}]);const rs="#define PROJECTION_MERCATOR",so="mercator";class qt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return so}get shaderDefine(){return rs}get shaderPreludeCode(){return fa.projectionMercator}get vertexShaderPreludeCode(){return fa.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,l,h,g){if(this._cachedMesh)return this._cachedMesh;const y=new d.aL;y.emplaceBack(0,0),y.emplaceBack(d.$,0),y.emplaceBack(0,d.$),y.emplaceBack(d.$,d.$);const w=e.createVertexBuffer(y,ja.members),T=d.aM.simpleSegment(0,0,4,2),E=new d.aN;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const A=e.createIndexBuffer(E);return this._cachedMesh=new Ds(w,A,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class as{constructor(e=0,a=0,l=0,h=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=l,this.right=h}interpolate(e,a,l){return a.top!=null&&e.top!=null&&(this.top=d.C.number(e.top,a.top,l)),a.bottom!=null&&e.bottom!=null&&(this.bottom=d.C.number(e.bottom,a.bottom,l)),a.left!=null&&e.left!=null&&(this.left=d.C.number(e.left,a.left,l)),a.right!=null&&e.right!=null&&(this.right=d.C.number(e.right,a.right,l)),this}getCenter(e,a){const l=d.ah((this.left+e-this.right)/2,0,e),h=d.ah((this.top+a-this.bottom)/2,0,a);return new d.P(l,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Yo(f,e){if(!f.renderWorldCopies||f.lngRange)return;const a=e.lng-f.center.lng;e.lng+=a>180?-360:a<-180?360:0}function ss(f){return Math.max(0,Math.floor(f))}class Cn{constructor(e,a,l,h,g,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=a||0,this._maxZoom=l||22,this._minPitch=h??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ss(this._zoom),this._scale=d.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new as,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ss(this._zoom),this._scale=d.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new as(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,a&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const a=d.aO(e,-180,180)*Math.PI/180;var l,h,g,y,w,T,E,A,R;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=Ie(),l=this._rotationMatrix,g=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],w=h[1],T=h[2],E=h[3],A=Math.sin(g),R=Math.cos(g),l[0]=y*R+T*A,l[1]=w*R+E*A,l[2]=y*-A+T*R,l[3]=w*-A+E*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const a=d.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aP(this._fovInRadians)}setFov(e){e=d.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=d.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const a=this.getConstrained(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=d.af(a),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,l){this._unmodified=!1,this._edgeInsets.interpolate(e,a,l),this._constrain(),this._calcMatrices()}resize(e,a,l=!0){this._width=e,this._height=a,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Yi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-d.ai,d.ai])}getConstrained(e,a){return this._callbacks.getConstrained(e,a)}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{const{minX:l,minY:h,maxX:g,maxY:y}=d.a2.fromPoints(a).extend(e);return[new d.P(l,h),new d.P(g,h),new d.P(g,y),new d.P(l,y),new d.P(l,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(a),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=d.ag(new Float64Array(16));d.N(e,e,[this._width/2,-this._height/2,1]),d.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=d.ag(new Float64Array(16)),d.N(e,e,[1,-1,1]),d.M(e,e,[-1,-1,0]),d.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,l,h){const g=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,w=d.a1.fromLngLat(e,a),T=-Math.cos(d.ae(y)),E=Math.sin(d.ae(y)),A=E*Math.sin(d.ae(g)),R=-E*Math.cos(d.ae(g));let P=this.elevation;const L=a-P;let U;T*L>=0||Math.abs(T)<.1?(U=1e4,P=a+U*T):U=-L/T;let H,$,X=d.aQ(1,w.y),W=0;do{if(W+=1,W>10)break;$=U/X,H=new d.a1(w.x+A*$,w.y+R*$),X=1/H.meterInMercatorCoordinateUnits()}while(Math.abs(U-$*X)>1e-12);return{center:H.toLngLat(),elevation:P,zoom:d.ak(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const a=d.aj(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/a,h=d.a1.fromLngLat(this.center,this.elevation),g=Me(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),d.aQ(g.z,h.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=d.aj(1,this.center.lat)*this.worldSize;return Me(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/d.$,1/a/d.$]}}class Rn{constructor(e,a){this.min=e,this.max=a,this.center=d.aR([],d.aS([],this.min,this.max),.5)}quadrant(e){const a=[e%2==0,e<2],l=d.aT(this.min),h=d.aT(this.max);for(let g=0;g<a.length;g++)l[g]=a[g]?this.min[g]:this.center[g],h[g]=a[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Rn(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let l=0;l<e.planes.length;l++){const h=this.intersectsPlane(e.planes[l]);if(h===0)return 0;h===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],l=e[3];for(let h=0;h<3;h++)e[h]>0?(a+=e[h]*this.min[h],l+=e[h]*this.max[h]):(l+=e[h]*this.min[h],a+=e[h]*this.max[h]);return a>=0?2:l<0?0:1}}class Wn{distanceToTile2d(e,a,l,h){const g=h.distanceX([e,a]),y=h.distanceY([e,a]);return Math.hypot(g,y)}getWrap(e,a,l){return l}getTileBoundingVolume(e,a,l,h){var g,y;let w=0,T=0;if(h?.terrain){const A=new d.Z(e.z,a,e.z,e.x,e.y),R=h.terrain.getMinMaxElevation(A);w=(g=R.minElevation)!==null&&g!==void 0?g:Math.min(0,l),T=(y=R.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}const E=1<<e.z;return new Rn([a+e.x/E,e.y/E,w],[a+(e.x+1)/E,(e.y+1)/E,T])}allowVariableZoom(e,a){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=d.ah(78.5-l/2,0,60);return!!a.terrain||e.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class gn{constructor(e,a,l){this.points=e,this.planes=a,this.aabb=l}static fromInvProjectionMatrix(e,a=1,l=0,h,g){const y=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>(function(L,U,H,$){const X=d.aw([],L,U),W=1/X[3]/H*$;return d.aY(X,X,[W,W,1/X[3],W])})(P,e,a,w)));h&&(function(P,L,U,H){const $=H?4:0,X=H?0:4;let W=0;const ee=[],Q=[];for(let J=0;J<4;J++){const de=d.aU([],P[J+X],P[J+$]),Ce=d.aZ(de);d.aR(de,de,1/Ce),ee.push(Ce),Q.push(de)}for(let J=0;J<4;J++){const de=d.a_(P[J+$],Q[J],U);W=de!==null&&de>=0?Math.max(W,de):Math.max(W,ee[J])}const ne=(function(J,de){const Ce=d.aU([],J[de[0]],J[de[1]]),be=d.aU([],J[de[2]],J[de[1]]),Te=[0,0,0,0];return d.aV(Te,d.aW([],Ce,be)),Te[3]=-d.aX(Te,J[de[0]]),Te})(P,L),le=(function(J,de){const Ce=d.a$(J),be=d.b0([],J,1/Ce),Te=d.aU([],de,d.aR([],be,d.aX(de,be))),Ae=d.a$(Te);if(Ae>0){const Qe=Math.sqrt(1-be[3]*be[3]),Ke=d.aR([],be,-be[3]),Fe=d.aS([],Ke,d.aR([],Te,Qe/Ae));return d.b1(de,Fe)}return null})(U,ne);if(le!==null){const J=le/d.aX(Q[0],ne);W=Math.min(W,J)}for(let J=0;J<4;J++){const de=Math.min(W,ee[J]);P[J+X]=[P[J+$][0]+Q[J][0]*de,P[J+$][1]+Q[J][1]*de,P[J+$][2]+Q[J][2]*de,1]}})(T,y[0],h,g);const E=y.map((P=>{const L=d.aU([],T[P[0]],T[P[1]]),U=d.aU([],T[P[2]],T[P[1]]),H=d.aV([],d.aW([],L,U)),$=-d.aX(H,T[P[1]]);return H.concat($)})),A=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const P of T)for(let L=0;L<3;L++)A[L]=Math.min(A[L],P[L]),R[L]=Math.max(R[L],P[L]);return new gn(T,E,new Rn(A,R))}}class di{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,l){return this._helper.interpolatePadding(e,a,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,l=!0){this._helper.resize(e,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e,a,l,h,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Cn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,w)=>this.getConstrained(y,w)},e,a,l,h,g),this._coveringTilesDetailsProvider=new Wn}clone(){const e=new di;return e.apply(this),e}apply(e,a,l){this._helper.apply(e,a,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const a=[new d.b2(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),h=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,h.x,g.x,y.x)),T=Math.floor(Math.max(l.x,h.x,g.x,y.x)),E=1;for(let A=w-E;A<=T+E;A++)A!==0&&a.push(new d.b2(A,e))}return a}getCameraFrustum(){return gn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const a=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,a){const l=d.aj(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(a,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=d.a1.fromLngLat(e),w=new d.a1(y.x-(h.x-g.x),y.y-(h.y-g.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(d.a1.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(d.a1.fromLngLat(e))}screenPointToLocation(e,a){var l;return(l=this.screenPointToMercatorCoordinate(e,a))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){const l=a.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){const l=a||0,h=[e.x,e.y,0,1],g=[e.x,e.y,1,1];d.aw(h,h,this._pixelMatrixInverse),d.aw(g,g,this._pixelMatrixInverse);const y=h[3],w=g[3],T=h[1]/y,E=g[1]/w,A=h[2]/y,R=g[2]/w,P=A===R?0:(l-A)/(R-A);return new d.a1(d.C.number(h[0]/y,g[0]/w,P)/this.worldSize,d.C.number(T,E,P)/this.worldSize,l)}coordinatePoint(e,a=0,l=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,a,1];return d.aw(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-se(this));return new Yi().extend(this.screenPointToLocation(new d.P(0,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-se(this)}calculatePosMatrix(e,a=!1,l){var h;const g=(h=e.key)!==null&&h!==void 0?h:d.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=a?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(g)){const E=y.get(g);return l?E.f32:E.f64}const w=he(e,this.worldSize);d.O(w,a?this._alignedProjMatrix:this._viewProjMatrix,w);const T={f64:w,f32:new Float32Array(w)};return y.set(g,T),l?T.f32:T.f64}calculateFogMatrix(e){const a=e.key,l=this._fogMatrixCacheF32;if(l.has(a))return l.get(a);const h=he(e,this.worldSize);return d.O(h,this._fogMatrix,h),l.set(a,new Float32Array(h)),l.get(a)}getConstrained(e,a){a=d.ah(+a,this.minZoom,this.maxZoom);const l={center:new d.S(e.lng,e.lat),zoom:a};let h=this._helper._lngRange;if(!this._helper._renderWorldCopies&&h===null){const ee=179.9999999999;h=[-ee,ee]}const g=this.tileSize*d.af(l.zoom);let y=0,w=g,T=0,E=g,A=0,R=0;const{x:P,y:L}=this.size;if(this._helper._latRange){const ee=this._helper._latRange;y=d.U(ee[1])*g,w=d.U(ee[0])*g,w-y<L&&(A=L/(w-y))}h&&(T=d.aO(d.V(h[0])*g,0,g),E=d.aO(d.V(h[1])*g,0,g),E<T&&(E+=g),E-T<P&&(R=P/(E-T)));const{x:U,y:H}=G(g,e);let $,X;const W=Math.max(R||0,A||0);if(W){const ee=new d.P(R?(E+T)/2:U,A?(w+y)/2:H);return l.center=ie(g,ee).wrap(),l.zoom+=d.ak(W),l}if(this._helper._latRange){const ee=L/2;H-ee<y&&(X=y+ee),H+ee>w&&(X=w-ee)}if(h){const ee=(T+E)/2;let Q=U;this._helper._renderWorldCopies&&(Q=d.aO(U,ee-g/2,ee+g/2));const ne=P/2;Q-ne<T&&($=T+ne),Q+ne>E&&($=E-ne)}if($!==void 0||X!==void 0){const ee=new d.P($??U,X??H);l.center=ie(g,ee).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,l,h)}_calculateNearFarZIfNeeded(e,a,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-h*this._helper._pixelPerMeter/Math.cos(a),y=h<0?g:e,w=Math.PI/2+this.pitchInRadians,T=d.ae(this.fov)*(Math.abs(Math.cos(d.ae(this.roll)))*this.height+Math.abs(Math.sin(d.ae(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(T)*y/Math.sin(d.ah(Math.PI-w-T,.01,Math.PI-.01)),A=se(this),R=Math.atan(A/this._helper.cameraToCenterDistance),P=d.ae(.75),L=R>P?2*R*(.5+l.y/(2*A)):P,U=Math.sin(L)*y/Math.sin(d.ah(Math.PI-w-L,.01,Math.PI-.01)),H=Math.min(E,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*H+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,a=G(this.worldSize,this.center),l=a.x,h=a.y;this._helper._pixelPerMeter=d.aj(1,this.center.lat)*this.worldSize;const g=d.ae(Math.min(this.pitch,j)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let w;this._calculateNearFarZIfNeeded(y,g,e),w=new Float64Array(16),d.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=d.b5(w),d.N(w,w,[1,-1,1]),d.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),d.b6(w,w,-this.rollInRadians),d.b7(w,w,this.pitchInRadians),d.b6(w,w,-this.bearingInRadians),d.M(w,w,[-l,-h,0]),this._mercatorMatrix=d.N([],w,[this.worldSize,this.worldSize,this.worldSize]),d.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),d.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=d.aq([],w);const T=[0,0,-1,1];d.aw(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),d.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,d.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.M(this._fogMatrix,this._fogMatrix,[-l,-h,0]),d.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const E=this._helper._width%2/2,A=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),P=Math.sin(-this.bearingInRadians),L=l-Math.round(l)+R*E+P*A,U=h-Math.round(h)+R*A+P*E,H=new Float64Array(w);if(d.M(H,H,[L>.5?L-1:L,U>.5?U-1:U,0]),this._alignedProjMatrix=H,w=d.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new d.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.aw(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=d.aj(1,this.center.lat)*this.worldSize;return Me(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){const l=d.a1.fromLngLat(e),h=[l.x*this.worldSize,l.y*this.worldSize,a,1];return d.aw(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:a,aligned:l,applyTerrainMatrix:h}=e,g=this._helper.getMercatorTileCoordinates(a),y=a?this.calculatePosMatrix(a,l,!0):null;let w;return w=a&&a.terrainRttPosMatrix32f&&h?a.terrainRttPosMatrix32f:y||d.b8(),{mainMatrix:w,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,l){return 1}transformLightDirection(e){return d.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,l,h){const g=this.calculatePosMatrix(l);let y;h?(y=[e,a,h(e,a),1],d.aw(y,y,g)):(y=[e,a,0,1],io(y,y,g));const w=y[3];return{point:new d.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){const l=d.a1.fromLngLat(e,a),h=l.meterInMercatorCoordinateUnits(),g=d.b9();return d.M(g,g,[l.x,l.y,l.z]),d.b6(g,g,Math.PI),d.b7(g,g,Math.PI/2),d.N(g,g,[-h,h,h]),g}getProjectionDataForCustomLayer(e=!0){const a=new d.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),h=he(a,this.worldSize);d.O(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const g=[d.$,d.$,this.worldSize/this._helper.pixelsPerMeter],y=d.ba();return d.N(y,h,g),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Ua(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Qn(f){if(f.useSlerp)if(f.k<1){const e=d.bb(f.startEulerAngles.roll,f.startEulerAngles.pitch,f.startEulerAngles.bearing),a=d.bb(f.endEulerAngles.roll,f.endEulerAngles.pitch,f.endEulerAngles.bearing),l=new Float64Array(4);d.bc(l,e,a,f.k);const h=d.bd(l);f.tr.setRoll(h.roll),f.tr.setPitch(h.pitch),f.tr.setBearing(h.bearing)}else f.tr.setRoll(f.endEulerAngles.roll),f.tr.setPitch(f.endEulerAngles.pitch),f.tr.setBearing(f.endEulerAngles.bearing);else f.tr.setRoll(d.C.number(f.startEulerAngles.roll,f.endEulerAngles.roll,f.k)),f.tr.setPitch(d.C.number(f.startEulerAngles.pitch,f.endEulerAngles.pitch,f.k)),f.tr.setBearing(d.C.number(f.startEulerAngles.bearing,f.endEulerAngles.bearing,f.k))}function Jn(f,e,a,l,h){const g=h.padding,y=G(h.worldSize,a.getNorthWest()),w=G(h.worldSize,a.getNorthEast()),T=G(h.worldSize,a.getSouthEast()),E=G(h.worldSize,a.getSouthWest()),A=d.ae(-l),R=y.rotate(A),P=w.rotate(A),L=T.rotate(A),U=E.rotate(A),H=new d.P(Math.max(R.x,P.x,U.x,L.x),Math.max(R.y,P.y,U.y,L.y)),$=new d.P(Math.min(R.x,P.x,U.x,L.x),Math.min(R.y,P.y,U.y,L.y)),X=H.sub($),W=(h.width-(g.left+g.right+e.left+e.right))/X.x,ee=(h.height-(g.top+g.bottom+e.top+e.bottom))/X.y;if(ee<0||W<0)return void Ua();const Q=Math.min(d.ak(h.scale*Math.min(W,ee)),f.maxZoom),ne=d.P.convert(f.offset),le=new d.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(d.ae(l)),J=ne.add(le).mult(h.scale/d.af(Q));return{center:ie(h.worldSize,y.add(T).div(2).sub(J)),zoom:Q,bearing:l}}class rn{get useGlobeControls(){return!1}handlePanInertia(e,a){const l=e.mag(),h=Math.abs(se(a));return{easingOffset:e.mult(Math.min(.75*h/l,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,l){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,a,l,h,g){return Jn(e,a,l,h,g)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(d.S.convert(a.center))}handleEaseTo(e,a){const l=e.zoom,h=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},w=a.zoom!==void 0,T=!e.isPaddingEqual(a.padding);let E=!1;const A=w?+a.zoom:e.zoom;let R=e.centerPoint.add(a.offsetAsPoint);const P=e.screenPointToLocation(R),{center:L,zoom:U}=e.getConstrained(d.S.convert(a.center||P),A??l);Yo(e,L);const H=G(e.worldSize,P),$=G(e.worldSize,L).sub(H),X=d.af(U-l);return E=U!==l,{easeFunc:W=>{if(E&&e.setZoom(d.C.number(l,U,W)),d.be(g,y)||Qn({startEulerAngles:g,endEulerAngles:y,tr:e,k:W,useSlerp:g.roll!=y.roll}),T&&(e.interpolatePadding(h,a.padding,W),R=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{const ee=d.af(e.zoom-l),Q=U>l?Math.min(2,X):Math.max(.5,X),ne=Math.pow(Q,1-W),le=ie(e.worldSize,H.add($.mult(W*ne)).mult(ee));e.setLocationAtPoint(e.renderWorldCopies?le.wrap():le,R)}},isZooming:E,elevationCenter:L}}handleFlyTo(e,a){const l=a.zoom!==void 0,h=e.zoom,g=e.getConstrained(d.S.convert(a.center||a.locationAtOffset),l?+a.zoom:h),y=g.center,w=g.zoom;Yo(e,y);const T=G(e.worldSize,a.locationAtOffset),E=G(e.worldSize,y).sub(T),A=E.mag(),R=d.af(w-h);let P;if(a.minZoom!==void 0){const L=Math.min(+a.minZoom,h,w),U=e.getConstrained(y,L).zoom;P=d.af(U-h)}return{easeFunc:(L,U,H,$)=>{e.setZoom(L===1?w:h+d.ak(U));const X=L===1?y:ie(e.worldSize,T.add(E.mult(H)).mult(U));e.setLocationAtPoint(e.renderWorldCopies?X.wrap():X,$)},scaleOfZoom:R,targetCenter:y,scaleOfMinZoom:P,pixelPathLength:A}}}class Ci{constructor(e,a,l){this.blendFunction=e,this.blendColor=a,this.mask=l}}Ci.Replace=[1,0],Ci.disabled=new Ci(Ci.Replace,d.bf.transparent,[!1,!1,!1,!1]),Ci.unblended=new Ci(Ci.Replace,d.bf.transparent,[!0,!0,!0,!0]),Ci.alphaBlended=new Ci([1,771],d.bf.transparent,[!0,!0,!0,!0]);const Na=2305;class wt{constructor(e,a,l){this.enable=e,this.mode=a,this.frontFace=l}}wt.disabled=new wt(!1,1029,Na),wt.backCCW=new wt(!0,1029,Na),wt.frontCCW=new wt(!0,1028,Na);class Dt{constructor(e,a,l){this.func=e,this.mask=a,this.range=l}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const na=7680;class ei{constructor(e,a,l,h,g,y){this.test=e,this.ref=a,this.mask=l,this.fail=h,this.depthFail=g,this.pass=y}}ei.disabled=new ei({func:519,mask:0},0,0,na,na,na);const Fi=new WeakMap;function sr(f){var e;if(Fi.has(f))return Fi.get(f);{const a=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Fi.set(f,a),a}}class Zr{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const a=e.context,l=a.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new d.aL;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const g=new d.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Ds(a.createVertexBuffer(h,ja.members),a.createIndexBuffer(g),d.aM.simpleSegment(0,0,h.length,g.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),sr(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Dt.disabled,ei.disabled,Ci.unblended,wt.disabled,((g,y)=>({u_input:g,u_output_expected:y}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&sr(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const g=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&sr(e)){const a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Zr._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}const Is=d.$/128;function bu(f,e){const a=f.granularity!==void 0?Math.max(f.granularity,1):1,l=a+(f.generateBorders?2:0),h=a+(f.extendToNorthPole||f.generateBorders?1:0)+(f.extendToSouthPole||f.generateBorders?1:0),g=l+1,y=h+1,w=f.generateBorders?-1:0,T=f.generateBorders||f.extendToNorthPole?-1:0,E=a+(f.generateBorders?1:0),A=a+(f.generateBorders||f.extendToSouthPole?1:0),R=g*y,P=l*h*6,L=g*y>65536;if(L&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=L||e==="32bit",H=new Int16Array(2*R);let $=0;for(let ee=T;ee<=A;ee++)for(let Q=w;Q<=E;Q++){let ne=Q/a*d.$;Q===-1&&(ne=-Is),Q===a+1&&(ne=d.$+Is);let le=ee/a*d.$;ee===-1&&(le=f.extendToNorthPole?d.bh:-Is),ee===a+1&&(le=f.extendToSouthPole?d.bi:d.$+Is),H[$++]=ne,H[$++]=le}const X=U?new Uint32Array(P):new Uint16Array(P);let W=0;for(let ee=0;ee<h;ee++)for(let Q=0;Q<l;Q++){const ne=Q+1+ee*g,le=Q+(ee+1)*g,J=Q+1+(ee+1)*g;X[W++]=Q+ee*g,X[W++]=le,X[W++]=ne,X[W++]=ne,X[W++]=le,X[W++]=J}return{vertices:H.buffer.slice(0),indices:X.buffer.slice(0),uses32bitIndices:U}}const ks=new d.aK({fill:new d.bj(128,2),line:new d.bj(512,0),tile:new d.bj(128,32),stencil:new d.bj(128,1),circle:3});class oo{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return fa.projectionGlobe}get vertexShaderPreludeCode(){return fa.projectionMercator.vertexSource}get subdivisionGranularity(){return ks}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Zr(e));const a=d.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(a,l),g=Ue.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=g);const y=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bl(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,l,h,g){const y=(g==="stencil"?ks.stencil:ks.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:a.y===0&&h,extendToSouthPole:a.y===(1<<a.z)-1&&h})}_getMesh(e,a){const l=this._getMeshKey(a);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(g,y){const w=bu(y,"16bit"),T=d.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),E=d.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Ds(g.createVertexBuffer(T,ja.members),g.createIndexBuffer(E),d.aM.simpleSegment(0,0,T.length,E.length))})(e,a);return this._tileMeshCache[l]=h,h}recalculate(e){}hasTransition(){const e=Ue.now();let a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Ls=new d.r({type:new d.D(d.v.projection.type)});class lo extends d.E{constructor(e){super(),this._transitionable=new d.t(Ls,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.F(0)),this._mercatorProjection=new qt,this._verticalPerspectiveProjection=new oo}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof d.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,l,h,g){return this.currentProjection.getMeshFromTileID(e,a,l,h,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function jl(f){const e=Ko(f.worldSize,f.center.lat);return 2*Math.PI*e}function pa(f,e,a,l,h){const g=1/(1<<h),y=e/d.$*g+l*g,w=d.bo((f/d.$*g+a*g)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,E=Math.cos(T),A=new Float64Array(3);return A[0]=Math.sin(w)*E,A[1]=Math.sin(T),A[2]=Math.cos(w)*E,A}function Un(f){return(function(e,a){const l=Math.cos(a),h=new Float64Array(3);return h[0]=Math.sin(e)*l,h[1]=Math.sin(a),h[2]=Math.cos(e)*l,h})(f.lng*Math.PI/180,f.lat*Math.PI/180)}function Ko(f,e){return f/(2*Math.PI)/Math.cos(e*Math.PI/180)}function co(f){const e=Math.asin(f[1])/Math.PI*180,a=Math.sqrt(f[0]*f[0]+f[2]*f[2]);if(a>1e-6){const l=f[0]/a,h=Math.acos(f[2]/a),g=(l>0?h:-h)/Math.PI*180;return new d.S(d.aO(g,-180,180),e)}return new d.S(0,e)}function uo(f){return Math.cos(f*Math.PI/180)}function ln(f,e){const a=uo(f),l=uo(e);return d.ak(l/a)}function Ch(f,e){const a=f.rotate(e.bearingInRadians),l=e.zoom+ln(e.center.lat,0),h=d.bk(1/uo(e.center.lat),1/uo(Math.min(Math.abs(e.center.lat),60)),d.bn(l,7,3,0,1)),g=360/jl({worldSize:e.worldSize,center:{lat:e.center.lat}});return new d.S(e.center.lng-a.x*g*h,d.ah(e.center.lat+a.y*g,-d.ai,d.ai))}function Ul(f){const e=.5*f,a=Math.sin(e),l=Math.cos(e);return Math.log(a+l)-Math.log(l-a)}function wu(f,e,a,l){const h=f.lat+a*l;if(Math.abs(a)>1){const g=(Math.sign(f.lat+a)!==Math.sign(f.lat)?-Math.abs(f.lat):Math.abs(f.lat))*Math.PI/180,y=Math.abs(f.lat+a)*Math.PI/180,w=Ul(g+l*(y-g)),T=Ul(g),E=Ul(y);return new d.S(f.lng+e*((w-T)/(E-T)),h)}return new d.S(f.lng+e*l,h)}class Ah{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,l,h){const g=`${e.z}_${e.x}_${e.y}_${h?.terrain?"t":""}`,y=this._cache.get(g);if(y)return y;const w=this._cachePrevious.get(g);if(w)return this._cache.set(g,w),w;const T=this._boundingVolumeFactory(e,a,l,h);return this._cache.set(g,T),this._hadAnyChanges=!0,T}}class Wo{constructor(e,a,l,h){this.min=l,this.max=h,this.points=e,this.planes=a}static fromAabb(e,a){const l=[];for(let h=0;h<8;h++)l.push([1&~h?e[0]:a[0],(h>>1&1)==1?a[1]:e[1],(h>>2&1)==1?a[2]:e[2]]);return new Wo(l,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,l){const h=d.br([],l[0],l[1],l[2]),g=d.bs([],[a[0],0,0],h),y=d.bs([],[0,a[1],0],h),w=d.bs([],[0,0,a[2]],h),T=[...e],E=[...e];for(let R=0;R<8;R++)for(let P=0;P<3;P++){const L=e[P]+g[P]*(1&~R?-1:1)+y[P]*((R>>1&1)==1?1:-1)+w[P]*((R>>2&1)==1?1:-1);T[P]=Math.min(T[P],L),E[P]=Math.max(E[P],L)}const A=[];for(let R=0;R<8;R++){const P=[...e];d.aS(P,P,d.aR([],g,1&~R?-1:1)),d.aS(P,P,d.aR([],y,(R>>1&1)==1?1:-1)),d.aS(P,P,d.aR([],w,(R>>2&1)==1?1:-1)),A.push(P)}return new Wo(A,[[...g,-d.aX(g,A[0])],[...y,-d.aX(y,A[0])],[...w,-d.aX(w,A[0])],[-g[0],-g[1],-g[2],-d.aX(g,A[7])],[-y[0],-y[1],-y[2],-d.aX(y,A[7])],[-w[0],-w[1],-w[2],-d.aX(w,A[7])]],T,E)}intersectsFrustum(e){let a=!0;const l=this.points.length,h=this.planes.length,g=e.planes.length,y=e.points.length;for(let w=0;w<g;w++){const T=e.planes[w];let E=0;for(let A=0;A<l;A++){const R=this.points[A];T[0]*R[0]+T[1]*R[1]+T[2]*R[2]+T[3]>=0&&E++}if(E===0)return 0;E<l&&(a=!1)}if(a)return 2;for(let w=0;w<h;w++){const T=this.planes[w];let E=0;for(let A=0;A<y;A++){const R=e.points[A];T[0]*R[0]+T[1]*R[1]+T[2]*R[2]+T[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(e){const a=this.points.length;let l=0;for(let h=0;h<a;h++){const g=this.points[h];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&l++}return l===a?2:l===0?0:1}}function er(f,e,a){const l=f-e;return l<0?-l:Math.max(0,l-a)}function Nl(f,e,a,l,h){const g=f-a;let y;return y=g<0?Math.min(-g,1+g-h):g>1?Math.min(Math.max(g-h,0),1-g):0,Math.max(y,er(e,l,h))}class Va{constructor(){this._boundingVolumeCache=new Ah(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,l,h){const g=1<<l.z,y=1/g,w=l.x/g,T=l.y/g;let E=2;return E=Math.min(E,Nl(e,a,w,T,y)),E=Math.min(E,Nl(e,a,w+.5,-T-y,y)),E=Math.min(E,Nl(e,a,w+.5,2-T-y,y)),E}getWrap(e,a,l){const h=1<<a.z,g=1/h,y=a.x/h,w=er(e.x,y,g),T=er(e.x,y-1,g),E=er(e.x,y+1,g),A=Math.min(w,T,E);return A===E?1:A===T?-1:0}allowVariableZoom(e,a){return ct(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,l,h){return this._boundingVolumeCache.getTileBoundingVolume(e,a,l,h)}_computeTileBoundingVolume(e,a,l,h){var g,y;let w=0,T=0;if(h?.terrain){const E=new d.Z(e.z,a,e.z,e.x,e.y),A=h.terrain.getMinMaxElevation(E);w=(g=A.minElevation)!==null&&g!==void 0?g:Math.min(0,l),T=(y=A.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}if(w/=d.bu,T/=d.bu,w+=1,T+=1,e.z<=0)return Wo.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return Wo.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{const E=[pa(0,0,e.x,e.y,e.z),pa(d.$,0,e.x,e.y,e.z),pa(d.$,d.$,e.x,e.y,e.z),pa(0,d.$,e.x,e.y,e.z)],A=[];for(const Te of E)A.push(d.aR([],Te,T));if(T!==w)for(const Te of E)A.push(d.aR([],Te,w));e.y===0&&A.push([0,1,0]),e.y===(1<<e.z)-1&&A.push([0,-1,0]);const R=[1,1,1],P=[-1,-1,-1];for(const Te of A)for(let Ae=0;Ae<3;Ae++)R[Ae]=Math.min(R[Ae],Te[Ae]),P[Ae]=Math.max(P[Ae],Te[Ae]);const L=pa(d.$/2,d.$/2,e.x,e.y,e.z),U=d.aW([],[0,1,0],L);d.aV(U,U);const H=d.aW([],L,U);d.aV(H,H);const $=d.aW([],E[2],E[1]);d.aV($,$);const X=d.aW([],E[0],E[3]);d.aV(X,X),A.push(d.aR([],L,T)),e.y>=(1<<e.z)/2&&A.push(d.aR([],pa(d.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&A.push(d.aR([],pa(d.$/2,d.$,e.x,e.y,e.z),T));const W=ho(L,A),ee=ho(H,A),Q=[-L[0],-L[1],-L[2],W.max],ne=[L[0],L[1],L[2],-W.min],le=[-H[0],-H[1],-H[2],ee.max],J=[H[0],H[1],H[2],-ee.min],de=[...$,0],Ce=[...X,0],be=[];return e.y===0?be.push(d.bt(Ce,de,Q),d.bt(Ce,de,ne)):be.push(d.bt(le,de,Q),d.bt(le,de,ne),d.bt(le,Ce,Q),d.bt(le,Ce,ne)),e.y===(1<<e.z)-1?be.push(d.bt(Ce,de,Q),d.bt(Ce,de,ne)):be.push(d.bt(J,de,Q),d.bt(J,de,ne),d.bt(J,Ce,Q),d.bt(J,Ce,ne)),new Wo(be,[Q,ne,le,J,de,Ce],R,P)}}}function ho(f,e){let a=1/0,l=-1/0;for(const h of e){const g=d.aX(f,h);a=Math.min(a,g),l=Math.max(l,g)}return{min:a,max:l}}class Vl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,l){return this._helper.interpolatePadding(e,a,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=d.bv(),this._projectionMatrix=d.b9(),this._globeViewProjMatrix32f=d.b8(),this._globeViewProjMatrixNoCorrection=d.b9(),this._globeViewProjMatrixNoCorrectionInverted=d.b9(),this._globeProjMatrixInverted=d.b9(),this._cameraPosition=d.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Cn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,a)=>this.getConstrained(e,a)}),this._coveringTilesDetailsProvider=new Va}clone(){const e=new Vl;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=d.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:a,applyGlobeMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const a=this.pitchInRadians,l=this.cameraToCenterDistance/e,h=Math.sin(a)*l,g=Math.cos(a)*l+1,y=1/Math.sqrt(h*h+g*g)*1;let w=-h,T=g;const E=Math.sqrt(w*w+T*T);w/=E,T/=E;const A=[0,w,T];d.bw(A,A,[0,0,0],-this.bearingInRadians),d.bx(A,A,[0,0,0],-1*this.center.lat*Math.PI/180),d.by(A,A,[0,0,0],this.center.lng*Math.PI/180);const R=1/d.aZ(A);return d.aR(A,A,R),[...A,-y*R]}isLocationOccluded(e){return!this.isSurfacePointVisible(Un(e))}transformLightDirection(e){const a=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),g=[Math.sin(a)*h,Math.sin(l),Math.cos(a)*h],y=[g[2],0,-g[0]],w=[0,0,0];d.aW(w,y,g),d.aV(y,y),d.aV(w,w);const T=[0,0,0];return d.aV(T,[y[0]*e[0]+w[0]*e[1]+g[0]*e[2],y[1]*e[0]+w[1]*e[1]+g[1]*e[2],y[2]*e[0]+w[2]*e[1]+g[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,l){const h=(function(w,T,E){const A=1/(1<<E.z);return new d.a1(w/d.$*A+E.x*A,T/d.$*A+E.y*A)})(e,a,l.canonical),g=(y=h.y,[d.bo(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,a,l,h){const g=l.canonical,y=pa(e,a,g.x,g.y,g.z),w=1+(h?h(e,a):0)/d.bu,T=[y[0]*w,y[1]*w,y[2]*w,1];d.aw(T,T,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,A=E[0]*y[0]+E[1]*y[1]+E[2]*y[2]+E[3]<0;return{point:new d.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:A}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Ko(this.worldSize,this.center.lat),a=d.ba(),l=d.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),d.b4(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;a[8]=2*-h.x/this._helper._width,a[9]=2*h.y/this._helper._height,this._projectionMatrix=d.b5(a),this._globeProjMatrixInverted=d.ba(),d.aq(this._globeProjMatrixInverted,a),d.M(a,a,[0,0,-this.cameraToCenterDistance]),d.b6(a,a,this.rollInRadians),d.b7(a,a,-this.pitchInRadians),d.b6(a,a,this.bearingInRadians),d.M(a,a,[0,0,-e]);const g=d.bp();g[0]=e,g[1]=e,g[2]=e,d.b7(l,a,this.center.lat*Math.PI/180),d.bz(l,l,-this.center.lng*Math.PI/180),d.N(l,l,g),this._globeViewProjMatrixNoCorrection=l,d.b7(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bz(a,a,-this.center.lng*Math.PI/180),d.N(a,a,g),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=d.ba(),d.aq(this._globeViewProjMatrixNoCorrectionInverted,l);const y=d.bp();this._cameraPosition=d.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,d.bw(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),d.bx(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),d.bw(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),d.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bx(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),d.by(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=d.b5(this._globeViewProjMatrixNoCorrectionInverted);d.N(w,w,[1,1,-1]),this._cachedFrustum=gn.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){d.w("calculateFogMatrix is not supported on globe projection.");const a=d.ba();return d.ag(a),a}getVisibleUnwrappedCoordinates(e){return[new d.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Un(e);d.aR(l,l,1+a/d.bu);const h=d.bv();return d.aw(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,a=.5*this.height,l=[new d.P(0,0),new d.P(e,0),new d.P(this.width,0),new d.P(this.width,a),new d.P(this.width,this.height),new d.P(e,this.height),new d.P(0,this.height),new d.P(0,a)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let g=0,y=0,w=0,T=0;const E=this.center;for(const R of h){const P=d.bA(E.lng,R.lng),L=d.bA(E.lat,R.lat);P<y&&(y=P),P>g&&(g=P),L<T&&(T=L),L>w&&(w=L)}const A=[E.lng+y,E.lat+T,E.lng+g,E.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(A[3]=90,A[0]=-180,A[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(A[1]=-90,A[0]=-180,A[2]=180),new Yi(A)}getConstrained(e,a){const l=d.ah(e.lat,-d.ai,d.ai),h=d.ah(+a,this.minZoom+ln(0,l),this.maxZoom);return{center:new d.S(e.lng,l),zoom:h}}calculateCenterFromCameraLngLatAlt(e,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,l,h)}setLocationAtPoint(e,a){const l=Un(this.unprojectScreenPoint(a)),h=Un(e),g=d.bp();d.bB(g);const y=d.bp();d.by(y,l,g,-this.center.lng*Math.PI/180),d.bx(y,y,g,this.center.lat*Math.PI/180);const w=h[0]*h[0]+h[2]*h[2],T=y[0]*y[0];if(w<T)return;const E=Math.sqrt(w-T),A=-E,R=d.bC(h[0],h[2],y[0],E),P=d.bC(h[0],h[2],y[0],A),L=d.bp();d.by(L,h,g,-R);const U=d.bC(L[1],L[2],y[1],y[2]),H=d.bp();d.by(H,h,g,-P);const $=d.bC(H[1],H[2],y[1],y[2]),X=.5*Math.PI,W=U>=-X&&U<=X,ee=$>=-X&&$<=X;let Q,ne;if(W&&ee){const Ce=this.center.lng*Math.PI/180,be=this.center.lat*Math.PI/180;d.bD(R,Ce)+d.bD(U,be)<d.bD(P,Ce)+d.bD($,be)?(Q=R,ne=U):(Q=P,ne=$)}else if(W)Q=R,ne=U;else{if(!ee)return;Q=P,ne=$}const le=Q/Math.PI*180,J=ne/Math.PI*180,de=this.center.lat;this.setCenter(new d.S(le,d.ah(J,-90,90))),this.setZoom(this.zoom+ln(de,this.center.lat))}locationToScreenPoint(e,a){const l=Un(e);if(a){const h=a.getElevationForLngLatZoom(e,this._helper._tileZoom);d.aR(l,l,1+h/d.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const a=d.bv();return d.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new d.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){const l=a.pointCoordinate(e);if(l)return l}return d.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var l;return(l=this.screenPointToMercatorCoordinate(e,a))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,a){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(e){const a=d.bv();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,d.aw(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const l=d.bp();l[0]=a[0]-this._cameraPosition[0],l[1]=a[1]-this._cameraPosition[1],l[2]=a[2]-this._cameraPosition[2];const h=d.bp();return d.aV(h,l),h}isSurfacePointVisible(e){const a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const a=d.bv();return d.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){const l=d.aX(e,a),h=d.bp(),g=d.bp();d.aR(g,a,l),d.aU(h,e,g);const y=1-d.aX(h,h);if(y<0)return null;const w=d.aX(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),E=w/T,A=T;return{tMin:Math.min(E,A),tMax:Math.max(E,A)}}unprojectScreenPoint(e){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(a,l);if(h){const A=d.bp();d.aS(A,a,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=d.bp();return d.aV(R,A),co(R)}const g=this._cachedClippingPlane,y=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],w=-d.b1(g,a)/y,T=d.bp();if(w>0)d.aS(T,a,[l[0]*w,l[1]*w,l[2]*w]);else{const A=d.bp();d.aS(A,a,[2*l[0],2*l[1],2*l[2]]);const R=d.b1(this._cachedClippingPlane,A);d.aU(T,A,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const E=(function(A){const R=d.bp();return R[0]=A[0]*-A[3],R[1]=A[1]*-A[3],R[2]=A[2]*-A[3],{center:R,radius:Math.sqrt(1-A[3]*A[3])}})(g);return co((function(A,R,P){const L=d.bp();d.aU(L,P,A);const U=d.bp();return d.bq(U,A,L,R/d.a$(L)),U})(E.center,E.radius,T))}getMatrixForModel(e,a){const l=d.S.convert(e),h=1/d.bu,g=d.b9();return d.bz(g,g,l.lng/180*Math.PI),d.b7(g,g,-l.lat/180*Math.PI),d.M(g,g,[0,0,1+a/d.bu]),d.b7(g,g,.5*Math.PI),d.N(g,g,[h,h,h]),g}getProjectionDataForCustomLayer(e=!0){const a=this.getProjectionData({overscaledTileID:new d.Z(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class Zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,l){return this._helper.interpolatePadding(e,a,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,l=!0){this._helper.resize(e,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Cn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,a)=>this.getConstrained(e,a)}),this._globeness=1,this._mercatorTransform=new di,this._verticalPerspectiveTransform=new Vl}clone(){const e=new Zl;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const a=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:a.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return d.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,l){const h=this._mercatorTransform.getPitchedTextCorrection(e,a,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,l);return d.bk(h,g,this._globeness)}projectTileCoordinates(e,a,l,h){return this.currentTransform.projectTileCoordinates(e,a,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,a){return this.currentTransform.getConstrained(e,a)}calculateCenterFromCameraLngLatAlt(e,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,l,h)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=a.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class or{get useGlobeControls(){return!0}handlePanInertia(e,a){const l=Ch(e,a);return Math.abs(l.lng-a.center.lng)>180&&(l.lng=a.center.lng+179.5*Math.sign(l.lng-a.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){const l=e.around,h=a.screenPointToLocation(l);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);const g=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);const y=a.zoom-g;if(y===0)return;const w=d.bA(a.center.lng,h.lng),T=w/(Math.abs(w/180)+1),E=d.bA(a.center.lat,h.lat),A=a.getRayDirectionFromPixel(l),R=a.cameraPosition,P=-1*d.aX(R,A),L=d.bp();d.aS(L,R,[A[0]*P,A[1]*P,A[2]*P]);const U=d.aZ(L)-1,H=Math.exp(.5*-Math.max(U-.3,0)),$=Ko(a.worldSize,a.center.lat)/Math.min(a.width,a.height),X=d.bn($,.9,.5,1,.25),W=(1-d.af(-y))*Math.min(H,X),ee=a.center.lat,Q=a.zoom,ne=new d.S(a.center.lng+T*W,d.ah(a.center.lat+E*W,-d.ai,d.ai));a.setLocationAtPoint(h,l);const le=a.center,J=d.bn(Math.abs(w),45,85,0,1),de=d.bn($,.75,.35,0,1),Ce=Math.pow(Math.max(J,de),.25),be=d.bA(le.lng,ne.lng),Te=d.bA(le.lat,ne.lat);a.setCenter(new d.S(le.lng+be*Ce,le.lat+Te*Ce).wrap()),a.setZoom(Q+ln(ee,a.center.lat))}handleMapControlsPan(e,a,l){if(!e.panDelta)return;const h=a.center.lat,g=a.zoom;a.setCenter(Ch(e.panDelta,a).wrap()),a.setZoom(g+ln(h,a.center.lat))}cameraForBoxAndBearing(e,a,l,h,g){const y=Jn(e,a,l,h,g),w=a.left/g.width*2-1,T=(g.width-a.right)/g.width*2-1,E=a.top/g.height*-2+1,A=(g.height-a.bottom)/g.height*-2+1,R=d.bA(l.getWest(),l.getEast())<0,P=R?l.getEast():l.getWest(),L=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),H=Math.min(l.getNorth(),l.getSouth()),$=P+.5*d.bA(P,L),X=U+.5*d.bA(U,H),W=g.clone();W.setCenter(y.center),W.setBearing(y.bearing),W.setPitch(0),W.setRoll(0),W.setZoom(y.zoom);const ee=W.modelViewProjectionMatrix,Q=[Un(l.getNorthWest()),Un(l.getNorthEast()),Un(l.getSouthWest()),Un(l.getSouthEast()),Un(new d.S(L,X)),Un(new d.S(P,X)),Un(new d.S($,U)),Un(new d.S($,H))],ne=Un(y.center);let le=Number.POSITIVE_INFINITY;for(const J of Q)w<0&&(le=or.getLesserNonNegativeNonNull(le,or.solveVectorScale(J,ne,ee,"x",w))),T>0&&(le=or.getLesserNonNegativeNonNull(le,or.solveVectorScale(J,ne,ee,"x",T))),E>0&&(le=or.getLesserNonNegativeNonNull(le,or.solveVectorScale(J,ne,ee,"y",E))),A<0&&(le=or.getLesserNonNegativeNonNull(le,or.solveVectorScale(J,ne,ee,"y",A)));if(Number.isFinite(le)&&le!==0)return y.zoom=W.zoom+d.ak(le),y;Ua()}handleJumpToCenterZoom(e,a){const l=e.center.lat,h=e.getConstrained(a.center?d.S.convert(a.center):e.center,e.zoom).center;e.setCenter(h.wrap());const g=a.zoom!==void 0?+a.zoom:e.zoom+ln(l,h.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,a){const l=e.zoom,h=e.center,g=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},T=a.zoom!==void 0,E=!e.isPaddingEqual(a.padding);let A=!1;const R=a.center?d.S.convert(a.center):h,P=e.getConstrained(R,l).center;Yo(e,P);const L=e.clone();L.setCenter(P),L.setZoom(T?+a.zoom:l+ln(h.lat,R.lat)),L.setBearing(a.bearing);const U=new d.P(d.ah(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),d.ah(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));L.setLocationAtPoint(P,U);const H=(a.offset&&a.offsetAsPoint.mag())>0?L.center:P,$=T?+a.zoom:l+ln(h.lat,H.lat),X=l+ln(h.lat,0),W=$+ln(H.lat,0),ee=d.bA(h.lng,H.lng),Q=d.bA(h.lat,H.lat),ne=d.af(W-X);return A=$!==l,{easeFunc:le=>{if(d.be(y,w)||Qn({startEulerAngles:y,endEulerAngles:w,tr:e,k:le,useSlerp:y.roll!=w.roll}),E&&e.interpolatePadding(g,a.padding,le),a.around)d.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{const J=W>X?Math.min(2,ne):Math.max(.5,ne),de=Math.pow(J,1-le),Ce=wu(h,ee,Q,le*de);e.setCenter(Ce.wrap())}if(A){const J=d.C.number(X,W,le)+ln(0,e.center.lat);e.setZoom(J)}},isZooming:A,elevationCenter:H}}handleFlyTo(e,a){const l=a.zoom!==void 0,h=e.center,g=e.zoom,y=e.padding,w=!e.isPaddingEqual(a.padding),T=e.getConstrained(d.S.convert(a.center||a.locationAtOffset),g).center,E=l?+a.zoom:e.zoom+ln(e.center.lat,T.lat),A=e.clone();A.setCenter(T),A.setZoom(E),A.setBearing(a.bearing);const R=new d.P(d.ah(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),d.ah(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));A.setLocationAtPoint(T,R);const P=A.center;Yo(e,P);const L=(function(Q,ne,le){const J=Un(ne),de=Un(le),Ce=d.aX(J,de),be=Math.acos(Ce),Te=jl(Q);return be/(2*Math.PI)*Te})(e,h,P),U=g+ln(h.lat,0),H=E+ln(P.lat,0),$=d.af(H-U);let X;if(typeof a.minZoom=="number"){const Q=+a.minZoom+ln(P.lat,0),ne=Math.min(Q,U,H)+ln(0,P.lat),le=e.getConstrained(P,ne).zoom+ln(P.lat,0);X=d.af(le-U)}const W=d.bA(h.lng,P.lng),ee=d.bA(h.lat,P.lat);return{easeFunc:(Q,ne,le,J)=>{const de=wu(h,W,ee,le);w&&e.interpolatePadding(y,a.padding,Q);const Ce=Q===1?P:de;e.setCenter(Ce.wrap());const be=U+d.ak(ne);e.setZoom(Q===1?E:be+ln(0,Ce.lat))},scaleOfZoom:$,targetCenter:P,scaleOfMinZoom:X,pixelPathLength:L}}static solveVectorScale(e,a,l,h,g){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],E=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],A=a[0]*y[0]+a[1]*y[1]+a[2]*y[2],R=a[0]*w[0]+a[1]*w[1]+a[2]*w[2];return A+g*E===T+g*R||w[3]*(T-A)+y[3]*(R-E)+T*R==A*E?null:(A+y[3]-g*R-g*w[3])/(A-T-g*R+g*E)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Tu{constructor(e){this._globe=e,this._mercatorCameraHelper=new rn,this._verticalPerspectiveCameraHelper=new or}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,l){this.currentHelper.handleMapControlsPan(e,a,l)}cameraForBoxAndBearing(e,a,l,h,g){return this.currentHelper.cameraForBoxAndBearing(e,a,l,h,g)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}const zc=(f,e)=>d.y(f,e&&e.filter((a=>a.identifier!=="source.canvas"))),hd=d.bE();class Su extends d.E{constructor(e,a={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const w=this.sourceCaches[y].getSource().type;w!=="vector"&&w!=="geojson"||this.sourceCaches[y].reload()}},this.map=e,this.dispatcher=new bt(Jt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((y,w)=>this.getGlyphs(y,w))),this.dispatcher.registerMessageHandler("GI",((y,w)=>this.getImages(y,w))),this.imageManager=new Ji,this.imageManager.setEventedParent(this);const g=((l=e._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new Xn(e._requestManager,a.localIdeographFontFamily,g),this.lineAtlas=new Tt(256,512),this.crossTileSymbolIndex=new ao,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",d.bG()),Mn().on(to,this._rtlPluginLoaded),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const w=this.sourceCaches[y.sourceId];if(!w)return;const T=w.getSource();if(T&&T.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===T.id&&this._validateLayer(A)}}))}setGlobalStateProperty(e,a){var l,h,g;this._checkLoaded();const y=a===null?(g=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||h===void 0?void 0:h.default)!==null&&g!==void 0?g:null:a;if(d.bH(y,this._globalState[e]))return this;this._globalState[e]=y,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const a=[];for(const l in e)!d.bH(this._globalState[l],e[l].default)&&(a.push(l),this._globalState[l]=e[l].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;const a=new Set,l={};for(const h of e){l[h]=this._globalState[h];for(const g in this._layers){const y=this._layers[g],w=y.getLayoutAffectingGlobalStateRefs(),T=y.getPaintAffectingGlobalStateRefs();if(w.has(h)&&a.add(y.source),T.has(h))for(const{name:E,value:A}of T.get(h))this._updatePaintProperty(y,E,A)}}this.dispatcher.broadcast("UGS",l);for(const h in this.sourceCaches)a.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(e,a={},l){this.fire(new d.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;d.j(h,this._loadStyleRequest).then((y=>{this._loadStyleRequest=null,this._load(y.data,a,l)})).catch((y=>{this._loadStyleRequest=null,y&&!g.signal.aborted&&this.fire(new d.k(y))}))}loadJSON(e,a={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ue.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,l)})).catch((()=>{}))}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(hd,{validate:!1})}_load(e,a,l){var h,g;let y=a.transformStyle?a.transformStyle(l,e):e;if(!a.validate||!zc(this,d.z(y))){y=Object.assign({},y),this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Be(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new At(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var e;const a=d.bI(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",a),this._order=a.map((l=>l.id)),this._layers={},this._serializedLayers=null;for(const l of a){const h=d.bJ(l,this._globalState);h.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=h}}_loadSprite(e,a=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,y,w,T){return d._(this,void 0,void 0,(function*(){const E=Qt(g),A=w>1?"@2x":"",R={},P={};for(const{id:L,url:U}of E){const H=y.transformRequest(vi(U,A,".json"),"SpriteJSON");R[L]=d.j(H,T);const $=y.transformRequest(vi(U,A,".png"),"SpriteImage");P[L]=ii.getImage($,T)}return yield Promise.all([...Object.values(R),...Object.values(P)]),(function(L,U){return d._(this,void 0,void 0,(function*(){const H={};for(const $ in L){H[$]={};const X=Ue.getImageCanvasContext((yield U[$]).data),W=(yield L[$]).data;for(const ee in W){const{width:Q,height:ne,x:le,y:J,sdf:de,pixelRatio:Ce,stretchX:be,stretchY:Te,content:Ae,textFitWidth:Qe,textFitHeight:Ke}=W[ee];H[$][ee]={data:null,pixelRatio:Ce,sdf:de,stretchX:be,stretchY:Te,content:Ae,textFitWidth:Qe,textFitHeight:Ke,spriteData:{width:Q,height:ne,x:le,y:J,context:X}}}}return H}))})(R,P)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const y in g){this._spritesImagesIds[y]=[];const w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter((T=>!(T in g))):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in g[y]){const E=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,g[y][T],!1):this.imageManager.addImage(E,g[y][T]),a&&(this._changedImages[E]=!0)}}})).catch((g=>{this._spriteRequest=null,h=g,this.fire(new d.k(h))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(h)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const l=e.sourceLayer;if(!l)return;const h=a.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?d.bK(l):l);const h=[];for(const g of e)if(l[g]){const y=a?d.bK(l[g]):l[g];h.push(y)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const h=this._layers[l];h.type!=="custom"&&(e[l]=h.serialize())}return e}hasTransitions(){var e,a,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const h=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(h.length||g.length)&&this._updateWorkerLayers(h,g);for(const y in this._updatedSources){const w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const g=this.sourceCaches[h];l[h]=g.used,g.used=!1}for(const h of this._order){const g=this._layers[h];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const h in l){const g=this.sourceCaches[h];!!l[h]!=!!g.used&&g.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var l;this._checkLoaded();const h=this.serialize();if(e=a.transformStyle?a.transformStyle(h,e):e,((l=a.validate)===null||l===void 0||l)&&zc(this,d.z(e)))return!1;(e=d.bK(e)).layers=d.bI(e.layers);const g=d.bL(h,e),y=this._getOperationsToPerform(g);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],l=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":a.push((()=>{}));break;default:l.push(h.command)}return{operations:a,unimplemented:l}}addImage(e,a){if(this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.z.source,`sources.${e}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const h=this.sourceCaches[e]=new Xt(e,a,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e}))),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,l={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new d.k(new Error(`Layer "${h}" already exists on this map.`)));let g;if(e.type==="custom"){if(zc(this,d.bM(e)))return;g=d.bJ(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=d.bK(e),e=d.e(e,{source:h})),this._validate(d.z.layer,`layers.${h}`,e,{arrayIndex:-1},l))return;g=d.bJ(e,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:h}})}const y=a?this._order.indexOf(a):this._order.length;if(a&&y===-1)this.fire(new d.k(new Error(`Cannot add layer "${h}" before non-existing layer "${a}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=g,this._removedLayers[h]&&g.source&&g.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const l=this._order.indexOf(e);this._order.splice(l,1);const h=a?this._order.indexOf(a):this._order.length;a&&h===-1?this.fire(new d.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,l){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===a&&h.maxzoom===l||(a!=null&&(h.minzoom=a),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,l={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!d.bH(h.filter,a))return a==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(d.z.filter,`layers.${h.id}.filter`,a,null,l)||(h.setFilter(d.bK(a)),this._updateLayer(h)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.bK(this.getLayer(e).filter)}setLayoutProperty(e,a,l,h={}){this._checkLoaded();const g=this.getLayer(e);g?d.bH(g.getLayoutProperty(a),l)||(g.setLayoutProperty(a,l,h),this._updateLayer(g)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const l=this.getLayer(e);if(l)return l.getLayoutProperty(a);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,l,h={}){this._checkLoaded();const g=this.getLayer(e);g?d.bH(g.getPaintProperty(a),l)||this._updatePaintProperty(g,a,l,h):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,l,h={}){e.setPaintProperty(a,l,h)&&this._updateLayer(e),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const l=e.source,h=e.sourceLayer,g=this.sourceCaches[l];if(g===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=g.getSource().type;y==="geojson"&&h?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(h,e.id,a)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const l=e.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=h.getSource().type,y=g==="vector"?e.sourceLayer:void 0;g!=="vector"||y?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,e.id,a):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,l=e.sourceLayer,h=this.sourceCaches[a];if(h!==void 0)return h.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,e.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.bN(this.sourceCaches,(g=>g.serialize())),a=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.bO({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:a,terrain:l},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(a(w)){l[w]=y;for(const T of e){const E=T[w];if(E)for(const A of E)h.push(A)}}}h.sort(((y,w)=>w.intersectionZ-y.intersectionZ));const g=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(a(w))for(let T=h.length-1;T>=0;T--){const E=h[T].feature;if(l[E.layer.id]<y)break;g.push(E),h.pop()}else for(const T of e){const E=T[w];if(E)for(const A of E)g.push(A.feature)}}return g}queryRenderedFeatures(e,a,l){a&&a.filter&&this._validate(d.z.filter,"queryRenderedFeatures.filter",a.filter,null,a);const h={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of a.layers){const A=this._layers[E];if(!A)return this.fire(new d.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];h[A.source]=!0}}const g=[];a.availableImages=this._availableImages;const y=this._serializedAllLayers(),w=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,T=Object.assign(Object.assign({},a),{layers:w,globalState:this._globalState});for(const E in this.sourceCaches)a.layers&&!h[E]||g.push(jn(this.sourceCaches[E],this._layers,y,e,T,l,this.map.terrain?(A,R,P)=>this.map.terrain.getElevation(A,R,P):void 0));return this.placement&&g.push((function(E,A,R,P,L,U,H){const $={},X=U.queryRenderedSymbols(P),W=[];for(const ee of Object.keys(X).map(Number))W.push(H[ee]);W.sort(As);for(const ee of W){const Q=ee.featureIndex.lookupSymbolFeatures(X[ee.bucketInstanceId],A,ee.bucketIndex,ee.sourceLayerIndex,{filterSpec:L.filter,globalState:L.globalState},L.layers,L.availableImages,E);for(const ne in Q){const le=$[ne]=$[ne]||[],J=Q[ne];J.sort(((de,Ce)=>{const be=ee.featureSortOrder;if(be){const Te=be.indexOf(de.featureIndex);return be.indexOf(Ce.featureIndex)-Te}return Ce.featureIndex-de.featureIndex}));for(const de of J)le.push(de)}}return(function(ee,Q,ne){for(const le in ee)for(const J of ee[le])es(J,ne[Q[le].source]);return ee})($,E,R)})(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,a){a?.filter&&this._validate(d.z.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.sourceCaches[e];return l?(function(h,g){const y=h.getRenderableIds().map((E=>h.getTileByID(E))),w=[],T={};for(let E=0;E<y.length;E++){const A=y[E],R=A.tileID.canonical.key;T[R]||(T[R]=!0,A.querySourceFeatures(w,g))}return w})(l,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in e)if(!d.bH(e[y],l[y])){h=!0;break}if(!h)return;const g={now:Ue.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!e&&!l)return;if(e&&!l)h=!0;else if(!e&&l)h=!0;else for(const y in e)if(!d.bH(e[y],l[y])){h=!0;break}if(!h)return;const g={now:Ue.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(g)}_setProjectionInternal(e){const a=(function(l){if(Array.isArray(l)){const h=new lo({type:l});return{projection:h,transform:new Zl,cameraHelper:new Tu(h)}}switch(l){case"mercator":return{projection:new qt,transform:new di,cameraHelper:new rn};case"globe":{const h=new lo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new Zl,cameraHelper:new Tu(h)}}case"vertical-perspective":return{projection:new oo,transform:new Vl,cameraHelper:new or};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new qt,transform:new di,cameraHelper:new rn}}})(e);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,a,l,h,g={}){return(!g||g.validate!==!1)&&zc(this,e.call(d.z,d.e({key:a,style:this.serialize(),value:l,styleSpec:d.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Mn().off(to,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const l=this.sourceCaches[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,l,h,g=!1){let y=!1,w=!1;const T={};for(const E of this._order){const A=this._layers[E];if(A.type!=="symbol")continue;if(!T[A.source]){const P=this.sourceCaches[A.source];T[A.source]=P.getRenderableIds(!0).map((L=>P.getTileByID(L))).sort(((L,U)=>U.tileID.overscaledZ-L.tileID.overscaledZ||(L.tileID.isLessThan(U.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(A,T[A.source],e.center.lng);y=y||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ue.now(),e.zoom))&&(this.pauseablePlacement=new Ol(e,this.map.terrain,this._order,g,a,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ue.now()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(const E of this._order){const A=this._layers[E];A.type==="symbol"&&this.placement.updateLayerOpacities(A,T[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ue.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return d._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[a.source];return h&&h.setDependencies(a.tileID.key,a.type,a.icons),l}))}getGlyphs(e,a){return d._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),h=this.sourceCaches[a.source];return h&&h.setDependencies(a.tileID.key,a.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(d.z.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,l={},h){this._checkLoaded();const g=[{id:e,url:a}],y=[...Qt(this.stylesheet.sprite),...g];this._validate(d.z.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(g,!0,h))}removeSprite(e){this._checkLoaded();const a=Qt(this.stylesheet.sprite);if(a.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Qt(this.stylesheet.sprite)}setSprite(e,a={},l){this._checkLoaded(),e&&this._validate(d.z.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var dd=d.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,l,h,g,y,w,T,E){this.context=e;let A=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!A&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(A=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(a,l,h,g,y,w,T,E):(e.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,a,l,h,g,y,w,T){const E=e.numAttributes,A=this.context,R=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,a.enableAttributes(R,e);for(const P of l)P.enableAttributes(R,e);y&&y.enableAttributes(R,e),w&&w.enableAttributes(R,e),T&&T.enableAttributes(R,e),a.bind(),a.setVertexAttribPointers(R,e,g);for(const P of l)P.bind(),P.setVertexAttribPointers(R,e,g);y&&(y.bind(),y.setVertexAttribPointers(R,e,g)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,e,g)),T&&(T.bind(),T.setVertexAttribPointers(R,e,g)),A.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Pc=(f,e,a,l,h)=>({u_texture:0,u_ele_delta:f,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):d.bf.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):d.bf.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Mu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function fo(f){const e=[];for(let a=0;a<f.length;a++){if(f[a]===null)continue;const l=f[a].split(" ");e.push(l.pop())}return e}class Eu{constructor(e,a,l,h,g,y,w,T,E=[]){const A=e.gl;this.program=A.createProgram();const R=fo(a.staticAttributes),P=l?l.getBinderAttributes():[],L=R.concat(P),U=fa.prelude.staticUniforms?fo(fa.prelude.staticUniforms):[],H=w.staticUniforms?fo(w.staticUniforms):[],$=a.staticUniforms?fo(a.staticUniforms):[],X=l?l.getBinderUniforms():[],W=U.concat(H).concat($).concat(X),ee=[];for(const be of W)ee.indexOf(be)<0&&ee.push(be);const Q=l?l.defines():[];sr(A)&&Q.unshift("#version 300 es"),g&&Q.push("#define OVERDRAW_INSPECTOR;"),y&&Q.push("#define TERRAIN3D;"),T&&Q.push(T),E&&Q.push(...E);let ne=Q.concat(fa.prelude.fragmentSource,w.fragmentSource,a.fragmentSource).join(`
`),le=Q.concat(fa.prelude.vertexSource,w.vertexSource,a.vertexSource).join(`
`);sr(A)||(ne=(function(be){return be.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ne),le=(function(be){return be.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(le));const J=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(J,ne),A.compileShader(J),!A.getShaderParameter(J,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(J)}`);A.attachShader(this.program,J);const de=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(de,le),A.compileShader(de),!A.getShaderParameter(de,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(de)}`);A.attachShader(this.program,de),this.attributes={};const Ce={};this.numAttributes=L.length;for(let be=0;be<this.numAttributes;be++)L[be]&&(A.bindAttribLocation(this.program,be,L[be]),this.attributes[L[be]]=be);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(de),A.deleteShader(J);for(let be=0;be<ee.length;be++){const Te=ee[be];if(Te&&!Ce[Te]){const Ae=A.getUniformLocation(this.program,Te);Ae&&(Ce[Te]=Ae)}}this.fixedUniforms=h(e,Ce),this.terrainUniforms=((be,Te)=>({u_depth:new d.bP(be,Te.u_depth),u_terrain:new d.bP(be,Te.u_terrain),u_terrain_dim:new d.bg(be,Te.u_terrain_dim),u_terrain_matrix:new d.bR(be,Te.u_terrain_matrix),u_terrain_unpack:new d.bS(be,Te.u_terrain_unpack),u_terrain_exaggeration:new d.bg(be,Te.u_terrain_exaggeration)}))(e,Ce),this.projectionUniforms=((be,Te)=>({u_projection_matrix:new d.bR(be,Te.u_projection_matrix),u_projection_tile_mercator_coords:new d.bS(be,Te.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.bS(be,Te.u_projection_clipping_plane),u_projection_transition:new d.bg(be,Te.u_projection_transition),u_projection_fallback_matrix:new d.bR(be,Te.u_projection_fallback_matrix)}))(e,Ce),this.binderUniforms=l?l.getUniforms(e,Ce):[]}draw(e,a,l,h,g,y,w,T,E,A,R,P,L,U,H,$,X,W,ee){const Q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(h),e.setColorMode(g),e.setCullFace(y),T){e.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,T.depthTexture),e.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,T.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(T[le])}if(E)for(const le in E)this.projectionUniforms[Mu[le]].set(E[le]);if(w)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(w[le]);$&&$.setUniforms(e,this.binderUniforms,U,{zoom:H});let ne=0;switch(a){case Q.LINES:ne=2;break;case Q.TRIANGLES:ne=3;break;case Q.LINE_STRIP:ne=1}for(const le of L.get()){const J=le.vaos||(le.vaos={});(J[A]||(J[A]=new fd)).bind(e,this,R,$?$.getPaintVertexBuffers():[],P,le.vertexOffset,X,W,ee),Q.drawElements(a,le.primitiveLength*ne,Q.UNSIGNED_SHORT,le.primitiveOffset*ne*2)}}}function Qo(f,e,a){const l=1/d.aC(a,1,e.transform.tileZoom),h=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,e.transform.tileZoom)/h,y=g*(a.tileID.canonical.x+a.tileID.wrap*h),w=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}const _r=(f,e,a,l)=>{const h=f.style.light,g=h.properties.get("position"),y=[g.x,g.y,g.z],w=d.bV();h.properties.get("anchor")==="viewport"&&d.bW(w,f.transform.bearingInRadians),d.bX(y,y,w);const T=f.transform.transformLightDirection(y),E=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:l}},pd=(f,e,a,l,h,g,y)=>d.e(_r(f,e,a,l),Qo(g,f,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),Gl=(f,e,a,l)=>d.e(Qo(e,f,a),{u_fill_translate:l}),Jo=(f,e)=>({u_world:f,u_fill_translate:e}),el=(f,e,a,l,h)=>d.e(Gl(f,e,a,h),{u_world:l}),zh=(f,e,a,l,h)=>{const g=f.transform;let y,w,T=0;if(a.paint.get("circle-pitch-alignment")==="map"){const E=d.aC(e,1,g.zoom);y=!0,w=[E,E],T=E/(d.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else y=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:T,u_translate:l}},ql=f=>({u_pixel_extrude_scale:[1/f.width,1/f.height]}),tl=f=>({u_viewport_size:[f.width,f.height]}),po=(f,e=1)=>({u_color:f,u_overlay:0,u_overlay_scale:e}),Ph=(f,e,a,l)=>{const h=d.aC(f,1,e)/(d.$*Math.pow(2,f.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.aC(f,1,e),u_intensity:a,u_globe_extrude_scale:h}},Cu=(f,e,a,l)=>{const h=d.L();d.bY(h,0,f.width,f.height,0,0,1);const g=f.context.gl;return{u_matrix:h,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:a,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Rh=(f,e,a)=>{const l=a.paint.get("hillshade-accent-color");let h;switch(a.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const g=a.getIlluminationProperties();for(let y=0;y<g.directionRadians.length;y++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[y]+=f.transform.bearingInRadians);return{u_image:0,u_latrange:mo(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:l,u_method:h,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Au=(f,e)=>{const a=e.stride,l=d.L();return d.bY(l,0,d.$,-d.$,0,0,1),d.M(l,l,[0,-d.$,0]),{u_matrix:l,u_image:1,u_dimension:[a,a],u_zoom:f.overscaledZ,u_unpack:e.getUnpackVector()}};function mo(f,e){const a=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.a1(0,l/a).toLngLat().lat,new d.a1(0,(l+1)/a).toLngLat().lat]}const il=(f,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:f.paint.get("color-relief-opacity")}),Rc=(f,e,a,l)=>{const h=f.transform;return{u_translation:Xl(f,e,a),u_ratio:l/d.aC(e,1,h.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Hl=(f,e,a,l,h)=>d.e(Rc(f,e,a,l),{u_image:0,u_image_height:h}),zu=(f,e,a,l,h)=>{const g=f.transform,y=$l(e,g);return{u_translation:Xl(f,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:l/d.aC(e,1,g.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Bs=(f,e,a,l,h,g)=>{const y=f.lineAtlas,w=$l(e,f.transform),T=a.layout.get("line-cap")==="round",E=y.getDash(h.from,T),A=y.getDash(h.to,T),R=E.width*g.fromScale,P=A.width*g.toScale;return d.e(Rc(f,e,a,l),{u_patternscale_a:[w/R,-E.height/2],u_patternscale_b:[w/P,-A.height/2],u_sdfgamma:y.width/(256*Math.min(R,P)*f.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:A.y,u_mix:g.t})};function $l(f,e){return 1/d.aC(f,1,e.tileZoom)}function Xl(f,e,a){return d.aD(f.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const nl=(f,e,a,l,h)=>{return{u_tl_parent:f,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Dh(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var g,y};function Dh(f){f*=Math.PI/180;const e=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const rl=(f,e,a,l,h,g,y,w,T,E,A,R,P)=>{const L=y.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:L.width/L.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+A,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:g,u_texsize:R,u_texture:0,u_translation:E,u_pitched_scale:P}},Ih=(f,e,a,l,h,g,y,w,T,E,A,R,P,L)=>{const U=y.transform;return d.e(rl(f,e,a,l,h,g,y,w,T,E,A,R,L),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},md=(f,e,a,l,h,g,y,w,T,E,A,R,P)=>d.e(Ih(f,e,a,l,h,g,y,w,T,E,!0,A,0,P),{u_texsize_icon:R,u_texture_icon:1}),kh=(f,e)=>({u_opacity:f,u_color:e}),Lh=(f,e,a,l,h)=>d.e((function(g,y,w,T){const E=w.imageManager.getPattern(g.from.toString()),A=w.imageManager.getPattern(g.to.toString()),{width:R,height:P}=w.imageManager.getPixelSize(),L=Math.pow(2,T.tileID.overscaledZ),U=T.tileSize*Math.pow(2,w.transform.tileZoom)/L,H=U*(T.tileID.canonical.x+T.tileID.wrap*L),$=U*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[R,P],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/d.aC(T,1,w.transform.tileZoom),u_pixel_coord_upper:[H>>16,$>>16],u_pixel_coord_lower:[65535&H,65535&$]}})(a,h,e,l),{u_opacity:f}),Pu=(f,e)=>{},yr={fillExtrusion:(f,e)=>({u_lightpos:new d.bT(f,e.u_lightpos),u_lightpos_globe:new d.bT(f,e.u_lightpos_globe),u_lightintensity:new d.bg(f,e.u_lightintensity),u_lightcolor:new d.bT(f,e.u_lightcolor),u_vertical_gradient:new d.bg(f,e.u_vertical_gradient),u_opacity:new d.bg(f,e.u_opacity),u_fill_translate:new d.bU(f,e.u_fill_translate)}),fillExtrusionPattern:(f,e)=>({u_lightpos:new d.bT(f,e.u_lightpos),u_lightpos_globe:new d.bT(f,e.u_lightpos_globe),u_lightintensity:new d.bg(f,e.u_lightintensity),u_lightcolor:new d.bT(f,e.u_lightcolor),u_vertical_gradient:new d.bg(f,e.u_vertical_gradient),u_height_factor:new d.bg(f,e.u_height_factor),u_opacity:new d.bg(f,e.u_opacity),u_fill_translate:new d.bU(f,e.u_fill_translate),u_image:new d.bP(f,e.u_image),u_texsize:new d.bU(f,e.u_texsize),u_pixel_coord_upper:new d.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(f,e.u_pixel_coord_lower),u_scale:new d.bT(f,e.u_scale),u_fade:new d.bg(f,e.u_fade)}),fill:(f,e)=>({u_fill_translate:new d.bU(f,e.u_fill_translate)}),fillPattern:(f,e)=>({u_image:new d.bP(f,e.u_image),u_texsize:new d.bU(f,e.u_texsize),u_pixel_coord_upper:new d.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(f,e.u_pixel_coord_lower),u_scale:new d.bT(f,e.u_scale),u_fade:new d.bg(f,e.u_fade),u_fill_translate:new d.bU(f,e.u_fill_translate)}),fillOutline:(f,e)=>({u_world:new d.bU(f,e.u_world),u_fill_translate:new d.bU(f,e.u_fill_translate)}),fillOutlinePattern:(f,e)=>({u_world:new d.bU(f,e.u_world),u_image:new d.bP(f,e.u_image),u_texsize:new d.bU(f,e.u_texsize),u_pixel_coord_upper:new d.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(f,e.u_pixel_coord_lower),u_scale:new d.bT(f,e.u_scale),u_fade:new d.bg(f,e.u_fade),u_fill_translate:new d.bU(f,e.u_fill_translate)}),circle:(f,e)=>({u_camera_to_center_distance:new d.bg(f,e.u_camera_to_center_distance),u_scale_with_map:new d.bP(f,e.u_scale_with_map),u_pitch_with_map:new d.bP(f,e.u_pitch_with_map),u_extrude_scale:new d.bU(f,e.u_extrude_scale),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_globe_extrude_scale:new d.bg(f,e.u_globe_extrude_scale),u_translate:new d.bU(f,e.u_translate)}),collisionBox:(f,e)=>({u_pixel_extrude_scale:new d.bU(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_viewport_size:new d.bU(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.bQ(f,e.u_color),u_overlay:new d.bP(f,e.u_overlay),u_overlay_scale:new d.bg(f,e.u_overlay_scale)}),depth:Pu,clippingMask:Pu,heatmap:(f,e)=>({u_extrude_scale:new d.bg(f,e.u_extrude_scale),u_intensity:new d.bg(f,e.u_intensity),u_globe_extrude_scale:new d.bg(f,e.u_globe_extrude_scale)}),heatmapTexture:(f,e)=>({u_matrix:new d.bR(f,e.u_matrix),u_world:new d.bU(f,e.u_world),u_image:new d.bP(f,e.u_image),u_color_ramp:new d.bP(f,e.u_color_ramp),u_opacity:new d.bg(f,e.u_opacity)}),hillshade:(f,e)=>({u_image:new d.bP(f,e.u_image),u_latrange:new d.bU(f,e.u_latrange),u_exaggeration:new d.bg(f,e.u_exaggeration),u_altitudes:new d.b_(f,e.u_altitudes),u_azimuths:new d.b_(f,e.u_azimuths),u_accent:new d.bQ(f,e.u_accent),u_method:new d.bP(f,e.u_method),u_shadows:new d.bZ(f,e.u_shadows),u_highlights:new d.bZ(f,e.u_highlights)}),hillshadePrepare:(f,e)=>({u_matrix:new d.bR(f,e.u_matrix),u_image:new d.bP(f,e.u_image),u_dimension:new d.bU(f,e.u_dimension),u_zoom:new d.bg(f,e.u_zoom),u_unpack:new d.bS(f,e.u_unpack)}),colorRelief:(f,e)=>({u_image:new d.bP(f,e.u_image),u_unpack:new d.bS(f,e.u_unpack),u_dimension:new d.bU(f,e.u_dimension),u_elevation_stops:new d.bP(f,e.u_elevation_stops),u_color_stops:new d.bP(f,e.u_color_stops),u_color_ramp_size:new d.bP(f,e.u_color_ramp_size),u_opacity:new d.bg(f,e.u_opacity)}),line:(f,e)=>({u_translation:new d.bU(f,e.u_translation),u_ratio:new d.bg(f,e.u_ratio),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bU(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_translation:new d.bU(f,e.u_translation),u_ratio:new d.bg(f,e.u_ratio),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bU(f,e.u_units_to_pixels),u_image:new d.bP(f,e.u_image),u_image_height:new d.bg(f,e.u_image_height)}),linePattern:(f,e)=>({u_translation:new d.bU(f,e.u_translation),u_texsize:new d.bU(f,e.u_texsize),u_ratio:new d.bg(f,e.u_ratio),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_image:new d.bP(f,e.u_image),u_units_to_pixels:new d.bU(f,e.u_units_to_pixels),u_scale:new d.bT(f,e.u_scale),u_fade:new d.bg(f,e.u_fade)}),lineSDF:(f,e)=>({u_translation:new d.bU(f,e.u_translation),u_ratio:new d.bg(f,e.u_ratio),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bU(f,e.u_units_to_pixels),u_patternscale_a:new d.bU(f,e.u_patternscale_a),u_patternscale_b:new d.bU(f,e.u_patternscale_b),u_sdfgamma:new d.bg(f,e.u_sdfgamma),u_image:new d.bP(f,e.u_image),u_tex_y_a:new d.bg(f,e.u_tex_y_a),u_tex_y_b:new d.bg(f,e.u_tex_y_b),u_mix:new d.bg(f,e.u_mix)}),raster:(f,e)=>({u_tl_parent:new d.bU(f,e.u_tl_parent),u_scale_parent:new d.bg(f,e.u_scale_parent),u_buffer_scale:new d.bg(f,e.u_buffer_scale),u_fade_t:new d.bg(f,e.u_fade_t),u_opacity:new d.bg(f,e.u_opacity),u_image0:new d.bP(f,e.u_image0),u_image1:new d.bP(f,e.u_image1),u_brightness_low:new d.bg(f,e.u_brightness_low),u_brightness_high:new d.bg(f,e.u_brightness_high),u_saturation_factor:new d.bg(f,e.u_saturation_factor),u_contrast_factor:new d.bg(f,e.u_contrast_factor),u_spin_weights:new d.bT(f,e.u_spin_weights),u_coords_top:new d.bS(f,e.u_coords_top),u_coords_bottom:new d.bS(f,e.u_coords_bottom)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.bP(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bP(f,e.u_is_size_feature_constant),u_size_t:new d.bg(f,e.u_size_t),u_size:new d.bg(f,e.u_size),u_camera_to_center_distance:new d.bg(f,e.u_camera_to_center_distance),u_pitch:new d.bg(f,e.u_pitch),u_rotate_symbol:new d.bP(f,e.u_rotate_symbol),u_aspect_ratio:new d.bg(f,e.u_aspect_ratio),u_fade_change:new d.bg(f,e.u_fade_change),u_label_plane_matrix:new d.bR(f,e.u_label_plane_matrix),u_coord_matrix:new d.bR(f,e.u_coord_matrix),u_is_text:new d.bP(f,e.u_is_text),u_pitch_with_map:new d.bP(f,e.u_pitch_with_map),u_is_along_line:new d.bP(f,e.u_is_along_line),u_is_variable_anchor:new d.bP(f,e.u_is_variable_anchor),u_texsize:new d.bU(f,e.u_texsize),u_texture:new d.bP(f,e.u_texture),u_translation:new d.bU(f,e.u_translation),u_pitched_scale:new d.bg(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.bP(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bP(f,e.u_is_size_feature_constant),u_size_t:new d.bg(f,e.u_size_t),u_size:new d.bg(f,e.u_size),u_camera_to_center_distance:new d.bg(f,e.u_camera_to_center_distance),u_pitch:new d.bg(f,e.u_pitch),u_rotate_symbol:new d.bP(f,e.u_rotate_symbol),u_aspect_ratio:new d.bg(f,e.u_aspect_ratio),u_fade_change:new d.bg(f,e.u_fade_change),u_label_plane_matrix:new d.bR(f,e.u_label_plane_matrix),u_coord_matrix:new d.bR(f,e.u_coord_matrix),u_is_text:new d.bP(f,e.u_is_text),u_pitch_with_map:new d.bP(f,e.u_pitch_with_map),u_is_along_line:new d.bP(f,e.u_is_along_line),u_is_variable_anchor:new d.bP(f,e.u_is_variable_anchor),u_texsize:new d.bU(f,e.u_texsize),u_texture:new d.bP(f,e.u_texture),u_gamma_scale:new d.bg(f,e.u_gamma_scale),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_is_halo:new d.bP(f,e.u_is_halo),u_translation:new d.bU(f,e.u_translation),u_pitched_scale:new d.bg(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.bP(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bP(f,e.u_is_size_feature_constant),u_size_t:new d.bg(f,e.u_size_t),u_size:new d.bg(f,e.u_size),u_camera_to_center_distance:new d.bg(f,e.u_camera_to_center_distance),u_pitch:new d.bg(f,e.u_pitch),u_rotate_symbol:new d.bP(f,e.u_rotate_symbol),u_aspect_ratio:new d.bg(f,e.u_aspect_ratio),u_fade_change:new d.bg(f,e.u_fade_change),u_label_plane_matrix:new d.bR(f,e.u_label_plane_matrix),u_coord_matrix:new d.bR(f,e.u_coord_matrix),u_is_text:new d.bP(f,e.u_is_text),u_pitch_with_map:new d.bP(f,e.u_pitch_with_map),u_is_along_line:new d.bP(f,e.u_is_along_line),u_is_variable_anchor:new d.bP(f,e.u_is_variable_anchor),u_texsize:new d.bU(f,e.u_texsize),u_texsize_icon:new d.bU(f,e.u_texsize_icon),u_texture:new d.bP(f,e.u_texture),u_texture_icon:new d.bP(f,e.u_texture_icon),u_gamma_scale:new d.bg(f,e.u_gamma_scale),u_device_pixel_ratio:new d.bg(f,e.u_device_pixel_ratio),u_is_halo:new d.bP(f,e.u_is_halo),u_translation:new d.bU(f,e.u_translation),u_pitched_scale:new d.bg(f,e.u_pitched_scale)}),background:(f,e)=>({u_opacity:new d.bg(f,e.u_opacity),u_color:new d.bQ(f,e.u_color)}),backgroundPattern:(f,e)=>({u_opacity:new d.bg(f,e.u_opacity),u_image:new d.bP(f,e.u_image),u_pattern_tl_a:new d.bU(f,e.u_pattern_tl_a),u_pattern_br_a:new d.bU(f,e.u_pattern_br_a),u_pattern_tl_b:new d.bU(f,e.u_pattern_tl_b),u_pattern_br_b:new d.bU(f,e.u_pattern_br_b),u_texsize:new d.bU(f,e.u_texsize),u_mix:new d.bg(f,e.u_mix),u_pattern_size_a:new d.bU(f,e.u_pattern_size_a),u_pattern_size_b:new d.bU(f,e.u_pattern_size_b),u_scale_a:new d.bg(f,e.u_scale_a),u_scale_b:new d.bg(f,e.u_scale_b),u_pixel_coord_upper:new d.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bU(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.bg(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_texture:new d.bP(f,e.u_texture),u_ele_delta:new d.bg(f,e.u_ele_delta),u_fog_matrix:new d.bR(f,e.u_fog_matrix),u_fog_color:new d.bQ(f,e.u_fog_color),u_fog_ground_blend:new d.bg(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.bg(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.bQ(f,e.u_horizon_color),u_horizon_fog_blend:new d.bg(f,e.u_horizon_fog_blend),u_is_globe_mode:new d.bg(f,e.u_is_globe_mode)}),terrainDepth:(f,e)=>({u_ele_delta:new d.bg(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_texture:new d.bP(f,e.u_texture),u_terrain_coords_id:new d.bg(f,e.u_terrain_coords_id),u_ele_delta:new d.bg(f,e.u_ele_delta)}),projectionErrorMeasurement:(f,e)=>({u_input:new d.bg(f,e.u_input),u_output_expected:new d.bg(f,e.u_output_expected)}),atmosphere:(f,e)=>({u_sun_pos:new d.bT(f,e.u_sun_pos),u_atmosphere_blend:new d.bg(f,e.u_atmosphere_blend),u_globe_position:new d.bT(f,e.u_globe_position),u_globe_radius:new d.bg(f,e.u_globe_radius),u_inv_proj_matrix:new d.bR(f,e.u_inv_proj_matrix)}),sky:(f,e)=>({u_sky_color:new d.bQ(f,e.u_sky_color),u_horizon_color:new d.bQ(f,e.u_horizon_color),u_horizon:new d.bU(f,e.u_horizon),u_horizon_normal:new d.bU(f,e.u_horizon_normal),u_sky_horizon_blend:new d.bg(f,e.u_sky_horizon_blend),u_sky_blend:new d.bg(f,e.u_sky_blend)})};class al{constructor(e,a,l){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Za{constructor(e,a,l,h){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=h,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let l=0;l<this.attributes.length;l++){const h=a.attributes[this.attributes[l].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,a,l){for(let h=0;h<this.attributes.length;h++){const g=this.attributes[h],y=a.attributes[g.name];y!==void 0&&e.vertexAttribPointer(y,g.components,e[Yl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dc extends oi{getDefault(){return d.bf.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Kl extends oi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Bh extends oi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Os extends oi{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class os extends oi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class go extends oi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ru extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Oh extends oi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class _o extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class sl extends oi{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ic extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Fh extends oi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Fs extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Wl extends oi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ql extends oi{getDefault(){return d.bf.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Jl extends oi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Du extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class yo extends oi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ec extends oi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class vo extends oi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Gr extends oi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class kc extends oi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ra extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Lc extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Nn extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class vr extends oi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ls extends oi{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xo extends oi{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const l=this.gl;sr(l)?l.bindVertexArray(e):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class bo extends oi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class tc extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class js extends oi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class qr extends oi{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class Iu extends qr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ol extends qr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Vt extends qr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const ic="Framebuffer is not complete";class Hr{constructor(e,a,l,h,g){this.context=e,this.width=a,this.height=l;const y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Iu(e,w),h)this.depthAttachment=g?new Vt(e,w):new ol(e,w);else if(g)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(ic)}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Bc{constructor(e){var a,l;if(this.gl=e,this.clearColor=new Dc(this),this.clearDepth=new Kl(this),this.clearStencil=new Bh(this),this.colorMask=new Os(this),this.depthMask=new os(this),this.stencilMask=new go(this),this.stencilFunc=new Ru(this),this.stencilOp=new Oh(this),this.stencilTest=new _o(this),this.depthRange=new sl(this),this.depthTest=new Ic(this),this.depthFunc=new Fh(this),this.blend=new Fs(this),this.blendFunc=new Wl(this),this.blendColor=new Ql(this),this.blendEquation=new Jl(this),this.cullFace=new Du(this),this.cullFaceSide=new yo(this),this.frontFace=new ec(this),this.program=new vo(this),this.activeTexture=new Gr(this),this.viewport=new kc(this),this.bindFramebuffer=new ra(this),this.bindRenderbuffer=new Lc(this),this.bindTexture=new Nn(this),this.bindVertexBuffer=new vr(this),this.bindElementBuffer=new ls(this),this.bindVertexArray=new xo(this),this.pixelStoreUnpack=new bo(this),this.pixelStoreUnpackPremultiplyAlpha=new tc(this),this.pixelStoreUnpackFlipY=new js(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),sr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:h?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new al(this,e,a)}createVertexBuffer(e,a,l){return new Za(this,e,a,l)}createRenderbuffer(e,a,l){const h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,e,a,l),this.bindRenderbuffer.set(null),g}createFramebuffer(e,a,l,h){return new Hr(this,e,a,l,h)}clear({color:e,depth:a,stencil:l}){const h=this.gl;let g=0;e&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(g|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.bH(e.blendFunction,Ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return sr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return sr(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let lr;function ku(f,e,a,l,h){const g=f.context,y=f.transform,w=g.gl,T=f.useProgram("collisionBox"),E=[];let A=0,R=0;for(let X=0;X<l.length;X++){const W=l[X],ee=e.getTile(W).getBucket(a);if(!ee)continue;const Q=h?ee.textCollisionBox:ee.iconCollisionBox,ne=ee.collisionCircleArray;ne.length>0&&(E.push({circleArray:ne,circleOffset:R,coord:W}),A+=ne.length/4,R=A),Q&&T.draw(g,w.LINES,Dt.disabled,ei.disabled,f.colorModeForRenderPass(),wt.disabled,ql(f.transform),f.style.map.terrain&&f.style.map.terrain.getTerrainData(W),y.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,null,f.transform.zoom,null,null,Q.collisionVertexBuffer)}if(!h||!E.length)return;const P=f.useProgram("collisionCircle"),L=new d.b$;L.resize(4*A),L._trim();let U=0;for(const X of E)for(let W=0;W<X.circleArray.length/4;W++){const ee=4*W,Q=X.circleArray[ee+0],ne=X.circleArray[ee+1],le=X.circleArray[ee+2],J=X.circleArray[ee+3];L.emplace(U++,Q,ne,le,J,0),L.emplace(U++,Q,ne,le,J,1),L.emplace(U++,Q,ne,le,J,2),L.emplace(U++,Q,ne,le,J,3)}(!lr||lr.length<2*A)&&(lr=(function(X){const W=2*X,ee=new d.c1;ee.resize(W),ee._trim();for(let Q=0;Q<W;Q++){const ne=6*Q;ee.uint16[ne+0]=4*Q+0,ee.uint16[ne+1]=4*Q+1,ee.uint16[ne+2]=4*Q+2,ee.uint16[ne+3]=4*Q+2,ee.uint16[ne+4]=4*Q+3,ee.uint16[ne+5]=4*Q+0}return ee})(A));const H=g.createIndexBuffer(lr,!0),$=g.createVertexBuffer(L,d.c0.members,!0);for(const X of E){const W=tl(f.transform);P.draw(g,w.TRIANGLES,Dt.disabled,ei.disabled,f.colorModeForRenderPass(),wt.disabled,W,f.style.map.terrain&&f.style.map.terrain.getTerrainData(X.coord),null,a.id,$,H,d.aM.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,f.transform.zoom,null,null,null)}$.destroy(),H.destroy()}const Oc=d.ag(new Float32Array(16));function Us(f,e,a,l,h,g){const{horizontalAlign:y,verticalAlign:w}=d.aH(f);return new d.P((-(y-.5)*e/h+l[0])*g,(-(w-.5)*a/h+l[1])*g)}function Lu(f,e,a,l,h,g){const y=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(g);a||(w=w.rotate(-h));const T=y.add(w);return Gi(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){const w=mn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function nc(f,e,a,l,h,g,y,w,T,E,A,R){const P=f.text.placedSymbolArray,L=f.text.dynamicLayoutVertexArray,U=f.icon.dynamicLayoutVertexArray,H={};L.clear();for(let $=0;$<P.length;$++){const X=P.get($),W=X.hidden||!X.crossTileID||f.allowVerticalPlacement&&!X.placedOrientation?null:l[X.crossTileID];if(W){const ee=new d.P(X.anchorX,X.anchorY),Q={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:g,pitchWithMap:a,transform:h,tileAnchorPoint:ee,translation:E,unwrappedTileID:A},ne=a?qi(ee.x,ee.y,Q):mn(ee.x,ee.y,Q),le=He(h.cameraToCenterDistance,ne.signedDistanceFromCamera);let J=d.ap(f.textSizeData,w,X)*le/d.aB;a&&(J*=f.tilePixelRatio/y);const{width:de,height:Ce,anchor:be,textOffset:Te,textBoxScale:Ae}=W,Qe=Us(be,de,Ce,Te,Ae,J),Ke=h.getPitchedTextCorrection(ee.x+E[0],ee.y+E[1],A),Fe=Lu(ne.point,Q,e,Qe,-h.bearingInRadians,Ke),ht=f.allowVerticalPlacement&&X.placedOrientation===d.ao.vertical?Math.PI/2:0;for(let Zt=0;Zt<X.numGlyphs;Zt++)d.av(L,Fe,ht);T&&X.associatedIconIndex>=0&&(H[X.associatedIconIndex]={shiftedAnchor:Fe,angle:ht})}else La(X.numGlyphs,L)}if(T){U.clear();const $=f.icon.placedSymbolArray;for(let X=0;X<$.length;X++){const W=$.get(X);if(W.hidden)La(W.numGlyphs,U);else{const ee=H[X];if(ee)for(let Q=0;Q<W.numGlyphs;Q++)d.av(U,ee.shiftedAnchor,ee.angle);else La(W.numGlyphs,U)}}f.icon.dynamicLayoutVertexBuffer.updateData(U)}f.text.dynamicLayoutVertexBuffer.updateData(L)}function cs(f,e,a){return a.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Ga(f,e,a,l,h,g,y,w,T,E,A,R,P){const L=f.context,U=L.gl,H=f.transform,$=w==="map",X=T==="map",W=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",ee=$&&!X&&!W,Q=!a.layout.get("symbol-sort-key").isConstant();let ne=!1;const le=f.getDepthModeForSublayer(0,Dt.ReadOnly),J=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),de=[],Ce=H.getCircleRadiusCorrection();for(const be of l){const Te=e.getTile(be),Ae=Te.getBucket(a);if(!Ae)continue;const Qe=h?Ae.text:Ae.icon;if(!Qe||!Qe.segments.get().length||!Qe.hasVisibleVertices)continue;const Ke=Qe.programConfigurations.get(a.id),Fe=h||Ae.sdfIcons,ht=h?Ae.textSizeData:Ae.iconSizeData,Zt=X||H.pitch!==0,li=f.useProgram(cs(Fe,h,Ae),Ke),Ui=d.an(ht,H.zoom),Ti=f.style.map.terrain&&f.style.map.terrain.getTerrainData(be);let Si,Ri,Ai,Mi,ti=[0,0],zn=null;if(h)Ri=Te.glyphAtlasTexture,Ai=U.LINEAR,Si=Te.glyphAtlasTexture.size,Ae.iconsInText&&(ti=Te.imageAtlasTexture.size,zn=Te.imageAtlasTexture,Mi=Zt||f.options.rotating||f.options.zooming||ht.kind==="composite"||ht.kind==="camera"?U.LINEAR:U.NEAREST);else{const fi=a.layout.get("icon-size").constantOr(0)!==1||Ae.iconsNeedLinear;Ri=Te.imageAtlasTexture,Ai=Fe||f.options.rotating||f.options.zooming||fi||Zt?U.LINEAR:U.NEAREST,Si=Te.imageAtlasTexture.size}const vn=d.aC(Te,1,f.transform.zoom),Er=Ei($,f.transform,vn),Ys=d.L();d.aq(Ys,Er);const ys=St(X,$,f.transform,vn),Cr=d.aD(H,Te,g,y),vs=H.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Ks=J&&Ae.hasTextData(),hc=a.layout.get("icon-text-fit")!=="none"&&Ks&&Ae.hasIconData();if(W){const fi=f.style.map.terrain?(ur,an)=>f.style.map.terrain.getElevation(be,ur,an):null,$i=a.layout.get("text-rotation-alignment")==="map";tn(Ae,f,h,Er,Ys,X,E,$i,be.toUnwrapped(),H.width,H.height,Cr,fi)}const xs=h&&J||hc,Gn=W||xs?Oc:X?Er:f.transform.clipSpaceToPixelsMatrix,$a=Fe&&a.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Xa;Xa=Fe?Ae.iconsInText?md(ht.kind,Ui,ee,X,W,xs,f,Gn,ys,Cr,Si,ti,Ce):Ih(ht.kind,Ui,ee,X,W,xs,f,Gn,ys,Cr,h,Si,0,Ce):rl(ht.kind,Ui,ee,X,W,xs,f,Gn,ys,Cr,h,Si,Ce);const Ws={program:li,buffers:Qe,uniformValues:Xa,projectionData:vs,atlasTexture:Ri,atlasTextureIcon:zn,atlasInterpolation:Ai,atlasInterpolationIcon:Mi,isSDF:Fe,hasHalo:$a};if(Q&&Ae.canOverlap){ne=!0;const fi=Qe.segments.get();for(const $i of fi)de.push({segments:new d.aM([$i]),sortKey:$i.sortKey,state:Ws,terrainData:Ti})}else de.push({segments:Qe.segments,sortKey:0,state:Ws,terrainData:Ti})}ne&&de.sort(((be,Te)=>be.sortKey-Te.sortKey));for(const be of de){const Te=be.state;if(L.activeTexture.set(U.TEXTURE0),Te.atlasTexture.bind(Te.atlasInterpolation,U.CLAMP_TO_EDGE),Te.atlasTextureIcon&&(L.activeTexture.set(U.TEXTURE1),Te.atlasTextureIcon&&Te.atlasTextureIcon.bind(Te.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Te.isSDF){const Ae=Te.uniformValues;Te.hasHalo&&(Ae.u_is_halo=1,Ns(Te.buffers,be.segments,a,f,Te.program,le,A,R,Ae,Te.projectionData,be.terrainData)),Ae.u_is_halo=0}Ns(Te.buffers,be.segments,a,f,Te.program,le,A,R,Te.uniformValues,Te.projectionData,be.terrainData)}}function Ns(f,e,a,l,h,g,y,w,T,E,A){const R=l.context;h.draw(R,R.gl.TRIANGLES,g,y,w,wt.backCCW,T,A,E,a.id,f.layoutVertexBuffer,f.indexBuffer,e,a.paint,l.transform.zoom,f.programConfigurations.get(a.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function ll(f,e,a,l,h){const g=f.context,y=g.gl,w=ei.disabled,T=new Ci([y.ONE,y.ONE],d.bf.transparent,[!0,!0,!0,!0]),E=e.getBucket(a);if(!E)return;const A=l.key;let R=a.heatmapFbos.get(A);R||(R=cr(g,e.tileSize,e.tileSize),a.heatmapFbos.set(A,R)),g.bindFramebuffer.set(R.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:d.bf.transparent});const P=E.programConfigurations.get(a.id),L=f.useProgram("heatmap",P,!h),U=f.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),H=f.style.map.terrain.getTerrainData(l);L.draw(g,y.TRIANGLES,Dt.disabled,w,T,wt.disabled,Ph(e,f.transform.zoom,a.paint.get("heatmap-intensity"),1),H,U,a.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,a.paint,f.transform.zoom,P)}function $r(f,e,a,l,h){const g=f.context,y=g.gl,w=f.transform;g.setColorMode(f.colorModeForRenderPass());const T=ma(g,e),E=a.key,A=e.heatmapFbos.get(E);if(!A)return;g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,A.colorAttachment.get()),g.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const R=w.getProjectionData({overscaledTileID:a,applyTerrainMatrix:h,applyGlobeMatrix:!l});f.useProgram("heatmapTexture").draw(g,y.TRIANGLES,Dt.disabled,ei.disabled,f.colorModeForRenderPass(),wt.disabled,Cu(f,e,0,1),null,R,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,w.zoom),A.destroy(),e.heatmapFbos.delete(E)}function cr(f,e,a){var l,h;const g=f.gl,y=g.createTexture();g.bindTexture(g.TEXTURE_2D,y),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,T=(h=f.RGBA16F)!==null&&h!==void 0?h:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,T,e,a,0,g.RGBA,w,null);const E=f.createFramebuffer(e,a,!1,!1);return E.colorAttachment.set(y),E}function ma(f,e){return e.colorRampTexture||(e.colorRampTexture=new d.T(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Xr(f,e,a,l,h){if(!a||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let y=g[a.to.toString()],w=g[a.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){const T=h.getPaintProperty(e);y=g[T],w=g[T]}y&&w&&f.setConstantPatternPositions(y,w)}function xr(f,e,a,l,h,g,y,w){const T=f.context.gl,E="fill-pattern",A=a.paint.get(E),R=A&&A.constantOr(1),P=a.getCrossfadeParameters();let L,U,H,$,X;const W=f.transform,ee=a.paint.get("fill-translate"),Q=a.paint.get("fill-translate-anchor");y?(U=R&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=T.LINES):(U=R?"fillPattern":"fill",L=T.TRIANGLES);const ne=A.constantOr(null);for(const le of l){const J=e.getTile(le);if(R&&!J.patternsLoaded())continue;const de=J.getBucket(a);if(!de)continue;const Ce=de.programConfigurations.get(a.id),be=f.useProgram(U,Ce),Te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(le);R&&(f.context.activeTexture.set(T.TEXTURE0),J.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Ce.updatePaintBuffers(P)),Xr(Ce,E,ne,J,a);const Ae=W.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),Qe=d.aD(W,J,ee,Q);if(y){$=de.indexBuffer2,X=de.segments2;const Fe=[T.drawingBufferWidth,T.drawingBufferHeight];H=U==="fillOutlinePattern"&&R?el(f,P,J,Fe,Qe):Jo(Fe,Qe)}else $=de.indexBuffer,X=de.segments,H=R?Gl(f,P,J,Qe):{u_fill_translate:Qe};const Ke=f.stencilModeForClipping(le);be.draw(f.context,L,h,Ke,g,wt.backCCW,H,Te,Ae,a.id,de.layoutVertexBuffer,$,X,a.paint,f.transform.zoom,Ce)}}function ga(f,e,a,l,h,g,y,w){const T=f.context,E=T.gl,A="fill-extrusion-pattern",R=a.paint.get(A),P=R.constantOr(1),L=a.getCrossfadeParameters(),U=a.paint.get("fill-extrusion-opacity"),H=R.constantOr(null),$=f.transform;for(const X of l){const W=e.getTile(X),ee=W.getBucket(a);if(!ee)continue;const Q=f.style.map.terrain&&f.style.map.terrain.getTerrainData(X),ne=ee.programConfigurations.get(a.id),le=f.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ne);P&&(f.context.activeTexture.set(E.TEXTURE0),W.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ne.updatePaintBuffers(L));const J=$.getProjectionData({overscaledTileID:X,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Xr(ne,A,H,W,a);const de=d.aD($,W,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ce=a.paint.get("fill-extrusion-vertical-gradient"),be=P?pd(f,Ce,U,de,X,L,W):_r(f,Ce,U,de);le.draw(T,T.gl.TRIANGLES,h,g,y,wt.backCCW,be,Q,J,a.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,a.paint,f.transform.zoom,ne,f.style.map.terrain&&ee.centroidVertexBuffer)}}function Fc(f,e,a,l,h,g,y,w,T){var E;const A=f.style.projection,R=f.context,P=f.transform,L=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],H=f.useProgram("hillshade",null,!1,U),$=!f.options.moving;for(const X of l){const W=e.getTile(X),ee=W.fbo;if(!ee)continue;const Q=A.getMeshFromTileID(R,X.canonical,w,!0,"raster"),ne=(E=f.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(X);R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,ee.colorAttachment.get());const le=P.getProjectionData({overscaledTileID:X,aligned:$,applyGlobeMatrix:!T,applyTerrainMatrix:!0});H.draw(R,L.TRIANGLES,g,h[X.overscaledZ],y,wt.backCCW,Rh(f,W,a),ne,le,a.id,Q.vertexBuffer,Q.indexBuffer,Q.segments)}}function us(f,e,a,l,h,g,y,w,T){var E;const A=f.style.projection,R=f.context,P=f.transform,L=R.gl,U=f.useProgram("colorRelief"),H=!f.options.moving;let $=!0,X=0;for(const W of l){const ee=e.getTile(W),Q=ee.dem;if($){const be=L.getParameter(L.MAX_TEXTURE_SIZE),{elevationTexture:Te,colorTexture:Ae}=a.getColorRampTextures(R,be,Q.getUnpackVector());R.activeTexture.set(L.TEXTURE1),Te.bind(L.NEAREST,L.CLAMP_TO_EDGE),R.activeTexture.set(L.TEXTURE4),Ae.bind(L.LINEAR,L.CLAMP_TO_EDGE),$=!1,X=Te.size[0]}if(!Q||!Q.data)continue;const ne=Q.stride,le=Q.getPixels();if(R.activeTexture.set(L.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),ee.demTexture=ee.demTexture||f.getTileTexture(ne),ee.demTexture){const be=ee.demTexture;be.update(le,{premultiply:!1}),be.bind(L.LINEAR,L.CLAMP_TO_EDGE)}else ee.demTexture=new d.T(R,le,L.RGBA,{premultiply:!1}),ee.demTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const J=A.getMeshFromTileID(R,W.canonical,w,!0,"raster"),de=(E=f.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(W),Ce=P.getProjectionData({overscaledTileID:W,aligned:H,applyGlobeMatrix:!T,applyTerrainMatrix:!0});U.draw(R,L.TRIANGLES,g,h[W.overscaledZ],y,wt.backCCW,il(a,ee.dem,X),de,Ce,a.id,J.vertexBuffer,J.indexBuffer,J.segments)}}const rc=[new d.P(0,0),new d.P(d.$,0),new d.P(d.$,d.$),new d.P(0,d.$)];function Dn(f,e,a,l,h,g,y,w,T=!1,E=!1){const A=l[l.length-1].overscaledZ,R=f.context,P=R.gl,L=f.useProgram("raster"),U=f.transform,H=f.style.projection,$=f.colorModeForRenderPass(),X=!f.options.moving;for(const W of l){const ee=f.getDepthModeForSublayer(W.overscaledZ-A,a.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,P.LESS),Q=e.getTile(W);Q.registerFadeDuration(a.paint.get("raster-fade-duration"));const ne=e.findLoadedParent(W,0),le=e.findLoadedSibling(W),J=Hi(Q,ne||le||null,e,a,f.transform,f.style.map.terrain);let de,Ce;const be=a.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;R.activeTexture.set(P.TEXTURE0),Q.texture.bind(be,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(P.TEXTURE1),ne?(ne.texture.bind(be,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),de=Math.pow(2,ne.tileID.overscaledZ-Q.tileID.overscaledZ),Ce=[Q.tileID.canonical.x*de%1,Q.tileID.canonical.y*de%1]):Q.texture.bind(be,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Q.texture.useMipmap&&R.extTextureFilterAnisotropic&&f.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(W),Ae=U.getProjectionData({overscaledTileID:W,aligned:X,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),Qe=nl(Ce||[0,0],de||1,J,a,w),Ke=H.getMeshFromTileID(R,W.canonical,g,y,"raster");L.draw(R,P.TRIANGLES,ee,h?h[W.overscaledZ]:ei.disabled,$,T?wt.frontCCW:wt.backCCW,Qe,Te,Ae,a.id,Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}}function Hi(f,e,a,l,h,g){const y=l.paint.get("raster-fade-duration");if(!g&&y>0){const w=Ue.now(),T=(w-f.timeAdded)/y,E=e?(w-e.timeAdded)/y:-1,A=a.getSource(),R=ct(h,{tileSize:A.tileSize,roundZoom:A.roundZoom}),P=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),L=P&&f.refreshedUponExpiration?1:d.ah(P?T:1-E,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}const hi=new d.bf(1,0,0,1),Vs=new d.bf(0,1,0,1),_a=new d.bf(0,0,1,1),cl=new d.bf(1,0,1,1),hs=new d.bf(0,1,1,1);function Bu(f,e,a,l){wi(f,0,e+a/2,f.transform.width,a,l)}function jc(f,e,a,l){wi(f,e-a/2,0,a,f.transform.height,l)}function wi(f,e,a,l,h,g){const y=f.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,a*f.pixelRatio,l*f.pixelRatio,h*f.pixelRatio),y.clear({color:g}),w.disable(w.SCISSOR_TEST)}function ya(f,e,a){const l=f.context,h=l.gl,g=f.useProgram("debug"),y=Dt.disabled,w=ei.disabled,T=f.colorModeForRenderPass(),E="$debug",A=f.style.map.terrain&&f.style.map.terrain.getTerrainData(a);l.activeTexture.set(h.TEXTURE0);const R=e.getTileByID(a.key).latestRawTileData,P=Math.floor((R&&R.byteLength||0)/1024),L=e.getTile(a).tileSize,U=512/Math.min(L,512)*(a.overscaledZ/f.transform.zoom)*.5;let H=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(H+=` => ${a.overscaledZ}`),(function(X,W){X.initDebugOverlayCanvas();const ee=X.debugOverlayCanvas,Q=X.context.gl,ne=X.debugOverlayCanvas.getContext("2d");ne.clearRect(0,0,ee.width,ee.height),ne.shadowColor="white",ne.shadowBlur=2,ne.lineWidth=1.5,ne.strokeStyle="white",ne.textBaseline="top",ne.font="bold 36px Open Sans, sans-serif",ne.fillText(W,5,5),ne.strokeText(W,5,5),X.debugOverlayTexture.update(ee),X.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)})(f,`${H} ${P}kB`);const $=f.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,h.TRIANGLES,y,w,Ci.alphaBlended,wt.disabled,po(d.bf.transparent,U),null,$,E,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),g.draw(l,h.LINE_STRIP,y,w,T,wt.disabled,po(d.bf.red),A,$,E,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function kr(f,e,a,l){const{isRenderingGlobe:h}=l,g=f.context,y=g.gl,w=f.transform,T=f.colorModeForRenderPass(),E=f.getDepthModeFor3D(),A=f.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,f.width,f.height]);for(const R of a){const P=e.getTerrainMesh(R.tileID),L=f.renderToTexture.getTexture(R),U=e.getTerrainData(R.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,L.texture);const H=e.getMeshFrameDelta(w.zoom),$=w.calculateFogMatrix(R.tileID.toUnwrapped()),X=Pc(H,$,f.style.sky,w.pitch,h),W=w.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});A.draw(g,y.TRIANGLES,E,ei.disabled,T,wt.backCCW,X,U,W,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}function Zs(f,e){if(!e.mesh){const a=new d.aL;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const l=new d.aN;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Ds(f.createVertexBuffer(a,ja.members),f.createIndexBuffer(l),d.aM.simpleSegment(0,0,a.length,l.length))}return e.mesh}class ul{constructor(e,a){this.context=new Bc(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xt.maxUnderzooming+Xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ao}resize(e,a,l){if(this.width=Math.floor(e*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,a=new d.aL;a.emplaceBack(0,0),a.emplaceBack(d.$,0),a.emplaceBack(0,d.$),a.emplaceBack(d.$,d.$),this.tileExtentBuffer=e.createVertexBuffer(a,ja.members),this.tileExtentSegments=d.aM.simpleSegment(0,0,4,2);const l=new d.aL;l.emplaceBack(0,0),l.emplaceBack(d.$,0),l.emplaceBack(0,d.$),l.emplaceBack(d.$,d.$),this.debugBuffer=e.createVertexBuffer(l,ja.members),this.debugSegments=d.aM.simpleSegment(0,0,4,5);const h=new d.c6;h.emplaceBack(0,0,0,0),h.emplaceBack(d.$,0,d.$,0),h.emplaceBack(0,d.$,0,d.$),h.emplaceBack(d.$,d.$,d.$,d.$),this.rasterBoundsBuffer=e.createVertexBuffer(h,dd.members),this.rasterBoundsSegments=d.aM.simpleSegment(0,0,4,2);const g=new d.aL;g.emplaceBack(0,0),g.emplaceBack(d.$,0),g.emplaceBack(0,d.$),g.emplaceBack(d.$,d.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,ja.members),this.rasterBoundsSegmentsPosOnly=d.aM.simpleSegment(0,0,4,5);const y=new d.aL;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,ja.members),this.viewportSegments=d.aM.simpleSegment(0,0,4,2);const w=new d.c7;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const T=new d.aN;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const E=this.context.gl;this.stencilClearMode=new ei({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new Ds(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.L();d.bY(l,0,this.width,this.height,0,0,1),d.N(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,Dt.disabled,this.stencilClearMode,Ci.disabled,wt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();const h=this.context;h.setColorMode(Ci.disabled),h.setDepthMode(Dt.disabled);const g={};for(const y of a)g[y.key]=this.nextStencilID++;this._renderTileMasks(g,a,l,!0),this._renderTileMasks(g,a,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,a,l,h){const g=this.context,y=g.gl,w=this.style.projection,T=this.transform,E=this.useProgram("clippingMask");for(const A of a){const R=e[A.key],P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),L=w.getMeshFromTileID(this.context,A.canonical,h,!0,"stencil"),U=T.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!l,applyTerrainMatrix:!0});E.draw(g,y.TRIANGLES,Dt.disabled,new ei({func:y.ALWAYS,mask:0},R,255,y.KEEP,y.KEEP,y.REPLACE),Ci.disabled,l?wt.disabled:wt.backCCW,null,P,U,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}_renderTilesDepthBuffer(){const e=this.context,a=e.gl,l=this.style.projection,h=this.transform,g=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=ge(h,{tileSize:h.tileSize});for(const T of w){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),A=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,a.TRIANGLES,y,ei.disabled,Ci.disabled,wt.backCCW,null,E,R,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new ei({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new ei({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const a=this.context.gl,l=e.sort(((y,w)=>w.overscaledZ-y.overscaledZ)),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const y={};for(let w=0;w<g;w++)y[w+h]=new ei({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[y,l]}return[{[h]:ei.disabled},l]}stencilConfigForOverlapTwoPass(e){const a=this.context.gl,l=e.sort(((y,w)=>w.overscaledZ-y.overscaledZ)),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(this.clearStencil(),g>1){const y={},w={};for(let T=0;T<g;T++)y[T+h]=new ei({func:a.GREATER,mask:255},g+1+T,255,a.KEEP,a.KEEP,a.REPLACE),w[T+h]=new ei({func:a.GREATER,mask:255},1+T,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*g+1,[y,w,l]}return this.nextStencilID=3,[{[h]:new ei({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[h]:new ei({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ci([e.CONSTANT_COLOR,e.ONE],new d.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ci.unblended:Ci.alphaBlended}getDepthModeForSublayer(e,a,l){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Dt(l||this.context.gl.LEQUAL,a,[h,h])}getDepthModeFor3D(){return new Dt(this.context.gl.LEQUAL,Dt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var l,h;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ue.now()),this.imageManager.beginFrame();const g=this.style._order,y=this.style.sourceCaches,w={},T={},E={},A={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const P in y){const L=y[P];L.used&&L.prepare(this.context),w[P]=L.getVisibleCoordinates(!1),T[P]=w[P].slice().reverse(),E[P]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<g.length;P++)if(this.style._layers[g[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of g){const L=this.style._layers[P];if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const U=T[L.source];(L.type==="custom"||U.length)&&this.renderLayer(this,y[L.source],L,U,A)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:P=>this.useProgram(P)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.bf.black:d.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(P,L){const U=P.context,H=U.gl,$=((le,J,de)=>{const Ce=Math.cos(J.rollInRadians),be=Math.sin(J.rollInRadians),Te=se(J),Ae=J.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(J.width/2-Te*be)*de,(J.height/2+Te*Ce)*de],u_horizon_normal:[-be,Ce],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*J.height/2*de,u_sky_blend:Ae}})(L,P.style.map.transform,P.pixelRatio),X=new Dt(H.LEQUAL,Dt.ReadWrite,[0,1]),W=ei.disabled,ee=P.colorModeForRenderPass(),Q=P.useProgram("sky"),ne=Zs(U,L);Q.draw(U,H.TRIANGLES,X,W,ee,wt.disabled,$,null,void 0,"sky",ne.vertexBuffer,ne.indexBuffer,ne.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[g[this.currentLayer]],L=y[P.source],U=w[P.source];this._renderTileClippingMasks(P,U,!1),this.renderLayer(this,L,P,U,A)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const P=this.style._layers[g[this.currentLayer]],L=y[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P,A))continue;this.opaquePassEnabledForLayer()||R||(R=!0,A.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(P.type==="symbol"?E:T)[P.source];this._renderTileClippingMasks(P,w[P.source],!!this.renderToTexture),this.renderLayer(this,L,P,U,A)}if(A.isRenderingGlobe&&(function(P,L,U){const H=P.context,$=H.gl,X=P.useProgram("atmosphere"),W=new Dt($.LEQUAL,Dt.ReadOnly,[0,1]),ee=P.transform,Q=(function(Ae,Qe){const Ke=Ae.properties.get("position"),Fe=[-Ke.x,-Ke.y,-Ke.z],ht=d.ag(new Float64Array(16));return Ae.properties.get("anchor")==="map"&&(d.b6(ht,ht,Qe.rollInRadians),d.b7(ht,ht,-Qe.pitchInRadians),d.b6(ht,ht,Qe.bearingInRadians),d.b7(ht,ht,Qe.center.lat*Math.PI/180),d.bz(ht,ht,-Qe.center.lng*Math.PI/180)),d.c5(Fe,Fe,ht),Fe})(U,P.transform),ne=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=L.properties.get("atmosphere-blend")*ne.projectionTransition;if(le===0)return;const J=Ko(ee.worldSize,ee.center.lat),de=ee.inverseProjectionMatrix,Ce=new Float64Array(4);Ce[3]=1,d.aw(Ce,Ce,ee.modelViewProjectionMatrix),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1,d.aw(Ce,Ce,de),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1;const be=((Ae,Qe,Ke,Fe,ht)=>({u_sun_pos:Ae,u_atmosphere_blend:Qe,u_globe_position:Ke,u_globe_radius:Fe,u_inv_proj_matrix:ht}))(Q,le,[Ce[0],Ce[1],Ce[2]],J,de),Te=Zs(H,L);X.draw(H,$.TRIANGLES,W,ei.disabled,Ci.alphaBlended,wt.disabled,be,null,null,"atmosphere",Te.vertexBuffer,Te.indexBuffer,Te.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const P=(function(L,U){let H=null;const $=Object.values(L._layers).flatMap((Q=>Q.source&&!Q.isHidden(U)?[L.sourceCaches[Q.source]]:[])),X=$.filter((Q=>Q.getSource().type==="vector")),W=$.filter((Q=>Q.getSource().type!=="vector")),ee=Q=>{(!H||H.getSource().maxzoom<Q.getSource().maxzoom)&&(H=Q)};return X.forEach((Q=>ee(Q))),H||W.forEach((Q=>ee(Q))),H})(this.style,this.transform.zoom);P&&(function(L,U,H){for(let $=0;$<H.length;$++)ya(L,U,H[$])})(this,P,P.getVisibleCoordinates())}this.options.showPadding&&(function(P){const L=P.transform.padding;Bu(P,P.transform.height-(L.top||0),3,hi),Bu(P,L.bottom||0,3,Vs),jc(P,L.left||0,3,_a),jc(P,P.transform.width-(L.right||0),3,cl);const U=P.transform.centerPoint;(function(H,$,X,W){wi(H,$-1,X-10,2,20,W),wi(H,$-10,X-1,20,2,W)})(P,U.x,P.transform.height-U.y,hs)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!d.c8(a,l):!d.c9(a,l)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(d.ca(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,y){const w=g.context,T=w.gl,E=g.transform,A=Ci.unblended,R=new Dt(T.LEQUAL,Dt.ReadWrite,[0,1]),P=y.sourceCache.getRenderableTiles(),L=g.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:d.bf.transparent,depth:1});for(const U of P){const H=y.getTerrainMesh(U.tileID),$=y.getTerrainData(U.tileID),X=E.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),W={u_ele_delta:y.getMeshFrameDelta(E.zoom)};L.draw(w,T.TRIANGLES,R,ei.disabled,A,wt.backCCW,W,$,X,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,y){const w=g.context,T=w.gl,E=g.transform,A=Ci.unblended,R=new Dt(T.LEQUAL,Dt.ReadWrite,[0,1]),P=y.getCoordsTexture(),L=y.sourceCache.getRenderableTiles(),U=g.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:d.bf.transparent,depth:1}),y.coordsIndex=[];for(const H of L){const $=y.getTerrainMesh(H.tileID),X=y.getTerrainData(H.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.texture);const W={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(E.zoom)},ee=E.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,T.TRIANGLES,R,ei.disabled,A,wt.backCCW,W,X,ee,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),y.coordsIndex.push(H.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,a,l,h,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,d.cb(l)?(function(y,w,T,E,A,R){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:P}=R,L=ei.disabled,U=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(H,$,X,W,ee,Q,ne,le,J){const de=$.transform,Ce=$.style.map.terrain,be=ee==="map",Te=Q==="map";for(const Ae of H){const Qe=W.getTile(Ae),Ke=Qe.getBucket(X);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const Fe=d.an(Ke.textSizeData,de.zoom),ht=d.aC(Qe,1,$.transform.zoom),Zt=Ei(be,$.transform,ht),li=X.layout.get("icon-text-fit")!=="none"&&Ke.hasIconData();if(Fe){const Ui=Math.pow(2,de.zoom-Qe.tileID.overscaledZ),Ti=Ce?(Si,Ri)=>Ce.getElevation(Ae,Si,Ri):null;nc(Ke,be,Te,J,de,Zt,Ui,Fe,li,d.aD(de,Qe,ne,le),Ae.toUnwrapped(),Ti)}}})(E,y,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),A),T.paint.get("icon-opacity").constantOr(1)!==0&&Ga(y,w,T,E,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),L,U,P),T.paint.get("text-opacity").constantOr(1)!==0&&Ga(y,w,T,E,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),L,U,P),w.map.showCollisionBoxes&&(ku(y,w,T,E,!0),ku(y,w,T,E,!1))})(e,a,l,h,this.style.placement.variableOffsets,g):d.cc(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=A,P=T.paint.get("circle-opacity"),L=T.paint.get("circle-stroke-width"),U=T.paint.get("circle-stroke-opacity"),H=!T.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(L.constantOr(1)===0||U.constantOr(1)===0))return;const $=y.context,X=$.gl,W=y.transform,ee=y.getDepthModeForSublayer(0,Dt.ReadOnly),Q=ei.disabled,ne=y.colorModeForRenderPass(),le=[],J=W.getCircleRadiusCorrection();for(let de=0;de<E.length;de++){const Ce=E[de],be=w.getTile(Ce),Te=be.getBucket(T);if(!Te)continue;const Ae=T.paint.get("circle-translate"),Qe=T.paint.get("circle-translate-anchor"),Ke=d.aD(W,be,Ae,Qe),Fe=Te.programConfigurations.get(T.id),ht=y.useProgram("circle",Fe),Zt=Te.layoutVertexBuffer,li=Te.indexBuffer,Ui=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ce),Ti={programConfiguration:Fe,program:ht,layoutVertexBuffer:Zt,indexBuffer:li,uniformValues:zh(y,be,T,Ke,J),terrainData:Ui,projectionData:W.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(H){const Si=Te.segments.get();for(const Ri of Si)le.push({segments:new d.aM([Ri]),sortKey:Ri.sortKey,state:Ti})}else le.push({segments:Te.segments,sortKey:0,state:Ti})}H&&le.sort(((de,Ce)=>de.sortKey-Ce.sortKey));for(const de of le){const{programConfiguration:Ce,program:be,layoutVertexBuffer:Te,indexBuffer:Ae,uniformValues:Qe,terrainData:Ke,projectionData:Fe}=de.state;be.draw($,X.TRIANGLES,ee,Q,ne,wt.backCCW,Qe,Ke,Fe,T.id,Te,Ae,de.segments,T.paint,y.transform.zoom,Ce)}})(e,a,l,h,g):d.cd(l)?(function(y,w,T,E,A){if(T.paint.get("heatmap-opacity")===0)return;const R=y.context,{isRenderingToTexture:P,isRenderingGlobe:L}=A;if(y.style.map.terrain){for(const U of E){const H=w.getTile(U);w.hasRenderableParent(U)||(y.renderPass==="offscreen"?ll(y,H,T,U,L):y.renderPass==="translucent"&&$r(y,T,U,P,L))}R.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function(U,H,$,X){const W=U.context,ee=W.gl,Q=U.transform,ne=ei.disabled,le=new Ci([ee.ONE,ee.ONE],d.bf.transparent,[!0,!0,!0,!0]);(function(J,de,Ce){const be=J.gl;J.activeTexture.set(be.TEXTURE1),J.viewport.set([0,0,de.width/4,de.height/4]);let Te=Ce.heatmapFbos.get(d.c2);Te?(be.bindTexture(be.TEXTURE_2D,Te.colorAttachment.get()),J.bindFramebuffer.set(Te.framebuffer)):(Te=cr(J,de.width/4,de.height/4),Ce.heatmapFbos.set(d.c2,Te))})(W,U,$),W.clear({color:d.bf.transparent});for(let J=0;J<X.length;J++){const de=X[J];if(H.hasRenderableParent(de))continue;const Ce=H.getTile(de),be=Ce.getBucket($);if(!be)continue;const Te=be.programConfigurations.get($.id),Ae=U.useProgram("heatmap",Te),Qe=Q.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ke=Q.getCircleRadiusCorrection();Ae.draw(W,ee.TRIANGLES,Dt.disabled,ne,le,wt.backCCW,Ph(Ce,Q.zoom,$.paint.get("heatmap-intensity"),Ke),null,Qe,$.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,$.paint,Q.zoom,Te)}W.viewport.set([0,0,U.width,U.height])})(y,w,T,E):y.renderPass==="translucent"&&(function(U,H){const $=U.context,X=$.gl;$.setColorMode(U.colorModeForRenderPass());const W=H.heatmapFbos.get(d.c2);W&&($.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,W.colorAttachment.get()),$.activeTexture.set(X.TEXTURE1),ma($,H).bind(X.LINEAR,X.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw($,X.TRIANGLES,Dt.disabled,ei.disabled,U.colorModeForRenderPass(),wt.disabled,Cu(U,H,0,1),null,null,H.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,H.paint,U.transform.zoom))})(y,T)})(e,a,l,h,g):d.ce(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=A,P=T.paint.get("line-opacity"),L=T.paint.get("line-width");if(P.constantOr(1)===0||L.constantOr(1)===0)return;const U=y.getDepthModeForSublayer(0,Dt.ReadOnly),H=y.colorModeForRenderPass(),$=T.paint.get("line-dasharray"),X=T.paint.get("line-pattern"),W=X.constantOr(1),ee=T.paint.get("line-gradient"),Q=T.getCrossfadeParameters(),ne=W?"linePattern":$?"lineSDF":ee?"lineGradient":"line",le=y.context,J=le.gl,de=y.transform;let Ce=!0;for(const be of E){const Te=w.getTile(be);if(W&&!Te.patternsLoaded())continue;const Ae=Te.getBucket(T);if(!Ae)continue;const Qe=Ae.programConfigurations.get(T.id),Ke=y.context.program.get(),Fe=y.useProgram(ne,Qe),ht=Ce||Fe.program!==Ke,Zt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(be),li=X.constantOr(null);if(li&&Te.imageAtlas){const Ai=Te.imageAtlas,Mi=Ai.patternPositions[li.to.toString()],ti=Ai.patternPositions[li.from.toString()];Mi&&ti&&Qe.setConstantPatternPositions(Mi,ti)}const Ui=de.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ti=de.getPixelScale(),Si=W?zu(y,Te,T,Ti,Q):$?Bs(y,Te,T,Ti,$,Q):ee?Hl(y,Te,T,Ti,Ae.lineClipsArray.length):Rc(y,Te,T,Ti);if(W)le.activeTexture.set(J.TEXTURE0),Te.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Qe.updatePaintBuffers(Q);else if($&&(ht||y.lineAtlas.dirty))le.activeTexture.set(J.TEXTURE0),y.lineAtlas.bind(le);else if(ee){const Ai=Ae.gradients[T.id];let Mi=Ai.texture;if(T.gradientVersion!==Ai.version){let ti=256;if(T.stepInterpolant){const zn=w.getSource().maxzoom,vn=be.canonical.z===zn?Math.ceil(1<<y.transform.maxZoom-be.canonical.z):1;ti=d.ah(d.c3(Ae.maxLineLength/d.$*1024*vn),256,le.maxTextureSize)}Ai.gradient=d.c4({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:ti,image:Ai.gradient||void 0,clips:Ae.lineClipsArray}),Ai.texture?Ai.texture.update(Ai.gradient):Ai.texture=new d.T(le,Ai.gradient,J.RGBA),Ai.version=T.gradientVersion,Mi=Ai.texture}le.activeTexture.set(J.TEXTURE0),Mi.bind(T.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}const Ri=y.stencilModeForClipping(be);Fe.draw(le,J.TRIANGLES,U,Ri,H,wt.disabled,Si,Zt,Ui,T.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,T.paint,y.transform.zoom,Qe,Ae.layoutVertexBuffer2),Ce=!1}})(e,a,l,h,g):d.cf(l)?(function(y,w,T,E,A){const R=T.paint.get("fill-color"),P=T.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const{isRenderingToTexture:L}=A,U=y.colorModeForRenderPass(),H=T.paint.get("fill-pattern"),$=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&R.constantOr(d.bf.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===$){const X=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);xr(y,w,T,E,X,U,!1,L)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const X=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);xr(y,w,T,E,X,U,!0,L)}})(e,a,l,h,g):d.cg(l)?(function(y,w,T,E,A){const R=T.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:P}=A;if(y.renderPass==="translucent"){const L=new Dt(y.context.gl.LEQUAL,Dt.ReadWrite,y.depthRangeFor3D);if(R!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))ga(y,w,T,E,L,ei.disabled,Ci.disabled,P),ga(y,w,T,E,L,y.stencilModeFor3D(),y.colorModeForRenderPass(),P);else{const U=y.colorModeForRenderPass();ga(y,w,T,E,L,ei.disabled,U,P)}}})(e,a,l,h,g):d.ch(l)?(function(y,w,T,E,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=A,P=y.context,L=y.style.projection.useSubdivision,U=y.getDepthModeForSublayer(0,Dt.ReadOnly),H=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function($,X,W,ee,Q,ne,le){const J=$.context,de=J.gl;for(const Ce of W){const be=X.getTile(Ce),Te=be.dem;if(!Te||!Te.data||!be.needsHillshadePrepare)continue;const Ae=Te.dim,Qe=Te.stride,Ke=Te.getPixels();if(J.activeTexture.set(de.TEXTURE1),J.pixelStoreUnpackPremultiplyAlpha.set(!1),be.demTexture=be.demTexture||$.getTileTexture(Qe),be.demTexture){const ht=be.demTexture;ht.update(Ke,{premultiply:!1}),ht.bind(de.NEAREST,de.CLAMP_TO_EDGE)}else be.demTexture=new d.T(J,Ke,de.RGBA,{premultiply:!1}),be.demTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE);J.activeTexture.set(de.TEXTURE0);let Fe=be.fbo;if(!Fe){const ht=new d.T(J,{width:Ae,height:Ae,data:null},de.RGBA);ht.bind(de.LINEAR,de.CLAMP_TO_EDGE),Fe=be.fbo=J.createFramebuffer(Ae,Ae,!0,!1),Fe.colorAttachment.set(ht.texture)}J.bindFramebuffer.set(Fe.framebuffer),J.viewport.set([0,0,Ae,Ae]),$.useProgram("hillshadePrepare").draw(J,de.TRIANGLES,Q,ne,le,wt.disabled,Au(be.tileID,Te),null,null,ee.id,$.rasterBoundsBuffer,$.quadTriangleIndexBuffer,$.rasterBoundsSegments),be.needsHillshadePrepare=!1}})(y,w,E,T,U,ei.disabled,H),P.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(L){const[$,X,W]=y.stencilConfigForOverlapTwoPass(E);Fc(y,w,T,W,$,U,H,!1,R),Fc(y,w,T,W,X,U,H,!0,R)}else{const[$,X]=y.getStencilConfigForOverlapAndUpdateStencilID(E);Fc(y,w,T,X,$,U,H,!1,R)}})(e,a,l,h,g):d.ci(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent"||!E.length)return;const{isRenderingToTexture:R}=A,P=y.style.projection.useSubdivision,L=y.getDepthModeForSublayer(0,Dt.ReadOnly),U=y.colorModeForRenderPass();if(P){const[H,$,X]=y.stencilConfigForOverlapTwoPass(E);us(y,w,T,X,H,L,U,!1,R),us(y,w,T,X,$,L,U,!0,R)}else{const[H,$]=y.getStencilConfigForOverlapAndUpdateStencilID(E);us(y,w,T,$,H,L,U,!1,R)}})(e,a,l,h,g):d.cj(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:R}=A,P=w.getSource(),L=y.style.projection.useSubdivision;if(P instanceof ha)Dn(y,w,T,E,null,!1,!1,P.tileCoords,P.flippedWindingOrder,R);else if(L){const[U,H,$]=y.stencilConfigForOverlapTwoPass(E);Dn(y,w,T,$,U,!1,!0,rc,!1,R),Dn(y,w,T,$,H,!0,!0,rc,!1,R)}else{const[U,H]=y.getStencilConfigForOverlapAndUpdateStencilID(E);Dn(y,w,T,H,U,!1,!0,rc,!1,R)}})(e,a,l,h,g):d.ck(l)?(function(y,w,T,E,A){const R=T.paint.get("background-color"),P=T.paint.get("background-opacity");if(P===0)return;const{isRenderingToTexture:L}=A,U=y.context,H=U.gl,$=y.style.projection,X=y.transform,W=X.tileSize,ee=T.paint.get("background-pattern");if(y.isPatternMissing(ee))return;const Q=!ee&&R.a===1&&P===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==Q)return;const ne=ei.disabled,le=y.getDepthModeForSublayer(0,Q==="opaque"?Dt.ReadWrite:Dt.ReadOnly),J=y.colorModeForRenderPass(),de=y.useProgram(ee?"backgroundPattern":"background"),Ce=E||ge(X,{tileSize:W,terrain:y.style.map.terrain});ee&&(U.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context));const be=T.getCrossfadeParameters();for(const Te of Ce){const Ae=X.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Qe=ee?Lh(P,y,ee,{tileID:Te,tileSize:W},be):kh(P,R),Ke=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Te),Fe=$.getMeshFromTileID(U,Te.canonical,!1,!0,"raster");de.draw(U,H.TRIANGLES,le,ne,J,wt.backCCW,Qe,Ke,Ae,T.id,Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}})(e,0,l,h,g):d.cl(l)&&(function(y,w,T,E){const{isRenderingGlobe:A}=E,R=y.context,P=T.implementation,L=y.style.projection,U=y.transform,H=U.getProjectionDataForCustomLayer(A),$={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:L.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${L.shaderPreludeCode.vertexSource}`,define:L.shaderDefine},defaultProjectionData:H},X=P.renderingMode?P.renderingMode:"2d";if(y.renderPass==="offscreen"){const W=P.prerender;W&&(y.setCustomLayerDefaults(),R.setColorMode(y.colorModeForRenderPass()),W.call(P,R.gl,$),R.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),R.setColorMode(y.colorModeForRenderPass()),R.setStencilMode(ei.disabled);const W=X==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,Dt.ReadOnly);R.setDepthMode(W),P.render(R.gl,$),R.setDirty(),y.setBaseState(),R.bindFramebuffer.set(null)}})(e,0,l,g))}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!a||!l}useProgram(e,a,l=!1,h=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,y=this.style.projection,w=l?fa.projectionMercator:y.shaderPreludeCode,T=l?rs:y.shaderDefine,E=e+(a?a.cacheKey:"")+`/${l?so:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[E]||(this.cache[E]=new Eu(this.context,fa[e],a,yr[e],this._showOverdrawInspector,g,w,T,h)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function ds(f,e){let a,l=!1,h=null,g=null;const y=()=>{h=null,l&&(f.apply(g,a),h=setTimeout(y,e),l=!1)};return(...w)=>(l=!0,g=this,a=w,h||y(),h)}class br{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const l=a.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let g=window.location.hash.replace(h,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let y=window.location.href.replace(/(#.+)?$/,g);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=ds(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),y=Math.round(a.lng*g)/g,w=Math.round(a.lat*g)/g,T=this._map.getBearing(),E=this._map.getPitch();let A="";if(A+=e?`/${y}/${w}/${l}`:`${l}/${w}/${y}`,(T||E)&&(A+="/"+Math.round(10*T)/10),E&&(A+=`/${Math.round(E)}`),this._hashName){const R=this._hashName;let P=!1;const L=window.location.hash.slice(1).split("&").map((U=>{const H=U.split("=")[0];return H===R?(P=!0,`${H}=${A}`):U})).filter((U=>U));return P||L.push(`${R}=${A}`),`#${L.join("&")}`}return`#${A}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new d.S(+e[2],+e[1])}catch{return!1}const a=+e[0],l=+(e[3]||0),h=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const Lr={linearity:.3,easing:d.cm(0,0,.3,1)},Yr=d.e({deceleration:2500,maxSpeed:1400},Lr),ac=d.e({deceleration:20,maxSpeed:1400},Lr),Uc=d.e({deceleration:1e3,maxSpeed:360},Lr),hl=d.e({deceleration:1e3,maxSpeed:90},Lr),sc=d.e({deceleration:1e3,maxSpeed:360},Lr);class Gs{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ue.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=Ue.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,a.roll+=g.rollDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(a.pan.mag()){const g=Br(a.pan.mag(),l,d.e({},Yr,e||{})),y=a.pan.mult(g.amount/a.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=w.easingCenter,h.offset=w.easingOffset,_n(h,g)}if(a.zoom){const g=Br(a.zoom,l,ac);h.zoom=this._map.transform.zoom+g.amount,_n(h,g)}if(a.bearing){const g=Br(a.bearing,l,Uc);h.bearing=this._map.transform.bearing+d.ah(g.amount,-179,179),_n(h,g)}if(a.pitch){const g=Br(a.pitch,l,hl);h.pitch=this._map.transform.pitch+g.amount,_n(h,g)}if(a.roll){const g=Br(a.roll,l,sc);h.roll=this._map.transform.roll+d.ah(g.amount,-179,179),_n(h,g)}if(h.zoom||h.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;h.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function _n(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Br(f,e,a){const{maxSpeed:l,linearity:h,deceleration:g}=a,y=d.ah(f*h/(e/1e3),-l,l),w=Math.abs(y)/(g*h);return{easing:a.easing,duration:1e3*w,amount:y*(w/2)}}class wr extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const g=ve.mousePos(a.getCanvas(),l),y=a.unproject(g);super(e,d.e({point:g,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=a}}class dl extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,l){const h=e==="touchend"?l.changedTouches:l.touches,g=ve.touchPos(a.getCanvasContainer(),h),y=g.map((T=>a.unproject(T))),w=g.reduce(((T,E,A,R)=>T.add(E.div(R.length))),new d.P(0,0));super(e,{points:g,point:w,lngLats:y,lngLat:a.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Ou extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class jh{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ou(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new wr(e.type,this._map,e))}mouseup(e){this._map.fire(new wr(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new wr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new wr(e.type,this._map,e))}mouseover(e){this._map.fire(new wr(e.type,this._map,e))}mouseout(e){this._map.fire(new wr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new dl(e.type,this._map,e))}touchmove(e){this._map.fire(new dl(e.type,this._map,e))}touchend(e){this._map.fire(new dl(e.type,this._map,e))}touchcancel(e){this._map.fire(new dl(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class An{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new wr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new wr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qs{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(d.P.convert(e),this._map.terrain)}}class wo{constructor(e,a){this._map=e,this._tr=new qs(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(ve.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=ve.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(h.x,l.x),y=Math.max(h.x,l.x),w=Math.min(h.y,l.y),T=Math.max(h.y,l.y);ve.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=y-g+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const l=this._startPos,h=a;if(this.reset(),ve.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ve.remove(this._box),this._box=null),ve.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new d.l(e,{originalEvent:a}))}}function Hs(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const a={};for(let l=0;l<f.length;l++)a[f[l].identifier]=e[l];return a}class fl{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const g=new d.P(0,0);for(const y of h)g._add(y);return g.div(h.length)})(a),this.touches=Hs(l,a)))}touchmove(e,a,l){if(this.aborted||!this.centroid)return;const h=Hs(l,a);for(const g in this.touches){const y=h[g];(!y||y.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,a,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class fs{constructor(e){this.singleTap=new fl(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,l){this.singleTap.touchstart(e,a,l)}touchmove(e,a,l){this.singleTap.touchmove(e,a,l)}touchend(e,a,l){const h=this.singleTap.touchend(e,a,l);if(h){const g=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(g&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class tr{constructor(e){this._tr=new qs(e),this._zoomIn=new fs({numTouches:1,numTaps:2}),this._zoomOut=new fs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,l){this._zoomIn.touchstart(e,a,l),this._zoomOut.touchstart(e,a,l)}touchmove(e,a,l){this._zoomIn.touchmove(e,a,l),this._zoomOut.touchmove(e,a,l)}touchend(e,a,l){const h=this._zoomIn.touchend(e,a,l),g=this._zoomOut.touchend(e,a,l),y=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(a)?a[0]:a;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ve.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Fu=0,va=2,To={[Fu]:1,[va]:2};class xa{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=ve.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,l){const h=To[l];return a.buttons===void 0||(a.buttons&h)!==h})(e,this._eventButton)}isValidEndEvent(e){return ve.mouseButton(e)===this._eventButton}}class ju{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Nc{constructor(e=new xa({checkCorrectEvent:()=>!0}),a=new ju){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,l){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const oc=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}};class pl{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,l){return this._calculateTransform(e,a,l)}touchmove(e,a,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,a,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,l){this._calculateTransform(e,a,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,l){l.length>0&&(this._active=!0);const h=Hs(l,a),g=new d.P(0,0),y=new d.P(0,0);let w=0;for(const E in h){const A=h[E],R=this._touches[E];R&&(g._add(A),y._add(A.sub(R)),w++,h[E]=A)}if(this._touches=h,this._shouldBePrevented(w)||!y.mag())return;const T=y.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $s{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,l){if(!this._firstTwoTouches)return;e.preventDefault();const[h,g]=this._firstTwoTouches,y=Sr(l,a,h),w=Sr(l,a,g);if(!y||!w)return;const T=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],T,e)}touchend(e,a,l){if(!this._firstTwoTouches)return;const[h,g]=this._firstTwoTouches,y=Sr(l,a,h),w=Sr(l,a,g);y&&w||(this._active&&ve.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sr(f,e,a){for(let l=0;l<f.length;l++)if(f[l].identifier===a)return e[l]}function st(f,e){return Math.log(f/e)/Math.LN2}class Vc extends $s{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(st(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:st(this._distance,l),pinchAround:a}}}function So(f,e){return 180*f.angleWith(e)/Math.PI}class Zc extends $s{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,l){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:So(this._vector,h),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,l=So(e,this._startVector);return Math.abs(l)<a}}function ba(f){return Math.abs(f.y)>Math.abs(f.x)}class Mo extends $s{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,l){super.touchstart(e,a,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,ba(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,g,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,l){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,g=a.mag()>=2;if(!h&&!g)return;if(!h||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==a.y>0;return ba(e)&&ba(a)&&y}}const Gc={panStep:100,bearingStep:15,pitchStep:10};class Ot{constructor(e){this._tr=new qs(e);const a=Gc;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,l=0,h=0,g=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:lc,zoom:a?Math.round(T.zoom)+a*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+h*this._pitchStep,offset:[-g*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lc(f){return f*(2-f)}const qc=4.000244140625,qa=1/450;class ps{constructor(e,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new qs(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=qa}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Ue.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%qc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ve.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.S.convert(l.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>qc?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);const E=typeof this._targetZoom!="number"?e.scale:d.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),d.ak(E*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let g,y=!1;if(this._type==="wheel"&&l&&h){const w=Ue.now()-this._lastWheelEventTime,T=Math.min((w+5)/200,1),E=h(T);g=d.C.number(l,a,E),T<1?this._frameId||(this._frameId=!0):y=!0}else g=a,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!y,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=d.co;if(this._prevEase){const l=this._prevEase,h=(Ue.now()-l.start)/l.duration,g=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-y*y);a=d.cm(y,w,.25,1)}return this._prevEase={start:Ue.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ml{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hc{constructor(e){this._tr=new qs(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cc{constructor(){this._tap=new fs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,l){if(!this._swipePoint)if(this._tapTime){const h=a[0],g=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;g&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,a,l)}touchmove(e,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=a[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,a,l)}touchend(e,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(e,a,l);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eo{constructor(e,a,l){this._el=e,this._mousePan=a,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gl{constructor(e,a,l,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $c{constructor(e,a,l,h){this._el=e,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Uu{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ve.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=a,this._container.appendChild(h);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ve.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ms=f=>f.zoom||f.drag||f.roll||f.pitch||f.rotate;class wa extends d.l{}function gi(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta||f.rollDelta}class Nu{constructor(e,a){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,g)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},T={},E={};for(const{handlerName:P,handler:L,allowed:U}of this._handlers){if(!L.isEnabled())continue;let H;if(this._blockedByActive(E,U,P))L.reset();else if(L[g||h.type]){if(d.cp(h,g||h.type)){const $=ve.mousePos(this._map.getCanvas(),h);H=L[g||h.type](h,$)}else if(d.cq(h,g||h.type)){const $=this._getMapTouches(h.touches),X=ve.touchPos(this._map.getCanvas(),$);H=L[g||h.type](h,X,$)}else d.cr(g||h.type)||(H=L[g||h.type](h));this.mergeHandlerResult(w,T,H,P,y),H&&H.needsRenderFrame&&this._triggerRenderFrame()}(H||L.isActive())&&(E[P]=L)}const A={};for(const P in this._previousActiveHandlers)E[P]||(A[P]=y);this._previousActiveHandlers=E,(Object.keys(A).length||gi(w))&&(this._changes.push([w,T,A]),this._triggerRenderFrame()),(Object.keys(E).length||gi(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=w;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gs(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,g,y]of this._listeners)ve.addEventListener(h,g,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,a,l]of this._listeners)ve.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new jh(a,e));const h=a.boxZoom=new wo(a,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const g=a.cooperativeGestures=new Uu(a,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const y=new tr(a),w=new Hc(a);a.doubleClickZoom=new ml(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const T=new cc;this._add("tapDragZoom",T);const E=a.touchPitch=new Mo(a);this._add("touchPitch",E),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const A=()=>a.project(a.getCenter()),R=(function({enable:Q,clickTolerance:ne,aroundCenter:le=!0,minPixelCenterThreshold:J=100,rotateDegreesPerPixelMoved:de=.8},Ce){const be=new xa({checkCorrectEvent:Te=>ve.mouseButton(Te)===0&&Te.ctrlKey||ve.mouseButton(Te)===2&&!Te.ctrlKey});return new Tr({clickTolerance:ne,move:(Te,Ae)=>{const Qe=Ce();if(le&&Math.abs(Qe.y-Te.y)>J)return{bearingDelta:d.cn(new d.P(Te.x,Ae.y),Ae,Qe)};let Ke=(Ae.x-Te.x)*de;return le&&Ae.y<Qe.y&&(Ke=-Ke),{bearingDelta:Ke}},moveStateManager:be,enable:Q,assignEvents:oc})})(e,A),P=(function({enable:Q,clickTolerance:ne,pitchDegreesPerPixelMoved:le=-.5}){const J=new xa({checkCorrectEvent:de=>ve.mouseButton(de)===0&&de.ctrlKey||ve.mouseButton(de)===2});return new Tr({clickTolerance:ne,move:(de,Ce)=>({pitchDelta:(Ce.y-de.y)*le}),moveStateManager:J,enable:Q,assignEvents:oc})})(e),L=(function({enable:Q,clickTolerance:ne,rollDegreesPerPixelMoved:le=.3},J){const de=new xa({checkCorrectEvent:Ce=>ve.mouseButton(Ce)===2&&Ce.ctrlKey});return new Tr({clickTolerance:ne,move:(Ce,be)=>{const Te=J();let Ae=(be.x-Ce.x)*le;return be.y<Te.y&&(Ae=-Ae),{rollDelta:Ae}},moveStateManager:de,enable:Q,assignEvents:oc})})(e,A);a.dragRotate=new gl(e,R,P,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",P,["mouseRotate","mouseRoll"]),this._add("mouseRoll",L,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const U=(function({enable:Q,clickTolerance:ne}){const le=new xa({checkCorrectEvent:J=>ve.mouseButton(J)===0&&!J.ctrlKey});return new Tr({clickTolerance:ne,move:(J,de)=>({around:de,panDelta:de.sub(J)}),activateOnStart:!0,moveStateManager:le,enable:Q,assignEvents:oc})})(e),H=new pl(e,a);a.dragPan=new Eo(l,U,H),this._add("mousePan",U),this._add("touchPan",H,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const $=new Zc,X=new Vc;a.touchZoomRotate=new $c(l,X,$,T),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);const W=a.scrollZoom=new ps(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",W,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const ee=a.keyboard=new Ot(a);this._add("keyboard",ee),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new An(a))}_add(e,a,l){this._handlers.push({handlerName:e,handler:a,allowed:l}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ms(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,l){for(const h in e)if(h!==l&&(!a||a.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const l of e)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(e,a,l,h,g){if(!l)return;d.e(e,l);const y={handlerName:h,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(a.zoom=y),l.panDelta!==void 0&&(a.drag=y),l.rollDelta!==void 0&&(a.roll=y),l.pitchDelta!==void 0&&(a.pitch=y),l.bearingDelta!==void 0&&(a.rotate=y)}_applyChanges(){const e={},a={},l={};for(const[h,g,y]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),d.e(a,g),d.e(l,y);this._updateMapTransform(e,a,l),this._changes=[]}_updateMapTransform(e,a,l){const h=this._map,g=h._getTransformForUpdate(),y=h.terrain;if(!(gi(e)||y&&this._terrainMovement))return this._fireEvents(a,l,!0);h._stop(!0);let{panDelta:w,zoomDelta:T,bearingDelta:E,pitchDelta:A,rollDelta:R,around:P,pinchAround:L}=e;L!==void 0&&(P=L),P=P||h.transform.centerPoint,y&&!g.isPointOnMapSurface(P)&&(P=g.centerPoint);const U={panDelta:w,zoomDelta:T,rollDelta:R,pitchDelta:A,bearingDelta:E,around:P};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(P)&&(P=g.centerPoint);const H=P.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(w?P.sub(w):P);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,g),this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(w))):this._map.cameraHelper.handleMapControlsPan(U,g,H):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(U,g,H))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,g),this._map.cameraHelper.handleMapControlsPan(U,g,H)),h._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,l,!0)}_fireEvents(e,a,l){const h=ms(this._eventsInProgress),g=ms(e),y={};for(const R in e){const{originalEvent:P}=e[R];this._eventsInProgress[R]||(y[`${R}start`]=P),this._eventsInProgress[R]=e[R]}!h&&g&&this._fireEvent("movestart",g.originalEvent);for(const R in y)this._fireEvent(R,y[R]);g&&this._fireEvent("move",g.originalEvent);for(const R in e){const{originalEvent:P}=e[R];this._fireEvent(R,P)}const w={};let T;for(const R in this._eventsInProgress){const{handlerName:P,originalEvent:L}=this._eventsInProgress[R];this._handlersById[P].isActive()||(delete this._eventsInProgress[R],T=a[P]||L,w[`${R}end`]=T)}for(const R in w)this._fireEvent(R,w[R]);const E=ms(this._eventsInProgress),A=(h||g)&&!E;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&A){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!R||!R.essential&&Ue.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:T})),P(this._map.getBearing())&&this._map.resetNorth()):(P(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new d.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new wa("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _l extends d.E{constructor(e,a,l){super(),this._renderFrameCallback=()=>{const h=Math.min((Ue.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new d.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},a),l)}panTo(e,a,l){return this.easeTo(d.e({center:e},a),l)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,l){return this.easeTo(d.e({zoom:e},a),l)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)).fire(new d.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,l){return this.easeTo(d.e({bearing:e},a),l)}resetNorth(e,a){return this.rotateTo(0,d.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=Yi.convert(e).adjustAntiMeridian();const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,a)}_cameraForBoxAndBearing(e,a,l,h){const g={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const E=h.padding;h.padding={top:E,bottom:E,right:E,left:E}}const y=d.e(g,h.padding);h.padding=y;const w=this.transform,T=new Yi(e,a);return this.cameraHelper.cameraForBoxAndBearing(h,y,T,l,w)}fitBounds(e,a,l){return this._fitInternal(this.cameraForBounds(e,a),a,l)}fitScreenCoordinates(e,a,l,h,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(e)),this.transform.screenPointToLocation(d.P.convert(a)),l,h),h,g)}_fitInternal(e,a,l){return e?(delete(a=d.e(e,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(e,a){this.stop();const l=this._getTransformForUpdate();let h=!1,g=!1,y=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(h=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(g=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)),T&&this.fire(new d.l("zoomstart",a)).fire(new d.l("zoom",a)).fire(new d.l("zoomend",a)),h&&this.fire(new d.l("rotatestart",a)).fire(new d.l("rotate",a)).fire(new d.l("rotateend",a)),g&&this.fire(new d.l("pitchstart",a)).fire(new d.l("pitch",a)).fire(new d.l("pitchend",a)),y&&this.fire(new d.l("rollstart",a)).fire(new d.l("roll",a)).fire(new d.l("rollend",a)),this.fire(new d.l("moveend",a))}calculateCameraOptionsFromTo(e,a,l,h=0){const g=d.a1.fromLngLat(e,a),y=d.a1.fromLngLat(l,h),w=y.x-g.x,T=y.y-g.y,E=y.z-g.z,A=Math.hypot(w,T,E);if(A===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(w,T),P=d.ak(this.transform.cameraToCenterDistance/A/this.transform.tileSize),L=180*Math.atan2(w,-T)/Math.PI;let U=180*Math.acos(R/A)/Math.PI;return U=E<0?90-U:90+U,{center:y.toLngLat(),elevation:h,zoom:P,pitch:U,bearing:L}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,l,h,g){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,a,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:g}}easeTo(e,a){this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.co},e)).animate===!1||!e.essential&&Ue.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),g=l.pitch,y=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,h):h,T="pitch"in e?+e.pitch:g,E="roll"in e?this._normalizeBearing(e.roll,y):y,A="padding"in e?e.padding:l.padding,R=d.P.convert(e.offset);let P,L;e.around&&(P=d.S.convert(e.around),L=l.locationToScreenPoint(P));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},H=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:T,roll:E,padding:A,around:P,aroundPoint:L,offsetAsPoint:R,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==w,this._pitching=this._pitching||T!==g,this._rolling=this._rolling||E!==y,this._padding=!l.isPaddingEqual(A),this._zooming=this._zooming||H.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,U),this.terrain&&this._prepareElevation(H.elevationCenter),this._ease(($=>{H.easeFunc($),this.terrain&&!e.freezeElevation&&this._updateElevation($),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),($=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,$)}),e),this}_prepareEase(e,a,l={}){this._moving=!0,a||l.moving||this.fire(new d.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(a-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(d.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const a=e.getCameraLngLat(),l=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(l<h){const g=this.calculateCameraOptionsFromTo(a,h,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(a.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&a.push((h=>this.transformCameraUpdate(h))),!a.length)return;const l=e.clone();for(const h of a){const g=l.clone(),{center:y,zoom:w,roll:T,pitch:E,bearing:A,elevation:R}=h(g);y&&g.setCenter(y),R!==void 0&&g.setElevation(R),w!==void 0&&g.setZoom(w),T!==void 0&&g.setRoll(T),E!==void 0&&g.setPitch(E),A!==void 0&&g.setBearing(A),l.apply(g)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.l("move",e)),this._zooming&&this.fire(new d.l("zoom",e)),this._rotating&&this.fire(new d.l("rotate",e)),this._pitching&&this.fire(new d.l("pitch",e)),this._rolling&&this.fire(new d.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,h=this._rotating,g=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",e)),h&&this.fire(new d.l("rotateend",e)),g&&this.fire(new d.l("pitchend",e)),y&&this.fire(new d.l("rollend",e)),this.fire(new d.l("moveend",e))}flyTo(e,a){if(!e.essential&&Ue.prefersReducedMotion){const Ae=d.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ae,a)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.co},e);const l=this._getTransformForUpdate(),h=l.bearing,g=l.pitch,y=l.roll,w=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,h):h,E="pitch"in e?+e.pitch:g,A="roll"in e?this._normalizeBearing(e.roll,y):y,R="padding"in e?e.padding:l.padding,P=d.P.convert(e.offset);let L=l.centerPoint.add(P);const U=l.screenPointToLocation(L),H=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:E,roll:A,padding:R,locationAtOffset:U,offsetAsPoint:P,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let $=e.curve;const X=Math.max(l.width,l.height),W=X/H.scaleOfZoom,ee=H.pixelPathLength;typeof H.scaleOfMinZoom=="number"&&($=Math.sqrt(X/H.scaleOfMinZoom/ee*2));const Q=$*$;function ne(Ae){const Qe=(W*W-X*X+(Ae?-1:1)*Q*Q*ee*ee)/(2*(Ae?W:X)*Q*ee);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function le(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function J(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}const de=ne(!1);let Ce=function(Ae){return J(de)/J(de+$*Ae)},be=function(Ae){return X*((J(de)*(le(Qe=de+$*Ae)/J(Qe))-le(de))/Q)/ee;var Qe},Te=(ne(!0)-de)/$;if(Math.abs(ee)<2e-6||!isFinite(Te)){if(Math.abs(X-W)<1e-6)return this.easeTo(e,a);const Ae=W<X?-1:1;Te=Math.abs(Math.log(W/X))/$,be=()=>0,Ce=Qe=>Math.exp(Ae*$*Qe)}return e.duration="duration"in e?+e.duration:1e3*Te/("screenSpeed"in e?+e.screenSpeed/$:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==T,this._pitching=E!==g,this._rolling=A!==y,this._padding=!l.isPaddingEqual(R),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(H.targetCenter),this._ease((Ae=>{const Qe=Ae*Te,Ke=1/Ce(Qe),Fe=be(Qe);this._rotating&&l.setBearing(d.C.number(h,T,Ae)),this._pitching&&l.setPitch(d.C.number(g,E,Ae)),this._rolling&&l.setRoll(d.C.number(y,A,Ae)),this._padding&&(l.interpolatePadding(w,R,Ae),L=l.centerPoint.add(P)),H.easeFunc(Ae,Ke,Fe,L),this.terrain&&!e.freezeElevation&&this._updateElevation(Ae),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,a,l){l.animate===!1||l.duration===0?(e(1),a()):(this._easeStart=Ue.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=d.aO(e,-180,180);const l=Math.abs(e-a);return Math.abs(e-360-a)<l&&(e-=360),Math.abs(e+360-a)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.S.convert(e),this.transform.tileZoom):null}}const Ta={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Yt{constructor(e=Ta){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ve.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ve.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ve.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ve.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const l=this._map._getUIString(`AttributionControl.${a}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const a=this._map.style.sourceCaches;for(const h in a){const g=a[h];if(g.used||g.usedForTerrain){const y=g.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter((h=>String(h).trim())),e.sort(((h,g)=>h.length-g.length)),e=e.filter(((h,g)=>{for(let y=g+1;y<e.length;y++)if(e[y].indexOf(h)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=ve.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _i{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ve.create("div","maplibregl-ctrl");const a=ve.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ve.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const h of l)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xc=d.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Mr extends d.E{constructor(e){super(),this._lastTilesetChange=Ue.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const l={};for(const h of ge(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),d.bY(h.terrainRttPosMatrix32f,0,d.$,d.$,0,0,1),this._tiles[h.key]=new Nr(h,this.tileSize),this._lastTilesetChange=Ue.now());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(e){for(const a in this._tiles){const l=this._tiles[a];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const a={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,g=e.clone(),y=d.ba();if(h.canonical.equals(e.canonical))d.bY(y,0,d.$,d.$,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const w=h.canonical.z-e.canonical.z,T=h.canonical.x-(h.canonical.x>>w<<w),E=h.canonical.y-(h.canonical.y>>w<<w),A=d.$>>w;d.bY(y,0,A,A,0,0,1),d.M(y,y,[-T*A,-E*A,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const w=e.canonical.z-h.canonical.z,T=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),A=d.$>>w;d.bY(y,0,d.$,d.$,0,0,1),d.M(y,y,[T*A,E*A,0]),d.N(y,y,[1/2**w,1/2**w,0])}}g.terrainRttPosMatrix32f=new Float32Array(y),a[l]=g}return a}_getTerrainCoordsForTileRanges(e,a){const l={};for(const h of this._renderableTilesKeys){const g=this._tiles[h].tileID;if(!this._isWithinTileRanges(g,a))continue;const y=e.clone(),w=d.ba();if(g.canonical.z===e.canonical.z){const T=e.canonical.x-g.canonical.x,E=e.canonical.y-g.canonical.y;d.bY(w,0,d.$,d.$,0,0,1),d.M(w,w,[T*d.$,E*d.$,0])}else if(g.canonical.z>e.canonical.z){const T=g.canonical.z-e.canonical.z,E=g.canonical.x-(g.canonical.x>>T<<T),A=g.canonical.y-(g.canonical.y>>T<<T),R=e.canonical.x-(g.canonical.x>>T),P=e.canonical.y-(g.canonical.y>>T),L=d.$>>T;d.bY(w,0,L,L,0,0,1),d.M(w,w,[-E*L+R*d.$,-A*L+P*d.$,0])}else{const T=e.canonical.z-g.canonical.z,E=e.canonical.x-(e.canonical.x>>T<<T),A=e.canonical.y-(e.canonical.y>>T<<T),R=(e.canonical.x>>T)-g.canonical.x,P=(e.canonical.y>>T)-g.canonical.y,L=d.$<<T;d.bY(w,0,L,L,0,0,1),d.M(w,w,[E*d.$+R*L,A*d.$+P*L,0])}y.terrainRttPosMatrix32f=new Float32Array(w),l[h]=y}return l}getSourceTile(e,a){const l=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&a)for(;h>=l.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(h--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class Ha{constructor(e,a,l){this._meshCache={},this.painter=e,this.sourceCache=new Mr(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,l,h=d.$){var g;if(!(a>=0&&a<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(e),w=(g=y.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const T=d.cs([],[a/h*d.$,l/h*d.$],y.u_terrain_matrix),E=[T[0]*w.dim,T[1]*w.dim],A=Math.floor(E[0]),R=Math.floor(E[1]),P=E[0]-A,L=E[1]-R;return w.get(A,R)*(1-P)*(1-L)+w.get(A+1,R)*P*(1-L)+w.get(A,R+1)*(1-P)*L+w.get(A+1,R+1)*P*L}getElevationForLngLatZoom(e,a){if(!d.ct(a,e.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(l,h%d.$,g%d.$,d.$)}getElevation(e,a,l,h=d.$){return this.getDEMElevation(e,a,l,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,g=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(h,g,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.ag([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const h=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new d.T(h,a.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),a.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a+a.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?g=e.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>g<<g),w=e.canonical.y-(e.canonical.y>>g<<g),T=d.cu(new Float64Array(16),[1/(d.$<<g),1/(d.$<<g),0]);d.M(T,T,[y*d.$,w*d.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,l=a.width/devicePixelRatio,h=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,y=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)a[y+0]=255&w,a[y+1]=255&g,a[y+2]=w>>8<<4|g>>8,a[y+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),h=new d.T(e,l,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,h=l.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(g,w-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const T=a[0]+(a[2]>>4<<8),E=a[1]+((15&a[2])<<8),A=this.coordsIndex[255-a[3]],R=A&&this.sourceCache.getTileByID(A);if(!R)return null;const P=this._coordsTextureSize,L=(1<<R.tileID.canonical.z)*P;return new d.a1((R.tileID.canonical.x*P+T)/L+R.tileID.wrap,(R.tileID.canonical.y*P+E)/L,this.getElevation(R.tileID,T,E,P))}depthAtPoint(e){const a=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;const l=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,h=l&&e.canonical.y===0,g=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${h?"n":""}_${g?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const w=this.painter.context,T=new d.cv,E=new d.aN,A=this.meshSize,R=d.$/A,P=A*A;for(let J=0;J<=A;J++)for(let de=0;de<=A;de++)T.emplaceBack(de*R,J*R,0);for(let J=0;J<P;J+=A+1)for(let de=0;de<A;de++)E.emplaceBack(de+J,A+de+J+1,A+de+J+2),E.emplaceBack(de+J,A+de+J+2,de+J+1);const L=T.length,U=L+(A+1),H=(A+1)*A,$=h?d.bh:0,X=h?0:1,W=g?d.bi:d.$,ee=g?0:1;for(let J=0;J<=A;J++)T.emplaceBack(J*R,$,X);for(let J=0;J<=A;J++)T.emplaceBack(J*R,W,ee);for(let J=0;J<A;J++)E.emplaceBack(H+J,U+J,U+J+1),E.emplaceBack(H+J,U+J+1,H+J+1),E.emplaceBack(0+J,L+J+1,L+J),E.emplaceBack(0+J,0+J+1,L+J+1);const Q=T.length,ne=Q+2*(A+1);for(const J of[0,1])for(let de=0;de<=A;de++)for(const Ce of[0,1])T.emplaceBack(J*d.$,de*R,Ce);for(let J=0;J<2*A;J+=2)E.emplaceBack(Q+J,Q+J+1,Q+J+3),E.emplaceBack(Q+J,Q+J+3,Q+J+2),E.emplaceBack(ne+J,ne+J+3,ne+J+1),E.emplaceBack(ne+J,ne+J+2,ne+J+3);const le=new Ds(w.createVertexBuffer(T,Xc.members),w.createIndexBuffer(E),d.aM.simpleSegment(0,0,T.length,E.length));return this._meshCache[y]=le,le}getMeshFrameDelta(e){return 2*Math.PI*d.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,a){const l=d.a1.fromLngLat(e.wrap()),h=(1<<a)*d.$,g=l.x*h,y=l.y*h,w=Math.floor(g/d.$),T=Math.floor(y/d.$);return{tileID:new d.Z(a,0,a,w,T),mercatorX:g,mercatorY:y}}}class ut{constructor(e,a,l){this._context=e,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:e,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>e.id!==a)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const gt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class gs{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new ut(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(a))),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const h=e.sourceCaches[l].getVisibleCoordinates(),g=e.sourceCaches[l].getSource(),y=g instanceof ha?g.terrainTileRanges:null;for(const w of h){const T=this.terrain.sourceCache.getTerrainCoords(w,y);for(const E in T)this._coordsAscending[l][E]||(this._coordsAscending[l][E]=[]),this._coordsAscending[l][E].push(T[E])}}this._coordsAscendingStr={};for(const l of e._order){const h=e._layers[l],g=h.source;if(gt[h.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const y in this._coordsAscending[g])this._coordsAscendingStr[g][y]=this._coordsAscending[g][y].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const g=this._coordsAscendingStr[h][l.tileID.key];g&&g!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),h=e.type,g=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(gt[h]&&(this._prevType&&gt[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(gt[this._prevType]||gt[h]&&y){this._prevType=h;const w=this._stacks.length-1,T=this._stacks[w]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(kr(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[w]){const R=this.pool.getObjectForId(E.rtt[w].id);if(R.stamp===E.rtt[w].stamp){this.pool.useObject(R);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),E.rtt[w]={id:A.id,stamp:A.stamp},g.context.bindFramebuffer.set(A.fbo.framebuffer),g.context.clear({color:d.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let R=0;R<T.length;R++){const P=g.style._layers[T[R]],L=P.source?this._coordsAscending[P.source][E.tileID.key]:[E.tileID];g.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),g._renderTileClippingMasks(P,L,!0),g.renderLayer(g,g.style.sourceCaches[P.source],P,L,l),P.source&&(E.rttCoords[P.source]=this._coordsAscendingStr[P.source][E.tileID.key])}}return kr(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),gt[h]}return!1}}const Vu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ki=Re,Vn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ta,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Yc={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class aa{constructor(e,a,l=!1){this.mousedown=g=>{this.startMove(g,ve.mousePos(this.element,g)),ve.addEventListener(window,"mousemove",this.mousemove),ve.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,ve.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ve.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),ve.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=ve.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const h=new Nc;this._rotatePitchHandler=new Tr({clickTolerance:3,move:(g,y)=>{const w=a.getBoundingClientRect(),T=new d.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:d.cn(new d.P(g.x,y.y),y,T),pitchDelta:l?-.5*(y.y-g.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,ve.addEventListener(a,"mousedown",this.mousedown),ve.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ve.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),ve.disableDrag()}move(e,a){const l=this.map,{bearingDelta:h,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,a)||{};h&&l.setBearing(l.getBearing()+h),g&&l.setPitch(l.getPitch()+g)}off(){const e=this.element;ve.removeEventListener(e,"mousedown",this.mousedown),ve.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ve.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.removeEventListener(window,"touchend",this.touchend),ve.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ve.enableDrag(),ve.removeEventListener(window,"mousemove",this.mousemove),ve.removeEventListener(window,"mouseup",this.mouseup),ve.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.removeEventListener(window,"touchend",this.touchend)}}let Xs;function yl(f,e,a,l=!1){if(l||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return f?.wrap();const h=new d.S(f.lng,f.lat);if(f=new d.S(f.lng,f.lat),e){const g=new d.S(f.lng-360,f.lat),y=new d.S(f.lng+360,f.lat),w=a.locationToScreenPoint(f).distSqr(e);a.locationToScreenPoint(g).distSqr(e)<w?f=g:a.locationToScreenPoint(y).distSqr(e)<w&&(f=y)}for(;Math.abs(f.lng-a.center.lng)>180;){const g=a.locationToScreenPoint(f);if(g.x>=0&&g.y>=0&&g.x<=a.width&&g.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f.lng!==h.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(f))?f:h}const Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wi(f,e,a){const l=f.classList;for(const h in Pi)l.remove(`maplibregl-${a}-anchor-${h}`);l.add(`maplibregl-${a}-anchor-${e}`)}class vl extends d.E{constructor(e){if(super(),this._onKeyPress=a=>{const l=a.code,h=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=yl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ve.setTransform(this._element,`${Pi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${h}`),Ue.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ve.create("div");const a=ve.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${h}px`),a.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const g=ve.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const y=ve.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const w=ve.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const X of T){const W=ve.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",X.rx),W.setAttributeNS(null,"ry",X.ry),w.appendChild(W)}const E=ve.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const A=ve.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(A);const R=ve.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const P=ve.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(P);const L=ve.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(6.0, 7.0)"),L.setAttributeNS(null,"fill","#FFFFFF");const U=ve.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=ve.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const $=ve.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),U.appendChild(H),U.appendChild($),y.appendChild(w),y.appendChild(E),y.appendChild(R),y.appendChild(L),y.appendChild(U),a.appendChild(y),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Wi(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ve.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,l;const h=(a=this._map)===null||a===void 0?void 0:a.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!h||g){const L=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==L&&(this._element.style.opacity=L))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-w<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/y.transform.pixelsPerMeter,A=Math.sin(y.getPitch()*Math.PI/180)*E,R=y.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),P=y.transform.lngLatToCameraDepth(this._lngLat,T+A)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&P&&this._popup.remove(),this._element.style.opacity=P?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Zn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ji=0,_s=!1;const Co={maxWidth:100,unit:"metric"};function Ao(f,e,a){const l=a&&a.maxWidth||100,h=f._container.clientHeight/2,g=f._container.clientWidth/2,y=f.unproject([g-l/2,h]),w=f.unproject([g+l/2,h]),T=Math.round(f.project(w).x-f.project(y).x),E=Math.min(l,T,f._container.clientWidth),A=y.distanceTo(w);if(a&&a.unit==="imperial"){const R=3.2808*A;R>5280?Sa(e,E,R/5280,f._getUIString("ScaleControl.Miles")):Sa(e,E,R,f._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Sa(e,E,A/1852,f._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Sa(e,E,A/1e3,f._getUIString("ScaleControl.Kilometers")):Sa(e,E,A,f._getUIString("ScaleControl.Meters"))}function Sa(f,e,a,l){const h=(function(g){const y=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E})(w),y*w})(a);f.style.width=e*(h/a)+"px",f.innerHTML=`${h}&nbsp;${l}`}const Ma={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},xl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return bl(new d.P(0,0))}const uc=Re;D.AJAXError=d.cz,D.Event=d.l,D.Evented=d.E,D.LngLat=d.S,D.MercatorCoordinate=d.a1,D.Point=d.P,D.addProtocol=d.cA,D.config=d.a,D.removeProtocol=d.cB,D.AttributionControl=Yt,D.BoxZoomHandler=wo,D.CanvasSource=da,D.CooperativeGesturesHandler=Uu,D.DoubleClickZoomHandler=ml,D.DragPanHandler=Eo,D.DragRotateHandler=gl,D.EdgeInsets=as,D.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ve.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=ve.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ve.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},D.GeoJSONSource=Ia,D.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new d.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,h=this._map.getBearing(),g=d.e({bearing:h},this.options.fitBoundsOptions),y=Yi.fromLngLat(a,l);this._map.fitBounds(y,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new d.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&_s)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ve.create("button","maplibregl-ctrl-geolocate",this._container),ve.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ve.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new vl({element:this._dotElement}),this._circleElement=ve.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const l=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))}))}},this.options=d.e({},Zn,f)}onAdd(f){return this._map=f,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return d._(this,arguments,void 0,(function*(e=!1){if(Xs!==void 0&&!e)return Xs;if(window.navigator.permissions===void 0)return Xs=!!window.navigator.geolocation,Xs;try{Xs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Xs=!!window.navigator.geolocation}return Xs}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ve.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ji=0,_s=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),a=f.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const f=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&f))return;const e=this._map.project(f),a=this._map.unproject([e.x+100,e.y]),l=f.distanceTo(a)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ji--,_s=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ji++,ji>1?(f={maximumAge:6e5,timeout:0},_s=!0):(f=this.options.positionOptions,_s=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},D.GlobeControl=class{constructor(){this._toggleProjection=()=>{var f;const e=(f=this._map.getProjection())===null||f===void 0?void 0:f.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var f;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((f=this._map.getProjection())===null||f===void 0?void 0:f.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(f){return this._map=f,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ve.create("button","maplibregl-ctrl-globe",this._container),ve.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ve.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},D.Hash=br,D.ImageSource=ha,D.KeyboardHandler=Ot,D.LngLatBounds=Yi,D.LogoControl=_i,D.Map=class extends _l{constructor(f){var e,a;d.cw.mark(d.cx.create);const l=Object.assign(Object.assign(Object.assign({},Vn),f),{canvasContextAttributes:Object.assign(Object.assign({},Vn.canvasContextAttributes),f.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new di,g=new rn;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),super(h,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new yn,this._controls=[],this._mapId=d.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Vu),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ii.addThrottleControl((()=>this.isMoving())),this._requestManager=new mt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const T=ds((E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())}),50);this._resizeObserver=new ResizeObserver((E=>{w?T(E):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Nu(this,l),this._hash=l.hash&&new br(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((a=(e=l.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Yt(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new _i,l.logoPosition),this.on("style.load",(()=>{if(y||this._resizeTransform(),this.transform.unmodified){const w=d.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new d.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new d.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new d.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(f,e){return this.style.setGlobalStateProperty(f,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}coveringTiles(f){return ge(this.transform,f)}calculateCameraOptionsFromTo(f,e,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,a,l)}resize(f,e=!0){const[a,l]=this._containerDimensions(),h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const w=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,w),this.painter.resize(a,l,w)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new d.l("movestart",f)).fire(new d.l("move",f))),this.fire(new d.l("resize",f)),g&&this.fire(new d.l("moveend",f)),this}_resizeTransform(f=!0){var e;const[a,l]=this._containerDimensions();this.transform.resize(a,l,f),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l,f)}_getClampedPixelRatio(f,e){const{0:a,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),g=f*h,y=e*h;return Math.min(g>a?a/g:1,y>l?l/y:1)*h}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Yi.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.setMinZoom(f),this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.setMaxZoom(f),this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.setMinPitch(f),this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(f>=this.transform.minPitch)return this.transform.setMaxPitch(f),this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.setRenderWorldCopies(f),this._update()}project(f){return this.transform.locationToScreenPoint(d.S.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.screenPointToLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,a){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:a,delegates:{mousemove:g=>{const y=e.filter((T=>this.getLayer(T))),w=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];w.length?l||(l=!0,a.call(this,new wr(f,this,g.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:a,delegates:{mousemove:y=>{const w=e.filter((T=>this.getLayer(T)));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?l=!0:l&&(l=!1,a.call(this,new wr(f,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,a.call(this,new wr(f,this,y.originalEvent)))}}}}{const l=h=>{const g=e.filter((w=>this.getLayer(w))),y=g.length!==0?this.queryRenderedFeatures(h.point,{layers:g}):[];y.length&&(h.features=y,a.call(this,h),delete h.features)};return{layers:e,listener:a,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,a){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let h=0;h<l.length;h++){const g=l[h];if(g.listener===a&&g.layers.length===e.length&&g.layers.every((y=>e.includes(y)))){for(const y in g.delegates)this.off(y,g.delegates[y]);return void l.splice(h,1)}}}on(f,e,a){if(a===void 0)return super.on(f,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(f,l,a);this._saveDelegatedListener(f,h);for(const g in h.delegates)this.on(g,h.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(f,l,a)}}}once(f,e,a){if(a===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(f,l,a);for(const g in h.delegates){const y=h.delegates[g];h.delegates[g]=(...w)=>{this._removeDelegatedListener(f,l,a),y(...w)}}this._saveDelegatedListener(f,h);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(f,e,a){return a===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let a;const l=f instanceof d.P||Array.isArray(f),h=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},h instanceof d.P||typeof h[0]=="number")a=[d.P.convert(h)];else{const g=d.P.convert(h[0]),y=d.P.convert(h[1]);a=[g,new d.P(y.x,g.y),y,new d.P(g.x,y.y),g]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){var a,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(f,e)));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Su(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,h):this.style.loadJSON(f,e,h),this):((l=(a=this.style)===null||a===void 0?void 0:a.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Su(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const a=this._requestManager.transformRequest(f,"Style");d.j(a,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new d.k(l))}))}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.k(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===f.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ha(this.painter,e,f),this.painter.renderToTexture=new gs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var l;a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==f.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=a.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const a=f[e]._tiles;for(const l in a){const h=a[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}setSourceTileLodParams(f,e,a){if(a){const l=this.getSource(a);if(!l)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);l.calculateTileZoom=qe(Math.max(1,f),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=qe(Math.max(1,f),Math.max(1,e));return this._update(!0),this}refreshTiles(f,e){const a=this.style.sourceCaches[f];if(!a)throw new Error(`There is no source cache with ID "${f}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map((l=>new d.a4(l.z,l.x,l.y))))}addImage(f,e,a={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:R,data:P}=e,L=e;return this.style.addImage(f,{data:new d.R({width:A,height:R},new Uint8Array(P)),pixelRatio:l,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E,sdf:h,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f),this}}{const{width:A,height:R,data:P}=Ue.getImageData(e);this.style.addImage(f,{data:new d.R({width:A,height:R},P),pixelRatio:l,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E,sdf:h,version:0})}}updateImage(f,e){const a=this.style.getImage(f);if(!a)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?Ue.getImageData(e):e,{width:h,height:g,data:y}=l;if(h===void 0||g===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==a.data.width||g!==a.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return a.data.replace(y,w),this.style.updateImage(f,a),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return ii.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,a){return this.style.setLayerZoomRange(f,e,a),this._update(!0)}setFilter(f,e,a={}){return this.style.setFilter(f,e,a),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,a,l={}){return this.style.setPaintProperty(f,e,a,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,a,l={}){return this.style.setLayoutProperty(f,e,a,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,a,(l=>{l||this._update(!0)})),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,(a=>{a||this._update(!0)})),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(f,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=ve.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ve.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const h=this._controlContainer=ve.create("div","maplibregl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((y=>{g[y]=ve.create("div",`maplibregl-ctrl-${y} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,a){this._canvas.width=Math.floor(a*f),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,f):this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f),!a){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new ul(a,this.transform),Nt.testSupport(a)}migrateProjection(f,e){super.migrateProjection(f,e),this.painter.transform=f,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){var e,a,l,h,g;const y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,P=Ue.now();this.style.zoomHistory.update(R,P);const L=new d.F(R,{now:P,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=L.crossFadingFactor();U===1&&U===this._crossFadingFactor||(T=!0,this._crossFadingFactor=U),this.style.update(L)}const E=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cw.mark(d.cx.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,d.cw.mark(d.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ii.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ve.remove(this._canvasContainer),ve.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cw.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ue.frame(this._frameRequest,(f=>{d.cw.frame(f),this._frameRequest=null;try{this._render(f)}catch(e){if(!d.cy(e)&&!(function(a){return a.message===ic})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ki}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),this.style.setProjection(f),this._update(!0)}},D.MapMouseEvent=wr,D.MapTouchEvent=dl,D.MapWheelEvent=Ou,D.Marker=vl,D.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Yc,f),this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),ve.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),ve.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=ve.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new aa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ve.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const a=ve.create("button",f,this._container);return a.type="button",a.addEventListener("click",e),a}},D.Popup=class extends d.E{constructor(f){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ve.remove(this._content),this._container&&(ve.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ve.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ve.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=yl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=bl(this.options.offset);if(!l){const y=this._container.offsetWidth,w=this._container.offsetHeight;let T;T=a.y+h.bottom.y<w?["top"]:a.y>this._map.transform.height-w?["bottom"]:[],a.x<y/2?T.push("left"):a.x>this._map.transform.width-y/2&&T.push("right"),l=T.length===0?"bottom":T.join("-")}let g=a.add(h[l]);this.options.subpixelPositioning||(g=g.round()),ve.setTransform(this._container,`${Pi[l]} translate(${g.x}px,${g.y}px)`),Wi(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Ma),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.S.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=f;l=a.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ve.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=ve.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(xl);f&&f.focus()}},D.RasterDEMTileSource=rr,D.RasterTileSource=Da,D.ScaleControl=class{constructor(f){this._onMove=()=>{Ao(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ao(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Co),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ve.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},D.ScrollZoomHandler=ps,D.Style=Su,D.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ve.create("button","maplibregl-ctrl-terrain",this._container),ve.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ve.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},D.TwoFingersTouchPitchHandler=Mo,D.TwoFingersTouchRotateHandler=Zc,D.TwoFingersTouchZoomHandler=Vc,D.TwoFingersTouchZoomRotateHandler=$c,D.VectorTileSource=ua,D.VideoSource=eo,D.addSourceType=(f,e)=>d._(void 0,void 0,void 0,(function*(){if(ts(f))throw new Error(`A source type called "${f}" already exists.`);((a,l)=>{zs[a]=l})(f,e)})),D.clearPrewarmedResources=function(){const f=at;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(ue),at=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},D.createTileMesh=bu,D.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},D.getRTLTextPluginStatus=function(){return Mn().getRTLTextPluginStatus()},D.getVersion=function(){return uc},D.getWorkerCount=function(){return Ne.workerCount},D.getWorkerUrl=function(){return d.a.WORKER_URL},D.importScriptInWorkers=function(f){return Fn().broadcast("IS",f)},D.prewarm=function(){Jt().acquire(ue)},D.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},D.setRTLTextPlugin=function(f,e){return Mn().setRTLTextPlugin(f,e)},D.setWorkerCount=function(f){Ne.workerCount=f},D.setWorkerUrl=function(f){d.a.WORKER_URL=f}}));var Je=ye;return Je}))})(yp)),yp.exports}var Rm=Pm();const Ra=_m(Rm);var Up=lm();function Dm(Z){const re={},ye={},Y={};for(const _e in Z)if(_e.startsWith("on"))re[_e]=Z[_e];else if(hm.includes(_e))ye[_e]=Z[_e];else if(um.includes(_e))Y[_e]=Z[_e];else if(!_e.startsWith("initial")&&_e!=="container"&&_e!=="style")throw Error(`unknown map option key ${_e}`);return[Y,re,ye]}function xf(Z,re){const ye={},Y={};for(const _e in Z){if(re?.includes(_e)){Y[_e]=Z[_e];continue}if(_e.startsWith("on"))ye[_e]=Z[_e];else{const Je=_e.startsWith("initial")?_e[7].toLowerCase()+_e.substring(8):_e;if(Y[Je])throw new Error(`duplicate key ${Je}`);Y[Je]=Z[_e]}}return[Y,ye]}function bf(Z,re){return Object.keys(Z).filter(Y=>Z[Y]in re).sort()}function cd(Z,re){if(Z===re)return!0;if(!Z||!re)return!1;if(Array.isArray(Z)){if(!Array.isArray(re)||Z.length!==re.length)return!1;for(let ye=0;ye<Z.length;ye++)if(!cd(Z[ye],re[ye]))return!1;return!0}else if(Array.isArray(re))return!1;if(typeof Z=="object"&&typeof re=="object"){const ye=Object.keys(Z),Y=Object.keys(re);if(ye.length!==Y.length)return!1;for(const _e of ye)if(!Object.prototype.hasOwnProperty.call(re,_e)||!cd(Z[_e],re[_e]))return!1;return!0}return!1}function Im(Z,re){const ye=Array.isArray(Z)?Z[0]:Z?Z.x:0,Y=Array.isArray(Z)?Z[1]:Z?Z.y:0,_e=Array.isArray(re)?re[0]:re?re.x:0,Je=Array.isArray(re)?re[1]:re?re.y:0;return ye===_e&&Y===Je}function vp(Z,re,ye){re.forEach(Y=>{Y!==""&&ye.indexOf(Y)===-1&&Z.classList.remove(Y)}),ye.forEach(Y=>{Y!==""&&(re.indexOf(Y)===-1||!Z.classList.contains(Y))&&Z.classList.add(Y)})}function km(Z,re,ye,Y){Z.forEach(_e=>{_e!==""&&re.indexOf(_e)===-1&&Y(_e)}),re.forEach(_e=>{_e!==""&&Z.indexOf(_e)===-1&&ye(_e)})}function Lm(){const Z="abcdefghijklmnopqrstuvwxyz0123456789";let re="";for(let ye=0;ye<8;ye++){const Y=Math.floor(Math.random()*Z.length);re+=Z[Y]}return re}const em={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mouseout:"onMouseOut",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",click:"onClick",dblclick:"onDblClick",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchcancel:"onTouchCancel",touchmove:"onTouchMove",movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd",wheel:"onWheel",resize:"onResize",remove:"onRemove",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",webglcontextlost:"onWebglContextLost",webglcontextrestored:"onWebglContextRestored",load:"onLoad",render:"onRender",idle:"onIdle",error:"onError",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",dataloading:"onDataLoading",styledataloading:"onStyleDataLoading",sourcedataloading:"onSourceDataLoading",tiledataloading:"onTileDataLoading",styleimagemissing:"onStyleImageMissing",dataabort:"onDataAbort",sourcedataabort:"onSourceDataAbort",terrain:"onTerrain"},um=["maxBounds","minZoom","maxZoom","minPitch","maxPitch","renderWorldCopies","pixelRatio","centerClampedToGround"],hm=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch","cooperativeGestures"],tm="https://demotiles.maplibre.org/style.json";var Bm=class{reactiveOptions={};handlerOptions={};eventNames=[];callbacks;_map;padding;mapStyle;controlledSources={};controlledLayers={};controlledTerrain=null;constructor({mapStyle:Z=tm,padding:re},ye,Y){this.mapStyle=Z,this.padding=re;const[_e,Je]=xf(ye);this.callbacks=Je;const D={..._e,container:Y,style:Z},d=new Ra.Map(D);d.style.on("error",this._onStyleError),re&&d.setPadding(re),this._map=d,this._updateCallbacks(Je)}setProps({mapStyle:Z=tm,styleDiffing:re=!0,styleTransformStyle:ye,padding:Y},_e){const[Je,D,d]=Dm(_e);this._updateCallbacks(D),this._updateStyle(Z,{diff:re,transformStyle:ye}),this._updateReactiveOptions(Je,{padding:Y}),this._updateHandlers(d)}getControlledTerrain(){return this.controlledTerrain}setControlledTerrain(Z){this.controlledTerrain=Z}getControlledLayer(Z){return this.controlledLayers[Z]??null}setControlledLayer(Z,re){re?this.controlledLayers[Z]=re:delete this.controlledLayers[Z]}getControlledSource(Z){return this.controlledSources[Z]??null}setControlledSource(Z,re){re?this.controlledSources[Z]=re:delete this.controlledSources[Z]}_updateStyle(Z,re){const ye=this.mapStyle;Z!==ye&&(this.mapStyle=Z,this._map.setStyle(Z,{diff:re.diff,transformStyle:(Y,_e)=>{const Je=Y?Object.fromEntries(Object.entries(Y?.sources).filter(([Re])=>Re in this.controlledSources)):{},D=Y?Y.layers.filter(Re=>Re.id in this.controlledLayers):[],d={..._e,sources:{..._e.sources,...Je},layers:[..._e.layers,...D],terrain:this.controlledTerrain?Y?.terrain:_e.terrain};return re.transformStyle?re.transformStyle(Y,d):d}}))}_updateReactiveOptions(Z,{padding:re}){const ye=this.reactiveOptions;this.reactiveOptions=Z;for(const Y of um)if(Y in Z&&!cd(ye[Y],Z[Y])){const _e=`set${Y[0].toUpperCase()}${Y.substring(1)}`;this._map[_e](Z[Y])}re&&!cd(this.padding,re)&&this._map.setPadding(re),this.padding=re}_updateCallbacks(Z={}){this.callbacks=Z;const re=bf(em,Z);this.eventNames.join("-")!==re.join("-")&&(km(this.eventNames,re,ye=>this._map.on(ye,this._onMapEvent),ye=>this._map.off(ye,this._onMapEvent)),this.eventNames=re)}_updateHandlers(Z){const re=this.handlerOptions;this.handlerOptions=Z;for(const ye of hm){const Y=Z[ye]??!0,_e=re[ye]??!0;cd(Y,_e)||(Y?this._map[ye].enable(Y):this._map[ye].disable())}}_onStyleError=Z=>{Z.error.name!=="AbortError"&&console.error(Z.error)};_onMapEvent=Z=>{const re=Z.type,ye=em[re];this.callbacks[ye]?this.callbacks[ye]?.(Z):console.info("not managed RMap event",re,Z)};get map(){return this._map}destroy(){this._updateCallbacks(),this._map.remove()}};const Bp=typeof window<"u"?rt.useLayoutEffect:rt.useEffect;var Om=class{_maps={};_listeners={};add(Z,re){this._maps[Z]=re,this._listeners[Z]?.forEach(([ye,Y])=>{ye||Y(!0)})}remove(Z){delete this._maps[Z],this._listeners[Z]?.forEach(([re,ye])=>{re&&ye(!1)})}get(Z){return Z?this._maps[Z]??null:null}addListener(Z,re){this._listeners[Z]?this._listeners[Z].push(re):this._listeners[Z]=[re];const ye=!!this._maps[Z];re[0]!==ye&&re[1](ye)}removeListener(Z,[,re]){this._listeners[Z]=this._listeners[Z].filter(([,ye])=>ye!==re)}};const Fp=rt.createContext(null),dm=rt.createContext(null),im={height:"100%"},Fm=rt.forwardRef(function({children:re,style:ye,id:Y,className:_e,onMounted:Je,mapStyle:D,styleDiffing:d,styleTransformStyle:Re,padding:Ie,...Ye},et){const Ue=rt.useRef(null),ve=rt.useRef(!0),Nt=rt.useRef(Y??Lm());if(Y&&Y!==Nt.current)throw new Error(`RMap id should not change. "${Y}" "${Nt.current}". If you defined id as const string add a "key" prop to your RMap component`);const Gt=Nt.current,Ht=rt.useContext(Fp),pi=rt.useRef(null);!Ht&&!pi.current&&(pi.current=new Om);const zt=Ht?Ht.current:pi.current,[,Ct]=rt.useState(0);Bp(()=>{const mt=zt.get(Gt);if(mt)ve.current?mt.setProps({mapStyle:D,padding:Ie,styleDiffing:d,styleTransformStyle:Re},Ye):ve.current=!0;else{const Qt=new Bm({mapStyle:D,styleDiffing:d,padding:Ie},Ye,Ue.current);zt.add(Gt,Qt),Je&&Je(Qt.map),Ct(vi=>vi+1),ve.current=!1}}),Bp(()=>()=>{const mt=zt.get(Gt);mt&&(mt.destroy(),zt.remove(Gt))},[]),rt.useImperativeHandle(et,()=>zt.get(Gt)?.map||null,[Gt,zt]),Bp(()=>{if(!_e)return;const mt=Ue.current;return _e.split(" ").map(Qt=>mt.classList.add(Qt)),()=>void _e.split(" ").map(Qt=>mt.classList.remove(Qt))},[_e]);const ii=rt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...ye}),[ye]);return fn.jsx("div",{ref:Ue,id:Gt,style:ii,children:zt.get(Gt)&&fn.jsx(dm.Provider,{value:Gt,children:Ht?fn.jsx("div",{className:"maplibregl-children",style:im,children:re}):fn.jsx(Fp.Provider,{value:pi,children:fn.jsx("div",{className:"maplibregl-children",style:im,children:re})})})})});function Np(Z){const re=rt.useContext(Fp),Y=rt.useContext(dm),_e=re?.current.get(Y)??null,Je=rt.useState(_e!==null);if(!re?.current)throw new Error("use useMapManager in components inside <RMap /> or inside <RMapContextProvider />");if(!Y)throw new Error("provide an id to useMap or use inside <RMap />");return rt.useEffect(()=>{const D=re.current;if(!D)throw new Error("mapManagers can't disappear");return D.addListener(Y,Je),()=>{D.removeListener(Y,Je)}},[Y,re,Je,_e]),_e}function wf(Z){return Np()?.map??null}const nm={dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",click:"onClick"};rt.memo(rt.forwardRef(function(re,ye){const{longitude:Y,latitude:_e,children:Je,...D}=re,d=wf(),[Re,Ie]=xf(D),Ye=rt.useRef(Re),et=rt.useRef(null);et.current=Ie;const Ue=rt.useMemo(()=>{const Oi={...Re,element:Je?document.createElement("div"):void 0},Ji=new Ra.Marker(Oi);return Ji.setLngLat([Y,_e]),Ji},[]),ve=bf(nm,Ie).join("-");rt.useEffect(()=>{function Oi(xi){const on=xi.type,ri=nm[on];et.current?.[ri]?et.current[ri]?.(xi):console.info("not managed RMarker event",on,xi)}const Ji=ve.split("-");return Ji.forEach(xi=>{xi==="click"?Ue.getElement().addEventListener("click",Oi):Ue.on(xi,Oi)}),()=>{Ji.forEach(xi=>{xi==="click"?Ue.getElement().removeEventListener("click",Oi):Ue.off(xi,Oi)})}},[ve,Ue]),rt.useEffect(()=>(Ue.addTo(d),()=>void Ue.remove()),[]);const{className:Nt,offset:Gt,draggable:Ht,clickTolerance:pi=0,rotation:zt,rotationAlignment:Ct,subpixelPositioning:ii=!1,pitchAlignment:mt,opacity:Qt,opacityWhenCovered:vi}=Re;return rt.useImperativeHandle(ye,()=>Ue,[Ue]),Ye.current.className!==Nt&&vp(Ue._element,Ye.current.className?.split(" ")||[],Nt?.split(" ")||[]),(Ue.getLngLat().lng!==Y||Ue.getLngLat().lat!==_e)&&Ue.setLngLat([Y,_e]),Gt&&!Im(Ue.getOffset(),Gt)&&Ue.setOffset(Gt),Ue.isDraggable()!==Ht&&Ue.setDraggable(Ht),Ue._clickTolerance!==pi&&(Ue._clickTolerance=pi),Ue.getRotation()!==zt&&Ue.setRotation(zt),Ue.getRotationAlignment()!==Ct&&Ue.setRotationAlignment(Ct),Ue.getPitchAlignment()!==mt&&Ue.setPitchAlignment(mt),(Ue._opacity!==Qt||Ue._opacityWhenCovered!==vi)&&Ue.setOpacity(Qt,vi),Ue.setSubpixelPositioning&&Ue._subpixelPositioning!==ii&&Ue.setSubpixelPositioning(ii),Ye.current=Re,Je?Up.createPortal(Je,Ue.getElement()):null}));const Op={map_click:"onMapClick",map_move:"onMapMove"};rt.memo(rt.forwardRef(function(re,ye){const{longitude:Y,latitude:_e,children:Je,...D}=re,d=wf(),[Re,Ie]=xf(D),Ye=rt.useRef(null),et=rt.useRef(Re),Ue=rt.useRef(null);Ue.current=Ie;const ve=rt.useMemo(()=>document.createElement("div"),[]);Ye.current||(Ye.current=new Ra.Popup({...Re,closeButton:!1,closeOnClick:!1,closeOnMove:!1}),Y!==void 0&&_e!==void 0&&Ye.current.setLngLat([Y,_e]));const Nt=bf(Op,Ie).join("-");rt.useEffect(()=>{function zt(mt){const Qt=mt.type,vi=Op[Qt]||Op[`map_${Qt}`];Ue.current?.[vi]?Ue.current[vi]?.(mt):console.info("not managed RPopup event",Qt,mt)}if(Nt==="")return;const Ct=Nt.split("-"),ii=Ye.current;return Ct.forEach(mt=>{mt.startsWith("map_")?d.on(mt.substring(4),zt):ii.on(mt,zt)}),()=>{Ct.forEach(mt=>{mt.startsWith("map_")?d.off(mt.substring(4),zt):ii.off(mt,zt)})}},[Nt,d]),rt.useEffect(()=>(Ye.current.setDOMContent(ve).addTo(d),()=>void Ye.current.remove()),[ve,d]);const{offset:Gt,maxWidth:Ht="240px",className:pi}=Re;return rt.useImperativeHandle(ye,()=>Ye.current,[Ye]),Ye.current.isOpen()&&(Y!==void 0&&_e!==void 0&&(Ye.current.getLngLat().lng!==Y||Ye.current.getLngLat().lat!==_e)&&Ye.current.setLngLat([Y,_e]),Gt&&!cd(Ye.current.options.offset,Gt)&&Ye.current.setOffset(Gt),et.current.className!==pi&&vp(ve,et.current.className?.split(" ")||[],pi?.split(" ")||[]),Ye.current.getMaxWidth()!==Ht&&Ye.current.setMaxWidth(Ht)),et.current=Re,Up.createPortal(Je,ve)}));const rm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mouseout:"onMouseOut",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",click:"onClick",dblclick:"onDblClick",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchcancel:"onTouchCancel",touchmove:"onTouchMove"};function jm(Z,re,ye){if(Z.style?._loaded&&(re.type==="background"||re.type==="custom"||re.source&&Z.getSource(re.source)))return Z.addLayer(re,ye&&Z.getLayer(ye)?ye:void 0),Z.getLayer(re.id)}function Um(Z,{beforeId:re,...ye},{beforeId:Y,..._e}){if(_e.type==="custom"||ye.type==="custom")return;Y!==re&&Z.moveLayer(ye.id,re),ye.type!=="background"&&ye.type!=="custom"&&_e.filter!==ye.filter&&Z.setFilter(ye.id,ye.filter);const Je=_e,D=ye;if(Je.layout!==D.layout){if(D.layout)for(const d of Object.keys(D.layout))D.layout[d]!==Je.layout?.[d]&&Z.setLayoutProperty(ye.id,d,D.layout[d]);for(const d in Je.layout)Object.prototype.hasOwnProperty.call(D.layout,d)||Z.setLayoutProperty(ye.id,d,void 0)}if(Je.paint!==D.paint){if(D.paint)for(const d of Object.keys(D.paint))D.paint[d]!==Je.paint?.[d]&&Z.setPaintProperty(ye.id,d,D.paint[d]);for(const d in Je.paint)Object.prototype.hasOwnProperty.call(D.paint,d)||Z.setPaintProperty(ye.id,d,void 0)}(Je.minzoom!==D.minzoom||Je.maxzoom!==D.maxzoom)&&D.minzoom&&D.maxzoom&&Z.setLayerZoomRange(ye.id,D.minzoom,D.maxzoom)}rt.memo(rt.forwardRef(function(re,ye){const{beforeId:Y,..._e}=re,[Je,D]=xf(_e,["onAdd"]),d=Je.id,Re=Np();if(!Re)throw new Error("use <RLayer /> component inside <RMap />");const Ie=Re.map,Ye=rt.useRef(d);if(d!==Ye.current)throw new Error(`RLayer id should not change. "${d}" "${Ye.current}". If you defined id as const string add a "key" prop to your RLayer component`);const et=Re.getControlledLayer(d)??re,[,Ue]=rt.useState(0),ve=rt.useCallback(()=>Ue(pi=>pi+1),[]);if(re.type!==et.type)throw new Error(`RLayer type should not change. "${re.type}" "${et.type}"`);const Nt=rt.useRef(null);Nt.current=D,rt.useEffect(()=>(Ie.on("styledata",ve),Ie.style&&Ie.style._loaded&&ve(),()=>{Ie.off("styledata",ve),Ie.style&&Ie.style._loaded&&Ie.getLayer(d)&&Ie.removeLayer(d),Re?.setControlledLayer(d,null)}),[Ie,d,Re,ve]);const Gt=bf(rm,D).join("-");rt.useEffect(()=>{function pi(Ct){const ii=Ct.type,mt=rm[ii];Nt.current?.[mt]?Nt.current[mt]?.(Ct):console.info("not managed RLayer event",ii,Ct)}const zt=Gt.split("-");return zt.forEach(Ct=>{Ie.on(Ct,d,pi)}),()=>{zt.forEach(Ct=>{Ie.off(Ct,d,pi)})}},[Gt,d,Ie]);let Ht=Ie.style?._loaded&&Ie.getLayer(d);return Ht?Um(Ie,re,et):(Ht=jm(Ie,Je,Y),Ht&&Ie.off("styledata",ve)),rt.useImperativeHandle(ye,()=>Ht||null,[Ht]),Re.setControlledLayer(d,re),null}));function Nm(Z,re,ye){if(Z.style?._loaded)return Z.addSource(re,ye),Z.getSource(re)}function Vm(Z,re,ye){switch(re.type){case"image":{const Y=ye,_e=re;Y.url!==_e.url&&Z.updateImage({url:_e.url,coordinates:_e.coordinates}),Y.coordinates!==_e.coordinates&&Z.setCoordinates(_e.coordinates);break}case"video":{const Y=ye,_e=re;Y.coordinates!==_e.coordinates&&Z.setCoordinates(_e.coordinates);break}case"geojson":{const Y=ye,_e=re;Y.data!==_e.data&&Z.setData(_e.data),(Y.cluster!==_e.cluster||Y.clusterMaxZoom!==_e.clusterMaxZoom||Y.clusterRadius!==_e.clusterRadius)&&Z.setClusterOptions({cluster:_e.cluster,clusterMaxZoom:_e.clusterMaxZoom,clusterRadius:_e.clusterRadius});break}case"raster":case"raster-dem":case"vector":{const Y=ye,_e=re;Y.tiles!==_e.tiles&&_e.tiles&&Z.setTiles(_e.tiles),Y.url!==_e.url&&_e.url&&Z.setUrl(_e.url);break}}}rt.memo(rt.forwardRef(function(re,ye){const{id:Y,..._e}=re,Je=Np(),D=Je.map,d=rt.useRef(Y);if(Y!==d.current)throw new Error(`RSource id should not change. "${Y}" "${d.current}". If you defined id as const string add a "key" prop to your RSource component`);const{id:Re,...Ie}=Je.getControlledSource(Y)??re;if(_e.type!==Ie.type)throw new Error(`RSource type should not change. "${_e.type}" "${Ie.type}"`);const[,Ye]=rt.useState(0),et=rt.useCallback(()=>void setTimeout(()=>Ye(ve=>ve+1),0),[]);rt.useEffect(()=>(D.on("styledata",et),D.style&&D.style._loaded&&et(),()=>{if(D.off("styledata",et),D.style&&D.getSource(Y)){const ve=D.getStyle()?.layers;if(ve)for(const Nt of ve)Nt.type!=="background"&&Nt.type!=="custom"&&Nt.source===Y&&D.removeLayer(Nt.id);D.removeSource(Y)}Je?.setControlledSource(Y,null)}),[D,Y,Je,et]);let Ue=D.style?._loaded&&D.getSource(Y);return Ue?Vm(Ue,_e,Ie):(Ue=Nm(D,Y,_e),Ue&&D.off("styledata",et)),rt.useImperativeHandle(ye,()=>Ue||null,[Ue]),Je.setControlledSource(Y,re),null}));function _u(Z,re){this.x=Z,this.y=re}_u.prototype={clone(){return new _u(this.x,this.y)},add(Z){return this.clone()._add(Z)},sub(Z){return this.clone()._sub(Z)},multByPoint(Z){return this.clone()._multByPoint(Z)},divByPoint(Z){return this.clone()._divByPoint(Z)},mult(Z){return this.clone()._mult(Z)},div(Z){return this.clone()._div(Z)},rotate(Z){return this.clone()._rotate(Z)},rotateAround(Z,re){return this.clone()._rotateAround(Z,re)},matMult(Z){return this.clone()._matMult(Z)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(Z){return this.x===Z.x&&this.y===Z.y},dist(Z){return Math.sqrt(this.distSqr(Z))},distSqr(Z){const re=Z.x-this.x,ye=Z.y-this.y;return re*re+ye*ye},angle(){return Math.atan2(this.y,this.x)},angleTo(Z){return Math.atan2(this.y-Z.y,this.x-Z.x)},angleWith(Z){return this.angleWithSep(Z.x,Z.y)},angleWithSep(Z,re){return Math.atan2(this.x*re-this.y*Z,this.x*Z+this.y*re)},_matMult(Z){const re=Z[0]*this.x+Z[1]*this.y,ye=Z[2]*this.x+Z[3]*this.y;return this.x=re,this.y=ye,this},_add(Z){return this.x+=Z.x,this.y+=Z.y,this},_sub(Z){return this.x-=Z.x,this.y-=Z.y,this},_mult(Z){return this.x*=Z,this.y*=Z,this},_div(Z){return this.x/=Z,this.y/=Z,this},_multByPoint(Z){return this.x*=Z.x,this.y*=Z.y,this},_divByPoint(Z){return this.x/=Z.x,this.y/=Z.y,this},_unit(){return this._div(this.mag()),this},_perp(){const Z=this.y;return this.y=this.x,this.x=-Z,this},_rotate(Z){const re=Math.cos(Z),ye=Math.sin(Z),Y=re*this.x-ye*this.y,_e=ye*this.x+re*this.y;return this.x=Y,this.y=_e,this},_rotateAround(Z,re){const ye=Math.cos(Z),Y=Math.sin(Z),_e=re.x+ye*(this.x-re.x)-Y*(this.y-re.y),Je=re.y+Y*(this.x-re.x)+ye*(this.y-re.y);return this.x=_e,this.y=Je,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:_u};_u.convert=function(Z){if(Z instanceof _u)return Z;if(Array.isArray(Z))return new _u(+Z[0],+Z[1]);if(Z.x!==void 0&&Z.y!==void 0)return new _u(+Z.x,+Z.y);throw new Error("Expected [x, y] or {x, y} point format")};var Th=class Sn{static docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style;static userSelect;static selectProp=Sn.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);static transformProp=Sn.testProp(["transform","WebkitTransform"]);static testProp(re){if(!Sn.docStyle)return re[0];for(let ye=0;ye<re.length;ye++)if(re[ye]in Sn.docStyle)return re[ye];return re[0]}static create(re,ye,Y){const _e=window.document.createElement(re);return ye!==void 0&&(_e.className=ye),Y&&Y.appendChild(_e),_e}static createNS(re,ye){return window.document.createElementNS(re,ye)}static disableDrag(){Sn.docStyle&&Sn.selectProp&&(Sn.userSelect=Sn.docStyle[Sn.selectProp],Sn.docStyle[Sn.selectProp]="none")}static enableDrag(){Sn.docStyle&&Sn.selectProp&&(Sn.docStyle[Sn.selectProp]=Sn.userSelect)}static setTransform(re,ye){re.style[Sn.transformProp]=ye}static addEventListener(re,ye,Y,_e={}){"passive"in _e?re.addEventListener(ye,Y,_e):re.addEventListener(ye,Y,_e.capture)}static removeEventListener(re,ye,Y,_e={}){"passive"in _e?re.removeEventListener(ye,Y,_e):re.removeEventListener(ye,Y,_e.capture)}static suppressClickInternal(re){re.preventDefault(),re.stopPropagation(),window.removeEventListener("click",Sn.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Sn.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Sn.suppressClickInternal,!0)},0)}static getScale(re){const ye=re.getBoundingClientRect();return{x:ye.width/re.offsetWidth||1,y:ye.height/re.offsetHeight||1,boundingClientRect:ye}}static getPoint(re,ye,Y){const _e=ye.boundingClientRect;return new _u((Y.clientX-_e.left)/ye.x-re.clientLeft,(Y.clientY-_e.top)/ye.y-re.clientTop)}static mousePos(re,ye){const Y=Sn.getScale(re);return Sn.getPoint(re,Y,ye)}static touchPos(re,ye){const Y=[],_e=Sn.getScale(re);for(let Je=0;Je<ye.length;Je++)Y.push(Sn.getPoint(re,_e,ye[Je]));return Y}static mouseButton(re){return re.button}static remove(re){re.parentNode&&re.parentNode.removeChild(re)}};const am="#ffe64b",sm=50;var Zm=class extends Ra.Marker{_interactive;_shape;_icon;_height=sm;_text;_circleElement=null;_iconElement=null;_textElement=null;_markerElement;constructor(Z){Z??={},Z.element=Th.create("div","maplibregl-gradient-marker"),Z.className&&Z.element.classList.add(Z.className),super(Z),this._draggable&&this._element.classList.add("draggable"),this._interactive=Z&&Z.interactive===!1?!1:"pending",this._shape=(Z&&Z.shape)??"pin",this._color=(Z&&Z.color)??am,this._icon=Z&&Z.icon,this._text=Z&&Z.text,this._defaultMarker=!0,this._element.setAttribute("aria-label","Map marker"),this._element.setAttribute("tabindex","0"),this.setScale(this._scale),this.setColor(this._color),this._markerElement=Th.create("div","marker"),this.setShape(this._shape),this._text?this.setText(this._text):this._icon&&this.setIcon(this._icon);const re=Th.create("div","target");this._element.appendChild(this._markerElement),this._element.appendChild(re)}_onActive=()=>{this._map.getContainer().addEventListener("mouseup",this._onInactive,{once:!0}),this._map.getContainer().addEventListener("touchend",this._onInactive,{once:!0}),this._element.classList.add("active")};_onInactive=()=>{this._element.classList.remove("active")};addTo(Z){return Ra.Marker.prototype.addTo.apply(this,[Z]),this._interactive==="pending"&&this.setInteractive(!0),this}setInteractive(Z=!0){this._interactive!==Z&&(this._interactive=Z,Z?this._element.dataset.interactive="":delete this._element.dataset.interactive,Z?(this._element.addEventListener("mousedown",this._onActive),this._element.addEventListener("touchstart",this._onActive)):(this._element.removeEventListener("mousedown",this._onInactive),this._element.removeEventListener("touchstart",this._onInactive)))}getInteractive(){return this._interactive}remove(){return this._map&&this.setInteractive(!1),Ra.Marker.prototype.remove.apply(this),this}setIcon(Z){return this.resetIconText(),this._icon=Z,Z?(this._circleElement=Th.create("div","circle",this._markerElement),typeof Z=="string"?(this._iconElement=Th.create("i",Z,this._markerElement),this._iconElement.className=Z||""):typeof Z=="function"?(this._iconElement=Z(),this._markerElement?.append(this._iconElement)):(this._iconElement=Z,this._markerElement?.append(Z)),this):this}getIcon(){return this._icon}resetIconText(){this._circleElement?.remove(),this._iconElement?.remove(),this._textElement?.remove(),this._circleElement=null,this._iconElement=null,this._textElement=null}setText(Z){return this.resetIconText(),this._text=Z,Z?(this._circleElement=Th.create("div","circle",this._markerElement),this._textElement=Th.create("div","text",this._markerElement),this._textElement.innerText=Z,this):this}getText(){return this._text}setColor(Z){return this._color=Z||am,this._element.style.setProperty("--marker-color",this._color),this}getColor(){return this._color}setScale(Z=1,re=sm){return this._scale=Z,this._height=re*this._scale,this._element.style.setProperty("--marker-scale",Z.toString()),this}getScale(){return this._scale}setShape(Z){return this._shape=Z||"pin",this._anchor=this._shape==="circle"?"center":"bottom",this._element.dataset.shape=this._shape,this._update(),this}getShape(){return this._shape}setDraggable(Z){return Ra.Marker.prototype.setDraggable.apply(this,[Z]),this._element.classList.toggle("draggable",Z),this}};const om={dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",click:"onClick"};rt.memo(rt.forwardRef(function(re,ye){const{longitude:Y,latitude:_e,...Je}=re,D=wf(),[d,Re]=xf(Je),Ie=rt.useRef(d),Ye=rt.useRef(null);Ye.current=Re;const et=rt.useMemo(()=>{const ri=new Zm({...d,anchor:"bottom"});return ri.setLngLat([Y,_e]),ri},[]),Ue=bf(om,Re).join("-");rt.useEffect(()=>{function ri(pn){const Zi=pn.type,Be=om[Zi];Ye.current?.[Be]?Ye.current[Be]?.(pn):console.info("not managed RGradientMarker event",Zi,pn)}const Xn=Ue.split("-");return Xn.forEach(pn=>{pn==="click"?et.getElement().addEventListener("click",ri):et.on(pn,ri)}),()=>{Xn.forEach(pn=>{pn==="click"?et.getElement().removeEventListener("click",ri):et.off(pn,ri)})}},[Ue,et]),rt.useEffect(()=>(et.addTo(D),()=>void et.remove()),[]);const{scale:ve,color:Nt,text:Gt,icon:Ht,interactive:pi,className:zt,draggable:Ct,clickTolerance:ii=0,rotation:mt,rotationAlignment:Qt,subpixelPositioning:vi=!1,pitchAlignment:Oi,shape:Ji,opacity:xi,opacityWhenCovered:on}=d;return rt.useImperativeHandle(ye,()=>et,[et]),Ie.current.className!==zt&&vp(et._element,Ie.current.className?.split(" ")||[],zt?.split(" ")||[]),et.getInteractive()!==pi&&et.setInteractive(pi),et.getShape()!==Ji&&et.setShape(Ji),(et.getLngLat().lng!==Y||et.getLngLat().lat!==_e)&&et.setLngLat([Y,_e]),et.isDraggable()!==Ct&&et.setDraggable(Ct),et._clickTolerance!==ii&&(et._clickTolerance=ii),et.getRotation()!==mt&&et.setRotation(mt),et.getRotationAlignment()!==Qt&&et.setRotationAlignment(Qt),et.getPitchAlignment()!==Oi&&et.setPitchAlignment(Oi),(et._opacity!==xi||et._opacityWhenCovered!==on)&&et.setOpacity(xi,on),et.setSubpixelPositioning&&et._subpixelPositioning!==vi&&et.setSubpixelPositioning(vi),et.getColor()!==Nt&&et.setColor(Nt),et.getScale()!==ve&&et.setScale(ve),et.getText()!==Gt&&et.setText(Gt),et.getIcon()!==Ht&&et.setIcon(Ht),Ie.current=d,null}));function Gm({position:Z,className:re="maplibregl-ctrl maplibregl-ctrl-group"}){const ye=wf(),Y=rt.useRef(null),_e=rt.useRef({className:re});if(!Y.current){const Je=document.createElement("div");Je.className=re,Y.current=Je}return rt.useEffect(()=>{const Je=Y.current;if(Je&&!Je.parentElement){const D=ye._controlPositions[Z];if(!D)throw new Error(`Unable to add control, position ${Z} doesn't exists`);Z.indexOf("bottom")!==-1?D.insertBefore(Je,D.firstChild):D.appendChild(Je)}return()=>{Y.current&&Y.current.remove()}},[ye,Z]),_e.current.className!==re&&vp(Y.current,_e.current.className?.split(" ")||[],re?.split(" ")||[]),_e.current={className:re},{container:Y.current}}function qm({height:Z=27}){const[re,ye]=rt.useState("25s");return fn.jsxs("svg",{width:Z*21/27,height:Z,viewBox:"-10.5 -10.5 21 27",fill:"none",version:"1.1",id:"svg3",xmlns:"http://www.w3.org/2000/svg",onMouseEnter:()=>ye("2s"),onMouseLeave:()=>ye("25s"),children:[fn.jsx("path",{fill:"#82b4fe",fillRule:"evenodd",d:"m 0.04378077,-7.0160133 c -3.95934197,-0.025693 -7.19979577,2.9709105 -7.22395607,6.67957072 -0.021351,3.28396108 1.6024867,4.88716988 3.3609363,6.62322508 1.2259466,1.2102943 2.5172339,2.4851233 3.36206037,4.4390285 0.056993,0.04631 0.095121,0.07722 0.1114948,0.09183 a 0.41450831,0.41450831 0 0 0 0.2727553,0.103225 0.41515047,0.41515047 0 0 0 0.2741963,-0.09961 c 0.00438,-0.0039 0.012527,-0.0074 0.022479,-0.01165 0.027304,-0.01171 0.068791,-0.02955 0.090222,-0.0789 C 1.1559887,8.7954149 2.4656545,7.5377628 3.7164045,6.3367792 5.4974902,4.626493 7.158975,3.0309869 7.1802478,-0.24301718 7.2043965,-3.9517594 4.0032063,-6.9901745 0.04378537,-7.016023 Z m -0.06903,10.6235008 C 1.9352357,3.6202595 3.5351559,2.0173639 3.5480768,0.02733852 3.5610008,-1.9626869 1.9821136,-3.5862858 0.02154667,-3.5990486 -1.9390213,-3.6118206 -3.5388592,-2.0089214 -3.5518634,-0.01889648 -3.5647874,1.9711289 -1.9858982,3.5947246 -0.02533123,3.6074875 Z"}),fn.jsx("path",{fill:"currentColor",d:"m -2.4911489,12.068709 c -0.3270955,-0.0022 -0.5946317,0.359604 -0.5975214,0.807906 l -0.014767,2.269118 c -0.00295,0.448302 0.2598305,0.813445 0.587006,0.815611 l 5.0075702,0.03259 c 0.3270965,0.0022 0.5946306,-0.359606 0.5975218,-0.807909 l 0.014775,-2.269117 c 0.00304,-0.44838 -0.259831,-0.813523 -0.5870064,-0.815609 z"}),fn.jsxs("g",{children:[fn.jsx("circle",{cx:"0",cy:"0",r:"2",fill:"currentColor",id:"circle1"}),fn.jsxs("g",{stroke:"currentColor",strokeWidth:"1",fill:"none",id:"g3",children:[fn.jsx("ellipse",{rx:"10",ry:"4.5",id:"ellipse1",cx:"0",cy:"0"}),fn.jsx("ellipse",{rx:"10",ry:"4.5",transform:"rotate(60)",id:"ellipse2",cx:"0",cy:"0"}),fn.jsx("ellipse",{rx:"10",ry:"4.5",transform:"rotate(120)",id:"ellipse3",cx:"0",cy:"0"})]}),fn.jsx("animateTransform",{attributeName:"transform",type:"rotate",dur:re,values:"0 0 0;360 0 0;",repeatCount:"indefinite"})]})]})}rt.memo(function({position:re="bottom-left"}){const{container:ye}=Gm({position:re,className:"maplibregl-ctrl maplibregl-ctrl-mrc-logo"});return Up.createPortal(fn.jsx("a",{target:"_blank",rel:"noopener nofollow",href:"https://maplibre-react-components.pentatrion.com","aria-label":"MapLibre React components logo",children:fn.jsx(qm,{height:30})}),ye)});function Hm(Z){const re=rt.useRef(()=>{throw new Error("Cannot call an event handler while rendering.")});return re.current=Z,rt.useCallback((...ye)=>re.current?.(...ye),[re])}function yu({position:Z="top-right",factory:re,onRemove:ye}){const Y=wf(),_e=rt.useMemo(()=>re(Y),[Y]),Je=Hm(ye||null);return rt.useEffect(()=>(Y.hasControl(_e)||Y.addControl(_e,Z),()=>{Je&&Je(Y),Y.hasControl(_e)&&Y.removeControl(_e)}),[Y,_e,Je,Z]),_e}rt.memo(rt.forwardRef(function({position:re="bottom-right",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.AttributionControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));rt.memo(rt.forwardRef(function({position:re="top-right",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.FullscreenControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));rt.memo(rt.forwardRef(function({position:re="top-right",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.GeolocateControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));rt.memo(rt.forwardRef(function({position:re="top-right"},ye){const Y=yu({position:re,factory:()=>new Ra.GlobeControl});return rt.useImperativeHandle(ye,()=>Y),null}));rt.memo(rt.forwardRef(function({position:re="bottom-left",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.LogoControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));rt.memo(rt.forwardRef(function({position:re="top-right",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.NavigationControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));rt.memo(rt.forwardRef(function({position:re="bottom-left",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.ScaleControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));rt.memo(rt.forwardRef(function({position:re="top-right",...ye},Y){const _e=yu({position:re,factory:()=>new Ra.TerrainControl(ye)});return rt.useImperativeHandle(Y,()=>_e),null}));const $m=[6.4546,46.1067];function Xm(){return fn.jsx("div",{style:{position:"relative",height:"400px",width:"100%"},children:fn.jsx(Fm,{minZoom:6,initialCenter:$m,initialZoom:8,mapStyle:"https://openmaptiles.geo.data.gouv.fr/styles/osm-bright/style.json",style:{height:"100%",width:"100%"}})})}const Ym={overflow:"hidden"};function Km(){return fn.jsxs("div",{style:Ym,children:[fn.jsx(Am,{}),fn.jsx(Xm,{})]})}Em.createRoot(document.getElementById("root")).render(fn.jsx(rt.StrictMode,{children:fn.jsx(Km,{})}));
